# LogicTest: local

statement ok
CREATE DATABASE a

statement ok
CREATE USER readwrite

statement ok
GRANT ALL ON DATABASE a TO readwrite

query TTTT colnames
SHOW GRANTS ON DATABASE a
----
database_name  schema_name         grantee    privilege_type
a              information_schema  admin      ALL
a              information_schema  readwrite  ALL
a              information_schema  root       ALL
a              kwdb_internal       admin      ALL
a              kwdb_internal       readwrite  ALL
a              kwdb_internal       root       ALL
a              pg_catalog          admin      ALL
a              pg_catalog          readwrite  ALL
a              pg_catalog          root       ALL
a              public              admin      ALL
a              public              readwrite  ALL
a              public              root       ALL

# Show that by default GRANT is restricted to the current database
query TTTTTT colnames
SHOW GRANTS
----
database_name  schema_name         table_name                         procedure_name  grantee  privilege_type
test           information_schema  NULL                               NULL            admin    ALL
test           information_schema  NULL                               NULL            root     ALL
test           information_schema  administrable_role_authorizations  NULL            public   SELECT
test           information_schema  applicable_roles                   NULL            public   SELECT
test           information_schema  check_constraints                  NULL            public   SELECT
test           information_schema  column_privileges                  NULL            public   SELECT
test           information_schema  columns                            NULL            public   SELECT
test           information_schema  constraint_column_usage            NULL            public   SELECT
test           information_schema  enabled_roles                      NULL            public   SELECT
test           information_schema  key_column_usage                   NULL            public   SELECT
test           information_schema  parameters                         NULL            public   SELECT
test           information_schema  procedure_privileges               NULL            public   SELECT
test           information_schema  referential_constraints            NULL            public   SELECT
test           information_schema  role_table_grants                  NULL            public   SELECT
test           information_schema  routines                           NULL            public   SELECT
test           information_schema  schema_privileges                  NULL            public   SELECT
test           information_schema  schemata                           NULL            public   SELECT
test           information_schema  sequences                          NULL            public   SELECT
test           information_schema  statistics                         NULL            public   SELECT
test           information_schema  table_constraints                  NULL            public   SELECT
test           information_schema  table_privileges                   NULL            public   SELECT
test           information_schema  tables                             NULL            public   SELECT
test           information_schema  user_privileges                    NULL            public   SELECT
test           information_schema  views                              NULL            public   SELECT
test           kwdb_internal       NULL                               NULL            admin    ALL
test           kwdb_internal       NULL                               NULL            root     ALL
test           kwdb_internal       audit_policies                     NULL            public   SELECT
test           kwdb_internal       backward_dependencies              NULL            public   SELECT
test           kwdb_internal       builtin_functions                  NULL            public   SELECT
test           kwdb_internal       cluster_queries                    NULL            public   SELECT
test           kwdb_internal       cluster_sessions                   NULL            public   SELECT
test           kwdb_internal       cluster_settings                   NULL            public   SELECT
test           kwdb_internal       cluster_transactions               NULL            public   SELECT
test           kwdb_internal       create_statements                  NULL            public   SELECT
test           kwdb_internal       feature_usage                      NULL            public   SELECT
test           kwdb_internal       forward_dependencies               NULL            public   SELECT
test           kwdb_internal       gossip_alerts                      NULL            public   SELECT
test           kwdb_internal       gossip_liveness                    NULL            public   SELECT
test           kwdb_internal       gossip_network                     NULL            public   SELECT
test           kwdb_internal       gossip_nodes                       NULL            public   SELECT
test           kwdb_internal       index_columns                      NULL            public   SELECT
test           kwdb_internal       jobs                               NULL            public   SELECT
test           kwdb_internal       kv_node_status                     NULL            public   SELECT
test           kwdb_internal       kv_store_status                    NULL            public   SELECT
test           kwdb_internal       kwdb_attributes                    NULL            public   SELECT
test           kwdb_internal       kwdb_functions                     NULL            public   SELECT
test           kwdb_internal       kwdb_object_create_statement       NULL            public   SELECT
test           kwdb_internal       kwdb_procedures                    NULL            public   SELECT
test           kwdb_internal       kwdb_retention                     NULL            public   SELECT
test           kwdb_internal       kwdb_schedules                     NULL            public   SELECT
test           kwdb_internal       kwdb_streams                       NULL            public   SELECT
test           kwdb_internal       kwdb_triggers                      NULL            public   SELECT
test           kwdb_internal       kwdb_tse_info                      NULL            public   SELECT
test           kwdb_internal       leases                             NULL            public   SELECT
test           kwdb_internal       node_build_info                    NULL            public   SELECT
test           kwdb_internal       node_metrics                       NULL            public   SELECT
test           kwdb_internal       node_queries                       NULL            public   SELECT
test           kwdb_internal       node_runtime_info                  NULL            public   SELECT
test           kwdb_internal       node_sessions                      NULL            public   SELECT
test           kwdb_internal       node_statement_statistics          NULL            public   SELECT
test           kwdb_internal       node_transactions                  NULL            public   SELECT
test           kwdb_internal       node_txn_stats                     NULL            public   SELECT
test           kwdb_internal       partitions                         NULL            public   SELECT
test           kwdb_internal       predefined_comments                NULL            public   SELECT
test           kwdb_internal       ranges                             NULL            public   SELECT
test           kwdb_internal       ranges_no_leases                   NULL            public   SELECT
test           kwdb_internal       schema_changes                     NULL            public   SELECT
test           kwdb_internal       session_trace                      NULL            public   SELECT
test           kwdb_internal       session_variables                  NULL            public   SELECT
test           kwdb_internal       table_columns                      NULL            public   SELECT
test           kwdb_internal       table_indexes                      NULL            public   SELECT
test           kwdb_internal       tables                             NULL            public   SELECT
test           kwdb_internal       ts_inflight_transactions           NULL            public   SELECT
test           kwdb_internal       zones                              NULL            public   SELECT
test           pg_catalog          NULL                               NULL            admin    ALL
test           pg_catalog          NULL                               NULL            root     ALL
test           pg_catalog          pg_am                              NULL            public   SELECT
test           pg_catalog          pg_attrdef                         NULL            public   SELECT
test           pg_catalog          pg_attribute                       NULL            public   SELECT
test           pg_catalog          pg_auth_members                    NULL            public   SELECT
test           pg_catalog          pg_authid                          NULL            public   SELECT
test           pg_catalog          pg_available_extensions            NULL            public   SELECT
test           pg_catalog          pg_cast                            NULL            public   SELECT
test           pg_catalog          pg_class                           NULL            public   SELECT
test           pg_catalog          pg_collation                       NULL            public   SELECT
test           pg_catalog          pg_constraint                      NULL            public   SELECT
test           pg_catalog          pg_conversion                      NULL            public   SELECT
test           pg_catalog          pg_database                        NULL            public   SELECT
test           pg_catalog          pg_default_acl                     NULL            public   SELECT
test           pg_catalog          pg_depend                          NULL            public   SELECT
test           pg_catalog          pg_description                     NULL            public   SELECT
test           pg_catalog          pg_enum                            NULL            public   SELECT
test           pg_catalog          pg_extension                       NULL            public   SELECT
test           pg_catalog          pg_foreign_data_wrapper            NULL            public   SELECT
test           pg_catalog          pg_foreign_server                  NULL            public   SELECT
test           pg_catalog          pg_foreign_table                   NULL            public   SELECT
test           pg_catalog          pg_index                           NULL            public   SELECT
test           pg_catalog          pg_indexes                         NULL            public   SELECT
test           pg_catalog          pg_inherits                        NULL            public   SELECT
test           pg_catalog          pg_language                        NULL            public   SELECT
test           pg_catalog          pg_locks                           NULL            public   SELECT
test           pg_catalog          pg_matviews                        NULL            public   SELECT
test           pg_catalog          pg_namespace                       NULL            public   SELECT
test           pg_catalog          pg_operator                        NULL            public   SELECT
test           pg_catalog          pg_prepared_statements             NULL            public   SELECT
test           pg_catalog          pg_prepared_xacts                  NULL            public   SELECT
test           pg_catalog          pg_proc                            NULL            public   SELECT
test           pg_catalog          pg_range                           NULL            public   SELECT
test           pg_catalog          pg_rewrite                         NULL            public   SELECT
test           pg_catalog          pg_roles                           NULL            public   SELECT
test           pg_catalog          pg_seclabel                        NULL            public   SELECT
test           pg_catalog          pg_seclabels                       NULL            public   SELECT
test           pg_catalog          pg_sequence                        NULL            public   SELECT
test           pg_catalog          pg_settings                        NULL            public   SELECT
test           pg_catalog          pg_shdepend                        NULL            public   SELECT
test           pg_catalog          pg_shdescription                   NULL            public   SELECT
test           pg_catalog          pg_shseclabel                      NULL            public   SELECT
test           pg_catalog          pg_stat_activity                   NULL            public   SELECT
test           pg_catalog          pg_stat_all_indexes                NULL            public   SELECT
test           pg_catalog          pg_tables                          NULL            public   SELECT
test           pg_catalog          pg_tablespace                      NULL            public   SELECT
test           pg_catalog          pg_trigger                         NULL            public   SELECT
test           pg_catalog          pg_type                            NULL            public   SELECT
test           pg_catalog          pg_user                            NULL            public   SELECT
test           pg_catalog          pg_user_mapping                    NULL            public   SELECT
test           pg_catalog          pg_views                           NULL            public   SELECT
test           public              NULL                               NULL            admin    ALL
test           public              NULL                               NULL            root     ALL

query TTTTTT colnames
SHOW GRANTS FOR root
----
database_name  schema_name         table_name  procedure_name  grantee  privilege_type
test           information_schema  NULL        NULL            root     ALL
test           kwdb_internal       NULL        NULL            root     ALL
test           pg_catalog          NULL        NULL            root     ALL
test           public              NULL        NULL            root     ALL

# With no database set, we show the grants everywhere
statement ok
SET DATABASE = ''

query TTTTTT colnames,rowsort
SELECT * FROM [SHOW GRANTS]
 WHERE schema_name NOT IN ('kwdb_internal', 'pg_catalog', 'information_schema')
ORDER BY 1,2,3
----
database_name  schema_name  table_name                       procedure_name  grantee    privilege_type
a              public       NULL                             NULL            admin      ALL
a              public       NULL                             NULL            readwrite  ALL
a              public       NULL                             NULL            root       ALL
defaultdb      public       NULL                             NULL            admin      ALL
defaultdb      public       NULL                             NULL            root       ALL
postgres       public       NULL                             NULL            root       ALL
postgres       public       NULL                             NULL            admin      ALL
system         public       NULL                             NULL            admin      GRANT
system         public       NULL                             NULL            root       SELECT
system         public       NULL                             NULL            root       GRANT
system         public       NULL                             NULL            admin      SELECT
system         public       audits                           NULL            admin      INSERT
system         public       audits                           NULL            admin      UPDATE
system         public       audits                           NULL            root       UPDATE
system         public       audits                           NULL            admin      DELETE
system         public       audits                           NULL            admin      GRANT
system         public       audits                           NULL            admin      SELECT
system         public       audits                           NULL            root       SELECT
system         public       audits                           NULL            root       DELETE
system         public       audits                           NULL            root       INSERT
system         public       audits                           NULL            root       GRANT
system         public       bo_black_list                    NULL            root       SELECT
system         public       bo_black_list                    NULL            root       UPDATE
system         public       bo_black_list                    NULL            admin      GRANT
system         public       bo_black_list                    NULL            admin      DELETE
system         public       bo_black_list                    NULL            root       INSERT
system         public       bo_black_list                    NULL            admin      INSERT
system         public       bo_black_list                    NULL            admin      SELECT
system         public       bo_black_list                    NULL            admin      UPDATE
system         public       bo_black_list                    NULL            root       DELETE
system         public       bo_black_list                    NULL            root       GRANT
system         public       comments                         NULL            root       DELETE
system         public       comments                         NULL            admin      UPDATE
system         public       comments                         NULL            public     SELECT
system         public       comments                         NULL            admin      SELECT
system         public       comments                         NULL            admin      INSERT
system         public       comments                         NULL            root       SELECT
system         public       comments                         NULL            admin      GRANT
system         public       comments                         NULL            admin      DELETE
system         public       comments                         NULL            root       GRANT
system         public       comments                         NULL            root       INSERT
system         public       comments                         NULL            root       UPDATE
system         public       descriptor                       NULL            admin      GRANT
system         public       descriptor                       NULL            root       GRANT
system         public       descriptor                       NULL            admin      SELECT
system         public       descriptor                       NULL            root       SELECT
system         public       eventlog                         NULL            admin      GRANT
system         public       eventlog                         NULL            root       DELETE
system         public       eventlog                         NULL            root       GRANT
system         public       eventlog                         NULL            root       INSERT
system         public       eventlog                         NULL            root       UPDATE
system         public       eventlog                         NULL            root       SELECT
system         public       eventlog                         NULL            admin      SELECT
system         public       eventlog                         NULL            admin      INSERT
system         public       eventlog                         NULL            admin      DELETE
system         public       eventlog                         NULL            admin      UPDATE
system         public       jobs                             NULL            admin      DELETE
system         public       jobs                             NULL            admin      INSERT
system         public       jobs                             NULL            root       SELECT
system         public       jobs                             NULL            admin      SELECT
system         public       jobs                             NULL            admin      UPDATE
system         public       jobs                             NULL            root       INSERT
system         public       jobs                             NULL            root       DELETE
system         public       jobs                             NULL            root       UPDATE
system         public       jobs                             NULL            root       GRANT
system         public       jobs                             NULL            admin      GRANT
system         public       kwdb_cdc_watermark               NULL            root       UPDATE
system         public       kwdb_cdc_watermark               NULL            root       INSERT
system         public       kwdb_cdc_watermark               NULL            admin      DELETE
system         public       kwdb_cdc_watermark               NULL            root       DELETE
system         public       kwdb_cdc_watermark               NULL            admin      UPDATE
system         public       kwdb_cdc_watermark               NULL            admin      SELECT
system         public       kwdb_cdc_watermark               NULL            admin      INSERT
system         public       kwdb_cdc_watermark               NULL            admin      GRANT
system         public       kwdb_cdc_watermark               NULL            root       SELECT
system         public       kwdb_cdc_watermark               NULL            root       GRANT
system         public       kwdb_replication_info            NULL            admin      SELECT
system         public       kwdb_replication_info            NULL            admin      INSERT
system         public       kwdb_replication_info            NULL            admin      UPDATE
system         public       kwdb_replication_info            NULL            root       DELETE
system         public       kwdb_replication_info            NULL            root       GRANT
system         public       kwdb_replication_info            NULL            root       INSERT
system         public       kwdb_replication_info            NULL            root       SELECT
system         public       kwdb_replication_info            NULL            admin      GRANT
system         public       kwdb_replication_info            NULL            root       UPDATE
system         public       kwdb_replication_info            NULL            admin      DELETE
system         public       kwdb_streams                     NULL            root       UPDATE
system         public       kwdb_streams                     NULL            admin      INSERT
system         public       kwdb_streams                     NULL            admin      GRANT
system         public       kwdb_streams                     NULL            admin      DELETE
system         public       kwdb_streams                     NULL            root       SELECT
system         public       kwdb_streams                     NULL            root       GRANT
system         public       kwdb_streams                     NULL            root       DELETE
system         public       kwdb_streams                     NULL            admin      UPDATE
system         public       kwdb_streams                     NULL            admin      SELECT
system         public       kwdb_streams                     NULL            root       INSERT
system         public       kwdb_ts_table                    NULL            root       DELETE
system         public       kwdb_ts_table                    NULL            admin      INSERT
system         public       kwdb_ts_table                    NULL            admin      GRANT
system         public       kwdb_ts_table                    NULL            admin      DELETE
system         public       kwdb_ts_table                    NULL            admin      UPDATE
system         public       kwdb_ts_table                    NULL            root       UPDATE
system         public       kwdb_ts_table                    NULL            root       SELECT
system         public       kwdb_ts_table                    NULL            root       INSERT
system         public       kwdb_ts_table                    NULL            root       GRANT
system         public       kwdb_ts_table                    NULL            admin      SELECT
system         public       lease                            NULL            root       INSERT
system         public       lease                            NULL            root       SELECT
system         public       lease                            NULL            root       UPDATE
system         public       lease                            NULL            root       GRANT
system         public       lease                            NULL            admin      UPDATE
system         public       lease                            NULL            admin      SELECT
system         public       lease                            NULL            root       DELETE
system         public       lease                            NULL            admin      GRANT
system         public       lease                            NULL            admin      DELETE
system         public       lease                            NULL            admin      INSERT
system         public       locations                        NULL            admin      INSERT
system         public       locations                        NULL            root       UPDATE
system         public       locations                        NULL            admin      DELETE
system         public       locations                        NULL            root       SELECT
system         public       locations                        NULL            admin      GRANT
system         public       locations                        NULL            root       INSERT
system         public       locations                        NULL            root       DELETE
system         public       locations                        NULL            admin      UPDATE
system         public       locations                        NULL            admin      SELECT
system         public       locations                        NULL            root       GRANT
system         public       namespace                        NULL            root       SELECT
system         public       namespace                        NULL            root       GRANT
system         public       namespace                        NULL            admin      SELECT
system         public       namespace                        NULL            admin      GRANT
system         public       namespace2                       NULL            admin      GRANT
system         public       namespace2                       NULL            admin      SELECT
system         public       namespace2                       NULL            root       GRANT
system         public       namespace2                       NULL            root       SELECT
system         public       protected_ts_meta                NULL            root       SELECT
system         public       protected_ts_meta                NULL            admin      SELECT
system         public       protected_ts_meta                NULL            admin      GRANT
system         public       protected_ts_meta                NULL            root       GRANT
system         public       protected_ts_records             NULL            root       GRANT
system         public       protected_ts_records             NULL            root       SELECT
system         public       protected_ts_records             NULL            admin      SELECT
system         public       protected_ts_records             NULL            admin      GRANT
system         public       rangelog                         NULL            root       UPDATE
system         public       rangelog                         NULL            root       SELECT
system         public       rangelog                         NULL            admin      DELETE
system         public       rangelog                         NULL            admin      GRANT
system         public       rangelog                         NULL            admin      INSERT
system         public       rangelog                         NULL            root       GRANT
system         public       rangelog                         NULL            admin      UPDATE
system         public       rangelog                         NULL            root       DELETE
system         public       rangelog                         NULL            root       INSERT
system         public       rangelog                         NULL            admin      SELECT
system         public       replication_constraint_stats     NULL            admin      DELETE
system         public       replication_constraint_stats     NULL            admin      GRANT
system         public       replication_constraint_stats     NULL            admin      INSERT
system         public       replication_constraint_stats     NULL            root       UPDATE
system         public       replication_constraint_stats     NULL            root       SELECT
system         public       replication_constraint_stats     NULL            root       INSERT
system         public       replication_constraint_stats     NULL            root       GRANT
system         public       replication_constraint_stats     NULL            root       DELETE
system         public       replication_constraint_stats     NULL            admin      SELECT
system         public       replication_constraint_stats     NULL            admin      UPDATE
system         public       replication_critical_localities  NULL            root       UPDATE
system         public       replication_critical_localities  NULL            admin      DELETE
system         public       replication_critical_localities  NULL            admin      INSERT
system         public       replication_critical_localities  NULL            admin      SELECT
system         public       replication_critical_localities  NULL            admin      UPDATE
system         public       replication_critical_localities  NULL            root       DELETE
system         public       replication_critical_localities  NULL            root       GRANT
system         public       replication_critical_localities  NULL            root       INSERT
system         public       replication_critical_localities  NULL            root       SELECT
system         public       replication_critical_localities  NULL            admin      GRANT
system         public       replication_stats                NULL            root       UPDATE
system         public       replication_stats                NULL            admin      SELECT
system         public       replication_stats                NULL            admin      UPDATE
system         public       replication_stats                NULL            admin      GRANT
system         public       replication_stats                NULL            root       DELETE
system         public       replication_stats                NULL            root       GRANT
system         public       replication_stats                NULL            root       INSERT
system         public       replication_stats                NULL            admin      DELETE
system         public       replication_stats                NULL            root       SELECT
system         public       replication_stats                NULL            admin      INSERT
system         public       reports_meta                     NULL            admin      DELETE
system         public       reports_meta                     NULL            admin      GRANT
system         public       reports_meta                     NULL            admin      INSERT
system         public       reports_meta                     NULL            root       UPDATE
system         public       reports_meta                     NULL            root       SELECT
system         public       reports_meta                     NULL            root       INSERT
system         public       reports_meta                     NULL            root       GRANT
system         public       reports_meta                     NULL            root       DELETE
system         public       reports_meta                     NULL            admin      UPDATE
system         public       reports_meta                     NULL            admin      SELECT
system         public       role_members                     NULL            root       INSERT
system         public       role_members                     NULL            root       GRANT
system         public       role_members                     NULL            root       DELETE
system         public       role_members                     NULL            root       UPDATE
system         public       role_members                     NULL            admin      SELECT
system         public       role_members                     NULL            admin      INSERT
system         public       role_members                     NULL            admin      GRANT
system         public       role_members                     NULL            admin      DELETE
system         public       role_members                     NULL            root       SELECT
system         public       role_members                     NULL            admin      UPDATE
system         public       role_options                     NULL            root       UPDATE
system         public       role_options                     NULL            admin      INSERT
system         public       role_options                     NULL            admin      SELECT
system         public       role_options                     NULL            admin      UPDATE
system         public       role_options                     NULL            root       GRANT
system         public       role_options                     NULL            root       INSERT
system         public       role_options                     NULL            root       SELECT
system         public       role_options                     NULL            root       DELETE
system         public       role_options                     NULL            admin      DELETE
system         public       role_options                     NULL            admin      GRANT
system         public       scheduled_jobs                   NULL            admin      DELETE
system         public       scheduled_jobs                   NULL            admin      UPDATE
system         public       scheduled_jobs                   NULL            root       DELETE
system         public       scheduled_jobs                   NULL            root       GRANT
system         public       scheduled_jobs                   NULL            root       SELECT
system         public       scheduled_jobs                   NULL            admin      INSERT
system         public       scheduled_jobs                   NULL            admin      GRANT
system         public       scheduled_jobs                   NULL            root       UPDATE
system         public       scheduled_jobs                   NULL            admin      SELECT
system         public       scheduled_jobs                   NULL            root       INSERT
system         public       settings                         NULL            root       GRANT
system         public       settings                         NULL            root       DELETE
system         public       settings                         NULL            admin      UPDATE
system         public       settings                         NULL            admin      SELECT
system         public       settings                         NULL            root       UPDATE
system         public       settings                         NULL            admin      GRANT
system         public       settings                         NULL            root       SELECT
system         public       settings                         NULL            admin      DELETE
system         public       settings                         NULL            admin      INSERT
system         public       settings                         NULL            root       INSERT
system         public       statement_bundle_chunks          NULL            admin      DELETE
system         public       statement_bundle_chunks          NULL            root       SELECT
system         public       statement_bundle_chunks          NULL            root       INSERT
system         public       statement_bundle_chunks          NULL            root       DELETE
system         public       statement_bundle_chunks          NULL            admin      GRANT
system         public       statement_bundle_chunks          NULL            admin      UPDATE
system         public       statement_bundle_chunks          NULL            admin      SELECT
system         public       statement_bundle_chunks          NULL            admin      INSERT
system         public       statement_bundle_chunks          NULL            root       GRANT
system         public       statement_bundle_chunks          NULL            root       UPDATE
system         public       statement_diagnostics            NULL            root       SELECT
system         public       statement_diagnostics            NULL            admin      DELETE
system         public       statement_diagnostics            NULL            admin      GRANT
system         public       statement_diagnostics            NULL            admin      INSERT
system         public       statement_diagnostics            NULL            admin      SELECT
system         public       statement_diagnostics            NULL            admin      UPDATE
system         public       statement_diagnostics            NULL            root       UPDATE
system         public       statement_diagnostics            NULL            root       DELETE
system         public       statement_diagnostics            NULL            root       GRANT
system         public       statement_diagnostics            NULL            root       INSERT
system         public       statement_diagnostics_requests   NULL            root       SELECT
system         public       statement_diagnostics_requests   NULL            admin      DELETE
system         public       statement_diagnostics_requests   NULL            admin      GRANT
system         public       statement_diagnostics_requests   NULL            admin      INSERT
system         public       statement_diagnostics_requests   NULL            admin      SELECT
system         public       statement_diagnostics_requests   NULL            admin      UPDATE
system         public       statement_diagnostics_requests   NULL            root       DELETE
system         public       statement_diagnostics_requests   NULL            root       INSERT
system         public       statement_diagnostics_requests   NULL            root       GRANT
system         public       statement_diagnostics_requests   NULL            root       UPDATE
system         public       table_statistics                 NULL            admin      DELETE
system         public       table_statistics                 NULL            root       SELECT
system         public       table_statistics                 NULL            root       INSERT
system         public       table_statistics                 NULL            root       GRANT
system         public       table_statistics                 NULL            root       DELETE
system         public       table_statistics                 NULL            admin      SELECT
system         public       table_statistics                 NULL            admin      INSERT
system         public       table_statistics                 NULL            admin      GRANT
system         public       table_statistics                 NULL            root       UPDATE
system         public       table_statistics                 NULL            admin      UPDATE
system         public       ui                               NULL            admin      DELETE
system         public       ui                               NULL            admin      SELECT
system         public       ui                               NULL            admin      UPDATE
system         public       ui                               NULL            root       DELETE
system         public       ui                               NULL            root       GRANT
system         public       ui                               NULL            root       INSERT
system         public       ui                               NULL            root       UPDATE
system         public       ui                               NULL            root       SELECT
system         public       ui                               NULL            admin      INSERT
system         public       ui                               NULL            admin      GRANT
system         public       user_defined_routine             NULL            admin      GRANT
system         public       user_defined_routine             NULL            admin      DELETE
system         public       user_defined_routine             NULL            admin      SELECT
system         public       user_defined_routine             NULL            admin      UPDATE
system         public       user_defined_routine             NULL            root       DELETE
system         public       user_defined_routine             NULL            root       GRANT
system         public       user_defined_routine             NULL            root       INSERT
system         public       user_defined_routine             NULL            root       SELECT
system         public       user_defined_routine             NULL            root       UPDATE
system         public       user_defined_routine             NULL            admin      INSERT
system         public       users                            NULL            root       UPDATE
system         public       users                            NULL            admin      INSERT
system         public       users                            NULL            admin      SELECT
system         public       users                            NULL            admin      GRANT
system         public       users                            NULL            root       DELETE
system         public       users                            NULL            root       GRANT
system         public       users                            NULL            admin      DELETE
system         public       users                            NULL            root       INSERT
system         public       users                            NULL            root       SELECT
system         public       users                            NULL            admin      UPDATE
system         public       web_sessions                     NULL            root       UPDATE
system         public       web_sessions                     NULL            admin      DELETE
system         public       web_sessions                     NULL            admin      GRANT
system         public       web_sessions                     NULL            admin      INSERT
system         public       web_sessions                     NULL            admin      SELECT
system         public       web_sessions                     NULL            admin      UPDATE
system         public       web_sessions                     NULL            root       DELETE
system         public       web_sessions                     NULL            root       INSERT
system         public       web_sessions                     NULL            root       SELECT
system         public       web_sessions                     NULL            root       GRANT
system         public       zones                            NULL            admin      DELETE
system         public       zones                            NULL            admin      GRANT
system         public       zones                            NULL            admin      INSERT
system         public       zones                            NULL            root       SELECT
system         public       zones                            NULL            admin      UPDATE
system         public       zones                            NULL            root       DELETE
system         public       zones                            NULL            root       GRANT
system         public       zones                            NULL            admin      SELECT
system         public       zones                            NULL            root       INSERT
system         public       zones                            NULL            root       UPDATE
test           public       NULL                             NULL            root       ALL
test           public       NULL                             NULL            admin      ALL

statement error pgcode 42P01 pq: relation "a.t" does not exist
SHOW GRANTS ON a.t

statement error pgcode 42P01 pq: relation "t" does not exist
SHOW GRANTS ON t

statement ok
SET DATABASE = a

statement error pgcode 42P01 relation "t" does not exist
SHOW GRANTS ON t

statement error pgcode 42P01 relation "a.t" does not exist
GRANT ALL ON a.t TO readwrite

statement ok
CREATE TABLE t (id INT PRIMARY KEY)

query TTTTT colnames
SHOW GRANTS ON t
----
database_name  schema_name  table_name  grantee    privilege_type
a              public       t           admin      ALL
a              public       t           readwrite  ALL
a              public       t           root       ALL

query TTTTT colnames
SHOW GRANTS ON a.t
----
database_name  schema_name  table_name  grantee    privilege_type
a              public       t           admin      ALL
a              public       t           readwrite  ALL
a              public       t           root       ALL

statement ok
INSERT INTO system.users VALUES('test-user','');

statement ok
GRANT ALL ON t TO readwrite, "test-user"

query TTTTT
SHOW GRANTS ON t
----
a  public  t  admin      ALL
a  public  t  readwrite  ALL
a  public  t  root       ALL
a  public  t  test-user  ALL

query TTTTT
SHOW GRANTS ON t FOR readwrite, "test-user"
----
a  public  t  readwrite  ALL
a  public  t  test-user  ALL

statement ok
REVOKE INSERT,DELETE ON t FROM "test-user",readwrite

query TTTTT
SHOW GRANTS ON t
----
a  public  t  admin      ALL
a  public  t  readwrite  CREATE
a  public  t  readwrite  DROP
a  public  t  readwrite  EXECUTE
a  public  t  readwrite  GRANT
a  public  t  readwrite  SELECT
a  public  t  readwrite  UPDATE
a  public  t  readwrite  ZONECONFIG
a  public  t  root       ALL
a  public  t  test-user  CREATE
a  public  t  test-user  DROP
a  public  t  test-user  EXECUTE
a  public  t  test-user  GRANT
a  public  t  test-user  SELECT
a  public  t  test-user  UPDATE
a  public  t  test-user  ZONECONFIG

query TTTTT
SHOW GRANTS ON t FOR readwrite, "test-user"
----
a  public  t  readwrite  CREATE
a  public  t  readwrite  DROP
a  public  t  readwrite  EXECUTE
a  public  t  readwrite  GRANT
a  public  t  readwrite  SELECT
a  public  t  readwrite  UPDATE
a  public  t  readwrite  ZONECONFIG
a  public  t  test-user  CREATE
a  public  t  test-user  DROP
a  public  t  test-user  EXECUTE
a  public  t  test-user  GRANT
a  public  t  test-user  SELECT
a  public  t  test-user  UPDATE
a  public  t  test-user  ZONECONFIG

statement ok
REVOKE SELECT ON t FROM "test-user"

query TTTTT
SHOW GRANTS ON t
----
a  public  t  admin      ALL
a  public  t  readwrite  CREATE
a  public  t  readwrite  DROP
a  public  t  readwrite  EXECUTE
a  public  t  readwrite  GRANT
a  public  t  readwrite  SELECT
a  public  t  readwrite  UPDATE
a  public  t  readwrite  ZONECONFIG
a  public  t  root       ALL
a  public  t  test-user  CREATE
a  public  t  test-user  DROP
a  public  t  test-user  EXECUTE
a  public  t  test-user  GRANT
a  public  t  test-user  UPDATE
a  public  t  test-user  ZONECONFIG

query TTTTT
SHOW GRANTS ON t FOR readwrite, "test-user"
----
a  public  t  readwrite  CREATE
a  public  t  readwrite  DROP
a  public  t  readwrite  EXECUTE
a  public  t  readwrite  GRANT
a  public  t  readwrite  SELECT
a  public  t  readwrite  UPDATE
a  public  t  readwrite  ZONECONFIG
a  public  t  test-user  CREATE
a  public  t  test-user  DROP
a  public  t  test-user  EXECUTE
a  public  t  test-user  GRANT
a  public  t  test-user  UPDATE
a  public  t  test-user  ZONECONFIG

statement ok
REVOKE ALL ON t FROM readwrite,"test-user"

query TTTTT
SHOW GRANTS ON t
----
a  public  t  admin  ALL
a  public  t  root   ALL

query TTTTT
SHOW GRANTS ON t FOR readwrite, "test-user"
----

# The same as above, but on a view

statement ok
CREATE VIEW v as SELECT id FROM t

query TTTTT colnames
SHOW GRANTS ON v
----
database_name  schema_name  table_name  grantee    privilege_type
a              public       v           admin      ALL
a              public       v           readwrite  ALL
a              public       v           root       ALL

query TTTTT colnames
SHOW GRANTS ON a.v
----
database_name  schema_name  table_name  grantee    privilege_type
a              public       v           admin      ALL
a              public       v           readwrite  ALL
a              public       v           root       ALL

statement ok
GRANT ALL ON v TO readwrite, "test-user"

query TTTTT
SHOW GRANTS ON v
----
a  public  v  admin      ALL
a  public  v  readwrite  ALL
a  public  v  root       ALL
a  public  v  test-user  ALL

query TTTTT
SHOW GRANTS ON v FOR readwrite, "test-user"
----
a  public  v  readwrite  ALL
a  public  v  test-user  ALL

statement ok
REVOKE INSERT,DELETE ON v FROM "test-user",readwrite

query TTTTT
SHOW GRANTS ON v
----
a  public  v  admin      ALL
a  public  v  readwrite  CREATE
a  public  v  readwrite  DROP
a  public  v  readwrite  EXECUTE
a  public  v  readwrite  GRANT
a  public  v  readwrite  SELECT
a  public  v  readwrite  UPDATE
a  public  v  readwrite  ZONECONFIG
a  public  v  root       ALL
a  public  v  test-user  CREATE
a  public  v  test-user  DROP
a  public  v  test-user  EXECUTE
a  public  v  test-user  GRANT
a  public  v  test-user  SELECT
a  public  v  test-user  UPDATE
a  public  v  test-user  ZONECONFIG

query TTTTT
SHOW GRANTS ON v FOR readwrite, "test-user"
----
a  public  v  readwrite  CREATE
a  public  v  readwrite  DROP
a  public  v  readwrite  EXECUTE
a  public  v  readwrite  GRANT
a  public  v  readwrite  SELECT
a  public  v  readwrite  UPDATE
a  public  v  readwrite  ZONECONFIG
a  public  v  test-user  CREATE
a  public  v  test-user  DROP
a  public  v  test-user  EXECUTE
a  public  v  test-user  GRANT
a  public  v  test-user  SELECT
a  public  v  test-user  UPDATE
a  public  v  test-user  ZONECONFIG

statement ok
REVOKE SELECT ON v FROM "test-user"

query TTTTT
SHOW GRANTS ON v
----
a  public  v  admin      ALL
a  public  v  readwrite  CREATE
a  public  v  readwrite  DROP
a  public  v  readwrite  EXECUTE
a  public  v  readwrite  GRANT
a  public  v  readwrite  SELECT
a  public  v  readwrite  UPDATE
a  public  v  readwrite  ZONECONFIG
a  public  v  root       ALL
a  public  v  test-user  CREATE
a  public  v  test-user  DROP
a  public  v  test-user  EXECUTE
a  public  v  test-user  GRANT
a  public  v  test-user  UPDATE
a  public  v  test-user  ZONECONFIG

query TTTTT
SHOW GRANTS ON v FOR readwrite, "test-user"
----
a  public  v  readwrite  CREATE
a  public  v  readwrite  DROP
a  public  v  readwrite  EXECUTE
a  public  v  readwrite  GRANT
a  public  v  readwrite  SELECT
a  public  v  readwrite  UPDATE
a  public  v  readwrite  ZONECONFIG
a  public  v  test-user  CREATE
a  public  v  test-user  DROP
a  public  v  test-user  EXECUTE
a  public  v  test-user  GRANT
a  public  v  test-user  UPDATE
a  public  v  test-user  ZONECONFIG

query TTTTTT
SHOW GRANTS FOR readwrite, "test-user"
----
a  information_schema  NULL  NULL  readwrite  ALL
a  kwdb_internal       NULL  NULL  readwrite  ALL
a  pg_catalog          NULL  NULL  readwrite  ALL
a  public              NULL  NULL  readwrite  ALL
a  public              v     NULL  readwrite  CREATE
a  public              v     NULL  readwrite  DROP
a  public              v     NULL  readwrite  EXECUTE
a  public              v     NULL  readwrite  GRANT
a  public              v     NULL  readwrite  SELECT
a  public              v     NULL  readwrite  UPDATE
a  public              v     NULL  readwrite  ZONECONFIG
a  public              v     NULL  test-user  CREATE
a  public              v     NULL  test-user  DROP
a  public              v     NULL  test-user  EXECUTE
a  public              v     NULL  test-user  GRANT
a  public              v     NULL  test-user  UPDATE
a  public              v     NULL  test-user  ZONECONFIG

statement ok
REVOKE ALL ON v FROM readwrite,"test-user"

query TTTTT
SHOW GRANTS ON v
----
a  public  v  admin  ALL
a  public  v  root   ALL

query TTTTT
SHOW GRANTS ON v FOR readwrite, "test-user"
----

query TTTTTT
SHOW GRANTS FOR readwrite, "test-user"
----
a  information_schema  NULL  NULL  readwrite  ALL
a  kwdb_internal       NULL  NULL  readwrite  ALL
a  pg_catalog          NULL  NULL  readwrite  ALL
a  public              NULL  NULL  readwrite  ALL

# Verify that the DB privileges have not changed.
query TTTT colnames
SHOW GRANTS ON DATABASE a
----
database_name  schema_name         grantee    privilege_type
a              information_schema  admin      ALL
a              information_schema  readwrite  ALL
a              information_schema  root       ALL
a              kwdb_internal       admin      ALL
a              kwdb_internal       readwrite  ALL
a              kwdb_internal       root       ALL
a              pg_catalog          admin      ALL
a              pg_catalog          readwrite  ALL
a              pg_catalog          root       ALL
a              public              admin      ALL
a              public              readwrite  ALL
a              public              root       ALL


# Errors due to invalid targets.
statement ok
SET DATABASE = ""

statement error at or near "@": syntax error
GRANT ALL ON a.t@xyz TO readwrite

statement error pq: target database or schema does not exist
GRANT ALL ON * TO readwrite

statement error pgcode 42P01 relation "a.tt" does not exist
GRANT ALL ON a.t, a.tt TO readwrite

# '*' doesn't work for databases.
statement error at or near "\*": syntax error
GRANT ALL ON DATABASE * TO readwrite

statement ok
CREATE DATABASE b

statement ok
CREATE TABLE b.t (id INT PRIMARY KEY)

statement ok
CREATE TABLE b.t2 (id INT PRIMARY KEY)

statement ok
CREATE DATABASE c

statement ok
CREATE TABLE c.t (id INT PRIMARY KEY)

# `*` works after you've set a database
statement ok
SET DATABASE = "b"

statement error pq: user or role vanilli does not exist
GRANT ALL ON * TO Vanilli

statement ok
CREATE USER Vanilli

statement ok
GRANT ALL ON * TO Vanilli

query TTTTT colnames
SHOW GRANTS ON *
----
database_name  schema_name  table_name  grantee  privilege_type
b              public       t           admin    ALL
b              public       t           root     ALL
b              public       t           vanilli  ALL
b              public       t2          admin    ALL
b              public       t2          root     ALL
b              public       t2          vanilli  ALL


# Multiple targets.
statement ok
CREATE USER Millie

statement ok
GRANT ALL ON c.*, b.t TO Millie

query TTTTT colnames
SHOW GRANTS ON b.*
----
database_name  schema_name  table_name  grantee  privilege_type
b              public       t           admin    ALL
b              public       t           millie   ALL
b              public       t           root     ALL
b              public       t           vanilli  ALL
b              public       t2          admin    ALL
b              public       t2          root     ALL
b              public       t2          vanilli  ALL

query TTTTT colnames
SHOW GRANTS ON a.*, b.*
----
database_name  schema_name  table_name  grantee  privilege_type
a              public       t           admin    ALL
a              public       t           root     ALL
a              public       v           admin    ALL
a              public       v           root     ALL
b              public       t           admin    ALL
b              public       t           millie   ALL
b              public       t           root     ALL
b              public       t           vanilli  ALL
b              public       t2          admin    ALL
b              public       t2          root     ALL
b              public       t2          vanilli  ALL

query TTTTT colnames
SHOW GRANTS ON c.t
----
database_name  schema_name  table_name  grantee  privilege_type
c              public       t           admin    ALL
c              public       t           millie   ALL
c              public       t           root     ALL

statement ok
REVOKE ALL ON *, c.* FROM Vanilli

query TTTTT colnames
SHOW GRANTS ON b.*
----
database_name  schema_name  table_name  grantee  privilege_type
b              public       t           admin    ALL
b              public       t           millie   ALL
b              public       t           root     ALL
b              public       t2          admin    ALL
b              public       t2          root     ALL

statement ok
CREATE DATABASE empty

query TTTTT colnames
SHOW GRANTS ON empty.*
----
database_name  schema_name  table_name  grantee  privilege_type

query TTTTT colnames
SHOW GRANTS ON empty.*, b.*
----
database_name  schema_name  table_name  grantee  privilege_type
b              public       t           admin    ALL
b              public       t           millie   ALL
b              public       t           root     ALL
b              public       t2          admin    ALL
b              public       t2          root     ALL
