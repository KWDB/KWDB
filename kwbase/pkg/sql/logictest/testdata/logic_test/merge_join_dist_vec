# LogicTest: 5node-vec

# Regression test for #39317.

statement ok
CREATE TABLE l (a INT PRIMARY KEY, b INT, FAMILY (a, b))

statement ok
CREATE TABLE r (a INT PRIMARY KEY, b INT, FAMILY (a, b))

statement ok
INSERT INTO l VALUES (1, 10), (2, 20), (3, 30)

statement ok
INSERT INTO r VALUES (2, 200), (3, 300), (4, 400)

statement ok
ALTER TABLE l SPLIT AT VALUES (2), (3)

statement ok
ALTER TABLE r SPLIT AT VALUES (2), (3)

statement ok
ALTER TABLE l EXPERIMENTAL_RELOCATE VALUES (ARRAY[1], 1), (ARRAY[2], 2), (ARRAY[3], 3)

statement ok
ALTER TABLE r EXPERIMENTAL_RELOCATE VALUES (ARRAY[1], 2), (ARRAY[2], 3), (ARRAY[3], 1)

query TTTI colnames
SELECT start_key, end_key, replicas, lease_holder from [SHOW EXPERIMENTAL_RANGES FROM TABLE l] ORDER BY lease_holder
----
start_key  end_key  replicas  lease_holder
NULL       /2       {1}       1
/2         /3       {2}       2
/3         NULL     {3}       3

query TTTI colnames
SELECT start_key, end_key, replicas, lease_holder from [SHOW EXPERIMENTAL_RANGES FROM TABLE r] ORDER BY lease_holder
----
start_key  end_key  replicas  lease_holder
/2         /3       {1}       1
/3         NULL     {2}       2
NULL       /2       {3}       3

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT * FROM l LEFT OUTER JOIN r USING(a) WHERE a = 2]
----
eJzUlFFv0zAQx9_5FNbx0oKnxGl4sTQpCDLI1KUjyQTSlAevOdpIWRxsR6Kq-t1RYtBIyUoLEmhv8fl-d_7_75Qt6C8VcEjDefgmI62qyEWyuCK34afr-esoJpO3UZqlH-ZT8j3lhU2oyDy8yMjlIoqJIjdpFL8jEzElH9-HSUgEOSdeDhRqWWAs7lEDvwUGFDzIKTRKLlFrqbrwtk-Kiq_AXQpl3bSmC-cUllIh8C2Y0lQIHDJxV2GCokDldLUKNKKs-tIqaFR5L9QGKKSNqDUnjnfmeM5zoLBoTdOabNOg5qSsjT8ay3cUZB-1r_rR9W5D1kKvh_0CBvkup6CNWCFwb0cfkfFQp62lKlBhMaiUd-TvUka8uEK1wktZ1qic2fBtnShux7O4ycKkHxJQqPCzmQTs5fRclau1_bROcBIwGng0GHfmzxx8cGf2F-6MSI_lmWwcf9_G0db-oDU7fr_coafV_90v9qiMf7Ff3pPdrxFhCepG1hqPWh-3swaLFVqrtWzVEq-VXPZt7NG-s59KgdrYW98eorq_6n8Px8PsMMz2Yfdn2BvAbB_2DsKvBrC7D89O0PxL58MwOwz7J2nOd8--BQAA__9EDDoB
