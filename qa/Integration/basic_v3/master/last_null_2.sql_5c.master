> create ts database last_db;
CREATE TS DATABASE
> use last_db;
SET
> create table t(k_timestamp timestamp not null, x float, y int, z varchar(32)) tags(a int not null) primary tags(a);
CREATE TABLE
> insert into t values('2023-07-29 03:11:59.688',  1.0,    1,  'a', 1);
INSERT 1
> insert into t values('2023-07-29 03:12:59.688',  2.0,    2, null, 1);
INSERT 1
> insert into t values('2023-07-29 03:15:59.688',  3.0, null,  'a', 1);
INSERT 1
> insert into t values('2023-07-29 03:18:59.688', null,    2,  'b', 1);
INSERT 1
> insert into t values('2023-07-29 03:25:59.688', 5.0 , null, null, 1);
INSERT 1
> insert into t values('2023-07-29 03:35:59.688', null, null,  'e', 1);
INSERT 1
> insert into t values('2023-07-29 03:10:59.688', null,    2, null, 1);
INSERT 1
> insert into t values('2023-07-29 03:26:59.688', null, null, null, 1);
INSERT 1
> select last(x) from t;
  last
--------
     5
(1 row)
> select last(y) from t;
  last
--------
     2
(1 row)
> select last(z) from t;
  last
--------
  e
(1 row)
> select last(z), sum(x) from t;
  last | sum
-------+------
  e    |  11
(1 row)
> select last(x), count(distinct y) from t;
  last | count
-------+--------
     5 |     2
(1 row)
> select last(x), last(x), last(y) from t;
  last | last | last
-------+------+-------
     5 |    5 |    2
(1 row)
> select last(*) from t;
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 |       5 |       2 | e       |       1
(1 row)
> select last(t.*) from t; -- throw error
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 |       5 |       2 | e       |       1
(1 row)
> select last(k_timestamp), last(x), last(y), last(z) from t;
              last              | last | last | last
--------------------------------+------+------+-------
  2023-07-29 03:35:59.688+00:00 |    5 |    2 | e
(1 row)
> select last(x) from t where x > 1.0;
  last
--------
     5
(1 row)
> select last(y) from t where y > 2;
  last
--------
  NULL
(1 row)
> select last(y), sum(x) from t where y > 2;
  last | sum
-------+-------
  NULL | NULL
(1 row)
> select last(z) from t where z in ('a', 'b', 'e');
  last
--------
  e
(1 row)
> select last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68';
  last | last | last
-------+------+-------
     5 |    5 |    2
(1 row)
> select last(*) from t where y in (6,5,3,1);
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1
(1 row)
> select last(t.*) from t where y in (6,5,3,1); -- throw error
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1
(1 row)
> select last(k_timestamp), last(x), last(y), last(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688';
              last              | last | last | last
--------------------------------+------+------+-------
  2023-07-29 03:35:59.688+00:00 |    5 |    2 | e
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(x) from t group by bucket order by bucket;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 |    2
  2023-07-29 03:15:00+00:00 |    3
  2023-07-29 03:25:00+00:00 |    5
  2023-07-29 03:35:00+00:00 | NULL
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(y), sum(a) from t group by bucket order by bucket; -- throw error because cannot aggregate tag
           bucket           | last | sum
----------------------------+------+------
  2023-07-29 03:10:00+00:00 |    2 |   3
  2023-07-29 03:15:00+00:00 |    2 |   2
  2023-07-29 03:25:00+00:00 | NULL |   2
  2023-07-29 03:35:00+00:00 | NULL |   1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(y) from t group by bucket order by bucket;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 |    2
  2023-07-29 03:15:00+00:00 |    2
  2023-07-29 03:25:00+00:00 | NULL
  2023-07-29 03:35:00+00:00 | NULL
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(z) from t group by bucket order by bucket;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 | a
  2023-07-29 03:15:00+00:00 | b
  2023-07-29 03:25:00+00:00 | NULL
  2023-07-29 03:35:00+00:00 | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(x), last(x), last(y) from t group by bucket order by bucket;
           bucket           | last | last | last
----------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  2023-07-29 03:15:00+00:00 |    3 |    3 |    2
  2023-07-29 03:25:00+00:00 |    5 |    5 | NULL
  2023-07-29 03:35:00+00:00 | NULL | NULL | NULL
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(*) from t group by bucket order by bucket;
           bucket           |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
----------------------------+-------------------------------+---------+---------+---------+----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |       2 |       2 | a       |       1
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |       3 |       2 | b       |       1
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |       5 | NULL    | NULL    |       1
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 | NULL    | NULL    | e       |       1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(*), count(*) from t group by bucket order by bucket;
           bucket           |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | count
----------------------------+-------------------------------+---------+---------+---------+---------+--------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |       2 |       2 | a       |       1 |     3
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |       3 |       2 | b       |       1 |     2
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |       5 | NULL    | NULL    |       1 |     2
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 | NULL    | NULL    | e       |       1 |     1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from t group by bucket order by bucket;
           bucket           |             last              | last | last | last
----------------------------+-------------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |    2 |    2 | a
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |    3 |    2 | b
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |    5 | NULL | NULL
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 | NULL | NULL | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(x) from t where x > 1.0 group by bucket order by bucket;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 |    2
  2023-07-29 03:15:00+00:00 |    3
  2023-07-29 03:25:00+00:00 |    5
(3 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(y) from t where y > 2 group by bucket order by bucket;
  bucket | last
---------+-------
(0 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(z) from t where z in ('a', 'b', 'e') group by bucket order by bucket;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 | a
  2023-07-29 03:15:00+00:00 | b
  2023-07-29 03:35:00+00:00 | e
(3 rows)
> select time_bucket(k_timestamp, '300s') bucket, count(distinct y), last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket order by bucket;
           bucket           | count | last | last | last
----------------------------+-------+------+------+-------
  2023-07-29 03:10:00+00:00 |     1 |    2 |    2 |    2
  2023-07-29 03:15:00+00:00 |     1 |    3 |    3 |    2
  2023-07-29 03:25:00+00:00 |     0 |    5 |    5 | NULL
  2023-07-29 03:35:00+00:00 |     0 | NULL | NULL | NULL
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket order by bucket;
           bucket           | last | last | last
----------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  2023-07-29 03:15:00+00:00 |    3 |    3 |    2
  2023-07-29 03:25:00+00:00 |    5 |    5 | NULL
  2023-07-29 03:35:00+00:00 | NULL | NULL | NULL
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(*) from t where y in (6,5,3,1) group by bucket order by bucket;
           bucket           |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
----------------------------+-------------------------------+---------+---------+---------+----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, sum(x), last(*), count(*) from t where y in (6,5,3,1) group by bucket order by bucket;
           bucket           | sum |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | count
----------------------------+-----+-------------------------------+---------+---------+---------+---------+--------
  2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1 |     1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket order by bucket;
           bucket           |             last              | last | last | last
----------------------------+-------------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |    2 |    2 | NULL
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |    3 |    2 | b
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |    5 | NULL | NULL
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 | NULL | NULL | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(x) from t where x > 1.0 group by bucket, y order by bucket, y;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 |    2
  2023-07-29 03:15:00+00:00 |    3
  2023-07-29 03:25:00+00:00 |    5
(3 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(y) from t where y > 2 group by bucket, z order by bucket, z;
  bucket | last
---------+-------
(0 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(z) from t where z in ('a', 'b', 'e') group by bucket, y order by bucket, y;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 | a
  2023-07-29 03:15:00+00:00 | a
  2023-07-29 03:15:00+00:00 | b
  2023-07-29 03:35:00+00:00 | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, count(distinct y), last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last(x) < 100 order by bucket, z;
           bucket           | count | last | last | last
----------------------------+-------+------+------+-------
  2023-07-29 03:10:00+00:00 |     1 |    2 |    2 |    2
  2023-07-29 03:15:00+00:00 |     0 |    3 |    3 | NULL
  2023-07-29 03:25:00+00:00 |     0 |    5 |    5 | NULL
(3 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last(y) > 2 order by bucket, z;
  bucket | last | last | last
---------+------+------+-------
(0 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y;
           bucket           |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
----------------------------+-------------------------------+---------+---------+---------+----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, sum(x), last(*), count(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y;
           bucket           | sum |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | count
----------------------------+-----+-------------------------------+---------+---------+---------+---------+--------
  2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1 |     1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, y having last(x) > 1.5 order by bucket, y;
           bucket           |             last              | last | last | last
----------------------------+-------------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |    2 |    2 | NULL
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.688+00:00 |    3 | NULL | a
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |    5 | NULL | NULL
(3 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(x) from t where x > 1.0 group by bucket, y order by bucket, y limit 1;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 |    2
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(y) from t where y > 2 group by bucket, z order by bucket, z limit 1;
  bucket | last
---------+-------
(0 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(z) from t where z in ('a', 'b', 'e') group by bucket, y order by bucket, y limit 1;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 | a
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, count(distinct y), last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last(x) < 100 order by bucket, z limit 1;
           bucket           | count | last | last | last
----------------------------+-------+------+------+-------
  2023-07-29 03:10:00+00:00 |     1 |    2 |    2 |    2
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last(y) > 2 order by bucket, z limit 1;
  bucket | last | last | last
---------+------+------+-------
(0 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y limit 1;
           bucket           |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
----------------------------+-------------------------------+---------+---------+---------+----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, sum(x), last(*), count(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y limit 1;
           bucket           | sum |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | count
----------------------------+-----+-------------------------------+---------+---------+---------+---------+--------
  2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1 |     1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, y having last(x) > 1.5 order by bucket, y limit 1;
           bucket           |             last              | last | last | last
----------------------------+-------------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |    2 |    2 | NULL
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(*), count(*) from t group by bucket having last(*) > 1;
ERROR: last(): cannot use "*" in this context
SQLSTATE: 42601
> select last(t1.*), last(t2.*) from t t1, t t2 where t1.y = t2.y;
ERROR: last() can only be used in timeseries table query or subquery
SQLSTATE: 0A000
> select last(x+1) from t;
ERROR: at or near "+": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(x+1) from t
             ^
HINT: try \hf last
> select last_row(x) from t;
  last_row
------------
  NULL
(1 row)
> select last_row(y) from t;
  last_row
------------
  NULL
(1 row)
> select last_row(z) from t;
  last_row
------------
  e
(1 row)
> select last_row(z), sum(x) from t;
  last_row | sum
-----------+------
  e        |  11
(1 row)
> select last_row(x), count(distinct y) from t;
  last_row | count
-----------+--------
  NULL     |     2
(1 row)
> select last_row(x), last_row(x), last_row(y) from t;
  last_row | last_row | last_row
-----------+----------+-----------
  NULL     | NULL     | NULL
(1 row)
> select last_row(*) from t;
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:35:59.688+00:00 | NULL        | NULL        | e           |           1
(1 row)
> select last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from t;
            last_row            | last_row | last_row | last_row
--------------------------------+----------+----------+-----------
  2023-07-29 03:35:59.688+00:00 | NULL     | NULL     | e
(1 row)
> select last_row(x) from t where x > 1.0;
  last_row
------------
         5
(1 row)
> select last_row(y) from t where y > 2;
  last_row
------------
  NULL
(1 row)
> select last_row(y), sum(x) from t where y > 2;
  last_row | sum
-----------+-------
  NULL     | NULL
(1 row)
> select last_row(z) from t where z in ('a', 'b', 'e');
  last_row
------------
  e
(1 row)
> select last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68';
  last_row | last_row | last_row
-----------+----------+-----------
  NULL     | NULL     | NULL
(1 row)
> select last_row(*) from t where y in (6,5,3,1);
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:11:59.688+00:00 |           1 |           1 | a           |           1
(1 row)
> select last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688';
            last_row            | last_row | last_row | last_row
--------------------------------+----------+----------+-----------
  2023-07-29 03:35:59.688+00:00 | NULL     | NULL     | e
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x) from t group by bucket order by bucket;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 |        2
  2023-07-29 03:15:00+00:00 | NULL
  2023-07-29 03:25:00+00:00 | NULL
  2023-07-29 03:35:00+00:00 | NULL
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(y), sum(a) from t group by bucket order by bucket; -- throw error because cannot aggregate tag
           bucket           | last_row | sum
----------------------------+----------+------
  2023-07-29 03:10:00+00:00 |        2 |   3
  2023-07-29 03:15:00+00:00 |        2 |   2
  2023-07-29 03:25:00+00:00 | NULL     |   2
  2023-07-29 03:35:00+00:00 | NULL     |   1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(y) from t group by bucket order by bucket;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 |        2
  2023-07-29 03:15:00+00:00 |        2
  2023-07-29 03:25:00+00:00 | NULL
  2023-07-29 03:35:00+00:00 | NULL
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(z) from t group by bucket order by bucket;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 | NULL
  2023-07-29 03:15:00+00:00 | b
  2023-07-29 03:25:00+00:00 | NULL
  2023-07-29 03:35:00+00:00 | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x), last_row(x), last_row(y) from t group by bucket order by bucket;
           bucket           | last_row | last_row | last_row
----------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  2023-07-29 03:15:00+00:00 | NULL     | NULL     |        2
  2023-07-29 03:25:00+00:00 | NULL     | NULL     | NULL
  2023-07-29 03:35:00+00:00 | NULL     | NULL     | NULL
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(*) from t group by bucket order by bucket;
           bucket           |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
----------------------------+-------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |           2 |           2 | NULL        |           1
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 | NULL        |           2 | b           |           1
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 | NULL        | NULL        | NULL        |           1
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 | NULL        | NULL        | e           |           1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(*), count(*) from t group by bucket order by bucket;
           bucket           |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | count
----------------------------+-------------------------------+-------------+-------------+-------------+-------------+--------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |           2 |           2 | NULL        |           1 |     3
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 | NULL        |           2 | b           |           1 |     2
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 | NULL        | NULL        | NULL        |           1 |     2
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 | NULL        | NULL        | e           |           1 |     1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from t group by bucket order by bucket;
           bucket           |           last_row            | last_row | last_row | last_row
----------------------------+-------------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |        2 |        2 | NULL
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 | NULL     |        2 | b
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 | NULL     | NULL     | NULL
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 | NULL     | NULL     | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x) from t where x > 1.0 group by bucket order by bucket;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 |        2
  2023-07-29 03:15:00+00:00 |        3
  2023-07-29 03:25:00+00:00 |        5
(3 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(y) from t where y > 2 group by bucket order by bucket;
  bucket | last_row
---------+-----------
(0 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(z) from t where z in ('a', 'b', 'e') group by bucket order by bucket;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 | a
  2023-07-29 03:15:00+00:00 | b
  2023-07-29 03:35:00+00:00 | e
(3 rows)
> select time_bucket(k_timestamp, '300s') bucket, count(distinct y), last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket order by bucket order by bucket;
ERROR: at or near "order": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select time_bucket(k_timestamp, '300s') bucket, count(distinct y), last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket order by bucket order by bucket
                                                                                                                                                                                             ^
> select time_bucket(k_timestamp, '300s') bucket, last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket order by bucket;
           bucket           | last_row | last_row | last_row
----------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  2023-07-29 03:15:00+00:00 | NULL     | NULL     |        2
  2023-07-29 03:25:00+00:00 | NULL     | NULL     | NULL
  2023-07-29 03:35:00+00:00 | NULL     | NULL     | NULL
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(*) from t where y in (6,5,3,1) group by bucket order by bucket;
           bucket           |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
----------------------------+-------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.688+00:00 |           1 |           1 | a           |           1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, sum(x), last_row(*), count(*) from t where y in (6,5,3,1) group by bucket order by bucket;
           bucket           | sum |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | count
----------------------------+-----+-------------------------------+-------------+-------------+-------------+-------------+--------
  2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.688+00:00 |           1 |           1 | a           |           1 |     1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket order by bucket;
           bucket           |           last_row            | last_row | last_row | last_row
----------------------------+-------------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |        2 |        2 | NULL
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 | NULL     |        2 | b
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 | NULL     | NULL     | NULL
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 | NULL     | NULL     | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x) from t where x > 1.0 group by bucket, y order by bucket, y;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 |        2
  2023-07-29 03:15:00+00:00 |        3
  2023-07-29 03:25:00+00:00 |        5
(3 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(y) from t where y > 2 group by bucket, z order by bucket, z;
  bucket | last_row
---------+-----------
(0 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(z) from t where z in ('a', 'b', 'e') group by bucket, y order by bucket, y;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 | a
  2023-07-29 03:15:00+00:00 | a
  2023-07-29 03:15:00+00:00 | b
  2023-07-29 03:35:00+00:00 | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, count(distinct y), last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last_row(x) < 100 order by bucket, z;
           bucket           | count | last_row | last_row | last_row
----------------------------+-------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 |     1 |        2 |        2 |        2
  2023-07-29 03:15:00+00:00 |     0 |        3 |        3 | NULL
(2 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last_row(y) > 2 order by bucket, z;
  bucket | last_row | last_row | last_row
---------+----------+----------+-----------
(0 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y;
           bucket           |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
----------------------------+-------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.688+00:00 |           1 |           1 | a           |           1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, sum(x), last_row(*), count(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y;
           bucket           | sum |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | count
----------------------------+-----+-------------------------------+-------------+-------------+-------------+-------------+--------
  2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.688+00:00 |           1 |           1 | a           |           1 |     1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, y having last_row(x) > 1.5 order by bucket, y;
           bucket           |           last_row            | last_row | last_row | last_row
----------------------------+-------------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |        2 |        2 | NULL
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.688+00:00 |        3 | NULL     | a
(2 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x) from t where x > 1.0 group by bucket, y order by bucket, y limit 1;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 |        2
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(y) from t where y > 2 group by bucket, z order by bucket, z limit 1;
  bucket | last_row
---------+-----------
(0 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(z) from t where z in ('a', 'b', 'e') group by bucket, y order by bucket, y limit 1;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 | a
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, count(distinct y), last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last_row(x) < 100 order by bucket, z limit 1;
           bucket           | count | last_row | last_row | last_row
----------------------------+-------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 |     1 |        2 |        2 |        2
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last_row(y) > 2 order by bucket, z limit 1;
  bucket | last_row | last_row | last_row
---------+----------+----------+-----------
(0 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y limit 1;
           bucket           |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
----------------------------+-------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.688+00:00 |           1 |           1 | a           |           1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, sum(x), last_row(*), count(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y limit 1;
           bucket           | sum |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | count
----------------------------+-----+-------------------------------+-------------+-------------+-------------+-------------+--------
  2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.688+00:00 |           1 |           1 | a           |           1 |     1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, y having last_row(x) > 1.5 order by bucket, y limit 1;
           bucket           |           last_row            | last_row | last_row | last_row
----------------------------+-------------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |        2 |        2 | NULL
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(*), count(*) from t group by bucket having last_row(*) > 1;
ERROR: last_row(): cannot use "*" in this context
SQLSTATE: 42601
> select last_row(t1.*), last_row(t2.*) from t t1, t t2 where t1.y = t2.y;
ERROR: last_row() can only be used in timeseries table query or subquery
SQLSTATE: 0A000
> select last_row(x+1) from t;
ERROR: at or near "+": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last_row(x+1) from t
                 ^
HINT: try \hf last_row
> create table ts(k_timestamp timestamp not null, x int, y float, z varchar(32), a char(1)) tags(name varchar(10) not null, location varchar(32), d_type smallint) primary tags(name);
CREATE TABLE
> select last(x) from ts;
  last
--------
  NULL
(1 row)
> select last(y) from ts;
  last
--------
  NULL
(1 row)
> select last(z) from ts;
  last
--------
  NULL
(1 row)
> select last(z), sum(x) from ts;
  last | sum
-------+-------
  NULL | NULL
(1 row)
> select last(x), last(x), last(y) from ts;
  last | last | last
-------+------+-------
  NULL | NULL | NULL
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(x) from ts where x > 1.0 group by bucket order by bucket;
  bucket | last
---------+-------
(0 rows)
> select last_row(x) from ts;
  last_row
------------
  NULL
(1 row)
> select last_row(y) from ts;
  last_row
------------
  NULL
(1 row)
> select last_row(z) from ts;
  last_row
------------
  NULL
(1 row)
> select last_row(z), sum(x) from ts;
  last_row | sum
-----------+-------
  NULL     | NULL
(1 row)
> select last_row(x), last_row(x), last_row(y) from ts;
  last_row | last_row | last_row
-----------+----------+-----------
  NULL     | NULL     | NULL
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x) from ts where x > 1.0 group by bucket order by bucket;
  bucket | last_row
---------+-----------
(0 rows)
> insert into ts values('2023-07-29 03:10:59.680',    1,  1.0, 'aaa',  'a', 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:12:59.680', null,  2.0, 'bbb',  'b', 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:15:59.680',    2, null,  null,  'c', 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:17:59.680', null,  4.0,  null, null, 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:19:59.680', null, null,  null, null, 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:29:59.680',    2,  6.0,  null,  'e', 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:30:59.680', null,  7.0, 'bbb', null, 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:32:59.680',    8,  8.0, 'ccc',  'c', 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:10:59.680',    1, null, 'aaa',  'a', 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:12:59.680',    2, null, 'bbb', null, 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:15:59.680', null, null,  null,  'c', 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:17:59.680',    3, null, 'ddd', null, 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:19:59.680',    5,  5.0, 'eee', null, 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:29:59.680', null, null,  null, null, 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:30:59.680',    8,  7.0, 'bbb',  'b', 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:32:59.680',    8, null,  null, null, 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:11:59.680', null, null,  null, null, 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:14:59.680',    2,  2.0, 'bbb', null, 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:15:59.680', null,  3.0,  null,  'c', 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:17:59.680',    3, null,  null,  'd', 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:25:59.680', null, null,  null,  'e', 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:29:59.680', null,  6.0, 'eee',  'e', 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:30:59.680', null, null,  null, null, 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:32:59.680',    8,  8.0, 'ccc',  'c', 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:11:59.680',    1,  1.0, null,  'a', 'ts_4', 'TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:14:59.680',    2,  2.0, null,  'b', 'ts_4', 'TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:15:59.680',    2, null, null,  'c', 'ts_4', 'TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:17:59.680',    3, null, null, null, 'ts_4', 'TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:25:59.680',    5,  5.0, null,  'e', 'ts_4', 'TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:29:59.680', null, null, null, null, 'ts_4', 'TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:30:59.680',    8,  7.0, null, null, 'ts_4', 'TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:32:59.680', null, null, null,  'c', 'ts_4', 'TianJin', 4);
INSERT 1
> select last(x) from ts group by location order by location;
  last
--------
     8
     8
     8
     8
(4 rows)
> select last(y) from ts group by location order by location;
  last
--------
     7
     8
     8
     7
(4 rows)
> select last(z) from ts group by location order by location;
  last
--------
  bbb
  ccc
  ccc
  NULL
(4 rows)
> select last(z), sum(x) from ts group by location order by location;
  last | sum
-------+------
  bbb  |  27
  ccc  |  13
  ccc  |  13
  NULL |  21
(4 rows)
> select last(x), last(x), last(y) from ts group by location order by location;
  last | last | last
-------+------+-------
     8 |    8 |    7
     8 |    8 |    8
     8 |    8 |    8
     8 |    8 |    7
(4 rows)
> select last(*) from ts group by location order by location;
       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(name) | last(location) | last(d_type)
-------------------------------+---------+---------+---------+---------+------------+----------------+---------------
  2023-07-29 03:32:59.68+00:00 |       8 |       7 | bbb     | b       | ts_2       | JiNan          |            2
  2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_1       | Milpitas       |            1
  2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_3       | ShangHai       |            3
  2023-07-29 03:32:59.68+00:00 |       8 |       7 | NULL    | c       | ts_4       | TianJin        |            4
(4 rows)
> select last(k_timestamp), last(x), last(y), last(z) from ts group by location order by location;
              last             | last | last | last
-------------------------------+------+------+-------
  2023-07-29 03:32:59.68+00:00 |    8 |    7 | bbb
  2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:32:59.68+00:00 |    8 |    7 | NULL
(4 rows)
> select last(x) from ts where x > 1.0 group by location order by location;
  last
--------
     8
     8
     8
     8
(4 rows)
> select last(y) from ts where y > 2 group by location order by location;
  last
--------
     7
     8
     8
     7
(4 rows)
> select last(y), sum(x) from ts where y > 2 group by location order by location;
  last | sum
-------+------
     7 |  13
     8 |  10
     8 |   8
     7 |  13
(4 rows)
> select last(z) from ts where z in ('aaa', 'bbb', 'eee') group by location order by location;
  last
--------
  bbb
  bbb
  eee
(3 rows)
> select last(x), last(x), last(y) from ts where k_timestamp > '2023-07-29 03:12:59.68' group by location order by location;
  last | last | last
-------+------+-------
     8 |    8 |    7
     8 |    8 |    8
     8 |    8 |    8
     8 |    8 |    7
(4 rows)
> select last(*) from ts where y in (6,5,3,1) group by location order by location;
       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(name) | last(location) | last(d_type)
-------------------------------+---------+---------+---------+---------+------------+----------------+---------------
  2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | NULL    | ts_2       | JiNan          |            2
  2023-07-29 03:29:59.68+00:00 |       2 |       6 | aaa     | e       | ts_1       | Milpitas       |            1
  2023-07-29 03:29:59.68+00:00 | NULL    |       6 | eee     | e       | ts_3       | ShangHai       |            3
  2023-07-29 03:25:59.68+00:00 |       5 |       5 | NULL    | e       | ts_4       | TianJin        |            4
(4 rows)
> select last(k_timestamp), last(x), last(y), last(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by location order by location;
              last             | last | last | last
-------------------------------+------+------+-------
  2023-07-29 03:32:59.68+00:00 |    8 |    7 | bbb
  2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:32:59.68+00:00 |    8 |    7 | NULL
(4 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(x) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last
-----------+---------------------------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 |    2
  Milpitas | 2023-07-29 03:10:00+00:00 |    1
  ShangHai | 2023-07-29 03:10:00+00:00 |    2
  TianJin  | 2023-07-29 03:10:00+00:00 |    2
  JiNan    | 2023-07-29 03:15:00+00:00 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |    2
  ShangHai | 2023-07-29 03:15:00+00:00 |    3
  TianJin  | 2023-07-29 03:15:00+00:00 |    3
  JiNan    | 2023-07-29 03:25:00+00:00 | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 |    2
  ShangHai | 2023-07-29 03:25:00+00:00 | NULL
  TianJin  | 2023-07-29 03:25:00+00:00 |    5
  JiNan    | 2023-07-29 03:30:00+00:00 |    8
  Milpitas | 2023-07-29 03:30:00+00:00 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |    8
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(y), sum(a) from ts group by bucket, location order by bucket, location; -- error because a is an attribute
ERROR: unknown signature: sum(CHAR)
SQLSTATE: 42883
> select location, time_bucket(k_timestamp, '300s') bucket, last(y) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last
-----------+---------------------------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 | NULL
  Milpitas | 2023-07-29 03:10:00+00:00 |    2
  ShangHai | 2023-07-29 03:10:00+00:00 |    2
  TianJin  | 2023-07-29 03:10:00+00:00 |    2
  JiNan    | 2023-07-29 03:15:00+00:00 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |    4
  ShangHai | 2023-07-29 03:15:00+00:00 |    3
  TianJin  | 2023-07-29 03:15:00+00:00 | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 |    6
  ShangHai | 2023-07-29 03:25:00+00:00 |    6
  TianJin  | 2023-07-29 03:25:00+00:00 |    5
  JiNan    | 2023-07-29 03:30:00+00:00 |    7
  Milpitas | 2023-07-29 03:30:00+00:00 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |    7
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(z) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last
-----------+---------------------------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | NULL
  JiNan    | 2023-07-29 03:15:00+00:00 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | NULL
  ShangHai | 2023-07-29 03:15:00+00:00 | NULL
  TianJin  | 2023-07-29 03:15:00+00:00 | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 | NULL
  ShangHai | 2023-07-29 03:25:00+00:00 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | NULL
  JiNan    | 2023-07-29 03:30:00+00:00 | bbb
  Milpitas | 2023-07-29 03:30:00+00:00 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | NULL
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(x), last(x), last(y) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last | last | last
-----------+---------------------------+------+------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 |    2 |    2 | NULL
  Milpitas | 2023-07-29 03:10:00+00:00 |    1 |    1 |    2
  ShangHai | 2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  TianJin  | 2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  JiNan    | 2023-07-29 03:15:00+00:00 |    5 |    5 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |    2 |    2 |    4
  ShangHai | 2023-07-29 03:15:00+00:00 |    3 |    3 |    3
  TianJin  | 2023-07-29 03:15:00+00:00 |    3 |    3 | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 | NULL | NULL | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 |    2 |    2 |    6
  ShangHai | 2023-07-29 03:25:00+00:00 | NULL | NULL |    6
  TianJin  | 2023-07-29 03:25:00+00:00 |    5 |    5 |    5
  JiNan    | 2023-07-29 03:30:00+00:00 |    8 |    8 |    7
  Milpitas | 2023-07-29 03:30:00+00:00 |    8 |    8 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |    8 |    8 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |    8 |    8 |    7
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(*) from ts group by bucket, location order by bucket, location;
  location |          bucket           |      last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(name) | last(location) | last(d_type)
-----------+---------------------------+------------------------------+---------+---------+---------+---------+------------+----------------+---------------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |       2 | NULL    | bbb     | a       | ts_2       | JiNan          |            2
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |       1 |       2 | bbb     | b       | ts_1       | Milpitas       |            1
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |       2 |       2 | bbb     | NULL    | ts_3       | ShangHai       |            3
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |       2 |       2 | NULL    | b       | ts_4       | TianJin        |            4
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | c       | ts_2       | JiNan          |            2
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |       2 |       4 | NULL    | c       | ts_1       | Milpitas       |            1
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |       3 |       3 | NULL    | d       | ts_3       | ShangHai       |            3
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |       3 | NULL    | NULL    | c       | ts_4       | TianJin        |            4
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL    | NULL    | NULL    | NULL    | ts_2       | JiNan          |            2
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | NULL    | e       | ts_1       | Milpitas       |            1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL    |       6 | eee     | e       | ts_3       | ShangHai       |            3
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       5 |       5 | NULL    | e       | ts_4       | TianJin        |            4
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       7 | bbb     | b       | ts_2       | JiNan          |            2
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_1       | Milpitas       |            1
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_3       | ShangHai       |            3
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       7 | NULL    | c       | ts_4       | TianJin        |            4
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(*), count(*) from ts group by bucket, location order by bucket, location;
  location |          bucket           |      last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(name) | last(location) | last(d_type) | count
-----------+---------------------------+------------------------------+---------+---------+---------+---------+------------+----------------+--------------+--------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |       2 | NULL    | bbb     | a       | ts_2       | JiNan          |            2 |     2
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |       1 |       2 | bbb     | b       | ts_1       | Milpitas       |            1 |     2
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |       2 |       2 | bbb     | NULL    | ts_3       | ShangHai       |            3 |     2
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |       2 |       2 | NULL    | b       | ts_4       | TianJin        |            4 |     2
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | c       | ts_2       | JiNan          |            2 |     3
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |       2 |       4 | NULL    | c       | ts_1       | Milpitas       |            1 |     3
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |       3 |       3 | NULL    | d       | ts_3       | ShangHai       |            3 |     2
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |       3 | NULL    | NULL    | c       | ts_4       | TianJin        |            4 |     2
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL    | NULL    | NULL    | NULL    | ts_2       | JiNan          |            2 |     1
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | NULL    | e       | ts_1       | Milpitas       |            1 |     1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL    |       6 | eee     | e       | ts_3       | ShangHai       |            3 |     2
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       5 |       5 | NULL    | e       | ts_4       | TianJin        |            4 |     2
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       7 | bbb     | b       | ts_2       | JiNan          |            2 |     2
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_1       | Milpitas       |            1 |     2
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_3       | ShangHai       |            3 |     2
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       7 | NULL    | c       | ts_4       | TianJin        |            4 |     2
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from ts group by bucket, location order by bucket, location;
  location |          bucket           |             last             | last | last | last
-----------+---------------------------+------------------------------+------+------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |    2 | NULL | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |    1 |    2 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | NULL
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |    5 |    5 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |    2 |    4 | NULL
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |    3 |    3 | NULL
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |    3 | NULL | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL | NULL | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | NULL
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL |    6 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    5 |    5 | NULL
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    7 | bbb
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    7 | NULL
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(x) from ts where x > 1.0 group by bucket, location order by bucket, location;
  location |          bucket           | last
-----------+---------------------------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 |    2
  ShangHai | 2023-07-29 03:10:00+00:00 |    2
  TianJin  | 2023-07-29 03:10:00+00:00 |    2
  JiNan    | 2023-07-29 03:15:00+00:00 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |    2
  ShangHai | 2023-07-29 03:15:00+00:00 |    3
  TianJin  | 2023-07-29 03:15:00+00:00 |    3
  Milpitas | 2023-07-29 03:25:00+00:00 |    2
  TianJin  | 2023-07-29 03:25:00+00:00 |    5
  JiNan    | 2023-07-29 03:30:00+00:00 |    8
  Milpitas | 2023-07-29 03:30:00+00:00 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |    8
(13 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(y) from ts where y > 2 group by bucket, location order by bucket, location;
  location |          bucket           | last
-----------+---------------------------+-------
  JiNan    | 2023-07-29 03:15:00+00:00 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |    4
  ShangHai | 2023-07-29 03:15:00+00:00 |    3
  Milpitas | 2023-07-29 03:25:00+00:00 |    6
  ShangHai | 2023-07-29 03:25:00+00:00 |    6
  TianJin  | 2023-07-29 03:25:00+00:00 |    5
  JiNan    | 2023-07-29 03:30:00+00:00 |    7
  Milpitas | 2023-07-29 03:30:00+00:00 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |    7
(10 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(z) from ts where z in ('aaa', 'bbb', 'eee') group by bucket, location order by bucket, location;
  location |          bucket           | last
-----------+---------------------------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | bbb
  JiNan    | 2023-07-29 03:15:00+00:00 | eee
  ShangHai | 2023-07-29 03:25:00+00:00 | eee
  JiNan    | 2023-07-29 03:30:00+00:00 | bbb
  Milpitas | 2023-07-29 03:30:00+00:00 | bbb
(7 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, count(distinct y), last(x), last(x), last(y) from ts where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, location order by bucket, location;
  location |          bucket           | count | last | last | last
-----------+---------------------------+-------+------+------+-------
  ShangHai | 2023-07-29 03:10:00+00:00 |     1 |    2 |    2 |    2
  TianJin  | 2023-07-29 03:10:00+00:00 |     1 |    2 |    2 |    2
  JiNan    | 2023-07-29 03:15:00+00:00 |     1 |    5 |    5 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |     1 |    2 |    2 |    4
  ShangHai | 2023-07-29 03:15:00+00:00 |     1 |    3 |    3 |    3
  TianJin  | 2023-07-29 03:15:00+00:00 |     0 |    3 |    3 | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 |     0 | NULL | NULL | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 |     1 |    2 |    2 |    6
  ShangHai | 2023-07-29 03:25:00+00:00 |     1 | NULL | NULL |    6
  TianJin  | 2023-07-29 03:25:00+00:00 |     1 |    5 |    5 |    5
  JiNan    | 2023-07-29 03:30:00+00:00 |     1 |    8 |    8 |    7
  Milpitas | 2023-07-29 03:30:00+00:00 |     2 |    8 |    8 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |     1 |    8 |    8 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |     1 |    8 |    8 |    7
(14 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(x), last(x), last(y) from ts where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, location order by bucket, location;
  location |          bucket           | last | last | last
-----------+---------------------------+------+------+-------
  ShangHai | 2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  TianJin  | 2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  JiNan    | 2023-07-29 03:15:00+00:00 |    5 |    5 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |    2 |    2 |    4
  ShangHai | 2023-07-29 03:15:00+00:00 |    3 |    3 |    3
  TianJin  | 2023-07-29 03:15:00+00:00 |    3 |    3 | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 | NULL | NULL | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 |    2 |    2 |    6
  ShangHai | 2023-07-29 03:25:00+00:00 | NULL | NULL |    6
  TianJin  | 2023-07-29 03:25:00+00:00 |    5 |    5 |    5
  JiNan    | 2023-07-29 03:30:00+00:00 |    8 |    8 |    7
  Milpitas | 2023-07-29 03:30:00+00:00 |    8 |    8 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |    8 |    8 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |    8 |    8 |    7
(14 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location;
  location |          bucket           |      last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(name) | last(location) | last(d_type)
-----------+---------------------------+------------------------------+---------+---------+---------+---------+------------+----------------+---------------
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:10:59.68+00:00 |       1 |       1 | aaa     | a       | ts_1       | Milpitas       |            1
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.68+00:00 |       1 |       1 | NULL    | a       | ts_4       | TianJin        |            4
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | NULL    | ts_2       | JiNan          |            2
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.68+00:00 | NULL    |       3 | NULL    | c       | ts_3       | ShangHai       |            3
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | NULL    | e       | ts_1       | Milpitas       |            1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL    |       6 | eee     | e       | ts_3       | ShangHai       |            3
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:25:59.68+00:00 |       5 |       5 | NULL    | e       | ts_4       | TianJin        |            4
(7 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, sum(x), last(*), count(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location;
  location |          bucket           | sum  |      last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(name) | last(location) | last(d_type) | count
-----------+---------------------------+------+------------------------------+---------+---------+---------+---------+------------+----------------+--------------+--------
  Milpitas | 2023-07-29 03:10:00+00:00 |    1 | 2023-07-29 03:10:59.68+00:00 |       1 |       1 | aaa     | a       | ts_1       | Milpitas       |            1 |     1
  TianJin  | 2023-07-29 03:10:00+00:00 |    1 | 2023-07-29 03:11:59.68+00:00 |       1 |       1 | NULL    | a       | ts_4       | TianJin        |            4 |     1
  JiNan    | 2023-07-29 03:15:00+00:00 |    5 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | NULL    | ts_2       | JiNan          |            2 |     1
  ShangHai | 2023-07-29 03:15:00+00:00 | NULL | 2023-07-29 03:15:59.68+00:00 | NULL    |       3 | NULL    | c       | ts_3       | ShangHai       |            3 |     1
  Milpitas | 2023-07-29 03:25:00+00:00 |    2 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | NULL    | e       | ts_1       | Milpitas       |            1 |     1
  ShangHai | 2023-07-29 03:25:00+00:00 | NULL | 2023-07-29 03:29:59.68+00:00 | NULL    |       6 | eee     | e       | ts_3       | ShangHai       |            3 |     1
  TianJin  | 2023-07-29 03:25:00+00:00 |    5 | 2023-07-29 03:25:59.68+00:00 |       5 |       5 | NULL    | e       | ts_4       | TianJin        |            4 |     1
(7 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location order by bucket, location;
  location |          bucket           |             last             | last | last | last
-----------+---------------------------+------------------------------+------+------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |    2 | NULL | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 | NULL |    2 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | NULL
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |    5 |    5 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |    2 |    4 | NULL
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |    3 |    3 | NULL
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |    3 | NULL | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL | NULL | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | NULL
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL |    6 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    5 |    5 | NULL
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    7 | bbb
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    7 | NULL
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location, y;
ERROR: column "y" must appear in the GROUP BY clause or be used in an aggregate function
SQLSTATE: 42803
> select location, time_bucket(k_timestamp, '300s') bucket, sum(x), last(*), count(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location, y;
ERROR: column "y" must appear in the GROUP BY clause or be used in an aggregate function
SQLSTATE: 42803
> select location, time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last(x) > 1.5 order by bucket, location;
  location |          bucket           |             last             | last | last | last
-----------+---------------------------+------------------------------+------+------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |    2 | NULL | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | NULL
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |    5 |    5 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |    2 |    4 | NULL
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |    3 |    3 | NULL
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |    3 | NULL | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | NULL
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    5 |    5 | NULL
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    7 | bbb
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    7 | NULL
(13 rows)
> select time_bucket(k_timestamp, '300s') bucket, location, last(k_timestamp), last(x), last(y), last(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last(x) > 1.5 order by bucket, location;
           bucket           | location |             last             | last | last | last
----------------------------+----------+------------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 | JiNan    | 2023-07-29 03:12:59.68+00:00 |    2 | NULL | bbb
  2023-07-29 03:10:00+00:00 | ShangHai | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | bbb
  2023-07-29 03:10:00+00:00 | TianJin  | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | NULL
  2023-07-29 03:15:00+00:00 | JiNan    | 2023-07-29 03:19:59.68+00:00 |    5 |    5 | eee
  2023-07-29 03:15:00+00:00 | Milpitas | 2023-07-29 03:19:59.68+00:00 |    2 |    4 | NULL
  2023-07-29 03:15:00+00:00 | ShangHai | 2023-07-29 03:17:59.68+00:00 |    3 |    3 | NULL
  2023-07-29 03:15:00+00:00 | TianJin  | 2023-07-29 03:17:59.68+00:00 |    3 | NULL | NULL
  2023-07-29 03:25:00+00:00 | Milpitas | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | NULL
  2023-07-29 03:25:00+00:00 | TianJin  | 2023-07-29 03:29:59.68+00:00 |    5 |    5 | NULL
  2023-07-29 03:30:00+00:00 | JiNan    | 2023-07-29 03:32:59.68+00:00 |    8 |    7 | bbb
  2023-07-29 03:30:00+00:00 | Milpitas | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:30:00+00:00 | ShangHai | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:30:00+00:00 | TianJin  | 2023-07-29 03:32:59.68+00:00 |    8 |    7 | NULL
(13 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location, y limit 1;
ERROR: column "y" must appear in the GROUP BY clause or be used in an aggregate function
SQLSTATE: 42803
> select location, time_bucket(k_timestamp, '300s') bucket, sum(x), last(*), count(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location, y limit 1;
ERROR: column "y" must appear in the GROUP BY clause or be used in an aggregate function
SQLSTATE: 42803
> select location, time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last(x) > 1.5 order by bucket, location limit 1;
  location |          bucket           |             last             | last | last | last
-----------+---------------------------+------------------------------+------+------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |    2 | NULL | bbb
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, location, last(k_timestamp), last(x), last(y), last(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last(x) > 1.5 order by bucket, location limit 1;
           bucket           | location |             last             | last | last | last
----------------------------+----------+------------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 | JiNan    | 2023-07-29 03:12:59.68+00:00 |    2 | NULL | bbb
(1 row)
> select last_row(x) from ts group by location order by location;
  last_row
------------
         8
         8
         8
  NULL
(4 rows)
> select last_row(y) from ts group by location order by location;
  last_row
------------
  NULL
         8
         8
  NULL
(4 rows)
> select last_row(z) from ts group by location order by location;
  last_row
------------
  NULL
  ccc
  ccc
  NULL
(4 rows)
> select last_row(z), sum(x) from ts group by location order by location;
  last_row | sum
-----------+------
  NULL     |  27
  ccc      |  13
  ccc      |  13
  NULL     |  21
(4 rows)
> select last_row(x), last_row(x), last_row(y) from ts group by location order by location;
  last_row | last_row | last_row
-----------+----------+-----------
         8 |        8 | NULL
         8 |        8 |        8
         8 |        8 |        8
  NULL     | NULL     | NULL
(4 rows)
> select last_row(*) from ts group by location order by location;
     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(name) | last_row(location) | last_row(d_type)
-------------------------------+-------------+-------------+-------------+-------------+----------------+--------------------+-------------------
  2023-07-29 03:32:59.68+00:00 |           8 | NULL        | NULL        | NULL        | ts_2           | JiNan              |                2
  2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_1           | Milpitas           |                1
  2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_3           | ShangHai           |                3
  2023-07-29 03:32:59.68+00:00 | NULL        | NULL        | NULL        | c           | ts_4           | TianJin            |                4
(4 rows)
> select last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts group by location order by location;
            last_row           | last_row | last_row | last_row
-------------------------------+----------+----------+-----------
  2023-07-29 03:32:59.68+00:00 |        8 | NULL     | NULL
  2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:32:59.68+00:00 | NULL     | NULL     | NULL
(4 rows)
> select last_row(x) from ts where x > 1.0 group by location order by location;
  last_row
------------
         8
         8
         8
         8
(4 rows)
> select last_row(y) from ts where y > 2 group by location order by location;
  last_row
------------
         7
         8
         8
         7
(4 rows)
> select last_row(y), sum(x) from ts where y > 2 group by location order by location;
  last_row | sum
-----------+------
         7 |  13
         8 |  10
         8 |   8
         7 |  13
(4 rows)
> select last_row(z) from ts where z in ('aaa', 'bbb', 'eee') group by location order by location;
  last_row
------------
  bbb
  bbb
  eee
(3 rows)
> select last_row(x), last_row(x), last_row(y) from ts where k_timestamp > '2023-07-29 03:12:59.68' group by location order by location;
  last_row | last_row | last_row
-----------+----------+-----------
         8 |        8 | NULL
         8 |        8 |        8
         8 |        8 |        8
  NULL     | NULL     | NULL
(4 rows)
> select last_row(*) from ts where y in (6,5,3,1) group by location order by location;
     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(name) | last_row(location) | last_row(d_type)
-------------------------------+-------------+-------------+-------------+-------------+----------------+--------------------+-------------------
  2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | NULL        | ts_2           | JiNan              |                2
  2023-07-29 03:29:59.68+00:00 |           2 |           6 | NULL        | e           | ts_1           | Milpitas           |                1
  2023-07-29 03:29:59.68+00:00 | NULL        |           6 | eee         | e           | ts_3           | ShangHai           |                3
  2023-07-29 03:25:59.68+00:00 |           5 |           5 | NULL        | e           | ts_4           | TianJin            |                4
(4 rows)
> select last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by location order by location;
            last_row           | last_row | last_row | last_row
-------------------------------+----------+----------+-----------
  2023-07-29 03:32:59.68+00:00 |        8 | NULL     | NULL
  2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:32:59.68+00:00 | NULL     | NULL     | NULL
(4 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(x) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last_row
-----------+---------------------------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 |        2
  Milpitas | 2023-07-29 03:10:00+00:00 | NULL
  ShangHai | 2023-07-29 03:10:00+00:00 |        2
  TianJin  | 2023-07-29 03:10:00+00:00 |        2
  JiNan    | 2023-07-29 03:15:00+00:00 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 | NULL
  ShangHai | 2023-07-29 03:15:00+00:00 |        3
  TianJin  | 2023-07-29 03:15:00+00:00 |        3
  JiNan    | 2023-07-29 03:25:00+00:00 | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 |        2
  ShangHai | 2023-07-29 03:25:00+00:00 | NULL
  TianJin  | 2023-07-29 03:25:00+00:00 | NULL
  JiNan    | 2023-07-29 03:30:00+00:00 |        8
  Milpitas | 2023-07-29 03:30:00+00:00 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 | NULL
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(y), sum(a) from ts group by bucket, location order by bucket, location; -- error because a is an attribute
ERROR: unknown signature: sum(CHAR)
SQLSTATE: 42883
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(y) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last_row
-----------+---------------------------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 | NULL
  Milpitas | 2023-07-29 03:10:00+00:00 |        2
  ShangHai | 2023-07-29 03:10:00+00:00 |        2
  TianJin  | 2023-07-29 03:10:00+00:00 |        2
  JiNan    | 2023-07-29 03:15:00+00:00 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 | NULL
  ShangHai | 2023-07-29 03:15:00+00:00 | NULL
  TianJin  | 2023-07-29 03:15:00+00:00 | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 |        6
  ShangHai | 2023-07-29 03:25:00+00:00 |        6
  TianJin  | 2023-07-29 03:25:00+00:00 | NULL
  JiNan    | 2023-07-29 03:30:00+00:00 | NULL
  Milpitas | 2023-07-29 03:30:00+00:00 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 | NULL
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(z) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last_row
-----------+---------------------------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | NULL
  JiNan    | 2023-07-29 03:15:00+00:00 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | NULL
  ShangHai | 2023-07-29 03:15:00+00:00 | NULL
  TianJin  | 2023-07-29 03:15:00+00:00 | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 | NULL
  ShangHai | 2023-07-29 03:25:00+00:00 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | NULL
  JiNan    | 2023-07-29 03:30:00+00:00 | NULL
  Milpitas | 2023-07-29 03:30:00+00:00 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | NULL
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(x), last_row(x), last_row(y) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last_row | last_row | last_row
-----------+---------------------------+----------+----------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 |        2 |        2 | NULL
  Milpitas | 2023-07-29 03:10:00+00:00 | NULL     | NULL     |        2
  ShangHai | 2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  TianJin  | 2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  JiNan    | 2023-07-29 03:15:00+00:00 |        5 |        5 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 | NULL     | NULL     | NULL
  ShangHai | 2023-07-29 03:15:00+00:00 |        3 |        3 | NULL
  TianJin  | 2023-07-29 03:15:00+00:00 |        3 |        3 | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 | NULL     | NULL     | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 |        2 |        2 |        6
  ShangHai | 2023-07-29 03:25:00+00:00 | NULL     | NULL     |        6
  TianJin  | 2023-07-29 03:25:00+00:00 | NULL     | NULL     | NULL
  JiNan    | 2023-07-29 03:30:00+00:00 |        8 |        8 | NULL
  Milpitas | 2023-07-29 03:30:00+00:00 |        8 |        8 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |        8 |        8 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 | NULL     | NULL     | NULL
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(*) from ts group by bucket, location order by bucket, location;
  location |          bucket           |    last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(name) | last_row(location) | last_row(d_type)
-----------+---------------------------+------------------------------+-------------+-------------+-------------+-------------+----------------+--------------------+-------------------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |           2 | NULL        | bbb         | NULL        | ts_2           | JiNan              |                2
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 | NULL        |           2 | bbb         | b           | ts_1           | Milpitas           |                1
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |           2 |           2 | bbb         | NULL        | ts_3           | ShangHai           |                3
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |           2 |           2 | NULL        | b           | ts_4           | TianJin            |                4
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | NULL        | ts_2           | JiNan              |                2
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 | NULL        | NULL        | NULL        | NULL        | ts_1           | Milpitas           |                1
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |           3 | NULL        | NULL        | d           | ts_3           | ShangHai           |                3
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |           3 | NULL        | NULL        | NULL        | ts_4           | TianJin            |                4
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL        | NULL        | NULL        | NULL        | ts_2           | JiNan              |                2
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | NULL        | e           | ts_1           | Milpitas           |                1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL        |           6 | eee         | e           | ts_3           | ShangHai           |                3
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL        | NULL        | NULL        | NULL        | ts_4           | TianJin            |                4
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 | NULL        | NULL        | NULL        | ts_2           | JiNan              |                2
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_1           | Milpitas           |                1
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_3           | ShangHai           |                3
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 | NULL        | NULL        | NULL        | c           | ts_4           | TianJin            |                4
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(*), count(*) from ts group by bucket, location order by bucket, location;
  location |          bucket           |    last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(name) | last_row(location) | last_row(d_type) | count
-----------+---------------------------+------------------------------+-------------+-------------+-------------+-------------+----------------+--------------------+------------------+--------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |           2 | NULL        | bbb         | NULL        | ts_2           | JiNan              |                2 |     2
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 | NULL        |           2 | bbb         | b           | ts_1           | Milpitas           |                1 |     2
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |           2 |           2 | bbb         | NULL        | ts_3           | ShangHai           |                3 |     2
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |           2 |           2 | NULL        | b           | ts_4           | TianJin            |                4 |     2
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | NULL        | ts_2           | JiNan              |                2 |     3
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 | NULL        | NULL        | NULL        | NULL        | ts_1           | Milpitas           |                1 |     3
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |           3 | NULL        | NULL        | d           | ts_3           | ShangHai           |                3 |     2
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |           3 | NULL        | NULL        | NULL        | ts_4           | TianJin            |                4 |     2
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL        | NULL        | NULL        | NULL        | ts_2           | JiNan              |                2 |     1
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | NULL        | e           | ts_1           | Milpitas           |                1 |     1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL        |           6 | eee         | e           | ts_3           | ShangHai           |                3 |     2
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL        | NULL        | NULL        | NULL        | ts_4           | TianJin            |                4 |     2
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 | NULL        | NULL        | NULL        | ts_2           | JiNan              |                2 |     2
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_1           | Milpitas           |                1 |     2
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_3           | ShangHai           |                3 |     2
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 | NULL        | NULL        | NULL        | c           | ts_4           | TianJin            |                4 |     2
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts group by bucket, location order by bucket, location;
  location |          bucket           |           last_row           | last_row | last_row | last_row
-----------+---------------------------+------------------------------+----------+----------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |        2 | NULL     | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 | NULL     |        2 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | NULL
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |        5 |        5 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 | NULL     | NULL     | NULL
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |        3 | NULL     | NULL
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |        3 | NULL     | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL     | NULL     | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | NULL
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL     |        6 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL     | NULL     | NULL
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 | NULL     | NULL
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 | NULL     | NULL     | NULL
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(x) from ts where x > 1.0 group by bucket, location order by bucket, location;
  location |          bucket           | last_row
-----------+---------------------------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 |        2
  ShangHai | 2023-07-29 03:10:00+00:00 |        2
  TianJin  | 2023-07-29 03:10:00+00:00 |        2
  JiNan    | 2023-07-29 03:15:00+00:00 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 |        2
  ShangHai | 2023-07-29 03:15:00+00:00 |        3
  TianJin  | 2023-07-29 03:15:00+00:00 |        3
  Milpitas | 2023-07-29 03:25:00+00:00 |        2
  TianJin  | 2023-07-29 03:25:00+00:00 |        5
  JiNan    | 2023-07-29 03:30:00+00:00 |        8
  Milpitas | 2023-07-29 03:30:00+00:00 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 |        8
(13 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(y) from ts where y > 2 group by bucket, location order by bucket, location;
  location |          bucket           | last_row
-----------+---------------------------+-----------
  JiNan    | 2023-07-29 03:15:00+00:00 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 |        4
  ShangHai | 2023-07-29 03:15:00+00:00 |        3
  Milpitas | 2023-07-29 03:25:00+00:00 |        6
  ShangHai | 2023-07-29 03:25:00+00:00 |        6
  TianJin  | 2023-07-29 03:25:00+00:00 |        5
  JiNan    | 2023-07-29 03:30:00+00:00 |        7
  Milpitas | 2023-07-29 03:30:00+00:00 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 |        7
(10 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(z) from ts where z in ('aaa', 'bbb', 'eee') group by bucket, location order by bucket, location;
  location |          bucket           | last_row
-----------+---------------------------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | bbb
  JiNan    | 2023-07-29 03:15:00+00:00 | eee
  ShangHai | 2023-07-29 03:25:00+00:00 | eee
  JiNan    | 2023-07-29 03:30:00+00:00 | bbb
  Milpitas | 2023-07-29 03:30:00+00:00 | bbb
(7 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, count(distinct y), last_row(x), last_row(x), last_row(y) from ts where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, location order by bucket, location;
  location |          bucket           | count | last_row | last_row | last_row
-----------+---------------------------+-------+----------+----------+-----------
  ShangHai | 2023-07-29 03:10:00+00:00 |     1 |        2 |        2 |        2
  TianJin  | 2023-07-29 03:10:00+00:00 |     1 |        2 |        2 |        2
  JiNan    | 2023-07-29 03:15:00+00:00 |     1 |        5 |        5 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 |     1 | NULL     | NULL     | NULL
  ShangHai | 2023-07-29 03:15:00+00:00 |     1 |        3 |        3 | NULL
  TianJin  | 2023-07-29 03:15:00+00:00 |     0 |        3 |        3 | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 |     0 | NULL     | NULL     | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 |     1 |        2 |        2 |        6
  ShangHai | 2023-07-29 03:25:00+00:00 |     1 | NULL     | NULL     |        6
  TianJin  | 2023-07-29 03:25:00+00:00 |     1 | NULL     | NULL     | NULL
  JiNan    | 2023-07-29 03:30:00+00:00 |     1 |        8 |        8 | NULL
  Milpitas | 2023-07-29 03:30:00+00:00 |     2 |        8 |        8 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |     1 |        8 |        8 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 |     1 | NULL     | NULL     | NULL
(14 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(x), last_row(x), last_row(y) from ts where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, location order by bucket, location;
  location |          bucket           | last_row | last_row | last_row
-----------+---------------------------+----------+----------+-----------
  ShangHai | 2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  TianJin  | 2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  JiNan    | 2023-07-29 03:15:00+00:00 |        5 |        5 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 | NULL     | NULL     | NULL
  ShangHai | 2023-07-29 03:15:00+00:00 |        3 |        3 | NULL
  TianJin  | 2023-07-29 03:15:00+00:00 |        3 |        3 | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 | NULL     | NULL     | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 |        2 |        2 |        6
  ShangHai | 2023-07-29 03:25:00+00:00 | NULL     | NULL     |        6
  TianJin  | 2023-07-29 03:25:00+00:00 | NULL     | NULL     | NULL
  JiNan    | 2023-07-29 03:30:00+00:00 |        8 |        8 | NULL
  Milpitas | 2023-07-29 03:30:00+00:00 |        8 |        8 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |        8 |        8 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 | NULL     | NULL     | NULL
(14 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location;
  location |          bucket           |    last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(name) | last_row(location) | last_row(d_type)
-----------+---------------------------+------------------------------+-------------+-------------+-------------+-------------+----------------+--------------------+-------------------
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:10:59.68+00:00 |           1 |           1 | aaa         | a           | ts_1           | Milpitas           |                1
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.68+00:00 |           1 |           1 | NULL        | a           | ts_4           | TianJin            |                4
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | NULL        | ts_2           | JiNan              |                2
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.68+00:00 | NULL        |           3 | NULL        | c           | ts_3           | ShangHai           |                3
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | NULL        | e           | ts_1           | Milpitas           |                1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL        |           6 | eee         | e           | ts_3           | ShangHai           |                3
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:25:59.68+00:00 |           5 |           5 | NULL        | e           | ts_4           | TianJin            |                4
(7 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, sum(x), last_row(*), count(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location;
  location |          bucket           | sum  |    last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(name) | last_row(location) | last_row(d_type) | count
-----------+---------------------------+------+------------------------------+-------------+-------------+-------------+-------------+----------------+--------------------+------------------+--------
  Milpitas | 2023-07-29 03:10:00+00:00 |    1 | 2023-07-29 03:10:59.68+00:00 |           1 |           1 | aaa         | a           | ts_1           | Milpitas           |                1 |     1
  TianJin  | 2023-07-29 03:10:00+00:00 |    1 | 2023-07-29 03:11:59.68+00:00 |           1 |           1 | NULL        | a           | ts_4           | TianJin            |                4 |     1
  JiNan    | 2023-07-29 03:15:00+00:00 |    5 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | NULL        | ts_2           | JiNan              |                2 |     1
  ShangHai | 2023-07-29 03:15:00+00:00 | NULL | 2023-07-29 03:15:59.68+00:00 | NULL        |           3 | NULL        | c           | ts_3           | ShangHai           |                3 |     1
  Milpitas | 2023-07-29 03:25:00+00:00 |    2 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | NULL        | e           | ts_1           | Milpitas           |                1 |     1
  ShangHai | 2023-07-29 03:25:00+00:00 | NULL | 2023-07-29 03:29:59.68+00:00 | NULL        |           6 | eee         | e           | ts_3           | ShangHai           |                3 |     1
  TianJin  | 2023-07-29 03:25:00+00:00 |    5 | 2023-07-29 03:25:59.68+00:00 |           5 |           5 | NULL        | e           | ts_4           | TianJin            |                4 |     1
(7 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location order by bucket, location;
  location |          bucket           |           last_row           | last_row | last_row | last_row
-----------+---------------------------+------------------------------+----------+----------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |        2 | NULL     | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 | NULL     |        2 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | NULL
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |        5 |        5 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 | NULL     | NULL     | NULL
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |        3 | NULL     | NULL
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |        3 | NULL     | NULL
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL     | NULL     | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | NULL
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL     |        6 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 | NULL     | NULL     | NULL
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 | NULL     | NULL
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 | NULL     | NULL     | NULL
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location, y;
ERROR: column "y" must appear in the GROUP BY clause or be used in an aggregate function
SQLSTATE: 42803
> select location, time_bucket(k_timestamp, '300s') bucket, sum(x), last_row(*), count(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location, y;
ERROR: column "y" must appear in the GROUP BY clause or be used in an aggregate function
SQLSTATE: 42803
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last_row(x) > 1.5 order by bucket, location;
  location |          bucket           |           last_row           | last_row | last_row | last_row
-----------+---------------------------+------------------------------+----------+----------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |        2 | NULL     | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | NULL
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |        5 |        5 | eee
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |        3 | NULL     | NULL
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |        3 | NULL     | NULL
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | NULL
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 | NULL     | NULL
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
(10 rows)
> select time_bucket(k_timestamp, '300s') bucket, location, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last_row(x) > 1.5 order by bucket, location;
           bucket           | location |           last_row           | last_row | last_row | last_row
----------------------------+----------+------------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 | JiNan    | 2023-07-29 03:12:59.68+00:00 |        2 | NULL     | bbb
  2023-07-29 03:10:00+00:00 | ShangHai | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | bbb
  2023-07-29 03:10:00+00:00 | TianJin  | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | NULL
  2023-07-29 03:15:00+00:00 | JiNan    | 2023-07-29 03:19:59.68+00:00 |        5 |        5 | eee
  2023-07-29 03:15:00+00:00 | ShangHai | 2023-07-29 03:17:59.68+00:00 |        3 | NULL     | NULL
  2023-07-29 03:15:00+00:00 | TianJin  | 2023-07-29 03:17:59.68+00:00 |        3 | NULL     | NULL
  2023-07-29 03:25:00+00:00 | Milpitas | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | NULL
  2023-07-29 03:30:00+00:00 | JiNan    | 2023-07-29 03:32:59.68+00:00 |        8 | NULL     | NULL
  2023-07-29 03:30:00+00:00 | Milpitas | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:30:00+00:00 | ShangHai | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
(10 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location, y limit 1;
ERROR: column "y" must appear in the GROUP BY clause or be used in an aggregate function
SQLSTATE: 42803
> select location, time_bucket(k_timestamp, '300s') bucket, sum(x), last_row(*), count(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location, y limit 1;
ERROR: column "y" must appear in the GROUP BY clause or be used in an aggregate function
SQLSTATE: 42803
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last_row(x) > 1.5 order by bucket, location limit 1;
  location |          bucket           |           last_row           | last_row | last_row | last_row
-----------+---------------------------+------------------------------+----------+----------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |        2 | NULL     | bbb
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, location, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last_row(x) > 1.5 order by bucket, location limit 1;
           bucket           | location |           last_row           | last_row | last_row | last_row
----------------------------+----------+------------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 | JiNan    | 2023-07-29 03:12:59.68+00:00 |        2 | NULL     | bbb
(1 row)
> create table t1(k_timestamp timestamp not null, x float, y int, z varchar(32)) tags(a int not null) primary tags(a);
CREATE TABLE
> select last(*) from t1;
  last(k_timestamp) | last(x) | last(y) | last(z) | last(a)
--------------------+---------+---------+---------+----------
  NULL              | NULL    | NULL    | NULL    | NULL
(1 row)
> select last_row(*) from t1;
  last_row(k_timestamp) | last_row(x) | last_row(y) | last_row(z) | last_row(a)
------------------------+-------------+-------------+-------------+--------------
  NULL                  | NULL        | NULL        | NULL        | NULL
(1 row)
> insert into t1 values('2023-07-29 03:35:59.688', null, null, 'e', 1);
INSERT 1
> select last(*) from t1;
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 | NULL    | NULL    | e       |       1
(1 row)
> select last_row(*) from t1;
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:35:59.688+00:00 | NULL        | NULL        | e           |           1
(1 row)
> insert into t1 values('2023-07-29 03:12:59.688', null, null, null, 1);
INSERT 1
> select last(*) from t1;
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 | NULL    | NULL    | e       |       1
(1 row)
> select last_row(*) from t1;
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:35:59.688+00:00 | NULL        | NULL        | e           |           1
(1 row)
> insert into t1 values('2023-07-29 03:20:59.688', null, 2, null, 1);
INSERT 1
> select last(*) from t1;
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 | NULL    |       2 | e       |       1
(1 row)
> select last_row(*) from t1; -- mark
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:35:59.688+00:00 | NULL        | NULL        | e           |           1
(1 row)
> insert into t1 values('2023-07-29 03:40:59.688', null, null, null, 1);
INSERT 1
> select last(*) from t1;
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:40:59.688+00:00 | NULL    |       2 | e       |       1
(1 row)
> select last_row(*) from t1;
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:40:59.688+00:00 | NULL        | NULL        | NULL        |           1
(1 row)
> create table t2(k_timestamp timestamp not null, x float, y int, z varchar(32)) tags(a int not null) primary tags(a);
CREATE TABLE
> select last(*) from t2 where true;
  last(k_timestamp) | last(x) | last(y) | last(z) | last(a)
--------------------+---------+---------+---------+----------
  NULL              | NULL    | NULL    | NULL    | NULL
(1 row)
> select last_row(*) from t2 where true; -- mark
  last_row(k_timestamp) | last_row(x) | last_row(y) | last_row(z) | last_row(a)
------------------------+-------------+-------------+-------------+--------------
  NULL                  | NULL        | NULL        | NULL        | NULL
(1 row)
> insert into t2 values('2023-07-29 03:35:59.688', null, null, 'e', 1);
INSERT 1
> select last(*) from t2 where true;
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 | NULL    | NULL    | e       |       1
(1 row)
> select last_row(*) from t2 where true;
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:35:59.688+00:00 | NULL        | NULL        | e           |           1
(1 row)
> insert into t2 values('2023-07-29 03:12:59.688', null, null, null, 1);
INSERT 1
> select last(*) from t2 where true;
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 | NULL    | NULL    | e       |       1
(1 row)
> select last_row(*) from t2 where true;
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:35:59.688+00:00 | NULL        | NULL        | e           |           1
(1 row)
> insert into t2 values('2023-07-29 03:20:59.688', null, 2, null, 1);
INSERT 1
> select last(*) from t2 where true;
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 | NULL    |       2 | e       |       1
(1 row)
> select last_row(*) from t2 where true;
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:35:59.688+00:00 | NULL        | NULL        | e           |           1
(1 row)
> insert into t2 values('2023-07-29 03:40:59.688', null, null, null, 1);
INSERT 1
> select last(*) from t2 where true;
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:40:59.688+00:00 | NULL    |       2 | e       |       1
(1 row)
> select last_row(*) from t2 where true; -- mark
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:40:59.688+00:00 | NULL        | NULL        | NULL        |           1
(1 row)
> create table t3(k_timestamp timestamp not null, x float, y int,k int,m int, z varchar(32)) tags(a int not null) primary tags(a);
CREATE TABLE
> select last(null), last_row(null);
ERROR: at or near "null": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(null), last_row(null)
            ^
HINT: try \hf last
> select last(3), last_row(3);
ERROR: at or near "3": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3), last_row(3)
            ^
HINT: try \hf last
> select last(3.1), last_row(3.1);
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3.1), last_row(3.1)
            ^
HINT: try \hf last
> select last('3.1'), last_row('3.1');
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last('3.1'), last_row('3.1')
            ^
HINT: try \hf last
> select last(null), last_row(null) from t3;
ERROR: at or near "null": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(null), last_row(null) from t3
            ^
HINT: try \hf last
> select last(3), last_row(3) from t3;
ERROR: at or near "3": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3), last_row(3) from t3
            ^
HINT: try \hf last
> select last(3.1), last_row(3.1) from t3;
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3.1), last_row(3.1) from t3
            ^
HINT: try \hf last
> select last('3.1'), last_row('3.1') from t3;
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last('3.1'), last_row('3.1') from t3
            ^
HINT: try \hf last
> select last(null), last_row(null) from t3 where x in (0);
ERROR: at or near "null": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(null), last_row(null) from t3 where x in (0)
            ^
HINT: try \hf last
> select last(3), last_row(3)  from t3 where x in (0);
ERROR: at or near "3": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3), last_row(3)  from t3 where x in (0)
            ^
HINT: try \hf last
> select last(3.1), last_row(3.1) from t3 where x in (0);
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3.1), last_row(3.1) from t3 where x in (0)
            ^
HINT: try \hf last
> select last('3.1'), last_row('3.1') from t3 where x in (0);
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last('3.1'), last_row('3.1') from t3 where x in (0)
            ^
HINT: try \hf last
> select last(null), last_row(null) from t3 group by y;
ERROR: at or near "null": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(null), last_row(null) from t3 group by y
            ^
HINT: try \hf last
> select last(3), last_row(3)  from t3 group by y;
ERROR: at or near "3": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3), last_row(3)  from t3 group by y
            ^
HINT: try \hf last
> select last(3.1), last_row(3.1) from t3 group by y;
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3.1), last_row(3.1) from t3 group by y
            ^
HINT: try \hf last
> select last('3.1'), last_row('3.1') from t3 group by y;
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last('3.1'), last_row('3.1') from t3 group by y
            ^
HINT: try \hf last
> select last(*) from t3 where true;
  last(k_timestamp) | last(x) | last(y) | last(k) | last(m) | last(z) | last(a)
--------------------+---------+---------+---------+---------+---------+----------
  NULL              | NULL    | NULL    | NULL    | NULL    | NULL    | NULL
(1 row)
> select last_row(*) from t3 where true; -- mark
  last_row(k_timestamp) | last_row(x) | last_row(y) | last_row(k) | last_row(m) | last_row(z) | last_row(a)
------------------------+-------------+-------------+-------------+-------------+-------------+--------------
  NULL                  | NULL        | NULL        | NULL        | NULL        | NULL        | NULL
(1 row)
> insert into t3 values('2023-07-29 03:35:59.688', null, null, 1,2, 'e', 1);
INSERT 1
> select last(*) from t3 where true;
        last(k_timestamp)       | last(x) | last(y) | last(k) | last(m) | last(z) | last(a)
--------------------------------+---------+---------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 | NULL    | NULL    |       1 |       2 | e       |       1
(1 row)
> select last_row(*) from t3 where true;
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(k) | last_row(m) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+-------------+-------------+--------------
  2023-07-29 03:35:59.688+00:00 | NULL        | NULL        |           1 |           2 | e           |           1
(1 row)
> insert into t3 values('2023-07-29 03:12:59.688', null, 3,7, null, null, 1);
INSERT 1
> select last(*) from t3 where true;
        last(k_timestamp)       | last(x) | last(y) | last(k) | last(m) | last(z) | last(a)
--------------------------------+---------+---------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 | NULL    |       3 |       1 |       2 | e       |       1
(1 row)
> select last_row(*) from t3 where true;
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(k) | last_row(m) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+-------------+-------------+--------------
  2023-07-29 03:35:59.688+00:00 | NULL        | NULL        |           1 |           2 | e           |           1
(1 row)
> insert into t3 values('2023-07-29 03:20:59.688',3,99, null, 2, null, 1);
INSERT 1
> select last(*) from t3 where true;
        last(k_timestamp)       | last(x) | last(y) | last(k) | last(m) | last(z) | last(a)
--------------------------------+---------+---------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 |       3 |      99 |       1 |       2 | e       |       1
(1 row)
> select last_row(*) from t3 where true;
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(k) | last_row(m) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+-------------+-------------+--------------
  2023-07-29 03:35:59.688+00:00 | NULL        | NULL        |           1 |           2 | e           |           1
(1 row)
> insert into t3 values('2023-07-29 03:40:59.688', null,77, null,22, null, 1);
INSERT 1
> select last(*) from t3 where true;
        last(k_timestamp)       | last(x) | last(y) | last(k) | last(m) | last(z) | last(a)
--------------------------------+---------+---------+---------+---------+---------+----------
  2023-07-29 03:40:59.688+00:00 |       3 |      77 |       1 |      22 | e       |       1
(1 row)
> select last_row(*) from t3 where true; -- mark
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(k) | last_row(m) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+-------------+-------------+--------------
  2023-07-29 03:40:59.688+00:00 | NULL        |          77 | NULL        |          22 | NULL        |           1
(1 row)
> select last(null), last_row(null);
ERROR: at or near "null": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(null), last_row(null)
            ^
HINT: try \hf last
> select last(3), last_row(3);
ERROR: at or near "3": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3), last_row(3)
            ^
HINT: try \hf last
> select last(3.1), last_row(3.1);
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3.1), last_row(3.1)
            ^
HINT: try \hf last
> select last('3.1'), last_row('3.1');
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last('3.1'), last_row('3.1')
            ^
HINT: try \hf last
> select last(null), last_row(null) from t3;
ERROR: at or near "null": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(null), last_row(null) from t3
            ^
HINT: try \hf last
> select last(3), last_row(3) from t3;
ERROR: at or near "3": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3), last_row(3) from t3
            ^
HINT: try \hf last
> select last(3.1), last_row(3.1) from t3;
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3.1), last_row(3.1) from t3
            ^
HINT: try \hf last
> select last('3.1'), last_row('3.1') from t3;
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last('3.1'), last_row('3.1') from t3
            ^
HINT: try \hf last
> select last(null), last_row(null) from t3 where x in (0);
ERROR: at or near "null": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(null), last_row(null) from t3 where x in (0)
            ^
HINT: try \hf last
> select last(3), last_row(3)  from t3 where x in (0);
ERROR: at or near "3": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3), last_row(3)  from t3 where x in (0)
            ^
HINT: try \hf last
> select last(3.1), last_row(3.1) from t3 where x in (0);
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3.1), last_row(3.1) from t3 where x in (0)
            ^
HINT: try \hf last
> select last('3.1'), last_row('3.1') from t3 where x in (0);
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last('3.1'), last_row('3.1') from t3 where x in (0)
            ^
HINT: try \hf last
> select last(null), last_row(null) from t3 group by y;
ERROR: at or near "null": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(null), last_row(null) from t3 group by y
            ^
HINT: try \hf last
> select last(3), last_row(3)  from t3 group by y;
ERROR: at or near "3": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3), last_row(3)  from t3 group by y
            ^
HINT: try \hf last
> select last(3.1), last_row(3.1) from t3 group by y;
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(3.1), last_row(3.1) from t3 group by y
            ^
HINT: try \hf last
> select last('3.1'), last_row('3.1') from t3 group by y;
ERROR: at or near "3.1": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last('3.1'), last_row('3.1') from t3 group by y
            ^
HINT: try \hf last
> drop table t;
DROP TABLE
> drop table t1;
DROP TABLE
> drop table t2;
DROP TABLE
> drop table t3;
DROP TABLE
> drop table ts cascade;
DROP TABLE
> drop database last_db;
DROP DATABASE
