> create ts database last_db;
CREATE TS DATABASE
> use last_db;
SET
> create table t(k_timestamp timestamp not null, x float, y int, z varchar(32)) tags(a int not null) primary tags (a);
CREATE TABLE
> insert into t values('2023-07-29 03:11:59.688', 1.0, 1, 'a', 1);
INSERT 1
> insert into t values('2023-07-29 03:12:59.688', 2.0, 2, 'b', 1);
INSERT 1
> insert into t values('2023-07-29 03:15:59.688', 3.0, 1, 'a', 1);
INSERT 1
> insert into t values('2023-07-29 03:18:59.688', 4.0, 2, 'b', 1);
INSERT 1
> insert into t values('2023-07-29 03:25:59.688', 5.0, 5, 'e', 1);
INSERT 1
> insert into t values('2023-07-29 03:35:59.688', 6.0, 6, 'e', 1);
INSERT 1
> insert into t values('2023-07-29 03:10:59.688', 0.1, 2, 'b', 1);
INSERT 1
> insert into t values('2023-07-29 03:26:59.688', 5.5, 5, 'e', 1);
INSERT 1
> select last(x) from t;
  last
--------
     6
(1 row)
> select last(y) from t;
  last
--------
     6
(1 row)
> select last(z) from t;
  last
--------
  e
(1 row)
> select last(z), sum(x) from t;
  last | sum
-------+-------
  e    | 26.6
(1 row)
> select last(x), count(distinct y) from t;
  last | count
-------+--------
     6 |     4
(1 row)
> select last(x), last(x), last(y) from t;
  last | last | last
-------+------+-------
     6 |    6 |    6
(1 row)
> select last(*) from t;
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 |       6 |       6 | e       |       1
(1 row)
> select last(t.*) from t;
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 |       6 |       6 | e       |       1
(1 row)
> select last(*), avg(x) from t;
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) |  avg
--------------------------------+---------+---------+---------+---------+--------
  2023-07-29 03:35:59.688+00:00 |       6 |       6 | e       |       1 | 3.325
(1 row)
> select last(k_timestamp), last(x), last(y), last(z) from t;
              last              | last | last | last
--------------------------------+------+------+-------
  2023-07-29 03:35:59.688+00:00 |    6 |    6 | e
(1 row)
> select last(k_timestamp), last(x), avg(x), last(y), last(z) from t;
              last              | last |  avg  | last | last
--------------------------------+------+-------+------+-------
  2023-07-29 03:35:59.688+00:00 |    6 | 3.325 |    6 | e
(1 row)
> select last(x) from t where x > 1.0;
  last
--------
     6
(1 row)
> select last(y) from t where y > 2;
  last
--------
     6
(1 row)
> select last(y), sum(x) from t where y > 2;
  last | sum
-------+-------
     6 | 16.5
(1 row)
> select last(z) from t where z in ('a', 'b', 'e');
  last
--------
  e
(1 row)
> select last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68';
  last | last | last
-------+------+-------
     6 |    6 |    6
(1 row)
> select last(*) from t where y in (6,5,3,1);
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 |       6 |       6 | e       |       1
(1 row)
> select last(t.*) from t where y in (6,5,3,1); -- throw error
        last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
--------------------------------+---------+---------+---------+----------
  2023-07-29 03:35:59.688+00:00 |       6 |       6 | e       |       1
(1 row)
> select last(k_timestamp), last(x), last(y), last(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688';
              last              | last | last | last
--------------------------------+------+------+-------
  2023-07-29 03:35:59.688+00:00 |    6 |    6 | e
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(x) from t group by bucket order by bucket;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 |    2
  2023-07-29 03:15:00+00:00 |    4
  2023-07-29 03:25:00+00:00 |  5.5
  2023-07-29 03:35:00+00:00 |    6
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(y), sum(a) from t group by bucket order by bucket; -- throw error because cannot aggregate tag
           bucket           | last | sum
----------------------------+------+------
  2023-07-29 03:10:00+00:00 |    2 |   3
  2023-07-29 03:15:00+00:00 |    2 |   2
  2023-07-29 03:25:00+00:00 |    5 |   2
  2023-07-29 03:35:00+00:00 |    6 |   1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(y) from t group by bucket order by bucket;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 |    2
  2023-07-29 03:15:00+00:00 |    2
  2023-07-29 03:25:00+00:00 |    5
  2023-07-29 03:35:00+00:00 |    6
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(z) from t group by bucket order by bucket;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 | b
  2023-07-29 03:15:00+00:00 | b
  2023-07-29 03:25:00+00:00 | e
  2023-07-29 03:35:00+00:00 | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(x), last(x), last(y) from t group by bucket order by bucket;
           bucket           | last | last | last
----------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  2023-07-29 03:15:00+00:00 |    4 |    4 |    2
  2023-07-29 03:25:00+00:00 |  5.5 |  5.5 |    5
  2023-07-29 03:35:00+00:00 |    6 |    6 |    6
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(*) from t group by bucket order by bucket;
           bucket           |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
----------------------------+-------------------------------+---------+---------+---------+----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |       2 |       2 | b       |       1
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |       4 |       2 | b       |       1
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |     5.5 |       5 | e       |       1
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |       6 |       6 | e       |       1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(*), count(*) from t group by bucket order by bucket;
           bucket           |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | count
----------------------------+-------------------------------+---------+---------+---------+---------+--------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |       2 |       2 | b       |       1 |     3
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |       4 |       2 | b       |       1 |     2
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |     5.5 |       5 | e       |       1 |     2
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |       6 |       6 | e       |       1 |     1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from t group by bucket order by bucket;
           bucket           |             last              | last | last | last
----------------------------+-------------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |    2 |    2 | b
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |    4 |    2 | b
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |  5.5 |    5 | e
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |    6 |    6 | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(x) from t where x > 1.0 group by bucket order by bucket;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 |    2
  2023-07-29 03:15:00+00:00 |    4
  2023-07-29 03:25:00+00:00 |  5.5
  2023-07-29 03:35:00+00:00 |    6
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(y) from t where y > 2 group by bucket order by bucket;
           bucket           | last
----------------------------+-------
  2023-07-29 03:25:00+00:00 |    5
  2023-07-29 03:35:00+00:00 |    6
(2 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(z) from t where z in ('a', 'b', 'e') group by bucket order by bucket;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 | b
  2023-07-29 03:15:00+00:00 | b
  2023-07-29 03:25:00+00:00 | e
  2023-07-29 03:35:00+00:00 | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, count(distinct y), last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket order by bucket;
           bucket           | count | last | last | last
----------------------------+-------+------+------+-------
  2023-07-29 03:10:00+00:00 |     1 |    2 |    2 |    2
  2023-07-29 03:15:00+00:00 |     2 |    4 |    4 |    2
  2023-07-29 03:25:00+00:00 |     1 |  5.5 |  5.5 |    5
  2023-07-29 03:35:00+00:00 |     1 |    6 |    6 |    6
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket order by bucket;
           bucket           | last | last | last
----------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  2023-07-29 03:15:00+00:00 |    4 |    4 |    2
  2023-07-29 03:25:00+00:00 |  5.5 |  5.5 |    5
  2023-07-29 03:35:00+00:00 |    6 |    6 |    6
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(*) from t where y in (6,5,3,1) group by bucket order by bucket;
           bucket           |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
----------------------------+-------------------------------+---------+---------+---------+----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.688+00:00 |       3 |       1 | a       |       1
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |     5.5 |       5 | e       |       1
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |       6 |       6 | e       |       1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, sum(x), last(*), count(*) from t where y in (6,5,3,1) group by bucket order by bucket;
           bucket           | sum  |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | count
----------------------------+------+-------------------------------+---------+---------+---------+---------+--------
  2023-07-29 03:10:00+00:00 |    1 | 2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1 |     1
  2023-07-29 03:15:00+00:00 |    3 | 2023-07-29 03:15:59.688+00:00 |       3 |       1 | a       |       1 |     1
  2023-07-29 03:25:00+00:00 | 10.5 | 2023-07-29 03:26:59.688+00:00 |     5.5 |       5 | e       |       1 |     2
  2023-07-29 03:35:00+00:00 |    6 | 2023-07-29 03:35:59.688+00:00 |       6 |       6 | e       |       1 |     1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket order by bucket;
           bucket           |             last              | last | last | last
----------------------------+-------------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |    2 |    2 | b
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |    4 |    2 | b
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |  5.5 |    5 | e
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |    6 |    6 | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(x) from t where x > 1.0 group by bucket, y order by bucket, y;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 |    2
  2023-07-29 03:15:00+00:00 |    3
  2023-07-29 03:15:00+00:00 |    4
  2023-07-29 03:25:00+00:00 |  5.5
  2023-07-29 03:35:00+00:00 |    6
(5 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(y) from t where y > 2 group by bucket, z order by bucket, z;
           bucket           | last
----------------------------+-------
  2023-07-29 03:25:00+00:00 |    5
  2023-07-29 03:35:00+00:00 |    6
(2 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(z) from t where z in ('a', 'b', 'e') group by bucket, y order by bucket, y;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 | a
  2023-07-29 03:10:00+00:00 | b
  2023-07-29 03:15:00+00:00 | a
  2023-07-29 03:15:00+00:00 | b
  2023-07-29 03:25:00+00:00 | e
  2023-07-29 03:35:00+00:00 | e
(6 rows)
> select time_bucket(k_timestamp, '300s') bucket, count(distinct y), last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last(x) < 100 order by bucket, z;
           bucket           | count | last | last | last
----------------------------+-------+------+------+-------
  2023-07-29 03:10:00+00:00 |     1 |    2 |    2 |    2
  2023-07-29 03:15:00+00:00 |     1 |    3 |    3 |    1
  2023-07-29 03:15:00+00:00 |     1 |    4 |    4 |    2
  2023-07-29 03:25:00+00:00 |     1 |  5.5 |  5.5 |    5
  2023-07-29 03:35:00+00:00 |     1 |    6 |    6 |    6
(5 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last(y) > 2 order by bucket, z;
           bucket           | last | last | last
----------------------------+------+------+-------
  2023-07-29 03:25:00+00:00 |  5.5 |  5.5 |    5
  2023-07-29 03:35:00+00:00 |    6 |    6 |    6
(2 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y;
           bucket           |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
----------------------------+-------------------------------+---------+---------+---------+----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.688+00:00 |       3 |       1 | a       |       1
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |     5.5 |       5 | e       |       1
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |       6 |       6 | e       |       1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, sum(x), last(*), count(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y;
           bucket           | sum  |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | count
----------------------------+------+-------------------------------+---------+---------+---------+---------+--------
  2023-07-29 03:10:00+00:00 |    1 | 2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1 |     1
  2023-07-29 03:15:00+00:00 |    3 | 2023-07-29 03:15:59.688+00:00 |       3 |       1 | a       |       1 |     1
  2023-07-29 03:25:00+00:00 | 10.5 | 2023-07-29 03:26:59.688+00:00 |     5.5 |       5 | e       |       1 |     2
  2023-07-29 03:35:00+00:00 |    6 | 2023-07-29 03:35:59.688+00:00 |       6 |       6 | e       |       1 |     1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, y having last(x) > 1.5 order by bucket, y;
           bucket           |             last              | last | last | last
----------------------------+-------------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |    2 |    2 | b
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.688+00:00 |    3 |    1 | a
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |    4 |    2 | b
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |  5.5 |    5 | e
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |    6 |    6 | e
(5 rows)
> select time_bucket(k_timestamp, '300s') bucket, last(x) from t where x > 1.0 group by bucket, y order by bucket, y limit 1;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 |    2
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(y) from t where y > 2 group by bucket, z order by bucket, z limit 1;
           bucket           | last
----------------------------+-------
  2023-07-29 03:25:00+00:00 |    5
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(z) from t where z in ('a', 'b', 'e') group by bucket, y order by bucket, y limit 1;
           bucket           | last
----------------------------+-------
  2023-07-29 03:10:00+00:00 | a
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, count(distinct y), last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last(x) < 100 order by bucket, z limit 1;
           bucket           | count | last | last | last
----------------------------+-------+------+------+-------
  2023-07-29 03:10:00+00:00 |     1 |    2 |    2 |    2
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(x), last(x), last(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last(y) > 2 order by bucket, z limit 1;
           bucket           | last | last | last
----------------------------+------+------+-------
  2023-07-29 03:25:00+00:00 |  5.5 |  5.5 |    5
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y limit 1;
           bucket           |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a)
----------------------------+-------------------------------+---------+---------+---------+----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, sum(x), last(*), count(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y limit 1;
           bucket           | sum |       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | count
----------------------------+-----+-------------------------------+---------+---------+---------+---------+--------
  2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.688+00:00 |       1 |       1 | a       |       1 |     1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, y having last(x) > 1.5 order by bucket, y limit 1;
           bucket           |             last              | last | last | last
----------------------------+-------------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |    2 |    2 | b
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(*), count(*) from t group by bucket having last(*) > 1;
ERROR: last(): cannot use "*" in this context
SQLSTATE: 42601
> select last(t1.*), last(t2.*) from t t1, t t2 where t1.y = t2.y;
ERROR: last() can only be used in timeseries table query or subquery
SQLSTATE: 0A000
> select last(x+1) from t;
ERROR: at or near "+": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(x+1) from t
             ^
HINT: try \hf last
> select last() from t;
ERROR: at or near ")": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last() from t
            ^
HINT: try \hf last
> select last_row() from t;
ERROR: at or near ")": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last_row() from t
                ^
HINT: try \hf last_row
> select last(x,y) from t;
ERROR: at or near "y": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last(x,y) from t
              ^
HINT: try \hf last
> select last_row(x,y) from t;
ERROR: at or near ",": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last_row(x,y) from t
                 ^
HINT: try \hf last_row
> select last_row(x) from t;
  last_row
------------
         6
(1 row)
> select last_row(y) from t;
  last_row
------------
         6
(1 row)
> select last_row(z) from t;
  last_row
------------
  e
(1 row)
> select last_row(z), sum(x) from t;
  last_row | sum
-----------+-------
  e        | 26.6
(1 row)
> select last_row(x), count(distinct y) from t;
  last_row | count
-----------+--------
         6 |     4
(1 row)
> select last_row(x), last_row(x), last_row(y) from t;
  last_row | last_row | last_row
-----------+----------+-----------
         6 |        6 |        6
(1 row)
> select last_row(*) from t;
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:35:59.688+00:00 |           6 |           6 | e           |           1
(1 row)
> select last_row(*), avg(x) from t;
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) |  avg
--------------------------------+-------------+-------------+-------------+-------------+--------
  2023-07-29 03:35:59.688+00:00 |           6 |           6 | e           |           1 | 3.325
(1 row)
> select last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from t;
            last_row            | last_row | last_row | last_row
--------------------------------+----------+----------+-----------
  2023-07-29 03:35:59.688+00:00 |        6 |        6 | e
(1 row)
> select last_row(k_timestamp), last_row(x), avg(x), last_row(y), last_row(z) from t;
            last_row            | last_row |  avg  | last_row | last_row
--------------------------------+----------+-------+----------+-----------
  2023-07-29 03:35:59.688+00:00 |        6 | 3.325 |        6 | e
(1 row)
> select last_row(x) from t where x > 1.0;
  last_row
------------
         6
(1 row)
> select last_row(y) from t where y > 2;
  last_row
------------
         6
(1 row)
> select last_row(y), sum(x) from t where y > 2;
  last_row | sum
-----------+-------
         6 | 16.5
(1 row)
> select last_row(z) from t where z in ('a', 'b', 'e');
  last_row
------------
  e
(1 row)
> select last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68';
  last_row | last_row | last_row
-----------+----------+-----------
         6 |        6 |        6
(1 row)
> select last_row(*) from t where y in (6,5,3,1);
      last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
--------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:35:59.688+00:00 |           6 |           6 | e           |           1
(1 row)
> select last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688';
            last_row            | last_row | last_row | last_row
--------------------------------+----------+----------+-----------
  2023-07-29 03:35:59.688+00:00 |        6 |        6 | e
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x) from t group by bucket order by bucket;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 |        2
  2023-07-29 03:15:00+00:00 |        4
  2023-07-29 03:25:00+00:00 |      5.5
  2023-07-29 03:35:00+00:00 |        6
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(y), sum(a) from t group by bucket order by bucket; -- throw error because cannot aggregate tag
           bucket           | last_row | sum
----------------------------+----------+------
  2023-07-29 03:10:00+00:00 |        2 |   3
  2023-07-29 03:15:00+00:00 |        2 |   2
  2023-07-29 03:25:00+00:00 |        5 |   2
  2023-07-29 03:35:00+00:00 |        6 |   1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(y) from t group by bucket order by bucket;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 |        2
  2023-07-29 03:15:00+00:00 |        2
  2023-07-29 03:25:00+00:00 |        5
  2023-07-29 03:35:00+00:00 |        6
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(z) from t group by bucket order by bucket;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 | b
  2023-07-29 03:15:00+00:00 | b
  2023-07-29 03:25:00+00:00 | e
  2023-07-29 03:35:00+00:00 | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x), last_row(x), last_row(y) from t group by bucket order by bucket;
           bucket           | last_row | last_row | last_row
----------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  2023-07-29 03:15:00+00:00 |        4 |        4 |        2
  2023-07-29 03:25:00+00:00 |      5.5 |      5.5 |        5
  2023-07-29 03:35:00+00:00 |        6 |        6 |        6
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(*) from t group by bucket order by bucket;
           bucket           |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
----------------------------+-------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |           2 |           2 | b           |           1
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |           4 |           2 | b           |           1
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |         5.5 |           5 | e           |           1
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |           6 |           6 | e           |           1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(*), count(*) from t group by bucket order by bucket;
           bucket           |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | count
----------------------------+-------------------------------+-------------+-------------+-------------+-------------+--------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |           2 |           2 | b           |           1 |     3
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |           4 |           2 | b           |           1 |     2
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |         5.5 |           5 | e           |           1 |     2
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |           6 |           6 | e           |           1 |     1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from t group by bucket order by bucket;
           bucket           |           last_row            | last_row | last_row | last_row
----------------------------+-------------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |        2 |        2 | b
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |        4 |        2 | b
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |      5.5 |        5 | e
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |        6 |        6 | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x) from t where x > 1.0 group by bucket order by bucket;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 |        2
  2023-07-29 03:15:00+00:00 |        4
  2023-07-29 03:25:00+00:00 |      5.5
  2023-07-29 03:35:00+00:00 |        6
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(y) from t where y > 2 group by bucket order by bucket;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:25:00+00:00 |        5
  2023-07-29 03:35:00+00:00 |        6
(2 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(z) from t where z in ('a', 'b', 'e') group by bucket order by bucket;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 | b
  2023-07-29 03:15:00+00:00 | b
  2023-07-29 03:25:00+00:00 | e
  2023-07-29 03:35:00+00:00 | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, count(distinct y), last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket order by bucket;
           bucket           | count | last_row | last_row | last_row
----------------------------+-------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 |     1 |        2 |        2 |        2
  2023-07-29 03:15:00+00:00 |     2 |        4 |        4 |        2
  2023-07-29 03:25:00+00:00 |     1 |      5.5 |      5.5 |        5
  2023-07-29 03:35:00+00:00 |     1 |        6 |        6 |        6
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket order by bucket;
           bucket           | last_row | last_row | last_row
----------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  2023-07-29 03:15:00+00:00 |        4 |        4 |        2
  2023-07-29 03:25:00+00:00 |      5.5 |      5.5 |        5
  2023-07-29 03:35:00+00:00 |        6 |        6 |        6
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(*) from t where y in (6,5,3,1) group by bucket order by bucket;
           bucket           |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
----------------------------+-------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.688+00:00 |           1 |           1 | a           |           1
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.688+00:00 |           3 |           1 | a           |           1
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |         5.5 |           5 | e           |           1
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |           6 |           6 | e           |           1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, sum(x), last_row(*), count(*) from t where y in (6,5,3,1) group by bucket order by bucket;
           bucket           | sum  |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | count
----------------------------+------+-------------------------------+-------------+-------------+-------------+-------------+--------
  2023-07-29 03:10:00+00:00 |    1 | 2023-07-29 03:11:59.688+00:00 |           1 |           1 | a           |           1 |     1
  2023-07-29 03:15:00+00:00 |    3 | 2023-07-29 03:15:59.688+00:00 |           3 |           1 | a           |           1 |     1
  2023-07-29 03:25:00+00:00 | 10.5 | 2023-07-29 03:26:59.688+00:00 |         5.5 |           5 | e           |           1 |     2
  2023-07-29 03:35:00+00:00 |    6 | 2023-07-29 03:35:59.688+00:00 |           6 |           6 | e           |           1 |     1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket order by bucket;
           bucket           |           last_row            | last_row | last_row | last_row
----------------------------+-------------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |        2 |        2 | b
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |        4 |        2 | b
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |      5.5 |        5 | e
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |        6 |        6 | e
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x) from t where x > 1.0 group by bucket, y order by bucket, y;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 |        2
  2023-07-29 03:15:00+00:00 |        3
  2023-07-29 03:15:00+00:00 |        4
  2023-07-29 03:25:00+00:00 |      5.5
  2023-07-29 03:35:00+00:00 |        6
(5 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(y) from t where y > 2 group by bucket, z order by bucket, z;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:25:00+00:00 |        5
  2023-07-29 03:35:00+00:00 |        6
(2 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(z) from t where z in ('a', 'b', 'e') group by bucket, y order by bucket, y;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 | a
  2023-07-29 03:10:00+00:00 | b
  2023-07-29 03:15:00+00:00 | a
  2023-07-29 03:15:00+00:00 | b
  2023-07-29 03:25:00+00:00 | e
  2023-07-29 03:35:00+00:00 | e
(6 rows)
> select time_bucket(k_timestamp, '300s') bucket, count(distinct y), last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last_row(x) < 100 order by bucket, z;
           bucket           | count | last_row | last_row | last_row
----------------------------+-------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 |     1 |        2 |        2 |        2
  2023-07-29 03:15:00+00:00 |     1 |        3 |        3 |        1
  2023-07-29 03:15:00+00:00 |     1 |        4 |        4 |        2
  2023-07-29 03:25:00+00:00 |     1 |      5.5 |      5.5 |        5
  2023-07-29 03:35:00+00:00 |     1 |        6 |        6 |        6
(5 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last_row(y) > 2 order by bucket, z;
           bucket           | last_row | last_row | last_row
----------------------------+----------+----------+-----------
  2023-07-29 03:25:00+00:00 |      5.5 |      5.5 |        5
  2023-07-29 03:35:00+00:00 |        6 |        6 |        6
(2 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y;
           bucket           |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
----------------------------+-------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.688+00:00 |           1 |           1 | a           |           1
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.688+00:00 |           3 |           1 | a           |           1
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |         5.5 |           5 | e           |           1
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |           6 |           6 | e           |           1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, sum(x), last_row(*), count(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y;
           bucket           | sum  |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | count
----------------------------+------+-------------------------------+-------------+-------------+-------------+-------------+--------
  2023-07-29 03:10:00+00:00 |    1 | 2023-07-29 03:11:59.688+00:00 |           1 |           1 | a           |           1 |     1
  2023-07-29 03:15:00+00:00 |    3 | 2023-07-29 03:15:59.688+00:00 |           3 |           1 | a           |           1 |     1
  2023-07-29 03:25:00+00:00 | 10.5 | 2023-07-29 03:26:59.688+00:00 |         5.5 |           5 | e           |           1 |     2
  2023-07-29 03:35:00+00:00 |    6 | 2023-07-29 03:35:59.688+00:00 |           6 |           6 | e           |           1 |     1
(4 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, y having last_row(x) > 1.5 order by bucket, y;
           bucket           |           last_row            | last_row | last_row | last_row
----------------------------+-------------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |        2 |        2 | b
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.688+00:00 |        3 |        1 | a
  2023-07-29 03:15:00+00:00 | 2023-07-29 03:18:59.688+00:00 |        4 |        2 | b
  2023-07-29 03:25:00+00:00 | 2023-07-29 03:26:59.688+00:00 |      5.5 |        5 | e
  2023-07-29 03:35:00+00:00 | 2023-07-29 03:35:59.688+00:00 |        6 |        6 | e
(5 rows)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x) from t where x > 1.0 group by bucket, y order by bucket, y limit 1;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 |        2
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(y) from t where y > 2 group by bucket, z order by bucket, z limit 1;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:25:00+00:00 |        5
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(z) from t where z in ('a', 'b', 'e') group by bucket, y order by bucket, y limit 1;
           bucket           | last_row
----------------------------+-----------
  2023-07-29 03:10:00+00:00 | a
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, count(distinct y), last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last_row(x) < 100 order by bucket, z limit 1;
           bucket           | count | last_row | last_row | last_row
----------------------------+-------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 |     1 |        2 |        2 |        2
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x), last_row(x), last_row(y) from t where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, z having last_row(y) > 2 order by bucket, z limit 1;
           bucket           | last_row | last_row | last_row
----------------------------+----------+----------+-----------
  2023-07-29 03:25:00+00:00 |      5.5 |      5.5 |        5
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y limit 1;
           bucket           |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a)
----------------------------+-------------------------------+-------------+-------------+-------------+--------------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.688+00:00 |           1 |           1 | a           |           1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, sum(x), last_row(*), count(*) from t where y in (6,5,3,1) group by bucket, y order by bucket, y limit 1;
           bucket           | sum |     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | count
----------------------------+-----+-------------------------------+-------------+-------------+-------------+-------------+--------
  2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.688+00:00 |           1 |           1 | a           |           1 |     1
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from t where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, y having last_row(x) > 1.5 order by bucket, y limit 1;
           bucket           |           last_row            | last_row | last_row | last_row
----------------------------+-------------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.688+00:00 |        2 |        2 | b
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(*), count(*) from t group by bucket having last_row(*) > 1;
ERROR: last_row(): cannot use "*" in this context
SQLSTATE: 42601
> select last_row(t1.*), last_row(t2.*) from t t1, t t2 where t1.y = t2.y;
ERROR: last_row() can only be used in timeseries table query or subquery
SQLSTATE: 0A000
> select last_row(x+1) from t;
ERROR: at or near "+": syntax error
SQLSTATE: 42601
DETAIL: source SQL:
select last_row(x+1) from t
                 ^
HINT: try \hf last_row
> create table ts(k_timestamp timestamp not null, x int, y float, z varchar(32), a char(1)) tags(tabName varchar(10) not null, location varchar(32), d_type smallint) primary tags(tabName);
CREATE TABLE
> select last(x) from ts;
  last
--------
  NULL
(1 row)
> select last(y) from ts;
  last
--------
  NULL
(1 row)
> select last(z) from ts;
  last
--------
  NULL
(1 row)
> select last(z), sum(x) from ts;
  last | sum
-------+-------
  NULL | NULL
(1 row)
> select last(x), last(x), last(y) from ts;
  last | last | last
-------+------+-------
  NULL | NULL | NULL
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last(x) from ts where x > 1.0 group by bucket;
  bucket | last
---------+-------
(0 rows)
> select last_row(x) from ts;
  last_row
------------
  NULL
(1 row)
> select last_row(y) from ts;
  last_row
------------
  NULL
(1 row)
> select last_row(z) from ts;
  last_row
------------
  NULL
(1 row)
> select last_row(z), sum(x) from ts;
  last_row | sum
-----------+-------
  NULL     | NULL
(1 row)
> select last_row(x), last_row(x), last_row(y) from ts;
  last_row | last_row | last_row
-----------+----------+-----------
  NULL     | NULL     | NULL
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, last_row(x) from ts where x > 1.0 group by bucket;
  bucket | last_row
---------+-----------
(0 rows)
> insert into ts values('2023-07-29 03:10:59.680', 1, 1.0, 'aaa', 'a', 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:12:59.680', 2, 2.0, 'bbb', 'b', 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:15:59.680', 2, 3.0, 'ccc', 'c', 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:17:59.680', 3, 4.0, 'ddd', 'd', 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:19:59.680', 5, 5.0, 'eee', 'e', 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:29:59.680', 2, 6.0, 'eee', 'e', 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:30:59.680', 8, 7.0, 'bbb', 'b', 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:32:59.680', 8, 8.0, 'ccc', 'c', 'ts_1', 'Milpitas', 1);
INSERT 1
> insert into ts values('2023-07-29 03:10:59.680', 1, 1.0, 'aaa', 'a', 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:12:59.680', 2, 2.0, 'bbb', 'b', 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:15:59.680', 2, 3.0, 'ccc', 'c', 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:17:59.680', 3, 4.0, 'ddd', 'd', 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:19:59.680', 5, 5.0, 'eee', 'e', 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:29:59.680', 2, 6.0, 'eee', 'e', 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:30:59.680', 8, 7.0, 'bbb', 'b', 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:32:59.680', 8, 8.0, 'ccc', 'c', 'ts_2', 'JiNan', 2);
INSERT 1
> insert into ts values('2023-07-29 03:11:59.680', 1, 1.0, 'aaa', 'a', 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:14:59.680', 2, 2.0, 'bbb', 'b', 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:15:59.680', 2, 3.0, 'ccc', 'c', 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:17:59.680', 3, 4.0, 'ddd', 'd', 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:25:59.680', 5, 5.0, 'eee', 'e', 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:29:59.680', 2, 6.0, 'eee', 'e', 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:30:59.680', 8, 7.0, 'bbb', 'b', 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:32:59.680', 8, 8.0, 'ccc', 'c', 'ts_3', 'ShangHai', 3);
INSERT 1
> insert into ts values('2023-07-29 03:11:59.680', 1, 1.0, 'aaa', 'a','ts_4','TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:14:59.680', 2, 2.0, 'bbb', 'b','ts_4','TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:15:59.680', 2, 3.0, 'ccc', 'c','ts_4','TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:17:59.680', 3, 4.0, 'ddd', 'd','ts_4','TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:25:59.680', 5, 5.0, 'eee', 'e','ts_4','TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:29:59.680', 2, 6.0, 'eee', 'e','ts_4','TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:30:59.680', 8, 7.0, 'bbb', 'b','ts_4','TianJin', 4);
INSERT 1
> insert into ts values('2023-07-29 03:32:59.680', 8, 8.0, 'ccc', 'c','ts_4','TianJin', 4);
INSERT 1
> select last(x) from ts group by location order by location;
  last
--------
     8
     8
     8
     8
(4 rows)
> select last(y) from ts group by location order by location;
  last
--------
     8
     8
     8
     8
(4 rows)
> select last(z) from ts group by location order by location;
  last
--------
  ccc
  ccc
  ccc
  ccc
(4 rows)
> select last(z), sum(x) from ts group by location order by location;
  last | sum
-------+------
  ccc  |  31
  ccc  |  31
  ccc  |  31
  ccc  |  31
(4 rows)
> select last(x), last(x), last(y) from ts group by location order by location;
  last | last | last
-------+------+-------
     8 |    8 |    8
     8 |    8 |    8
     8 |    8 |    8
     8 |    8 |    8
(4 rows)
> select last(*) from ts group by location order by location;
       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(tabname) | last(location) | last(d_type)
-------------------------------+---------+---------+---------+---------+---------------+----------------+---------------
  2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_2          | JiNan          |            2
  2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_1          | Milpitas       |            1
  2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_3          | ShangHai       |            3
  2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_4          | TianJin        |            4
(4 rows)
> select last(*), avg(x) from ts group by location order by location;
       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(tabname) | last(location) | last(d_type) |  avg
-------------------------------+---------+---------+---------+---------+---------------+----------------+--------------+--------
  2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_2          | JiNan          |            2 | 3.875
  2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_1          | Milpitas       |            1 | 3.875
  2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_3          | ShangHai       |            3 | 3.875
  2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_4          | TianJin        |            4 | 3.875
(4 rows)
> select last(k_timestamp), last(x), last(y), last(z) from ts group by location order by location;
              last             | last | last | last
-------------------------------+------+------+-------
  2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
(4 rows)
> select last(k_timestamp), last(x), avg(x), last(y), last(z) from ts group by location order by location;
              last             | last |  avg  | last | last
-------------------------------+------+-------+------+-------
  2023-07-29 03:32:59.68+00:00 |    8 | 3.875 |    8 | ccc
  2023-07-29 03:32:59.68+00:00 |    8 | 3.875 |    8 | ccc
  2023-07-29 03:32:59.68+00:00 |    8 | 3.875 |    8 | ccc
  2023-07-29 03:32:59.68+00:00 |    8 | 3.875 |    8 | ccc
(4 rows)
> select last(x) from ts where x > 1.0 group by location order by location;
  last
--------
     8
     8
     8
     8
(4 rows)
> select last(y) from ts where y > 2 group by location order by location;
  last
--------
     8
     8
     8
     8
(4 rows)
> select last(y), sum(x) from ts where y > 2 group by location order by location;
  last | sum
-------+------
     8 |  28
     8 |  28
     8 |  28
     8 |  28
(4 rows)
> select last(z) from ts where z in ('aaa', 'bbb', 'eee') group by location order by location;
  last
--------
  bbb
  bbb
  bbb
  bbb
(4 rows)
> select last(x), last(x), last(y) from ts where k_timestamp > '2023-07-29 03:12:59.68' group by location order by location;
  last | last | last
-------+------+-------
     8 |    8 |    8
     8 |    8 |    8
     8 |    8 |    8
     8 |    8 |    8
(4 rows)
> select last(*) from ts where y in (6,5,3,1) group by location order by location;
       last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(tabname) | last(location) | last(d_type)
-------------------------------+---------+---------+---------+---------+---------------+----------------+---------------
  2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_2          | JiNan          |            2
  2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_1          | Milpitas       |            1
  2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_3          | ShangHai       |            3
  2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_4          | TianJin        |            4
(4 rows)
> select last(k_timestamp), last(x), last(y), last(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by location order by location;
              last             | last | last | last
-------------------------------+------+------+-------
  2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
(4 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(x) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last
-----------+---------------------------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 |    2
  Milpitas | 2023-07-29 03:10:00+00:00 |    2
  ShangHai | 2023-07-29 03:10:00+00:00 |    2
  TianJin  | 2023-07-29 03:10:00+00:00 |    2
  JiNan    | 2023-07-29 03:15:00+00:00 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |    5
  ShangHai | 2023-07-29 03:15:00+00:00 |    3
  TianJin  | 2023-07-29 03:15:00+00:00 |    3
  JiNan    | 2023-07-29 03:25:00+00:00 |    2
  Milpitas | 2023-07-29 03:25:00+00:00 |    2
  ShangHai | 2023-07-29 03:25:00+00:00 |    2
  TianJin  | 2023-07-29 03:25:00+00:00 |    2
  JiNan    | 2023-07-29 03:30:00+00:00 |    8
  Milpitas | 2023-07-29 03:30:00+00:00 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |    8
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(y), sum(a) from ts group by bucket, location order by bucket, location; -- error because a is an attribute
ERROR: unknown signature: sum(CHAR)
SQLSTATE: 42883
> select location, time_bucket(k_timestamp, '300s') bucket, last(y) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last
-----------+---------------------------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 |    2
  Milpitas | 2023-07-29 03:10:00+00:00 |    2
  ShangHai | 2023-07-29 03:10:00+00:00 |    2
  TianJin  | 2023-07-29 03:10:00+00:00 |    2
  JiNan    | 2023-07-29 03:15:00+00:00 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |    5
  ShangHai | 2023-07-29 03:15:00+00:00 |    4
  TianJin  | 2023-07-29 03:15:00+00:00 |    4
  JiNan    | 2023-07-29 03:25:00+00:00 |    6
  Milpitas | 2023-07-29 03:25:00+00:00 |    6
  ShangHai | 2023-07-29 03:25:00+00:00 |    6
  TianJin  | 2023-07-29 03:25:00+00:00 |    6
  JiNan    | 2023-07-29 03:30:00+00:00 |    8
  Milpitas | 2023-07-29 03:30:00+00:00 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |    8
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(z) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last
-----------+---------------------------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | bbb
  JiNan    | 2023-07-29 03:15:00+00:00 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | eee
  ShangHai | 2023-07-29 03:15:00+00:00 | ddd
  TianJin  | 2023-07-29 03:15:00+00:00 | ddd
  JiNan    | 2023-07-29 03:25:00+00:00 | eee
  Milpitas | 2023-07-29 03:25:00+00:00 | eee
  ShangHai | 2023-07-29 03:25:00+00:00 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | eee
  JiNan    | 2023-07-29 03:30:00+00:00 | ccc
  Milpitas | 2023-07-29 03:30:00+00:00 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | ccc
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(x), last(x), last(y) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last | last | last
-----------+---------------------------+------+------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  Milpitas | 2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  ShangHai | 2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  TianJin  | 2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  JiNan    | 2023-07-29 03:15:00+00:00 |    5 |    5 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |    5 |    5 |    5
  ShangHai | 2023-07-29 03:15:00+00:00 |    3 |    3 |    4
  TianJin  | 2023-07-29 03:15:00+00:00 |    3 |    3 |    4
  JiNan    | 2023-07-29 03:25:00+00:00 |    2 |    2 |    6
  Milpitas | 2023-07-29 03:25:00+00:00 |    2 |    2 |    6
  ShangHai | 2023-07-29 03:25:00+00:00 |    2 |    2 |    6
  TianJin  | 2023-07-29 03:25:00+00:00 |    2 |    2 |    6
  JiNan    | 2023-07-29 03:30:00+00:00 |    8 |    8 |    8
  Milpitas | 2023-07-29 03:30:00+00:00 |    8 |    8 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |    8 |    8 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |    8 |    8 |    8
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(*) from ts group by bucket, location order by bucket, location;
  location |          bucket           |      last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(tabname) | last(location) | last(d_type)
-----------+---------------------------+------------------------------+---------+---------+---------+---------+---------------+----------------+---------------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |       2 |       2 | bbb     | b       | ts_2          | JiNan          |            2
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |       2 |       2 | bbb     | b       | ts_1          | Milpitas       |            1
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |       2 |       2 | bbb     | b       | ts_3          | ShangHai       |            3
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |       2 |       2 | bbb     | b       | ts_4          | TianJin        |            4
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | e       | ts_2          | JiNan          |            2
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | e       | ts_1          | Milpitas       |            1
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |       3 |       4 | ddd     | d       | ts_3          | ShangHai       |            3
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |       3 |       4 | ddd     | d       | ts_4          | TianJin        |            4
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_2          | JiNan          |            2
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_1          | Milpitas       |            1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_3          | ShangHai       |            3
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_4          | TianJin        |            4
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_2          | JiNan          |            2
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_1          | Milpitas       |            1
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_3          | ShangHai       |            3
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_4          | TianJin        |            4
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(*), count(*) from ts group by bucket, location order by bucket, location;
  location |          bucket           |      last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(tabname) | last(location) | last(d_type) | count
-----------+---------------------------+------------------------------+---------+---------+---------+---------+---------------+----------------+--------------+--------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |       2 |       2 | bbb     | b       | ts_2          | JiNan          |            2 |     2
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |       2 |       2 | bbb     | b       | ts_1          | Milpitas       |            1 |     2
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |       2 |       2 | bbb     | b       | ts_3          | ShangHai       |            3 |     2
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |       2 |       2 | bbb     | b       | ts_4          | TianJin        |            4 |     2
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | e       | ts_2          | JiNan          |            2 |     3
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | e       | ts_1          | Milpitas       |            1 |     3
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |       3 |       4 | ddd     | d       | ts_3          | ShangHai       |            3 |     2
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |       3 |       4 | ddd     | d       | ts_4          | TianJin        |            4 |     2
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_2          | JiNan          |            2 |     1
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_1          | Milpitas       |            1 |     1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_3          | ShangHai       |            3 |     2
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_4          | TianJin        |            4 |     2
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_2          | JiNan          |            2 |     2
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_1          | Milpitas       |            1 |     2
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_3          | ShangHai       |            3 |     2
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |       8 |       8 | ccc     | c       | ts_4          | TianJin        |            4 |     2
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from ts group by bucket, location order by bucket, location;
  location |          bucket           |             last             | last | last | last
-----------+---------------------------+------------------------------+------+------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |    2 |    2 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |    2 |    2 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | bbb
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |    5 |    5 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |    5 |    5 | eee
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |    3 |    4 | ddd
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |    3 |    4 | ddd
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(x) from ts where x > 1.0 group by bucket, location order by bucket, location;
  location |          bucket           | last
-----------+---------------------------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 |    2
  Milpitas | 2023-07-29 03:10:00+00:00 |    2
  ShangHai | 2023-07-29 03:10:00+00:00 |    2
  TianJin  | 2023-07-29 03:10:00+00:00 |    2
  JiNan    | 2023-07-29 03:15:00+00:00 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |    5
  ShangHai | 2023-07-29 03:15:00+00:00 |    3
  TianJin  | 2023-07-29 03:15:00+00:00 |    3
  JiNan    | 2023-07-29 03:25:00+00:00 |    2
  Milpitas | 2023-07-29 03:25:00+00:00 |    2
  ShangHai | 2023-07-29 03:25:00+00:00 |    2
  TianJin  | 2023-07-29 03:25:00+00:00 |    2
  JiNan    | 2023-07-29 03:30:00+00:00 |    8
  Milpitas | 2023-07-29 03:30:00+00:00 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |    8
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(y) from ts where y > 2 group by bucket, location order by bucket, location;
  location |          bucket           | last
-----------+---------------------------+-------
  JiNan    | 2023-07-29 03:15:00+00:00 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |    5
  ShangHai | 2023-07-29 03:15:00+00:00 |    4
  TianJin  | 2023-07-29 03:15:00+00:00 |    4
  JiNan    | 2023-07-29 03:25:00+00:00 |    6
  Milpitas | 2023-07-29 03:25:00+00:00 |    6
  ShangHai | 2023-07-29 03:25:00+00:00 |    6
  TianJin  | 2023-07-29 03:25:00+00:00 |    6
  JiNan    | 2023-07-29 03:30:00+00:00 |    8
  Milpitas | 2023-07-29 03:30:00+00:00 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |    8
(12 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(z) from ts where z in ('aaa', 'bbb', 'eee') group by bucket, location order by bucket, location;
  location |          bucket           | last
-----------+---------------------------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | bbb
  JiNan    | 2023-07-29 03:15:00+00:00 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | eee
  JiNan    | 2023-07-29 03:25:00+00:00 | eee
  Milpitas | 2023-07-29 03:25:00+00:00 | eee
  ShangHai | 2023-07-29 03:25:00+00:00 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | eee
  JiNan    | 2023-07-29 03:30:00+00:00 | bbb
  Milpitas | 2023-07-29 03:30:00+00:00 | bbb
  ShangHai | 2023-07-29 03:30:00+00:00 | bbb
  TianJin  | 2023-07-29 03:30:00+00:00 | bbb
(14 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, count(distinct y), last(x), last(x), last(y) from ts where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, location order by bucket, location;
  location |          bucket           | count | last | last | last
-----------+---------------------------+-------+------+------+-------
  ShangHai | 2023-07-29 03:10:00+00:00 |     1 |    2 |    2 |    2
  TianJin  | 2023-07-29 03:10:00+00:00 |     1 |    2 |    2 |    2
  JiNan    | 2023-07-29 03:15:00+00:00 |     3 |    5 |    5 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |     3 |    5 |    5 |    5
  ShangHai | 2023-07-29 03:15:00+00:00 |     2 |    3 |    3 |    4
  TianJin  | 2023-07-29 03:15:00+00:00 |     2 |    3 |    3 |    4
  JiNan    | 2023-07-29 03:25:00+00:00 |     1 |    2 |    2 |    6
  Milpitas | 2023-07-29 03:25:00+00:00 |     1 |    2 |    2 |    6
  ShangHai | 2023-07-29 03:25:00+00:00 |     2 |    2 |    2 |    6
  TianJin  | 2023-07-29 03:25:00+00:00 |     2 |    2 |    2 |    6
  JiNan    | 2023-07-29 03:30:00+00:00 |     2 |    8 |    8 |    8
  Milpitas | 2023-07-29 03:30:00+00:00 |     2 |    8 |    8 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |     2 |    8 |    8 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |     2 |    8 |    8 |    8
(14 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(x), last(x), last(y) from ts where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, location order by bucket, location;
  location |          bucket           | last | last | last
-----------+---------------------------+------+------+-------
  ShangHai | 2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  TianJin  | 2023-07-29 03:10:00+00:00 |    2 |    2 |    2
  JiNan    | 2023-07-29 03:15:00+00:00 |    5 |    5 |    5
  Milpitas | 2023-07-29 03:15:00+00:00 |    5 |    5 |    5
  ShangHai | 2023-07-29 03:15:00+00:00 |    3 |    3 |    4
  TianJin  | 2023-07-29 03:15:00+00:00 |    3 |    3 |    4
  JiNan    | 2023-07-29 03:25:00+00:00 |    2 |    2 |    6
  Milpitas | 2023-07-29 03:25:00+00:00 |    2 |    2 |    6
  ShangHai | 2023-07-29 03:25:00+00:00 |    2 |    2 |    6
  TianJin  | 2023-07-29 03:25:00+00:00 |    2 |    2 |    6
  JiNan    | 2023-07-29 03:30:00+00:00 |    8 |    8 |    8
  Milpitas | 2023-07-29 03:30:00+00:00 |    8 |    8 |    8
  ShangHai | 2023-07-29 03:30:00+00:00 |    8 |    8 |    8
  TianJin  | 2023-07-29 03:30:00+00:00 |    8 |    8 |    8
(14 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location;
  location |          bucket           |      last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(tabname) | last(location) | last(d_type)
-----------+---------------------------+------------------------------+---------+---------+---------+---------+---------------+----------------+---------------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:10:59.68+00:00 |       1 |       1 | aaa     | a       | ts_2          | JiNan          |            2
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:10:59.68+00:00 |       1 |       1 | aaa     | a       | ts_1          | Milpitas       |            1
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.68+00:00 |       1 |       1 | aaa     | a       | ts_3          | ShangHai       |            3
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.68+00:00 |       1 |       1 | aaa     | a       | ts_4          | TianJin        |            4
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | e       | ts_2          | JiNan          |            2
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | e       | ts_1          | Milpitas       |            1
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.68+00:00 |       2 |       3 | ccc     | c       | ts_3          | ShangHai       |            3
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.68+00:00 |       2 |       3 | ccc     | c       | ts_4          | TianJin        |            4
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_2          | JiNan          |            2
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_1          | Milpitas       |            1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_3          | ShangHai       |            3
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_4          | TianJin        |            4
(12 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, sum(x), last(*), count(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location;
  location |          bucket           | sum |      last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(tabname) | last(location) | last(d_type) | count
-----------+---------------------------+-----+------------------------------+---------+---------+---------+---------+---------------+----------------+--------------+--------
  JiNan    | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:10:59.68+00:00 |       1 |       1 | aaa     | a       | ts_2          | JiNan          |            2 |     1
  Milpitas | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:10:59.68+00:00 |       1 |       1 | aaa     | a       | ts_1          | Milpitas       |            1 |     1
  ShangHai | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.68+00:00 |       1 |       1 | aaa     | a       | ts_3          | ShangHai       |            3 |     1
  TianJin  | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.68+00:00 |       1 |       1 | aaa     | a       | ts_4          | TianJin        |            4 |     1
  JiNan    | 2023-07-29 03:15:00+00:00 |   7 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | e       | ts_2          | JiNan          |            2 |     2
  Milpitas | 2023-07-29 03:15:00+00:00 |   7 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | e       | ts_1          | Milpitas       |            1 |     2
  ShangHai | 2023-07-29 03:15:00+00:00 |   2 | 2023-07-29 03:15:59.68+00:00 |       2 |       3 | ccc     | c       | ts_3          | ShangHai       |            3 |     1
  TianJin  | 2023-07-29 03:15:00+00:00 |   2 | 2023-07-29 03:15:59.68+00:00 |       2 |       3 | ccc     | c       | ts_4          | TianJin        |            4 |     1
  JiNan    | 2023-07-29 03:25:00+00:00 |   2 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_2          | JiNan          |            2 |     1
  Milpitas | 2023-07-29 03:25:00+00:00 |   2 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_1          | Milpitas       |            1 |     1
  ShangHai | 2023-07-29 03:25:00+00:00 |   7 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_3          | ShangHai       |            3 |     2
  TianJin  | 2023-07-29 03:25:00+00:00 |   7 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_4          | TianJin        |            4 |     2
(12 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location order by bucket, location;
  location |          bucket           |             last             | last | last | last
-----------+---------------------------+------------------------------+------+------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |    2 |    2 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |    2 |    2 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | bbb
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |    5 |    5 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |    5 |    5 | eee
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |    3 |    4 | ddd
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |    3 |    4 | ddd
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location;
  location |          bucket           |      last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(tabname) | last(location) | last(d_type)
-----------+---------------------------+------------------------------+---------+---------+---------+---------+---------------+----------------+---------------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:10:59.68+00:00 |       1 |       1 | aaa     | a       | ts_2          | JiNan          |            2
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:10:59.68+00:00 |       1 |       1 | aaa     | a       | ts_1          | Milpitas       |            1
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.68+00:00 |       1 |       1 | aaa     | a       | ts_3          | ShangHai       |            3
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.68+00:00 |       1 |       1 | aaa     | a       | ts_4          | TianJin        |            4
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | e       | ts_2          | JiNan          |            2
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | e       | ts_1          | Milpitas       |            1
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.68+00:00 |       2 |       3 | ccc     | c       | ts_3          | ShangHai       |            3
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.68+00:00 |       2 |       3 | ccc     | c       | ts_4          | TianJin        |            4
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_2          | JiNan          |            2
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_1          | Milpitas       |            1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_3          | ShangHai       |            3
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_4          | TianJin        |            4
(12 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, sum(x), last(*), count(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location;
  location |          bucket           | sum |      last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(tabname) | last(location) | last(d_type) | count
-----------+---------------------------+-----+------------------------------+---------+---------+---------+---------+---------------+----------------+--------------+--------
  JiNan    | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:10:59.68+00:00 |       1 |       1 | aaa     | a       | ts_2          | JiNan          |            2 |     1
  Milpitas | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:10:59.68+00:00 |       1 |       1 | aaa     | a       | ts_1          | Milpitas       |            1 |     1
  ShangHai | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.68+00:00 |       1 |       1 | aaa     | a       | ts_3          | ShangHai       |            3 |     1
  TianJin  | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.68+00:00 |       1 |       1 | aaa     | a       | ts_4          | TianJin        |            4 |     1
  JiNan    | 2023-07-29 03:15:00+00:00 |   7 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | e       | ts_2          | JiNan          |            2 |     2
  Milpitas | 2023-07-29 03:15:00+00:00 |   7 | 2023-07-29 03:19:59.68+00:00 |       5 |       5 | eee     | e       | ts_1          | Milpitas       |            1 |     2
  ShangHai | 2023-07-29 03:15:00+00:00 |   2 | 2023-07-29 03:15:59.68+00:00 |       2 |       3 | ccc     | c       | ts_3          | ShangHai       |            3 |     1
  TianJin  | 2023-07-29 03:15:00+00:00 |   2 | 2023-07-29 03:15:59.68+00:00 |       2 |       3 | ccc     | c       | ts_4          | TianJin        |            4 |     1
  JiNan    | 2023-07-29 03:25:00+00:00 |   2 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_2          | JiNan          |            2 |     1
  Milpitas | 2023-07-29 03:25:00+00:00 |   2 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_1          | Milpitas       |            1 |     1
  ShangHai | 2023-07-29 03:25:00+00:00 |   7 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_3          | ShangHai       |            3 |     2
  TianJin  | 2023-07-29 03:25:00+00:00 |   7 | 2023-07-29 03:29:59.68+00:00 |       2 |       6 | eee     | e       | ts_4          | TianJin        |            4 |     2
(12 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last(x) > 1.5 order by bucket, location;
  location |          bucket           |             last             | last | last | last
-----------+---------------------------+------------------------------+------+------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |    2 |    2 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |    2 |    2 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | bbb
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |    5 |    5 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |    5 |    5 | eee
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |    3 |    4 | ddd
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |    3 |    4 | ddd
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
(16 rows)
> select time_bucket(k_timestamp, '300s') bucket, location, last(k_timestamp), last(x), last(y), last(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last(x) > 1.5 order by bucket, location;
           bucket           | location |             last             | last | last | last
----------------------------+----------+------------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 | JiNan    | 2023-07-29 03:12:59.68+00:00 |    2 |    2 | bbb
  2023-07-29 03:10:00+00:00 | Milpitas | 2023-07-29 03:12:59.68+00:00 |    2 |    2 | bbb
  2023-07-29 03:10:00+00:00 | ShangHai | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | bbb
  2023-07-29 03:10:00+00:00 | TianJin  | 2023-07-29 03:14:59.68+00:00 |    2 |    2 | bbb
  2023-07-29 03:15:00+00:00 | JiNan    | 2023-07-29 03:19:59.68+00:00 |    5 |    5 | eee
  2023-07-29 03:15:00+00:00 | Milpitas | 2023-07-29 03:19:59.68+00:00 |    5 |    5 | eee
  2023-07-29 03:15:00+00:00 | ShangHai | 2023-07-29 03:17:59.68+00:00 |    3 |    4 | ddd
  2023-07-29 03:15:00+00:00 | TianJin  | 2023-07-29 03:17:59.68+00:00 |    3 |    4 | ddd
  2023-07-29 03:25:00+00:00 | JiNan    | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  2023-07-29 03:25:00+00:00 | Milpitas | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  2023-07-29 03:25:00+00:00 | ShangHai | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  2023-07-29 03:25:00+00:00 | TianJin  | 2023-07-29 03:29:59.68+00:00 |    2 |    6 | eee
  2023-07-29 03:30:00+00:00 | JiNan    | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:30:00+00:00 | Milpitas | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:30:00+00:00 | ShangHai | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
  2023-07-29 03:30:00+00:00 | TianJin  | 2023-07-29 03:32:59.68+00:00 |    8 |    8 | ccc
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last(*) from ts where y in (6,5,3,1) group by bucket, location, y order by bucket, location, y limit 1;
  location |          bucket           |      last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(tabname) | last(location) | last(d_type)
-----------+---------------------------+------------------------------+---------+---------+---------+---------+---------------+----------------+---------------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:10:59.68+00:00 |       1 |       1 | aaa     | a       | ts_2          | JiNan          |            2
(1 row)
> select location, time_bucket(k_timestamp, '300s') bucket, sum(x), last(*), count(*) from ts where y in (6,5,3,1) group by bucket, location,y order by bucket, location, y limit 1;
  location |          bucket           | sum |      last(k_timestamp)       | last(x) | last(y) | last(z) | last(a) | last(tabname) | last(location) | last(d_type) | count
-----------+---------------------------+-----+------------------------------+---------+---------+---------+---------+---------------+----------------+--------------+--------
  JiNan    | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:10:59.68+00:00 |       1 |       1 | aaa     | a       | ts_2          | JiNan          |            2 |     1
(1 row)
> select location, time_bucket(k_timestamp, '300s') bucket, last(k_timestamp), last(x), last(y), last(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last(x) > 1.5 order by bucket, location limit 1;
  location |          bucket           |             last             | last | last | last
-----------+---------------------------+------------------------------+------+------+-------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |    2 |    2 | bbb
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, location, last(k_timestamp), last(x), last(y), last(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last(x) > 1.5 order by bucket, location limit 1;
           bucket           | location |             last             | last | last | last
----------------------------+----------+------------------------------+------+------+-------
  2023-07-29 03:10:00+00:00 | JiNan    | 2023-07-29 03:12:59.68+00:00 |    2 |    2 | bbb
(1 row)
> select last_row(x) from ts group by location order by location;
  last_row
------------
         8
         8
         8
         8
(4 rows)
> select last_row(y) from ts group by location order by location;
  last_row
------------
         8
         8
         8
         8
(4 rows)
> select last_row(z) from ts group by location order by location;
  last_row
------------
  ccc
  ccc
  ccc
  ccc
(4 rows)
> select last_row(z), sum(x) from ts group by location order by location;
  last_row | sum
-----------+------
  ccc      |  31
  ccc      |  31
  ccc      |  31
  ccc      |  31
(4 rows)
> select last_row(x), last_row(x), last_row(y) from ts group by location order by location;
  last_row | last_row | last_row
-----------+----------+-----------
         8 |        8 |        8
         8 |        8 |        8
         8 |        8 |        8
         8 |        8 |        8
(4 rows)
> select last_row(*) from ts group by location order by location;
     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(tabname) | last_row(location) | last_row(d_type)
-------------------------------+-------------+-------------+-------------+-------------+-------------------+--------------------+-------------------
  2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_2              | JiNan              |                2
  2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_1              | Milpitas           |                1
  2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_3              | ShangHai           |                3
  2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_4              | TianJin            |                4
(4 rows)
> select last_row(*), avg(x) from ts group by location order by location;
     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(tabname) | last_row(location) | last_row(d_type) |  avg
-------------------------------+-------------+-------------+-------------+-------------+-------------------+--------------------+------------------+--------
  2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_2              | JiNan              |                2 | 3.875
  2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_1              | Milpitas           |                1 | 3.875
  2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_3              | ShangHai           |                3 | 3.875
  2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_4              | TianJin            |                4 | 3.875
(4 rows)
> select last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts group by location order by location;
            last_row           | last_row | last_row | last_row
-------------------------------+----------+----------+-----------
  2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
(4 rows)
> select last_row(k_timestamp), last_row(x), avg(x), last_row(y), last_row(z) from ts group by location order by location;
            last_row           | last_row |  avg  | last_row | last_row
-------------------------------+----------+-------+----------+-----------
  2023-07-29 03:32:59.68+00:00 |        8 | 3.875 |        8 | ccc
  2023-07-29 03:32:59.68+00:00 |        8 | 3.875 |        8 | ccc
  2023-07-29 03:32:59.68+00:00 |        8 | 3.875 |        8 | ccc
  2023-07-29 03:32:59.68+00:00 |        8 | 3.875 |        8 | ccc
(4 rows)
> select last_row(x) from ts where x > 1.0 group by location order by location;
  last_row
------------
         8
         8
         8
         8
(4 rows)
> select last_row(y) from ts where y > 2 group by location order by location;
  last_row
------------
         8
         8
         8
         8
(4 rows)
> select last_row(y), sum(x) from ts where y > 2 group by location order by location;
  last_row | sum
-----------+------
         8 |  28
         8 |  28
         8 |  28
         8 |  28
(4 rows)
> select last_row(z) from ts where z in ('aaa', 'bbb', 'eee') group by location order by location;
  last_row
------------
  bbb
  bbb
  bbb
  bbb
(4 rows)
> select last_row(x), last_row(x), last_row(y) from ts where k_timestamp > '2023-07-29 03:12:59.68' group by location order by location;
  last_row | last_row | last_row
-----------+----------+-----------
         8 |        8 |        8
         8 |        8 |        8
         8 |        8 |        8
         8 |        8 |        8
(4 rows)
> select last_row(*) from ts where y in (6,5,3,1) group by location order by location;
     last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(tabname) | last_row(location) | last_row(d_type)
-------------------------------+-------------+-------------+-------------+-------------+-------------------+--------------------+-------------------
  2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_2              | JiNan              |                2
  2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_1              | Milpitas           |                1
  2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_3              | ShangHai           |                3
  2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_4              | TianJin            |                4
(4 rows)
> select last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by location order by location;
            last_row           | last_row | last_row | last_row
-------------------------------+----------+----------+-----------
  2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
(4 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(x) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last_row
-----------+---------------------------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 |        2
  Milpitas | 2023-07-29 03:10:00+00:00 |        2
  ShangHai | 2023-07-29 03:10:00+00:00 |        2
  TianJin  | 2023-07-29 03:10:00+00:00 |        2
  JiNan    | 2023-07-29 03:15:00+00:00 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 |        5
  ShangHai | 2023-07-29 03:15:00+00:00 |        3
  TianJin  | 2023-07-29 03:15:00+00:00 |        3
  JiNan    | 2023-07-29 03:25:00+00:00 |        2
  Milpitas | 2023-07-29 03:25:00+00:00 |        2
  ShangHai | 2023-07-29 03:25:00+00:00 |        2
  TianJin  | 2023-07-29 03:25:00+00:00 |        2
  JiNan    | 2023-07-29 03:30:00+00:00 |        8
  Milpitas | 2023-07-29 03:30:00+00:00 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 |        8
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(y), sum(x) from ts group by bucket, location order by bucket, location; -- error because a is an attribute
  location |          bucket           | last_row | sum
-----------+---------------------------+----------+------
  JiNan    | 2023-07-29 03:10:00+00:00 |        2 |   3
  Milpitas | 2023-07-29 03:10:00+00:00 |        2 |   3
  ShangHai | 2023-07-29 03:10:00+00:00 |        2 |   3
  TianJin  | 2023-07-29 03:10:00+00:00 |        2 |   3
  JiNan    | 2023-07-29 03:15:00+00:00 |        5 |  10
  Milpitas | 2023-07-29 03:15:00+00:00 |        5 |  10
  ShangHai | 2023-07-29 03:15:00+00:00 |        4 |   5
  TianJin  | 2023-07-29 03:15:00+00:00 |        4 |   5
  JiNan    | 2023-07-29 03:25:00+00:00 |        6 |   2
  Milpitas | 2023-07-29 03:25:00+00:00 |        6 |   2
  ShangHai | 2023-07-29 03:25:00+00:00 |        6 |   7
  TianJin  | 2023-07-29 03:25:00+00:00 |        6 |   7
  JiNan    | 2023-07-29 03:30:00+00:00 |        8 |  16
  Milpitas | 2023-07-29 03:30:00+00:00 |        8 |  16
  ShangHai | 2023-07-29 03:30:00+00:00 |        8 |  16
  TianJin  | 2023-07-29 03:30:00+00:00 |        8 |  16
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(y) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last_row
-----------+---------------------------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 |        2
  Milpitas | 2023-07-29 03:10:00+00:00 |        2
  ShangHai | 2023-07-29 03:10:00+00:00 |        2
  TianJin  | 2023-07-29 03:10:00+00:00 |        2
  JiNan    | 2023-07-29 03:15:00+00:00 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 |        5
  ShangHai | 2023-07-29 03:15:00+00:00 |        4
  TianJin  | 2023-07-29 03:15:00+00:00 |        4
  JiNan    | 2023-07-29 03:25:00+00:00 |        6
  Milpitas | 2023-07-29 03:25:00+00:00 |        6
  ShangHai | 2023-07-29 03:25:00+00:00 |        6
  TianJin  | 2023-07-29 03:25:00+00:00 |        6
  JiNan    | 2023-07-29 03:30:00+00:00 |        8
  Milpitas | 2023-07-29 03:30:00+00:00 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 |        8
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(z) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last_row
-----------+---------------------------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | bbb
  JiNan    | 2023-07-29 03:15:00+00:00 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | eee
  ShangHai | 2023-07-29 03:15:00+00:00 | ddd
  TianJin  | 2023-07-29 03:15:00+00:00 | ddd
  JiNan    | 2023-07-29 03:25:00+00:00 | eee
  Milpitas | 2023-07-29 03:25:00+00:00 | eee
  ShangHai | 2023-07-29 03:25:00+00:00 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | eee
  JiNan    | 2023-07-29 03:30:00+00:00 | ccc
  Milpitas | 2023-07-29 03:30:00+00:00 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | ccc
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(x), last_row(x), last_row(y) from ts group by bucket, location order by bucket, location;
  location |          bucket           | last_row | last_row | last_row
-----------+---------------------------+----------+----------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  Milpitas | 2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  ShangHai | 2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  TianJin  | 2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  JiNan    | 2023-07-29 03:15:00+00:00 |        5 |        5 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 |        5 |        5 |        5
  ShangHai | 2023-07-29 03:15:00+00:00 |        3 |        3 |        4
  TianJin  | 2023-07-29 03:15:00+00:00 |        3 |        3 |        4
  JiNan    | 2023-07-29 03:25:00+00:00 |        2 |        2 |        6
  Milpitas | 2023-07-29 03:25:00+00:00 |        2 |        2 |        6
  ShangHai | 2023-07-29 03:25:00+00:00 |        2 |        2 |        6
  TianJin  | 2023-07-29 03:25:00+00:00 |        2 |        2 |        6
  JiNan    | 2023-07-29 03:30:00+00:00 |        8 |        8 |        8
  Milpitas | 2023-07-29 03:30:00+00:00 |        8 |        8 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |        8 |        8 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 |        8 |        8 |        8
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(*) from ts group by bucket, location order by bucket, location;
  location |          bucket           |    last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(tabname) | last_row(location) | last_row(d_type)
-----------+---------------------------+------------------------------+-------------+-------------+-------------+-------------+-------------------+--------------------+-------------------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |           2 |           2 | bbb         | b           | ts_2              | JiNan              |                2
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |           2 |           2 | bbb         | b           | ts_1              | Milpitas           |                1
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |           2 |           2 | bbb         | b           | ts_3              | ShangHai           |                3
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |           2 |           2 | bbb         | b           | ts_4              | TianJin            |                4
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | e           | ts_2              | JiNan              |                2
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | e           | ts_1              | Milpitas           |                1
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |           3 |           4 | ddd         | d           | ts_3              | ShangHai           |                3
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |           3 |           4 | ddd         | d           | ts_4              | TianJin            |                4
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_2              | JiNan              |                2
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_1              | Milpitas           |                1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_3              | ShangHai           |                3
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_4              | TianJin            |                4
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_2              | JiNan              |                2
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_1              | Milpitas           |                1
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_3              | ShangHai           |                3
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_4              | TianJin            |                4
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(*), count(*) from ts group by bucket, location order by bucket, location;
  location |          bucket           |    last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(tabname) | last_row(location) | last_row(d_type) | count
-----------+---------------------------+------------------------------+-------------+-------------+-------------+-------------+-------------------+--------------------+------------------+--------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |           2 |           2 | bbb         | b           | ts_2              | JiNan              |                2 |     2
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |           2 |           2 | bbb         | b           | ts_1              | Milpitas           |                1 |     2
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |           2 |           2 | bbb         | b           | ts_3              | ShangHai           |                3 |     2
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |           2 |           2 | bbb         | b           | ts_4              | TianJin            |                4 |     2
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | e           | ts_2              | JiNan              |                2 |     3
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | e           | ts_1              | Milpitas           |                1 |     3
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |           3 |           4 | ddd         | d           | ts_3              | ShangHai           |                3 |     2
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |           3 |           4 | ddd         | d           | ts_4              | TianJin            |                4 |     2
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_2              | JiNan              |                2 |     1
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_1              | Milpitas           |                1 |     1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_3              | ShangHai           |                3 |     2
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_4              | TianJin            |                4 |     2
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_2              | JiNan              |                2 |     2
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_1              | Milpitas           |                1 |     2
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_3              | ShangHai           |                3 |     2
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |           8 |           8 | ccc         | c           | ts_4              | TianJin            |                4 |     2
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts group by bucket, location order by bucket, location;
  location |          bucket           |           last_row           | last_row | last_row | last_row
-----------+---------------------------+------------------------------+----------+----------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |        2 |        2 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |        2 |        2 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | bbb
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |        5 |        5 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |        5 |        5 | eee
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |        3 |        4 | ddd
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |        3 |        4 | ddd
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(x) from ts where x > 1.0 group by bucket, location order by bucket, location;
  location |          bucket           | last_row
-----------+---------------------------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 |        2
  Milpitas | 2023-07-29 03:10:00+00:00 |        2
  ShangHai | 2023-07-29 03:10:00+00:00 |        2
  TianJin  | 2023-07-29 03:10:00+00:00 |        2
  JiNan    | 2023-07-29 03:15:00+00:00 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 |        5
  ShangHai | 2023-07-29 03:15:00+00:00 |        3
  TianJin  | 2023-07-29 03:15:00+00:00 |        3
  JiNan    | 2023-07-29 03:25:00+00:00 |        2
  Milpitas | 2023-07-29 03:25:00+00:00 |        2
  ShangHai | 2023-07-29 03:25:00+00:00 |        2
  TianJin  | 2023-07-29 03:25:00+00:00 |        2
  JiNan    | 2023-07-29 03:30:00+00:00 |        8
  Milpitas | 2023-07-29 03:30:00+00:00 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 |        8
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(y) from ts where y > 2 group by bucket, location order by bucket, location;
  location |          bucket           | last_row
-----------+---------------------------+-----------
  JiNan    | 2023-07-29 03:15:00+00:00 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 |        5
  ShangHai | 2023-07-29 03:15:00+00:00 |        4
  TianJin  | 2023-07-29 03:15:00+00:00 |        4
  JiNan    | 2023-07-29 03:25:00+00:00 |        6
  Milpitas | 2023-07-29 03:25:00+00:00 |        6
  ShangHai | 2023-07-29 03:25:00+00:00 |        6
  TianJin  | 2023-07-29 03:25:00+00:00 |        6
  JiNan    | 2023-07-29 03:30:00+00:00 |        8
  Milpitas | 2023-07-29 03:30:00+00:00 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 |        8
(12 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(z) from ts where z in ('aaa', 'bbb', 'eee') group by bucket, location order by bucket, location;
  location |          bucket           | last_row
-----------+---------------------------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | bbb
  JiNan    | 2023-07-29 03:15:00+00:00 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | eee
  JiNan    | 2023-07-29 03:25:00+00:00 | eee
  Milpitas | 2023-07-29 03:25:00+00:00 | eee
  ShangHai | 2023-07-29 03:25:00+00:00 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | eee
  JiNan    | 2023-07-29 03:30:00+00:00 | bbb
  Milpitas | 2023-07-29 03:30:00+00:00 | bbb
  ShangHai | 2023-07-29 03:30:00+00:00 | bbb
  TianJin  | 2023-07-29 03:30:00+00:00 | bbb
(14 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, count(distinct y), last_row(x), last_row(x), last_row(y) from ts where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, location order by bucket, location;
  location |          bucket           | count | last_row | last_row | last_row
-----------+---------------------------+-------+----------+----------+-----------
  ShangHai | 2023-07-29 03:10:00+00:00 |     1 |        2 |        2 |        2
  TianJin  | 2023-07-29 03:10:00+00:00 |     1 |        2 |        2 |        2
  JiNan    | 2023-07-29 03:15:00+00:00 |     3 |        5 |        5 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 |     3 |        5 |        5 |        5
  ShangHai | 2023-07-29 03:15:00+00:00 |     2 |        3 |        3 |        4
  TianJin  | 2023-07-29 03:15:00+00:00 |     2 |        3 |        3 |        4
  JiNan    | 2023-07-29 03:25:00+00:00 |     1 |        2 |        2 |        6
  Milpitas | 2023-07-29 03:25:00+00:00 |     1 |        2 |        2 |        6
  ShangHai | 2023-07-29 03:25:00+00:00 |     2 |        2 |        2 |        6
  TianJin  | 2023-07-29 03:25:00+00:00 |     2 |        2 |        2 |        6
  JiNan    | 2023-07-29 03:30:00+00:00 |     2 |        8 |        8 |        8
  Milpitas | 2023-07-29 03:30:00+00:00 |     2 |        8 |        8 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |     2 |        8 |        8 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 |     2 |        8 |        8 |        8
(14 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(x), last_row(x), last_row(y) from ts where k_timestamp > '2023-07-29 03:12:59.68' group by bucket, location order by bucket, location;
  location |          bucket           | last_row | last_row | last_row
-----------+---------------------------+----------+----------+-----------
  ShangHai | 2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  TianJin  | 2023-07-29 03:10:00+00:00 |        2 |        2 |        2
  JiNan    | 2023-07-29 03:15:00+00:00 |        5 |        5 |        5
  Milpitas | 2023-07-29 03:15:00+00:00 |        5 |        5 |        5
  ShangHai | 2023-07-29 03:15:00+00:00 |        3 |        3 |        4
  TianJin  | 2023-07-29 03:15:00+00:00 |        3 |        3 |        4
  JiNan    | 2023-07-29 03:25:00+00:00 |        2 |        2 |        6
  Milpitas | 2023-07-29 03:25:00+00:00 |        2 |        2 |        6
  ShangHai | 2023-07-29 03:25:00+00:00 |        2 |        2 |        6
  TianJin  | 2023-07-29 03:25:00+00:00 |        2 |        2 |        6
  JiNan    | 2023-07-29 03:30:00+00:00 |        8 |        8 |        8
  Milpitas | 2023-07-29 03:30:00+00:00 |        8 |        8 |        8
  ShangHai | 2023-07-29 03:30:00+00:00 |        8 |        8 |        8
  TianJin  | 2023-07-29 03:30:00+00:00 |        8 |        8 |        8
(14 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location;
  location |          bucket           |    last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(tabname) | last_row(location) | last_row(d_type)
-----------+---------------------------+------------------------------+-------------+-------------+-------------+-------------+-------------------+--------------------+-------------------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:10:59.68+00:00 |           1 |           1 | aaa         | a           | ts_2              | JiNan              |                2
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:10:59.68+00:00 |           1 |           1 | aaa         | a           | ts_1              | Milpitas           |                1
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.68+00:00 |           1 |           1 | aaa         | a           | ts_3              | ShangHai           |                3
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.68+00:00 |           1 |           1 | aaa         | a           | ts_4              | TianJin            |                4
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | e           | ts_2              | JiNan              |                2
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | e           | ts_1              | Milpitas           |                1
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.68+00:00 |           2 |           3 | ccc         | c           | ts_3              | ShangHai           |                3
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.68+00:00 |           2 |           3 | ccc         | c           | ts_4              | TianJin            |                4
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_2              | JiNan              |                2
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_1              | Milpitas           |                1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_3              | ShangHai           |                3
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_4              | TianJin            |                4
(12 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, sum(x), last_row(*), count(*) from ts where y in (6,5,3,1) group by bucket, location order by bucket, location;
  location |          bucket           | sum |    last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(tabname) | last_row(location) | last_row(d_type) | count
-----------+---------------------------+-----+------------------------------+-------------+-------------+-------------+-------------+-------------------+--------------------+------------------+--------
  JiNan    | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:10:59.68+00:00 |           1 |           1 | aaa         | a           | ts_2              | JiNan              |                2 |     1
  Milpitas | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:10:59.68+00:00 |           1 |           1 | aaa         | a           | ts_1              | Milpitas           |                1 |     1
  ShangHai | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.68+00:00 |           1 |           1 | aaa         | a           | ts_3              | ShangHai           |                3 |     1
  TianJin  | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.68+00:00 |           1 |           1 | aaa         | a           | ts_4              | TianJin            |                4 |     1
  JiNan    | 2023-07-29 03:15:00+00:00 |   7 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | e           | ts_2              | JiNan              |                2 |     2
  Milpitas | 2023-07-29 03:15:00+00:00 |   7 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | e           | ts_1              | Milpitas           |                1 |     2
  ShangHai | 2023-07-29 03:15:00+00:00 |   2 | 2023-07-29 03:15:59.68+00:00 |           2 |           3 | ccc         | c           | ts_3              | ShangHai           |                3 |     1
  TianJin  | 2023-07-29 03:15:00+00:00 |   2 | 2023-07-29 03:15:59.68+00:00 |           2 |           3 | ccc         | c           | ts_4              | TianJin            |                4 |     1
  JiNan    | 2023-07-29 03:25:00+00:00 |   2 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_2              | JiNan              |                2 |     1
  Milpitas | 2023-07-29 03:25:00+00:00 |   2 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_1              | Milpitas           |                1 |     1
  ShangHai | 2023-07-29 03:25:00+00:00 |   7 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_3              | ShangHai           |                3 |     2
  TianJin  | 2023-07-29 03:25:00+00:00 |   7 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_4              | TianJin            |                4 |     2
(12 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location order by bucket, location;
  location |          bucket           |           last_row           | last_row | last_row | last_row
-----------+---------------------------+------------------------------+----------+----------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |        2 |        2 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |        2 |        2 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | bbb
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |        5 |        5 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |        5 |        5 | eee
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |        3 |        4 | ddd
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |        3 |        4 | ddd
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(*) from ts where y in (6,5,3,1) group by bucket, location, y order by bucket, location, y;
  location |          bucket           |    last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(tabname) | last_row(location) | last_row(d_type)
-----------+---------------------------+------------------------------+-------------+-------------+-------------+-------------+-------------------+--------------------+-------------------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:10:59.68+00:00 |           1 |           1 | aaa         | a           | ts_2              | JiNan              |                2
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:10:59.68+00:00 |           1 |           1 | aaa         | a           | ts_1              | Milpitas           |                1
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.68+00:00 |           1 |           1 | aaa         | a           | ts_3              | ShangHai           |                3
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:11:59.68+00:00 |           1 |           1 | aaa         | a           | ts_4              | TianJin            |                4
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.68+00:00 |           2 |           3 | ccc         | c           | ts_2              | JiNan              |                2
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | e           | ts_2              | JiNan              |                2
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.68+00:00 |           2 |           3 | ccc         | c           | ts_1              | Milpitas           |                1
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | e           | ts_1              | Milpitas           |                1
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.68+00:00 |           2 |           3 | ccc         | c           | ts_3              | ShangHai           |                3
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:15:59.68+00:00 |           2 |           3 | ccc         | c           | ts_4              | TianJin            |                4
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_2              | JiNan              |                2
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_1              | Milpitas           |                1
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:25:59.68+00:00 |           5 |           5 | eee         | e           | ts_3              | ShangHai           |                3
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_3              | ShangHai           |                3
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:25:59.68+00:00 |           5 |           5 | eee         | e           | ts_4              | TianJin            |                4
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_4              | TianJin            |                4
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, sum(x), last_row(*), count(*) from ts where y in (6,5,3,1) group by bucket, location, y order by bucket, location, y;
  location |          bucket           | sum |    last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(tabname) | last_row(location) | last_row(d_type) | count
-----------+---------------------------+-----+------------------------------+-------------+-------------+-------------+-------------+-------------------+--------------------+------------------+--------
  JiNan    | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:10:59.68+00:00 |           1 |           1 | aaa         | a           | ts_2              | JiNan              |                2 |     1
  Milpitas | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:10:59.68+00:00 |           1 |           1 | aaa         | a           | ts_1              | Milpitas           |                1 |     1
  ShangHai | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.68+00:00 |           1 |           1 | aaa         | a           | ts_3              | ShangHai           |                3 |     1
  TianJin  | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:11:59.68+00:00 |           1 |           1 | aaa         | a           | ts_4              | TianJin            |                4 |     1
  JiNan    | 2023-07-29 03:15:00+00:00 |   2 | 2023-07-29 03:15:59.68+00:00 |           2 |           3 | ccc         | c           | ts_2              | JiNan              |                2 |     1
  JiNan    | 2023-07-29 03:15:00+00:00 |   5 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | e           | ts_2              | JiNan              |                2 |     1
  Milpitas | 2023-07-29 03:15:00+00:00 |   2 | 2023-07-29 03:15:59.68+00:00 |           2 |           3 | ccc         | c           | ts_1              | Milpitas           |                1 |     1
  Milpitas | 2023-07-29 03:15:00+00:00 |   5 | 2023-07-29 03:19:59.68+00:00 |           5 |           5 | eee         | e           | ts_1              | Milpitas           |                1 |     1
  ShangHai | 2023-07-29 03:15:00+00:00 |   2 | 2023-07-29 03:15:59.68+00:00 |           2 |           3 | ccc         | c           | ts_3              | ShangHai           |                3 |     1
  TianJin  | 2023-07-29 03:15:00+00:00 |   2 | 2023-07-29 03:15:59.68+00:00 |           2 |           3 | ccc         | c           | ts_4              | TianJin            |                4 |     1
  JiNan    | 2023-07-29 03:25:00+00:00 |   2 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_2              | JiNan              |                2 |     1
  Milpitas | 2023-07-29 03:25:00+00:00 |   2 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_1              | Milpitas           |                1 |     1
  ShangHai | 2023-07-29 03:25:00+00:00 |   5 | 2023-07-29 03:25:59.68+00:00 |           5 |           5 | eee         | e           | ts_3              | ShangHai           |                3 |     1
  ShangHai | 2023-07-29 03:25:00+00:00 |   2 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_3              | ShangHai           |                3 |     1
  TianJin  | 2023-07-29 03:25:00+00:00 |   5 | 2023-07-29 03:25:59.68+00:00 |           5 |           5 | eee         | e           | ts_4              | TianJin            |                4 |     1
  TianJin  | 2023-07-29 03:25:00+00:00 |   2 | 2023-07-29 03:29:59.68+00:00 |           2 |           6 | eee         | e           | ts_4              | TianJin            |                4 |     1
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last_row(x) > 1.5 order by bucket, location;
  location |          bucket           |           last_row           | last_row | last_row | last_row
-----------+---------------------------+------------------------------+----------+----------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |        2 |        2 | bbb
  Milpitas | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |        2 |        2 | bbb
  ShangHai | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | bbb
  TianJin  | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | bbb
  JiNan    | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |        5 |        5 | eee
  Milpitas | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:19:59.68+00:00 |        5 |        5 | eee
  ShangHai | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |        3 |        4 | ddd
  TianJin  | 2023-07-29 03:15:00+00:00 | 2023-07-29 03:17:59.68+00:00 |        3 |        4 | ddd
  JiNan    | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  Milpitas | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  ShangHai | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  TianJin  | 2023-07-29 03:25:00+00:00 | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  JiNan    | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  Milpitas | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  ShangHai | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  TianJin  | 2023-07-29 03:30:00+00:00 | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
(16 rows)
> select time_bucket(k_timestamp, '300s') bucket, location, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last_row(x) > 1.5 order by bucket, location;
           bucket           | location |           last_row           | last_row | last_row | last_row
----------------------------+----------+------------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 | JiNan    | 2023-07-29 03:12:59.68+00:00 |        2 |        2 | bbb
  2023-07-29 03:10:00+00:00 | Milpitas | 2023-07-29 03:12:59.68+00:00 |        2 |        2 | bbb
  2023-07-29 03:10:00+00:00 | ShangHai | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | bbb
  2023-07-29 03:10:00+00:00 | TianJin  | 2023-07-29 03:14:59.68+00:00 |        2 |        2 | bbb
  2023-07-29 03:15:00+00:00 | JiNan    | 2023-07-29 03:19:59.68+00:00 |        5 |        5 | eee
  2023-07-29 03:15:00+00:00 | Milpitas | 2023-07-29 03:19:59.68+00:00 |        5 |        5 | eee
  2023-07-29 03:15:00+00:00 | ShangHai | 2023-07-29 03:17:59.68+00:00 |        3 |        4 | ddd
  2023-07-29 03:15:00+00:00 | TianJin  | 2023-07-29 03:17:59.68+00:00 |        3 |        4 | ddd
  2023-07-29 03:25:00+00:00 | JiNan    | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  2023-07-29 03:25:00+00:00 | Milpitas | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  2023-07-29 03:25:00+00:00 | ShangHai | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  2023-07-29 03:25:00+00:00 | TianJin  | 2023-07-29 03:29:59.68+00:00 |        2 |        6 | eee
  2023-07-29 03:30:00+00:00 | JiNan    | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:30:00+00:00 | Milpitas | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:30:00+00:00 | ShangHai | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
  2023-07-29 03:30:00+00:00 | TianJin  | 2023-07-29 03:32:59.68+00:00 |        8 |        8 | ccc
(16 rows)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(*) from ts where y in (6,5,3,1) group by bucket, location, y order by bucket, location, y limit 1;
  location |          bucket           |    last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(tabname) | last_row(location) | last_row(d_type)
-----------+---------------------------+------------------------------+-------------+-------------+-------------+-------------+-------------------+--------------------+-------------------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:10:59.68+00:00 |           1 |           1 | aaa         | a           | ts_2              | JiNan              |                2
(1 row)
> select location, time_bucket(k_timestamp, '300s') bucket, sum(x), last_row(*), count(*) from ts where y in (6,5,3,1) group by bucket, location, y order by bucket, location, y limit 1;
  location |          bucket           | sum |    last_row(k_timestamp)     | last_row(x) | last_row(y) | last_row(z) | last_row(a) | last_row(tabname) | last_row(location) | last_row(d_type) | count
-----------+---------------------------+-----+------------------------------+-------------+-------------+-------------+-------------+-------------------+--------------------+------------------+--------
  JiNan    | 2023-07-29 03:10:00+00:00 |   1 | 2023-07-29 03:10:59.68+00:00 |           1 |           1 | aaa         | a           | ts_2              | JiNan              |                2 |     1
(1 row)
> select location, time_bucket(k_timestamp, '300s') bucket, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last_row(x) > 1.5 order by bucket, location limit 1;
  location |          bucket           |           last_row           | last_row | last_row | last_row
-----------+---------------------------+------------------------------+----------+----------+-----------
  JiNan    | 2023-07-29 03:10:00+00:00 | 2023-07-29 03:12:59.68+00:00 |        2 |        2 | bbb
(1 row)
> select time_bucket(k_timestamp, '300s') bucket, location, last_row(k_timestamp), last_row(x), last_row(y), last_row(z) from ts where k_timestamp between '2023-07-29 03:12:59.680' and '2023-07-29 03:35:59.688' group by bucket, location having last_row(x) > 1.5 order by bucket, location limit 1;
           bucket           | location |           last_row           | last_row | last_row | last_row
----------------------------+----------+------------------------------+----------+----------+-----------
  2023-07-29 03:10:00+00:00 | JiNan    | 2023-07-29 03:12:59.68+00:00 |        2 |        2 | bbb
(1 row)
> select last(x) from ts group by location order by location limit 1;
  last
--------
     8
(1 row)
> select last_row(x) from ts group by location order by location limit 1;
  last_row
------------
         8
(1 row)
> drop table t;
DROP TABLE
> drop table ts cascade;
DROP TABLE
> use defaultdb;
SET
> drop database last_db cascade;
DROP DATABASE
> create ts database ts_db;
CREATE TS DATABASE
> use ts_db;
SET
> create table test(ts timestamp not null, ts1 timestamp, a int) tags (size int not null) primary tags(size);
CREATE TABLE
> insert into test values (1695139200000, 1695139200000, 1, 1);
INSERT 1
> select ts,ts1 from test group by ts,ts1 having max(ts)-last(ts1) = '0h';
             ts             |            ts1
----------------------------+----------------------------
  2023-09-19 16:00:00+00:00 | 2023-09-19 16:00:00+00:00
(1 row)
> select ts,ts1 from test group by ts,ts1 having max(ts)-max(ts1) = '0h';
             ts             |            ts1
----------------------------+----------------------------
  2023-09-19 16:00:00+00:00 | 2023-09-19 16:00:00+00:00
(1 row)
> select ts,ts1 from test group by ts,ts1 having max(ts)-last(ts1) = 0;
ERROR: unsupported comparison operator: <interval> = <int>
SQLSTATE: 22023
> select ts,ts1 from test group by ts,ts1 having max(ts)-max(ts1) = 0;
ERROR: unsupported comparison operator: <interval> = <int>
SQLSTATE: 22023
> drop table test;
DROP TABLE
> use defaultdb;
SET
> drop database ts_db cascade;
DROP DATABASE
