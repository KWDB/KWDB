> drop database if exists test cascade;
DROP DATABASE
> create ts database test;
CREATE TS DATABASE
> create table test.cpu
(
    k_timestamp      timestamp not null,
    usage_user       bigint,
    usage_system     bigint,
    usage_idle       int,
    usage_nice       int,
    usage_iowait     smallint,
    usage_irq        smallint,
    usage_softirq    float,
    usage_steal      float,
    usage_guest      real,
    usage_guest_nice real
) attributes (
    hostname char(30) not null,
    region varchar(8) not null,
    datacenter int not null,
    rack int not null,
    os char(30),
    arch char(30),
    team char(30),
    service char(30),
    service_version char(30),
    service_environment char(30)
    )
primary attributes (hostname, region, datacenter, rack);
CREATE TABLE
> INSERT INTO test.cpu
values ('2023-05-31 10:00:00', -2147483648, -2147483648, -2147483648, -2147483648, -32768, -32768, 54.122111, 54.122111, 3.141593, 3.141593, 'host_0', 'aaaaaaaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', -2147483648, -2147483648, -2147483648, -2147483648, -32768, -32768, 54.122111, 54.122111, 3.141593, 3.141593, 'host_0', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 84, 2147483647, -2147483648, 2147483647, 29, 20, -54.122111, -54.122111, 53, 74, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 29, 48, 5, 63, -17, 52, 60, null, 93, 1, 'host_2', 'a', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 8, 21, -89, 78, 30, 81, 33, 24, 24, 82, 'host_3', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 2, 26, 64, 6, 38, 20, -71, 19, 40, 54, 'host_4', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', -76, -40, -63, -7, -81, -20, -29, -55, null, -15, 'host_5', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 44, 70, 20, -67, 65, 11, 7, 92, 0, 31, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 92, 35, 99, 9, 31, -1, 2, 24, 96, 69, 'host_7', 'aaa', -888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 90, 0, 81, 28, 25, -44, 8, -89, 11, 76, 'host_9', 'aaa', 888888, 6666, '', '', '', '', '', '');
INSERT 11
> INSERT INTO test.cpu
values ('2023-05-31 10:00:01', 2147483647, -2147483648, 2147483647, -2147483648, 32767, -32768, -100.1, 54.122111, -3.141593, null, 'host_0', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', null, 2147483647, 2147483647, 2147483647, 32767, 32767, 54.122111, -54.1221111, 3.141593, -3.141593, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 29, 48, 5, 63, 17, 52, 60, 49, 93, 1, 'host_3', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 8, 21, 89, 78, 30, 81, 33, 24, 24, 82, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 2, 26, 64, 6, 38, 20, 71, null, 40, 54, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 76, 40, 63, 7, 81, 20, 29, -55, 20, 15, 'host_6', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_7', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 92, 35,-99, 9, 31, 1, 2, 24, 96, 69, 'host_8', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 21, 77, 90, 83, 41, 84, 26, 60, null, 36, 'host_9', 'aaa', -888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 90, 0, -81, 28, 25, 44, 8, 89, 11, 76, 'host_2', 'a', -888888, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:02', 58, -2, 24, 61, 22, 63, 6, 44, null, 38, 'host_2', 'aaa', 2147483647, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_3', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 29, 48, -5, 63, -17, 52, 60, 49, 93, 1, 'host_4', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 8, 21, 89, -78, 30, 81, 33, 24, 24, 82, 'host_5', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 2, 26, -64, 6, -38, 20, 71, null, 40, 54, 'host_6', 'aaa', 2147483647, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_7', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_8', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 92, 35, 99, -9, 31, 1, -2, 24, 96, 69, 'host_9', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 21, 77, -90, 83, 41, 84, 26, 60, 43, null, 'host_0', 'aaaaaaaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 90, 0, 81, 28, 25, 44, 8, -89, 11, 76, 'host_1', 'aaa', 2147483647, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:04', null, 2, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 29, 48, 5, -63, 17, -52, 60, 49, 93, 1, 'host_5', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 8, 21, 89, 78, 30, -81, 33, 24, 24, 82, 'host_6', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 2, 26, -64, 6, 38, -20, 71, null, 40, 54, 'host_7', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_8', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_9', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 92, 35, 99, 9, 31, -1, 2, 24, 96, 69, 'host_0', 'aaaaaaaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_1', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 90, 0, 81, 28, 25, 44, 8, -89, 11, 76, 'host_2', 'aaa', -2147483648, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:03', 58, null, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 29, 48, 5, 63, 17, 52, 60, 49, 93, 1, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 8, 21, 89, 78, 30, 81, 33, 24, 24, 82, 'host_6', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 2, 26, 64, 6, 38, -20, 71, null, 40, 54, 'host_7', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 44, 70, 20, 67, 65, 11, -7, 92, 0, 31, 'host_9', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 92, 35, 99, 9, 31, 1, 2, 24, 96, 69, 'host_0', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 90, 0, 81, 28, 25, 44, 8, 89, 11, 76, 'host_2', 'aaa', 888888, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_3', 'aaaaaaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_7', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_9', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_0', 'aaa', 0, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_2', 'aaa', 888888, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_3', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_5', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_7', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_8', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_9', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_0', 'aaa', -888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_2', 'aaa', 888888, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:10', 58, null, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 29, 48, 5, -63, 17, 52, 60, 49, 93, 1, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 8, 21, 89, -78, 30, 81, 33, 24, 24, 82, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 2, 26, 64, 6, 38, -20, 71, null, -40, 54, 'host_7', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 76, 40, -63, 7, 81, -20, 29, 55, 20, 15, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 44, 70, 20, 67, 65, 11, 7, -92, 0, 31, 'host_9', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 92, 35, 99, 9, -31, 1, 2, 24, 96, 69, 'host_0', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 21, 77, 90, 83, 41, -84, 26, 60, 43, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 90, 0, 81, 28, 25, -44, 8, 89, 11, 76, 'host_2', 'aaa', -888888, 6666, '', '', '', '', '', '');
INSERT 10
> SELECT hostname, max(usage_user) as max_cur, min(usage_user) as min_cur, avg(usage_user) as avg_cur
FROM test.cpu
where 1 = 1
  and hostname = 'host_4'
  and k_timestamp > '2023-01-01 00:00:00'::timestamp and k_timestamp < '2024-01-01 00:00:00':: timestamp
group by hostname
order by hostname asc;
  hostname | max_cur | min_cur | avg_cur
-----------+---------+---------+----------
  host_4   |      84 |       2 |    48.5
(1 row)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       lastts(usage_guest),
       sum(usage_steal),
       firstts(usage_nice),
       max(usage_user),
       max(usage_irq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          lastts           |    sum    |          firstts          |     max     |  max   |          last_ts
----------------------------+----------+---------------------------+-----------+---------------------------+-------------+--------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 | 54.122111 | 2023-05-31 10:00:00+00:00 | -2147483648 | -32768 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 | 54.122111 | 2023-05-31 10:00:00+00:00 | -2147483648 | -32768 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:01+00:00 | 54.122111 | 2023-05-31 10:00:01+00:00 |  2147483647 | -32768 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:02+00:00 |        60 | 2023-05-31 10:00:02+00:00 |          21 |     84 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:03+00:00 |        24 | 2023-05-31 10:00:03+00:00 |          92 |      1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   | 2023-05-31 10:00:04+00:00 |        24 | 2023-05-31 10:00:04+00:00 |          92 |     -1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | NULL      | NULL                      |        NULL | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | NULL      | NULL                      |        NULL | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_0   | 2023-05-31 10:00:10+00:00 |        24 | 2023-05-31 10:00:10+00:00 |          92 |      1 | 2023-05-31 10:00:10+00:00
(9 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       first_row(usage_idle),
       lastts(usage_nice),
       lastts(usage_irq),
       lastts(usage_guest_nice),
       max(usage_idle),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_1'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |  first_row  |          lastts           |          lastts           |          lastts           |    max     |          last_ts
----------------------------+----------+-------------+---------------------------+---------------------------+---------------------------+------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_1   | -2147483648 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2147483647 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          81 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         81 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          90 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | NULL                      |         90 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |          90 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | NULL                      |         90 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL        | NULL                      | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_1   |          90 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | NULL                      |         90 | 2023-05-31 10:00:10+00:00
(6 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       sum(usage_guest),
       count(usage_idle),
       avg(usage_system),
       max(usage_steal),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaa'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |         sum         | count |     avg     |    max    |          last_ts
----------------------------+----------+---------------------+-------+-------------+-----------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |  3.1415929794311523 |     1 | -2147483648 | 54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | -3.1415929794311523 |     1 | -2147483648 | 54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |                  96 |     1 |          35 |        24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                |     0 | NULL        | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL                |     0 | NULL        | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_0   |                  96 |     1 |          35 |        24 | 2023-05-31 10:00:10+00:00
(6 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       last_row(usage_iowait),
       avg(usage_irq),
       max(usage_system),
       firstts(usage_irq),
       lastts(usage_softirq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaaaaaaa'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname | last_row |  avg   |     max     |          firstts          |          lastts           |          last_ts
----------------------------+----------+----------+--------+-------------+---------------------------+---------------------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |   -32768 | -32768 | -2147483648 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_0   |       41 |     84 |          77 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:04+00:00 | host_0   |       31 |     -1 |          35 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
(3 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       first_row(usage_irq),
       lastts(usage_iowait),
       sum(usage_iowait),
       hostname,
       first_row(usage_system),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND region = 'aaa'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | first_row |          lastts           |  sum   | hostname |  first_row  |          last_ts
----------------------------+-----------+---------------------------+--------+----------+-------------+----------------------------
  2023-05-31 10:00:00+00:00 |    -32768 | 2023-05-31 10:00:00+00:00 | -32768 | host_0   | -2147483648 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |    -32768 | 2023-05-31 10:00:01+00:00 |  32767 | host_0   | -2147483648 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |         1 | 2023-05-31 10:00:03+00:00 |     31 | host_0   |          35 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_0   |        NULL | NULL
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_0   |        NULL | NULL
  2023-05-31 10:00:10+00:00 |         1 | 2023-05-31 10:00:10+00:00 |    -31 | host_0   |          35 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        20 | 2023-05-31 10:00:01+00:00 |  32796 | host_1   |  2147483647 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 |        44 | 2023-05-31 10:00:02+00:00 |     25 | host_1   |           0 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |        84 | 2023-05-31 10:00:03+00:00 |     41 | host_1   |          77 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        84 | 2023-05-31 10:00:04+00:00 |     41 | host_1   |          77 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_1   |        NULL | NULL
  2023-05-31 10:00:10+00:00 |       -84 | 2023-05-31 10:00:10+00:00 |     41 | host_1   |          77 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:02+00:00 |        63 | 2023-05-31 10:00:02+00:00 |     22 | host_2   |          -2 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |        44 | 2023-05-31 10:00:03+00:00 |     25 | host_2   |           0 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        44 | 2023-05-31 10:00:04+00:00 |     25 | host_2   |           0 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_2   |        NULL | NULL
  2023-05-31 10:00:10+00:00 |       -44 | 2023-05-31 10:00:10+00:00 |     25 | host_2   |           0 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        81 | 2023-05-31 10:00:00+00:00 |     30 | host_3   |          21 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |        52 | 2023-05-31 10:00:01+00:00 |     17 | host_3   |          48 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        20 | 2023-05-31 10:00:02+00:00 |     29 | host_3   |          11 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |        63 | 2023-05-31 10:00:03+00:00 |     22 | host_3   |        NULL | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        63 | 2023-05-31 10:00:04+00:00 |     22 | host_3   |           2 | NULL
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_3   |        NULL | NULL
  2023-05-31 10:00:10+00:00 |        63 | 2023-05-31 10:00:10+00:00 |     22 | host_3   |        NULL | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        20 | 2023-05-31 10:00:00+00:00 |     38 | host_4   |          26 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |        81 | 2023-05-31 10:00:01+00:00 |     30 | host_4   |          21 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        52 | 2023-05-31 10:00:02+00:00 |    -17 | host_4   |          48 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |        20 | 2023-05-31 10:00:03+00:00 |     29 | host_4   |          11 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        20 | 2023-05-31 10:00:04+00:00 |     29 | host_4   |          11 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_4   |        NULL | NULL
  2023-05-31 10:00:10+00:00 |        20 | 2023-05-31 10:00:10+00:00 |     29 | host_4   |          11 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |       -20 | 2023-05-31 10:00:00+00:00 |    -81 | host_5   |         -40 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |        20 | 2023-05-31 10:00:01+00:00 |     38 | host_5   |          26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        81 | 2023-05-31 10:00:02+00:00 |     30 | host_5   |          21 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |        52 | 2023-05-31 10:00:03+00:00 |     17 | host_5   |          48 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |       -52 | 2023-05-31 10:00:04+00:00 |     17 | host_5   |          48 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_5   |        NULL | NULL
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_5   |        NULL | NULL
  2023-05-31 10:00:10+00:00 |        52 | 2023-05-31 10:00:10+00:00 |     17 | host_5   |          48 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        11 | 2023-05-31 10:00:00+00:00 |     65 | host_6   |          70 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |        20 | 2023-05-31 10:00:01+00:00 |     81 | host_6   |          40 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        20 | 2023-05-31 10:00:02+00:00 |    -38 | host_6   |          26 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |        81 | 2023-05-31 10:00:03+00:00 |     30 | host_6   |          21 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |       -81 | 2023-05-31 10:00:04+00:00 |     30 | host_6   |          21 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_6   |        NULL | NULL
  2023-05-31 10:00:10+00:00 |        81 | 2023-05-31 10:00:10+00:00 |     30 | host_6   |          21 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        -1 | 2023-05-31 10:00:00+00:00 |     31 | host_7   |          35 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |        11 | 2023-05-31 10:00:01+00:00 |     65 | host_7   |          70 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        20 | 2023-05-31 10:00:02+00:00 |     81 | host_7   |          40 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |       -20 | 2023-05-31 10:00:03+00:00 |     38 | host_7   |          26 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |       -20 | 2023-05-31 10:00:04+00:00 |     38 | host_7   |          26 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_7   |        NULL | NULL
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_7   |        NULL | NULL
  2023-05-31 10:00:10+00:00 |       -20 | 2023-05-31 10:00:10+00:00 |     38 | host_7   |          26 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        84 | 2023-05-31 10:00:00+00:00 |     41 | host_8   |          77 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |         1 | 2023-05-31 10:00:01+00:00 |     31 | host_8   |          35 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        11 | 2023-05-31 10:00:02+00:00 |     65 | host_8   |          70 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |        20 | 2023-05-31 10:00:03+00:00 |     81 | host_8   |          40 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        20 | 2023-05-31 10:00:04+00:00 |     81 | host_8   |          40 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_8   |        NULL | NULL
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_8   |        NULL | NULL
  2023-05-31 10:00:10+00:00 |       -20 | 2023-05-31 10:00:10+00:00 |     81 | host_8   |          40 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |       -44 | 2023-05-31 10:00:00+00:00 |     25 | host_9   |           0 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |        84 | 2023-05-31 10:00:01+00:00 |     41 | host_9   |          77 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |         1 | 2023-05-31 10:00:02+00:00 |     31 | host_9   |          35 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |        11 | 2023-05-31 10:00:03+00:00 |     65 | host_9   |          70 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        11 | 2023-05-31 10:00:04+00:00 |     65 | host_9   |          70 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL   | host_9   |        NULL | NULL
  2023-05-31 10:00:10+00:00 |        11 | 2023-05-31 10:00:10+00:00 |     65 | host_9   |          70 | 2023-05-31 10:00:10+00:00
(69 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b, first (usage_nice), min (usage_system), min (usage_softirq), last_row(usage_guest_nice), hostname, lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
  AND region = 'aaaaaaaa'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       |    first    |     min     |    min    | last_row | hostname |          last_ts
----------------------------+-------------+-------------+-----------+----------+----------+----------------------------
  2023-05-31 10:00:00+00:00 | -2147483648 | -2147483648 | 54.122111 | 3.141593 | host_0   | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 |          83 |          77 |        26 | NULL     | host_0   | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:04+00:00 |           9 |          35 |         2 |       69 | host_0   | 2023-05-31 10:00:04+00:00
(3 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       avg(usage_steal),
       avg(usage_guest_nice),
       last_row(usage_guest),
       min(usage_idle),
       hostname,
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts LIMIT 10;
        k_timestamp_b       |     avg      |        avg         | last_row  |     min     | hostname |          last_ts
----------------------------+--------------+--------------------+-----------+-------------+----------+----------------------------
  2023-05-31 10:00:00+00:00 |    54.122111 | 3.1415929794311523 |  3.141593 | -2147483648 | host_0   | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |    54.122111 | 3.1415929794311523 |  3.141593 | -2147483648 | host_0   | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |    54.122111 | NULL               | -3.141593 |  2147483647 | host_0   | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |           60 | NULL               |        43 |         -90 | host_0   | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |           24 |                 69 |        96 |          99 | host_0   | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |           24 |                 69 |        96 |          99 | host_0   | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL         | NULL               | NULL      | NULL        | host_0   | NULL
  2023-05-31 10:00:08+00:00 | NULL         | NULL               | NULL      | NULL        | host_0   | NULL
  2023-05-31 10:00:10+00:00 |           24 |                 69 |        96 |          99 | host_0   | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | -54.12211105 | 35.429203510284424 |  3.141593 | -2147483648 | host_1   | 2023-05-31 10:00:00+00:00
(10 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       sum(usage_nice),
       sum(usage_idle),
       min(usage_irq),
       sum(usage_system),
       last_row(usage_user),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_1'
  AND region = 'aaa'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts
OFFSET 2;
        k_timestamp_b       | hostname | sum  | sum  | min  | sum  | last_row |          last_ts
----------------------------+----------+------+------+------+------+----------+----------------------------
  2023-05-31 10:00:02+00:00 | host_1   |   83 |   90 |   84 |   77 |       21 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |   83 |   90 |   84 |   77 |       21 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL | NULL | NULL | NULL |     NULL | NULL
  2023-05-31 10:00:10+00:00 | host_1   |   83 |   90 |  -84 |   77 |       21 | 2023-05-31 10:00:10+00:00
(4 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       min(usage_iowait),
       last_row(usage_irq),
       count(usage_nice),
       last_row(usage_idle),
       last_row(usage_system),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaa'
  AND datacenter = 888888
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |  min   | last_row | count |  last_row   |  last_row   |          last_ts
----------------------------+----------+--------+----------+-------+-------------+-------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | -32768 |   -32768 |     1 | -2147483648 | -2147483648 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_0   |     31 |        1 |     1 |          99 |          35 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:10+00:00 | host_0   |    -31 |        1 |     1 |          99 |          35 | 2023-05-31 10:00:10+00:00
(3 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       first_row(usage_iowait),
       last_row(usage_steal),
       min(usage_user),
       last_row(usage_nice),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaa'
  AND datacenter = 888888
  AND rack = 8888.88
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
  k_timestamp_b | hostname | first_row | last_row | min | last_row | last_ts
----------------+----------+-----------+----------+-----+----------+----------
(0 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       sum(usage_guest_nice),
       sum(usage_irq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |        sum         |  sum   |          last_ts
----------------------------+----------+--------------------+--------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 3.1415929794311523 | -32768 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 3.1415929794311523 | -32768 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | NULL               | -32768 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | NULL               |     84 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |                 69 |      1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |                 69 |     -1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL               | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_0   |                 69 |      1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |  70.85840702056885 |  32787 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |                 76 |     44 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   | NULL               |     84 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | NULL               |     84 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_1   | NULL               |    -84 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |                 77 |     96 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |                 38 |     63 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |                 76 |     44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |                 76 |     44 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_2   |                 76 |    -44 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |                 82 |     81 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_3   |                  1 |     52 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |                 74 |     20 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |                 38 |     63 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |                 38 |     63 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL               | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_3   |                 38 |     63 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |                 54 |     20 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_4   |                 82 |     81 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |                  1 |     52 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_4   |                 74 |     20 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |                 74 |     20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_4   |                 74 |     20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |                -15 |    -20 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |                 54 |     20 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |                 82 |     81 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_5   |                  1 |     52 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |                  1 |    -52 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL               | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_5   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_5   |                  1 |     52 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |                 31 |     11 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_6   |                 15 |     20 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |                 54 |     20 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |                 82 |     81 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |                 82 |    -81 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_6   |                 82 |     81 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |                 69 |     -1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |                 31 |     11 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |                 15 |     20 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_7   |                 54 |    -20 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |                 54 |    -20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL               | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_7   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_7   |                 54 |    -20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | NULL               |     84 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_8   |                 69 |      1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |                 31 |     11 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_8   |                 15 |     20 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |                 15 |     20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL               | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_8   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_8   |                 15 |    -20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |                 76 |    -44 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |                 36 |     84 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |                 69 |      1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_9   |                 31 |     11 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |                 31 |     11 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_9   |                 31 |     11 | 2023-05-31 10:00:10+00:00
(74 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       min(usage_nice),
       firstts(usage_user),
       min(usage_guest), first (usage_idle), first (usage_softirq),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |     min     |          firstts          |    min    |    first    |   first    |          last_ts
----------------------------+----------+-------------+---------------------------+-----------+-------------+------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 | 2023-05-31 10:00:00+00:00 |  3.141593 | -2147483648 |  54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 | 2023-05-31 10:00:00+00:00 |  3.141593 | -2147483648 |  54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 | 2023-05-31 10:00:01+00:00 | -3.141593 |  2147483647 |     -100.1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |          83 | 2023-05-31 10:00:02+00:00 |        43 |         -90 |         26 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |           9 | 2023-05-31 10:00:03+00:00 |        96 |          99 |          2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |           9 | 2023-05-31 10:00:04+00:00 |        96 |          99 |          2 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_0   |           9 | 2023-05-31 10:00:10+00:00 |        96 |          99 |          2 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |  2147483647 | 2023-05-31 10:00:00+00:00 |  3.141593 | -2147483648 | -54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          28 | 2023-05-31 10:00:02+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          83 | 2023-05-31 10:00:03+00:00 |        43 |          90 |         26 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |          83 | 2023-05-31 10:00:04+00:00 |        43 |          90 |         26 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_1   |          83 | 2023-05-31 10:00:10+00:00 |        43 |          90 |         26 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |          28 | 2023-05-31 10:00:00+00:00 |        11 |           5 |         60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |          61 | 2023-05-31 10:00:02+00:00 | NULL      |          24 |          6 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |          28 | 2023-05-31 10:00:03+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |          28 | 2023-05-31 10:00:04+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_2   |          28 | 2023-05-31 10:00:10+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |          78 | 2023-05-31 10:00:00+00:00 |        24 |         -89 |         33 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_3   |          63 | 2023-05-31 10:00:01+00:00 |        93 |           5 |         60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          87 | 2023-05-31 10:00:02+00:00 |        53 |          53 |         54 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          61 | 2023-05-31 10:00:03+00:00 | NULL      |          24 |          6 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |          61 | NULL                      | NULL      |          24 |          6 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_3   |          61 | 2023-05-31 10:00:10+00:00 | NULL      |          24 |          6 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |           6 | 2023-05-31 10:00:00+00:00 |        40 |          64 |        -71 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_4   |          78 | 2023-05-31 10:00:01+00:00 |        24 |          89 |         33 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |          63 | 2023-05-31 10:00:02+00:00 |        93 |          -5 |         60 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_4   |          87 | 2023-05-31 10:00:03+00:00 |        53 |          53 |         54 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |          87 | 2023-05-31 10:00:04+00:00 |        53 |          53 |         54 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_4   |          87 | 2023-05-31 10:00:10+00:00 |        53 |          53 |         54 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |          -7 | 2023-05-31 10:00:00+00:00 | NULL      |         -63 |        -29 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |           6 | 2023-05-31 10:00:01+00:00 |        40 |          64 |         71 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |         -78 | 2023-05-31 10:00:02+00:00 |        24 |          89 |         33 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_5   |          63 | 2023-05-31 10:00:03+00:00 |        93 |           5 |         60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |         -63 | 2023-05-31 10:00:04+00:00 |        93 |           5 |         60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:08+00:00 | host_5   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_5   |         -63 | 2023-05-31 10:00:10+00:00 |        93 |           5 |         60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |         -67 | 2023-05-31 10:00:00+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_6   |           7 | 2023-05-31 10:00:01+00:00 |        20 |          63 |         29 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |           6 | 2023-05-31 10:00:02+00:00 |        40 |         -64 |         71 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |          78 | 2023-05-31 10:00:03+00:00 |        24 |          89 |         33 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |          78 | 2023-05-31 10:00:04+00:00 |        24 |          89 |         33 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_6   |         -78 | 2023-05-31 10:00:10+00:00 |        24 |          89 |         33 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |           9 | 2023-05-31 10:00:00+00:00 |        96 |          99 |          2 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |          67 | 2023-05-31 10:00:01+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |           7 | 2023-05-31 10:00:02+00:00 |        20 |          63 |         29 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_7   |           6 | 2023-05-31 10:00:03+00:00 |        40 |          64 |         71 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |           6 | 2023-05-31 10:00:04+00:00 |        40 |         -64 |         71 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:08+00:00 | host_7   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_7   |           6 | 2023-05-31 10:00:10+00:00 |       -40 |          64 |         71 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |          83 | 2023-05-31 10:00:00+00:00 |        43 |          90 |         26 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_8   |           9 | 2023-05-31 10:00:01+00:00 |        96 |         -99 |          2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |          67 | 2023-05-31 10:00:02+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_8   |           7 | 2023-05-31 10:00:03+00:00 |        20 |          63 |         29 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |           7 | 2023-05-31 10:00:04+00:00 |        20 |          63 |         29 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:08+00:00 | host_8   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_8   |           7 | 2023-05-31 10:00:10+00:00 |        20 |         -63 |         29 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |          28 | 2023-05-31 10:00:00+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |          83 | 2023-05-31 10:00:01+00:00 | NULL      |          90 |         26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |          -9 | 2023-05-31 10:00:02+00:00 |        96 |          99 |         -2 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_9   |          67 | 2023-05-31 10:00:03+00:00 |         0 |          20 |         -7 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |          67 | 2023-05-31 10:00:04+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_9   |          67 | 2023-05-31 10:00:10+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:10+00:00
(74 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       count(usage_iowait), last (usage_guest_nice), sum (usage_softirq), first_row(usage_user),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts
    LIMIT 1
OFFSET 1;
        k_timestamp_b       | hostname | count |   last   |    sum    |  first_row  |          last_ts
----------------------------+----------+-------+----------+-----------+-------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |     1 | 3.141593 | 54.122111 | -2147483648 | 2023-05-31 10:00:00+00:00
(1 row)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       firstts(usage_iowait), last (usage_user), min (usage_steal),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          firstts          |    last     |     min     |          last_ts
----------------------------+----------+---------------------------+-------------+-------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 | -2147483648 |   54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 | -2147483648 |   54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:01+00:00 |  2147483647 |   54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:02+00:00 |          21 |          60 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:03+00:00 |          92 |          24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   | 2023-05-31 10:00:04+00:00 |          92 |          24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_0   | 2023-05-31 10:00:10+00:00 |          92 |          24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | 2023-05-31 10:00:00+00:00 |          84 | -54.1221111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   | 2023-05-31 10:00:02+00:00 |          90 |         -89 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   | 2023-05-31 10:00:03+00:00 |          21 |          60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | 2023-05-31 10:00:04+00:00 |          21 |          60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_1   | 2023-05-31 10:00:10+00:00 |          21 |          60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   | 2023-05-31 10:00:00+00:00 |          90 |          89 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:02+00:00 |          58 |          44 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:03+00:00 |          90 |          89 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   | 2023-05-31 10:00:04+00:00 |          90 |         -89 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_2   | 2023-05-31 10:00:10+00:00 |          90 |          89 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:00+00:00 |           8 |          24 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:01+00:00 |          29 |          49 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:02+00:00 |          84 |          77 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:03+00:00 |          58 |          44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   | 2023-05-31 10:00:04+00:00 |        NULL |          44 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_3   | 2023-05-31 10:00:10+00:00 |          58 |          44 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:00:00+00:00 |           2 |          19 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:00:01+00:00 |           8 |          24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   | 2023-05-31 10:00:02+00:00 |          29 |          49 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_4   | 2023-05-31 10:00:03+00:00 |          84 |          77 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   | 2023-05-31 10:00:04+00:00 |          84 |          77 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_4   | 2023-05-31 10:00:10+00:00 |          84 |          77 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:00+00:00 |         -76 |         -55 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:01+00:00 |           2 | NULL        | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   | 2023-05-31 10:00:02+00:00 |           8 |          24 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_5   | 2023-05-31 10:00:03+00:00 |          29 |          49 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   | 2023-05-31 10:00:04+00:00 |          29 |          49 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:08+00:00 | host_5   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_5   | 2023-05-31 10:00:10+00:00 |          29 |          49 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:00:00+00:00 |          44 |          92 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:00:01+00:00 |          76 |         -55 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:02+00:00 |           2 | NULL        | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:03+00:00 |           8 |          24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   | 2023-05-31 10:00:04+00:00 |           8 |          24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_6   | 2023-05-31 10:00:10+00:00 |           8 |          24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:00+00:00 |          92 |          24 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:01+00:00 |          44 |          92 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   | 2023-05-31 10:00:02+00:00 |          76 |          55 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_7   | 2023-05-31 10:00:03+00:00 |           2 | NULL        | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   | 2023-05-31 10:00:04+00:00 |           2 | NULL        | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:08+00:00 | host_7   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_7   | 2023-05-31 10:00:10+00:00 |           2 | NULL        | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:00:00+00:00 |          21 |          60 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:00:01+00:00 |          92 |          24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   | 2023-05-31 10:00:02+00:00 |          44 |          92 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_8   | 2023-05-31 10:00:03+00:00 |          76 |          55 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   | 2023-05-31 10:00:04+00:00 |          76 |          55 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:08+00:00 | host_8   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_8   | 2023-05-31 10:00:10+00:00 |          76 |          55 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:00+00:00 |          90 |         -89 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:01+00:00 |          21 |          60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   | 2023-05-31 10:00:02+00:00 |          92 |          24 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_9   | 2023-05-31 10:00:03+00:00 |          44 |          92 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   | 2023-05-31 10:00:04+00:00 |          44 |          92 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL                      |        NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_9   | 2023-05-31 10:00:10+00:00 |          44 |         -92 | 2023-05-31 10:00:10+00:00
(74 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       first_row(usage_guest),
       firstts(usage_system),
       lastts(usage_system),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname | first_row |          firstts          |          lastts           |          last_ts
----------------------------+----------+-----------+---------------------------+---------------------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |  3.141593 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   |  3.141593 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | -3.141593 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |        43 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |        96 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |        96 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_0   |        96 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |        53 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |        11 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   |        43 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |        43 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_1   |        43 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |        93 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   | NULL      | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |        11 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |        11 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_2   |        11 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |        24 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_3   |        93 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |        53 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   | NULL      | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_3   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |        40 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_4   |        24 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |        93 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_4   |        53 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |        53 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_4   |        53 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL      | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |        40 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |        24 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_5   |        93 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |        93 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:08+00:00 | host_5   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_5   |        93 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |         0 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_6   |        20 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |        40 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |        24 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |        24 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_6   |        24 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |        96 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |         0 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |        20 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_7   |        40 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |        40 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:08+00:00 | host_7   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_7   |       -40 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |        43 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_8   |        96 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |         0 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_8   |        20 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |        20 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:08+00:00 | host_8   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_8   |        20 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |        11 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   | NULL      | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |        96 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_9   |         0 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |         0 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_9   |         0 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
(74 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname, first (usage_steal), count (usage_system), firstts(usage_steal), lastts(usage_steal), first_row(usage_steal),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |   first    | count |          firstts          |          lastts           | first_row  |          last_ts
----------------------------+----------+------------+-------+---------------------------+---------------------------+------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |  54.122111 |     1 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |  54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   |  54.122111 |     1 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |  54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   |  54.122111 |     1 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |  54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |         60 |     1 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         60 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |         24 |     1 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |         24 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_0   |         24 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | -54.122111 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | -54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |        -89 |     1 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |        -89 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   |         60 |     1 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |         60 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_1   |         60 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |         89 |     2 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | NULL       | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |         44 |     1 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         44 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |         89 |     1 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         89 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |        -89 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        -89 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_2   |         89 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         89 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |         24 |     1 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |         24 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_3   |         49 |     1 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |         49 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |         77 |     1 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         77 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |         44 |     0 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |         44 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         44 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_3   |         44 |     0 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         44 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |         19 |     1 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |         19 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_4   |         24 |     1 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |         24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |         49 |     1 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         49 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_4   |         77 |     1 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         77 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |         77 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         77 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_4   |         77 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         77 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |        -55 |     1 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |        -55 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL       |     1 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |         24 |     1 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         24 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_5   |         49 |     1 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         49 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |         49 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         49 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:08+00:00 | host_5   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_5   |         49 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         49 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |         92 |     1 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |         92 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_6   |        -55 |     1 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |        -55 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   | NULL       |     1 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |         24 |     1 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |         24 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_6   |         24 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |         24 |     1 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |         24 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |         92 |     1 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |         92 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |         55 |     1 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         55 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_7   | NULL       |     1 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   | NULL       |     1 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:08+00:00 | host_7   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_7   | NULL       |     1 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |         60 |     1 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |         60 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_8   |         24 |     1 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |         24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |         92 |     1 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         92 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_8   |         55 |     1 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         55 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |         55 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         55 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:08+00:00 | host_8   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_8   |         55 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         55 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |        -89 |     1 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |        -89 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |         60 |     1 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |         60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |         24 |     1 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         24 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_9   |         92 |     1 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         92 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |         92 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         92 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_9   |        -92 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        -92 | 2023-05-31 10:00:10+00:00
(74 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname, first (usage_guest_nice), last (usage_guest), first (usage_iowait), firstts(usage_guest),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |  first   |   last    | first  |          firstts          |          last_ts
----------------------------+----------+----------+-----------+--------+---------------------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 3.141593 |  3.141593 | -32768 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 3.141593 |  3.141593 | -32768 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | NULL     | -3.141593 |  32767 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | NULL     |        43 |     41 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |       69 |        96 |     31 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |       69 |        96 |     31 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_0   |       69 |        96 |    -31 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |       74 |  3.141593 |     29 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |       76 |        11 |     25 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   | NULL     |        43 |     41 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | NULL     |        43 |     41 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_1   | NULL     |        43 |     41 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |        1 |        11 |    -17 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |       38 | NULL      |     22 | NULL                      | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |       76 |        11 |     25 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |       76 |        11 |     25 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_2   |       76 |        11 |     25 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |       82 |        24 |     30 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_3   |        1 |        93 |     17 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |       74 |        53 |     29 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |       38 | NULL      |     22 | NULL                      | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |       38 | NULL      |     22 | NULL                      | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_3   |       38 | NULL      |     22 | NULL                      | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |       54 |        40 |     38 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_4   |       82 |        24 |     30 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |        1 |        93 |    -17 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_4   |       74 |        53 |     29 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |       74 |        53 |     29 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_4   |       74 |        53 |     29 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |      -15 | NULL      |    -81 | NULL                      | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |       54 |        40 |     38 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |       82 |        24 |     30 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_5   |        1 |        93 |     17 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |        1 |        93 |     17 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:08+00:00 | host_5   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_5   |        1 |        93 |     17 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |       31 |         0 |     65 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_6   |       15 |        20 |     81 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |       54 |        40 |    -38 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |       82 |        24 |     30 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |       82 |        24 |     30 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_6   |       82 |        24 |     30 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |       69 |        96 |     31 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |       31 |         0 |     65 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |       15 |        20 |     81 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_7   |       54 |        40 |     38 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |       54 |        40 |     38 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:08+00:00 | host_7   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_7   |       54 |       -40 |     38 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | NULL     |        43 |     41 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_8   |       69 |        96 |     31 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |       31 |         0 |     65 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_8   |       15 |        20 |     81 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |       15 |        20 |     81 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:08+00:00 | host_8   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_8   |       15 |        20 |     81 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |       76 |        11 |     25 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |       36 | NULL      |     41 | NULL                      | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |       69 |        96 |     31 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_9   |       31 |         0 |     65 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |       31 |         0 |     65 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_9   |       31 |         0 |     65 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
(74 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       lastts(usage_user),
       firstts(usage_guest_nice), last (usage_softirq), last_row(usage_softirq),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          lastts           |          firstts          |   last    | last_row  |          last_ts
----------------------------+----------+---------------------------+---------------------------+-----------+-----------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 54.122111 | 54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 54.122111 | 54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:01+00:00 | NULL                      |    -100.1 |    -100.1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:02+00:00 | NULL                      |        26 |        26 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         2 |         2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         2 |         2 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_0   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         2 |         2 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 54.122111 | 54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         8 |         8 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   | 2023-05-31 10:00:03+00:00 | NULL                      |        26 |        26 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | 2023-05-31 10:00:04+00:00 | NULL                      |        26 |        26 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_1   | 2023-05-31 10:00:10+00:00 | NULL                      |        26 |        26 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |         8 |         8 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         6 |         6 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         8 |         8 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         8 |         8 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_2   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         8 |         8 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |        33 |        33 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |        60 |        60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |        54 |        54 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         6 |         6 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   | NULL                      | 2023-05-31 10:00:04+00:00 |         6 |         6 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_3   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         6 |         6 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |       -71 |       -71 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |        33 |        33 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |        60 |        60 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_4   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |        54 |        54 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        54 |        54 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_4   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        54 |        54 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |       -29 |       -29 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |        71 |        71 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |        33 |        33 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_5   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |        60 |        60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        60 |        60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_5   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_5   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        60 |        60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |         7 |         7 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |        29 |        29 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |        71 |        71 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |        33 |        33 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        33 |        33 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_6   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        33 |        33 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |         2 |         2 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |         7 |         7 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |        29 |        29 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_7   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |        71 |        71 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        71 |        71 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_7   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_7   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        71 |        71 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:00:00+00:00 | NULL                      |        26 |        26 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |         2 |         2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         7 |         7 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_8   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |        29 |        29 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        29 |        29 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_8   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_8   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        29 |        29 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |         8 |         8 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |        26 |        26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |        -2 |        -2 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_9   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |        -7 |        -7 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         7 |         7 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_9   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         7 |         7 | 2023-05-31 10:00:10+00:00
(74 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       firstts(usage_idle),
       first_row(usage_guest_nice),
       avg(usage_user),
       count(usage_softirq),
       count(usage_steal),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          firstts          | first_row |     avg     | count | count |          last_ts
----------------------------+----------+---------------------------+-----------+-------------+-------+-------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 |  3.141593 | -2147483648 |     1 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 |  3.141593 | -2147483648 |     1 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:01+00:00 | NULL      |  2147483647 |     1 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:02+00:00 | NULL      |          21 |     1 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:03+00:00 |        69 |          92 |     1 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   | 2023-05-31 10:00:04+00:00 |        69 |          92 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_0   | 2023-05-31 10:00:10+00:00 |        69 |          92 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | 2023-05-31 10:00:00+00:00 |        74 |          84 |     2 |     2 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   | 2023-05-31 10:00:02+00:00 |        76 |          90 |     1 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   | 2023-05-31 10:00:03+00:00 | NULL      |          21 |     1 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | 2023-05-31 10:00:04+00:00 | NULL      |          21 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_1   | 2023-05-31 10:00:10+00:00 | NULL      |          21 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   | 2023-05-31 10:00:00+00:00 |         1 |        59.5 |     2 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:02+00:00 |        38 |          58 |     1 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:03+00:00 |        76 |          90 |     1 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   | 2023-05-31 10:00:04+00:00 |        76 |          90 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_2   | 2023-05-31 10:00:10+00:00 |        76 |          90 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:00+00:00 |        82 |           8 |     1 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:01+00:00 |         1 |          29 |     1 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:02+00:00 |        74 |          84 |     1 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:03+00:00 |        38 |          58 |     1 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   | 2023-05-31 10:00:04+00:00 |        38 | NULL        |     1 |     1 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_3   | 2023-05-31 10:00:10+00:00 |        38 |          58 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:00:00+00:00 |        54 |           2 |     1 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:00:01+00:00 |        82 |           8 |     1 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   | 2023-05-31 10:00:02+00:00 |         1 |          29 |     1 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_4   | 2023-05-31 10:00:03+00:00 |        74 |          84 |     1 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   | 2023-05-31 10:00:04+00:00 |        74 |          84 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_4   | 2023-05-31 10:00:10+00:00 |        74 |          84 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:00+00:00 |       -15 |         -76 |     1 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:01+00:00 |        54 |           2 |     1 |     0 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   | 2023-05-31 10:00:02+00:00 |        82 |           8 |     1 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_5   | 2023-05-31 10:00:03+00:00 |         1 |          29 |     1 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   | 2023-05-31 10:00:04+00:00 |         1 |          29 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:08+00:00 | host_5   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_5   | 2023-05-31 10:00:10+00:00 |         1 |          29 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:00:00+00:00 |        31 |          44 |     1 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:00:01+00:00 |        15 |          76 |     1 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:02+00:00 |        54 |           2 |     1 |     0 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:03+00:00 |        82 |           8 |     1 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   | 2023-05-31 10:00:04+00:00 |        82 |           8 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_6   | 2023-05-31 10:00:10+00:00 |        82 |           8 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:00+00:00 |        69 |          92 |     1 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:01+00:00 |        31 |          44 |     1 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   | 2023-05-31 10:00:02+00:00 |        15 |          76 |     1 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_7   | 2023-05-31 10:00:03+00:00 |        54 |           2 |     1 |     0 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   | 2023-05-31 10:00:04+00:00 |        54 |           2 |     1 |     0 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:08+00:00 | host_7   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_7   | 2023-05-31 10:00:10+00:00 |        54 |           2 |     1 |     0 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:00:00+00:00 | NULL      |          21 |     1 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:00:01+00:00 |        69 |          92 |     1 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   | 2023-05-31 10:00:02+00:00 |        31 |          44 |     1 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_8   | 2023-05-31 10:00:03+00:00 |        15 |          76 |     1 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   | 2023-05-31 10:00:04+00:00 |        15 |          76 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:08+00:00 | host_8   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_8   | 2023-05-31 10:00:10+00:00 |        15 |          76 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:00+00:00 |        76 |          90 |     1 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:01+00:00 |        36 |          21 |     1 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   | 2023-05-31 10:00:02+00:00 |        69 |          92 |     1 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_9   | 2023-05-31 10:00:03+00:00 |        31 |          44 |     1 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   | 2023-05-31 10:00:04+00:00 |        31 |          44 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL                      | NULL      | NULL        |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_9   | 2023-05-31 10:00:10+00:00 |        31 |          44 |     1 |     1 | 2023-05-31 10:00:10+00:00
(74 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       max(usage_nice), first (usage_system), avg (usage_idle), last (usage_irq), first (usage_irq),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |     max     |    first    |     avg     |  last  | first  |          last_ts
----------------------------+----------+-------------+-------------+-------------+--------+--------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 | -2147483648 | -2147483648 | -32768 | -32768 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 | -2147483648 | -2147483648 | -32768 | -32768 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 | -2147483648 |  2147483647 | -32768 | -32768 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |          83 |          77 |         -90 |     84 |     84 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |           9 |          35 |          99 |      1 |      1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |           9 |          35 |          99 |     -1 |     -1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_0   |           9 |          35 |          99 |      1 |      1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |  2147483647 |  2147483647 |        -0.5 |  32767 |     20 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          28 |           0 |          81 |     44 |     44 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          83 |          77 |          90 |     84 |     84 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |          83 |          77 |          90 |     84 |     84 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_1   |          83 |          77 |          90 |    -84 |    -84 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |          63 |          48 |         -38 |     44 |     52 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |          61 |          -2 |          24 |     63 |     63 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |          28 |           0 |          81 |     44 |     44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |          28 |           0 |          81 |     44 |     44 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_2   |          28 |           0 |          81 |    -44 |    -44 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |          78 |          21 |         -89 |     81 |     81 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_3   |          63 |          48 |           5 |     52 |     52 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          87 |          11 |          53 |     20 |     20 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          61 |        NULL |          24 |     63 |     63 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |          61 |           2 |          24 |     63 |     63 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_3   |          61 |        NULL |          24 |     63 |     63 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |           6 |          26 |          64 |     20 |     20 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_4   |          78 |          21 |          89 |     81 |     81 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |          63 |          48 |          -5 |     52 |     52 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_4   |          87 |          11 |          53 |     20 |     20 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |          87 |          11 |          53 |     20 |     20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_4   |          87 |          11 |          53 |     20 |     20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |          -7 |         -40 |         -63 |    -20 |    -20 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |           6 |          26 |          64 |     20 |     20 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |         -78 |          21 |          89 |     81 |     81 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_5   |          63 |          48 |           5 |     52 |     52 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |         -63 |          48 |           5 |    -52 |    -52 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_5   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_5   |         -63 |          48 |           5 |     52 |     52 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |         -67 |          70 |          20 |     11 |     11 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_6   |           7 |          40 |          63 |     20 |     20 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |           6 |          26 |         -64 |     20 |     20 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |          78 |          21 |          89 |     81 |     81 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |          78 |          21 |          89 |    -81 |    -81 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_6   |         -78 |          21 |          89 |     81 |     81 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |           9 |          35 |          99 |     -1 |     -1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |          67 |          70 |          20 |     11 |     11 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |           7 |          40 |          63 |     20 |     20 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_7   |           6 |          26 |          64 |    -20 |    -20 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |           6 |          26 |         -64 |    -20 |    -20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_7   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_7   |           6 |          26 |          64 |    -20 |    -20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |          83 |          77 |          90 |     84 |     84 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_8   |           9 |          35 |         -99 |      1 |      1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |          67 |          70 |          20 |     11 |     11 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_8   |           7 |          40 |          63 |     20 |     20 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |           7 |          40 |          63 |     20 |     20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_8   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_8   |           7 |          40 |         -63 |    -20 |    -20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |          28 |           0 |          81 |    -44 |    -44 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |          83 |          77 |          90 |     84 |     84 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |          -9 |          35 |          99 |      1 |      1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_9   |          67 |          70 |          20 |     11 |     11 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |          67 |          70 |          20 |     11 |     11 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL        |        NULL | NULL        | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_9   |          67 |          70 |          20 |     11 |     11 | 2023-05-31 10:00:10+00:00
(74 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       max(usage_guest_nice),
       lastts(usage_idle),
       max(usage_guest),
       avg(usage_nice), first (usage_guest),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |   max    |          lastts           |    max    |     avg     |   first   |          last_ts
----------------------------+----------+----------+---------------------------+-----------+-------------+-----------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 3.141593 | 2023-05-31 10:00:00+00:00 |  3.141593 | -2147483648 |  3.141593 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 3.141593 | 2023-05-31 10:00:00+00:00 |  3.141593 | -2147483648 |  3.141593 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | NULL     | 2023-05-31 10:00:01+00:00 | -3.141593 | -2147483648 | -3.141593 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | NULL     | 2023-05-31 10:00:02+00:00 |        43 |          83 |        43 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |       69 | 2023-05-31 10:00:03+00:00 |        96 |           9 |        96 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |       69 | 2023-05-31 10:00:04+00:00 |        96 |           9 |        96 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_0   |       69 | 2023-05-31 10:00:10+00:00 |        96 |           9 |        96 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |       74 | 2023-05-31 10:00:01+00:00 |        53 |  2147483647 |        53 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |       76 | 2023-05-31 10:00:02+00:00 |        11 |          28 |        11 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   | NULL     | 2023-05-31 10:00:03+00:00 |        43 |          83 |        43 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | NULL     | 2023-05-31 10:00:04+00:00 |        43 |          83 |        43 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_1   | NULL     | 2023-05-31 10:00:10+00:00 |        43 |          83 |        43 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |       76 | 2023-05-31 10:00:01+00:00 |        93 |        45.5 |        93 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |       38 | 2023-05-31 10:00:02+00:00 | NULL      |          61 | NULL      | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |       76 | 2023-05-31 10:00:03+00:00 |        11 |          28 |        11 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |       76 | 2023-05-31 10:00:04+00:00 |        11 |          28 |        11 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_2   |       76 | 2023-05-31 10:00:10+00:00 |        11 |          28 |        11 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |       82 | 2023-05-31 10:00:00+00:00 |        24 |          78 |        24 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_3   |        1 | 2023-05-31 10:00:01+00:00 |        93 |          63 |        93 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |       74 | 2023-05-31 10:00:02+00:00 |        53 |          87 |        53 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |       38 | 2023-05-31 10:00:03+00:00 | NULL      |          61 | NULL      | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |       38 | 2023-05-31 10:00:04+00:00 | NULL      |          61 | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_3   |       38 | 2023-05-31 10:00:10+00:00 | NULL      |          61 | NULL      | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |       54 | 2023-05-31 10:00:00+00:00 |        40 |           6 |        40 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_4   |       82 | 2023-05-31 10:00:01+00:00 |        24 |          78 |        24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |        1 | 2023-05-31 10:00:02+00:00 |        93 |          63 |        93 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_4   |       74 | 2023-05-31 10:00:03+00:00 |        53 |          87 |        53 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |       74 | 2023-05-31 10:00:04+00:00 |        53 |          87 |        53 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_4   |       74 | 2023-05-31 10:00:10+00:00 |        53 |          87 |        53 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |      -15 | 2023-05-31 10:00:00+00:00 | NULL      |          -7 | NULL      | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |       54 | 2023-05-31 10:00:01+00:00 |        40 |           6 |        40 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |       82 | 2023-05-31 10:00:02+00:00 |        24 |         -78 |        24 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_5   |        1 | 2023-05-31 10:00:03+00:00 |        93 |          63 |        93 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |        1 | 2023-05-31 10:00:04+00:00 |        93 |         -63 |        93 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_5   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_5   |        1 | 2023-05-31 10:00:10+00:00 |        93 |         -63 |        93 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |       31 | 2023-05-31 10:00:00+00:00 |         0 |         -67 |         0 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_6   |       15 | 2023-05-31 10:00:01+00:00 |        20 |           7 |        20 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |       54 | 2023-05-31 10:00:02+00:00 |        40 |           6 |        40 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |       82 | 2023-05-31 10:00:03+00:00 |        24 |          78 |        24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |       82 | 2023-05-31 10:00:04+00:00 |        24 |          78 |        24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_6   |       82 | 2023-05-31 10:00:10+00:00 |        24 |         -78 |        24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |       69 | 2023-05-31 10:00:00+00:00 |        96 |           9 |        96 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |       31 | 2023-05-31 10:00:01+00:00 |         0 |          67 |         0 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |       15 | 2023-05-31 10:00:02+00:00 |        20 |           7 |        20 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_7   |       54 | 2023-05-31 10:00:03+00:00 |        40 |           6 |        40 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |       54 | 2023-05-31 10:00:04+00:00 |        40 |           6 |        40 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_7   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_7   |       54 | 2023-05-31 10:00:10+00:00 |       -40 |           6 |       -40 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | NULL     | 2023-05-31 10:00:00+00:00 |        43 |          83 |        43 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_8   |       69 | 2023-05-31 10:00:01+00:00 |        96 |           9 |        96 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |       31 | 2023-05-31 10:00:02+00:00 |         0 |          67 |         0 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_8   |       15 | 2023-05-31 10:00:03+00:00 |        20 |           7 |        20 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |       15 | 2023-05-31 10:00:04+00:00 |        20 |           7 |        20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_8   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_8   |       15 | 2023-05-31 10:00:10+00:00 |        20 |           7 |        20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |       76 | 2023-05-31 10:00:00+00:00 |        11 |          28 |        11 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |       36 | 2023-05-31 10:00:01+00:00 | NULL      |          83 | NULL      | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |       69 | 2023-05-31 10:00:02+00:00 |        96 |          -9 |        96 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_9   |       31 | 2023-05-31 10:00:03+00:00 |         0 |          67 |         0 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |       31 | 2023-05-31 10:00:04+00:00 |         0 |          67 |         0 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL     | NULL                      | NULL      | NULL        | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_9   |       31 | 2023-05-31 10:00:10+00:00 |         0 |          67 |         0 | 2023-05-31 10:00:10+00:00
(74 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       min(usage_guest_nice),
       max(usage_softirq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |    min    |    max    |          last_ts
----------------------------+----------+-----------+-----------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |  3.141593 | 54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   |  3.141593 | 54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | NULL      |    -100.1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | NULL      |        26 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |        69 |         2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |        69 |         2 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL      | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_0   |        69 |         2 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | -3.141593 | 54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |        76 |         8 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   | NULL      |        26 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | NULL      |        26 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_1   | NULL      |        26 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |         1 |        60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |        38 |         6 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |        76 |         8 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |        76 |         8 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_2   |        76 |         8 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |        82 |        33 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_3   |         1 |        60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |        74 |        54 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |        38 |         6 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |        38 |         6 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL      | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_3   |        38 |         6 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |        54 |       -71 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_4   |        82 |        33 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |         1 |        60 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_4   |        74 |        54 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |        74 |        54 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_4   |        74 |        54 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |       -15 |       -29 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |        54 |        71 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |        82 |        33 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_5   |         1 |        60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |         1 |        60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL      | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_5   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_5   |         1 |        60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |        31 |         7 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_6   |        15 |        29 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |        54 |        71 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |        82 |        33 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |        82 |        33 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_6   |        82 |        33 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |        69 |         2 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |        31 |         7 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |        15 |        29 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_7   |        54 |        71 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |        54 |        71 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL      | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_7   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_7   |        54 |        71 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | NULL      |        26 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_8   |        69 |         2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |        31 |         7 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_8   |        15 |        29 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |        15 |        29 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL      | NULL      | NULL
  2023-05-31 10:00:08+00:00 | host_8   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_8   |        15 |        29 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |        76 |         8 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |        36 |        26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |        69 |        -2 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_9   |        31 |        -7 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |        31 |         7 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_9   |        31 |         7 | 2023-05-31 10:00:10+00:00
(74 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname, last (usage_steal), count (usage_user), avg (usage_iowait), count (usage_guest),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |    last     | count |  avg   | count |          last_ts
----------------------------+----------+-------------+-------+--------+-------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |   54.122111 |     1 | -32768 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   |   54.122111 |     1 | -32768 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   |   54.122111 |     1 |  32767 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |          60 |     1 |     41 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |          24 |     1 |     31 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |          24 |     1 |     31 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:08+00:00 | host_0   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_0   |          24 |     1 |    -31 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | -54.1221111 |     1 |  16398 |     2 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |         -89 |     1 |     25 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          60 |     1 |     41 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |          60 |     1 |     41 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_1   |          60 |     1 |     41 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |          89 |     2 |      4 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |          44 |     1 |     22 |     0 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |          89 |     1 |     25 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |         -89 |     1 |     25 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_2   |          89 |     1 |     25 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |          24 |     1 |     30 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_3   |          49 |     1 |     17 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          77 |     1 |     29 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          44 |     1 |     22 |     0 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |          44 |     0 |     22 |     0 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_3   |          44 |     1 |     22 |     0 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |          19 |     1 |     38 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_4   |          24 |     1 |     30 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |          49 |     1 |    -17 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_4   |          77 |     1 |     29 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |          77 |     1 |     29 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_4   |          77 |     1 |     29 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |         -55 |     1 |    -81 |     0 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL        |     1 |     38 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |          24 |     1 |     30 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_5   |          49 |     1 |     17 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |          49 |     1 |     17 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:08+00:00 | host_5   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_5   |          49 |     1 |     17 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |          92 |     1 |     65 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_6   |         -55 |     1 |     81 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   | NULL        |     1 |    -38 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |          24 |     1 |     30 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |          24 |     1 |     30 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_6   |          24 |     1 |     30 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |          24 |     1 |     31 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |          92 |     1 |     65 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |          55 |     1 |     81 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_7   | NULL        |     1 |     38 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   | NULL        |     1 |     38 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:08+00:00 | host_7   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_7   | NULL        |     1 |     38 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |          60 |     1 |     41 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_8   |          24 |     1 |     31 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |          92 |     1 |     65 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_8   |          55 |     1 |     81 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |          55 |     1 |     81 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:08+00:00 | host_8   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_8   |          55 |     1 |     81 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |         -89 |     1 |     25 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |          60 |     1 |     41 |     0 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |          24 |     1 |     31 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_9   |          92 |     1 |     65 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |          92 |     1 |     65 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL        |     0 | NULL   |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_9   |         -92 |     1 |     65 |     1 | 2023-05-31 10:00:10+00:00
(74 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       count(usage_guest_nice),
       firstts(usage_softirq), last (usage_nice), sum (usage_user), max (usage_iowait),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname | count |          firstts          |    last     |     sum     |  max   |          last_ts
----------------------------+----------+-------+---------------------------+-------------+-------------+--------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |     1 | 2023-05-31 10:00:00+00:00 | -2147483648 | -2147483648 | -32768 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   |     1 | 2023-05-31 10:00:00+00:00 | -2147483648 | -2147483648 | -32768 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   |     0 | 2023-05-31 10:00:01+00:00 | -2147483648 |  2147483647 |  32767 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |     0 | 2023-05-31 10:00:02+00:00 |          83 |          21 |     41 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |     1 | 2023-05-31 10:00:03+00:00 |           9 |          92 |     31 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |     1 | 2023-05-31 10:00:04+00:00 |           9 |          92 |     31 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_0   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_0   |     1 | 2023-05-31 10:00:10+00:00 |           9 |          92 |    -31 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |     2 | 2023-05-31 10:00:00+00:00 |  2147483647 |          84 |  32767 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |     1 | 2023-05-31 10:00:02+00:00 |          28 |          90 |     25 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_1   |     0 | 2023-05-31 10:00:03+00:00 |          83 |          21 |     41 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |     0 | 2023-05-31 10:00:04+00:00 |          83 |          21 |     41 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_1   |     0 | 2023-05-31 10:00:10+00:00 |          83 |          21 |     41 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |     2 | 2023-05-31 10:00:00+00:00 |          28 |         119 |     25 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |     1 | 2023-05-31 10:00:02+00:00 |          61 |          58 |     22 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |     1 | 2023-05-31 10:00:03+00:00 |          28 |          90 |     25 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |     1 | 2023-05-31 10:00:04+00:00 |          28 |          90 |     25 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_2   |     1 | 2023-05-31 10:00:10+00:00 |          28 |          90 |     25 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |     1 | 2023-05-31 10:00:00+00:00 |          78 |           8 |     30 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_3   |     1 | 2023-05-31 10:00:01+00:00 |          63 |          29 |     17 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |     1 | 2023-05-31 10:00:02+00:00 |          87 |          84 |     29 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |     1 | 2023-05-31 10:00:03+00:00 |          61 |          58 |     22 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |     1 | 2023-05-31 10:00:04+00:00 |          61 | NULL        |     22 | NULL
  2023-05-31 10:00:08+00:00 | host_3   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_3   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_3   |     1 | 2023-05-31 10:00:10+00:00 |          61 |          58 |     22 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |     1 | 2023-05-31 10:00:00+00:00 |           6 |           2 |     38 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_4   |     1 | 2023-05-31 10:00:01+00:00 |          78 |           8 |     30 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |     1 | 2023-05-31 10:00:02+00:00 |          63 |          29 |    -17 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_4   |     1 | 2023-05-31 10:00:03+00:00 |          87 |          84 |     29 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |     1 | 2023-05-31 10:00:04+00:00 |          87 |          84 |     29 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_4   |     1 | 2023-05-31 10:00:10+00:00 |          87 |          84 |     29 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |     1 | 2023-05-31 10:00:00+00:00 |          -7 |         -76 |    -81 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |     1 | 2023-05-31 10:00:01+00:00 |           6 |           2 |     38 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |     1 | 2023-05-31 10:00:02+00:00 |         -78 |           8 |     30 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_5   |     1 | 2023-05-31 10:00:03+00:00 |          63 |          29 |     17 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |     1 | 2023-05-31 10:00:04+00:00 |         -63 |          29 |     17 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_5   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_5   |     1 | 2023-05-31 10:00:10+00:00 |         -63 |          29 |     17 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |     1 | 2023-05-31 10:00:00+00:00 |         -67 |          44 |     65 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_6   |     1 | 2023-05-31 10:00:01+00:00 |           7 |          76 |     81 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |     1 | 2023-05-31 10:00:02+00:00 |           6 |           2 |    -38 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |     1 | 2023-05-31 10:00:03+00:00 |          78 |           8 |     30 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |     1 | 2023-05-31 10:00:04+00:00 |          78 |           8 |     30 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_6   |     1 | 2023-05-31 10:00:10+00:00 |         -78 |           8 |     30 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |     1 | 2023-05-31 10:00:00+00:00 |           9 |          92 |     31 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |     1 | 2023-05-31 10:00:01+00:00 |          67 |          44 |     65 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |     1 | 2023-05-31 10:00:02+00:00 |           7 |          76 |     81 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_7   |     1 | 2023-05-31 10:00:03+00:00 |           6 |           2 |     38 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |     1 | 2023-05-31 10:00:04+00:00 |           6 |           2 |     38 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_7   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_7   |     1 | 2023-05-31 10:00:10+00:00 |           6 |           2 |     38 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |     0 | 2023-05-31 10:00:00+00:00 |          83 |          21 |     41 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_8   |     1 | 2023-05-31 10:00:01+00:00 |           9 |          92 |     31 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |     1 | 2023-05-31 10:00:02+00:00 |          67 |          44 |     65 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_8   |     1 | 2023-05-31 10:00:03+00:00 |           7 |          76 |     81 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |     1 | 2023-05-31 10:00:04+00:00 |           7 |          76 |     81 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:08+00:00 | host_8   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_8   |     1 | 2023-05-31 10:00:10+00:00 |           7 |          76 |     81 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |     1 | 2023-05-31 10:00:00+00:00 |          28 |          90 |     25 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |     1 | 2023-05-31 10:00:01+00:00 |          83 |          21 |     41 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |     1 | 2023-05-31 10:00:02+00:00 |          -9 |          92 |     31 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_9   |     1 | 2023-05-31 10:00:03+00:00 |          67 |          44 |     65 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |     1 | 2023-05-31 10:00:04+00:00 |          67 |          44 |     65 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   |     0 | NULL                      | NULL        | NULL        | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_9   |     1 | 2023-05-31 10:00:10+00:00 |          67 |          44 |     65 | 2023-05-31 10:00:10+00:00
(74 rows)
> SELECT count(usage_irq),
       time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       avg(usage_softirq),
       first_row(usage_softirq),
       first_row(usage_nice), last (usage_iowait),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
  count |       k_timestamp_b       | hostname |    avg    | first_row  |  first_row  |  last  |          last_ts
--------+---------------------------+----------+-----------+------------+-------------+--------+----------------------------
      1 | 2023-05-31 10:00:00+00:00 | host_0   | 54.122111 |  54.122111 | -2147483648 | -32768 | 2023-05-31 10:00:00+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_0   | 54.122111 |  54.122111 | -2147483648 | -32768 | 2023-05-31 10:00:00+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_0   |    -100.1 |     -100.1 | -2147483648 |  32767 | 2023-05-31 10:00:01+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_0   |        26 |         26 |          83 |     41 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_0   |         2 |          2 |           9 |     31 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_0   |         2 |          2 |           9 |     31 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_0   | NULL      | NULL       | NULL        | NULL   | NULL
      0 | 2023-05-31 10:00:08+00:00 | host_0   | NULL      | NULL       | NULL        | NULL   | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_0   |         2 |          2 |           9 |    -31 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_1   |         0 | -54.122111 |  2147483647 |  32767 | 2023-05-31 10:00:00+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_1   |         8 |          8 |          28 |     25 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_1   |        26 |         26 |          83 |     41 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_1   |        26 |         26 |          83 |     41 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_1   | NULL      | NULL       | NULL        | NULL   | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_1   |        26 |         26 |          83 |     41 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_2   |        34 |         60 |          63 |     25 | 2023-05-31 10:00:01+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_2   |         6 |          6 |          61 |     22 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_2   |         8 |          8 |          28 |     25 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_2   |         8 |          8 |          28 |     25 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_2   | NULL      | NULL       | NULL        | NULL   | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_2   |         8 |          8 |          28 |     25 | 2023-05-31 10:00:10+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_3   |        33 |         33 |          78 |     30 | 2023-05-31 10:00:00+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_3   |        60 |         60 |          63 |     17 | 2023-05-31 10:00:01+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_3   |        54 |         54 |          87 |     29 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_3   |         6 |          6 |          61 |     22 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_3   |         6 |          6 |          61 |     22 | NULL
      0 | 2023-05-31 10:00:08+00:00 | host_3   | NULL      | NULL       | NULL        | NULL   | NULL
      0 | 2023-05-31 10:00:08+00:00 | host_3   | NULL      | NULL       | NULL        | NULL   | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_3   |         6 |          6 |          61 |     22 | 2023-05-31 10:00:10+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_4   |       -71 |        -71 |           6 |     38 | 2023-05-31 10:00:00+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_4   |        33 |         33 |          78 |     30 | 2023-05-31 10:00:01+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_4   |        60 |         60 |          63 |    -17 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_4   |        54 |         54 |          87 |     29 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_4   |        54 |         54 |          87 |     29 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_4   | NULL      | NULL       | NULL        | NULL   | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_4   |        54 |         54 |          87 |     29 | 2023-05-31 10:00:10+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_5   |       -29 |        -29 |          -7 |    -81 | 2023-05-31 10:00:00+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_5   |        71 |         71 |           6 |     38 | 2023-05-31 10:00:01+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_5   |        33 |         33 |         -78 |     30 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_5   |        60 |         60 |          63 |     17 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_5   |        60 |         60 |         -63 |     17 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_5   | NULL      | NULL       | NULL        | NULL   | NULL
      0 | 2023-05-31 10:00:08+00:00 | host_5   | NULL      | NULL       | NULL        | NULL   | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_5   |        60 |         60 |         -63 |     17 | 2023-05-31 10:00:10+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_6   |         7 |          7 |         -67 |     65 | 2023-05-31 10:00:00+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_6   |        29 |         29 |           7 |     81 | 2023-05-31 10:00:01+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_6   |        71 |         71 |           6 |    -38 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_6   |        33 |         33 |          78 |     30 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_6   |        33 |         33 |          78 |     30 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_6   | NULL      | NULL       | NULL        | NULL   | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_6   |        33 |         33 |         -78 |     30 | 2023-05-31 10:00:10+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_7   |         2 |          2 |           9 |     31 | 2023-05-31 10:00:00+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_7   |         7 |          7 |          67 |     65 | 2023-05-31 10:00:01+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_7   |        29 |         29 |           7 |     81 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_7   |        71 |         71 |           6 |     38 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_7   |        71 |         71 |           6 |     38 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_7   | NULL      | NULL       | NULL        | NULL   | NULL
      0 | 2023-05-31 10:00:08+00:00 | host_7   | NULL      | NULL       | NULL        | NULL   | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_7   |        71 |         71 |           6 |     38 | 2023-05-31 10:00:10+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_8   |        26 |         26 |          83 |     41 | 2023-05-31 10:00:00+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_8   |         2 |          2 |           9 |     31 | 2023-05-31 10:00:01+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_8   |         7 |          7 |          67 |     65 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_8   |        29 |         29 |           7 |     81 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_8   |        29 |         29 |           7 |     81 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_8   | NULL      | NULL       | NULL        | NULL   | NULL
      0 | 2023-05-31 10:00:08+00:00 | host_8   | NULL      | NULL       | NULL        | NULL   | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_8   |        29 |         29 |           7 |     81 | 2023-05-31 10:00:10+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_9   |         8 |          8 |          28 |     25 | 2023-05-31 10:00:00+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_9   |        26 |         26 |          83 |     41 | 2023-05-31 10:00:01+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_9   |        -2 |         -2 |          -9 |     31 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_9   |        -7 |         -7 |          67 |     65 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_9   |         7 |          7 |          67 |     65 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_9   | NULL      | NULL       | NULL        | NULL   | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_9   |         7 |          7 |          67 |     65 | 2023-05-31 10:00:10+00:00
(74 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b, hostname, lastts(usage_guest), sum(usage_steal), firstts(usage_nice), max(usage_user), max(usage_irq), lastts(usage_user) as last_ts
FROM test.cpu WHERE k_timestamp >= '2023-01-01 00:00:00' AND k_timestamp < '2024-01-01 00:00:00' AND hostname = 'host_0' GROUP BY hostname, region, datacenter, rack, k_timestamp_b ORDER BY hostname, k_timestamp_b, last_ts;
                tree               |                  field                   |                                description
-----------------------------------+------------------------------------------+-----------------------------------------------------------------------------
                                   | distributed                              | true
                                   | vectorized                               | false
  render                           |                                          |
   │                               | k_timestamp_b                            | k_timestamp_b
   │                               | hostname                                 | any_not_null
   │                               | lastts                                   | lastts
   │                               | sum                                      | sum
   │                               | firstts                                  | firstts
   │                               | max                                      | max
   │                               | max                                      | max
   │                               | last_ts                                  | lastts
   └── sort                        |                                          |
        │                          | order                                    | +k_timestamp_b,+lastts
        └── render                 |                                          |
             │                     | engine type                              | time series
             │                     | any_not_null                             | any_not_null
             │                     | lastts                                   | lastts
             │                     | sum                                      | sum
             │                     | firstts                                  | firstts
             │                     | max                                      | max
             │                     | max                                      | max
             │                     | lastts                                   | lastts
             │                     | k_timestamp_b                            | k_timestamp_b
             └── group             |                                          |
                  │                | engine type                              | time series
                  │                | aggregate 0                              | region
                  │                | aggregate 1                              | datacenter
                  │                | aggregate 2                              | rack
                  │                | aggregate 3                              | k_timestamp_b
                  │                | aggregate 4                              | lastts(usage_guest, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | aggregate 5                              | sum(usage_steal)
                  │                | aggregate 6                              | firstts(usage_nice, k_timestamp)
                  │                | aggregate 7                              | max(usage_user)
                  │                | aggregate 8                              | max(usage_irq)
                  │                | aggregate 9                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | aggregate 10                             | any_not_null(hostname)
                  │                | group by                                 | region, datacenter, rack, k_timestamp_b
                  │                | pushLocalAggToScan                       | true
                  │                | addSynchronizer                          | true
                  └── render       |                                          |
                       │           | engine type                              | time series
                       │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                       │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                       │           | k_timestamp                              | k_timestamp
                       │           | usage_user                               | usage_user
                       │           | usage_nice                               | usage_nice
                       │           | usage_irq                                | usage_irq
                       │           | usage_steal                              | usage_steal
                       │           | usage_guest                              | usage_guest
                       │           | hostname                                 | hostname
                       │           | region                                   | region
                       │           | datacenter                               | datacenter
                       │           | rack                                     | rack
                       └── ts scan |                                          |
                                   | ts-table                                 | cpu
                                   | access mode                              | tableTableMeta
                                   | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                   | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
                                   | tag filter[0]                            | hostname = 'host_0'
(59 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b, hostname, first_row(usage_idle), lastts(usage_nice), lastts(usage_irq), lastts(usage_guest_nice), max(usage_idle), lastts(usage_user) as last_ts FROM test.cpu WHERE k_timestamp >= '2023-01-01 00:00:00' AND k_timestamp < '2024-01-01 00:00:00' AND hostname = 'host_1' GROUP BY hostname, region, datacenter, rack, k_timestamp_b ORDER BY hostname, k_timestamp_b, last_ts;
                tree               |                  field                   |                                   description
-----------------------------------+------------------------------------------+----------------------------------------------------------------------------------
                                   | distributed                              | true
                                   | vectorized                               | false
  render                           |                                          |
   │                               | k_timestamp_b                            | k_timestamp_b
   │                               | hostname                                 | any_not_null
   │                               | first_row                                | first_row
   │                               | lastts                                   | lastts
   │                               | lastts                                   | lastts
   │                               | lastts                                   | lastts
   │                               | max                                      | max
   │                               | last_ts                                  | lastts
   └── sort                        |                                          |
        │                          | order                                    | +k_timestamp_b,+lastts
        └── render                 |                                          |
             │                     | engine type                              | time series
             │                     | any_not_null                             | any_not_null
             │                     | first_row                                | first_row
             │                     | lastts                                   | lastts
             │                     | lastts                                   | lastts
             │                     | lastts                                   | lastts
             │                     | max                                      | max
             │                     | lastts                                   | lastts
             │                     | k_timestamp_b                            | k_timestamp_b
             └── group             |                                          |
                  │                | engine type                              | time series
                  │                | aggregate 0                              | region
                  │                | aggregate 1                              | datacenter
                  │                | aggregate 2                              | rack
                  │                | aggregate 3                              | k_timestamp_b
                  │                | aggregate 4                              | first_row(usage_idle, k_timestamp)
                  │                | aggregate 5                              | lastts(usage_nice, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | aggregate 6                              | lastts(usage_irq, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | aggregate 7                              | lastts(usage_guest_nice, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | aggregate 8                              | max(usage_idle)
                  │                | aggregate 9                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | aggregate 10                             | any_not_null(hostname)
                  │                | group by                                 | region, datacenter, rack, k_timestamp_b
                  │                | pushLocalAggToScan                       | true
                  │                | addSynchronizer                          | true
                  └── render       |                                          |
                       │           | engine type                              | time series
                       │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                       │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                       │           | k_timestamp                              | k_timestamp
                       │           | usage_user                               | usage_user
                       │           | usage_idle                               | usage_idle
                       │           | usage_nice                               | usage_nice
                       │           | usage_irq                                | usage_irq
                       │           | usage_guest_nice                         | usage_guest_nice
                       │           | hostname                                 | hostname
                       │           | region                                   | region
                       │           | datacenter                               | datacenter
                       │           | rack                                     | rack
                       └── ts scan |                                          |
                                   | ts-table                                 | cpu
                                   | access mode                              | tableTableMeta
                                   | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                   | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
                                   | tag filter[0]                            | hostname = 'host_1'
(59 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b, hostname, sum(usage_guest), count(usage_idle), avg(usage_system), max(usage_steal), lastts(usage_user) as last_ts FROM test.cpu WHERE k_timestamp >= '2023-01-01 00:00:00' AND k_timestamp < '2024-01-01 00:00:00' AND hostname = 'host_0' AND region = 'aaa' GROUP BY hostname, region, datacenter, rack, k_timestamp_b ORDER BY hostname, k_timestamp_b, last_ts;
                tree               |                  field                   |                                description
-----------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                   | distributed                              | true
                                   | vectorized                               | false
  render                           |                                          |
   │                               | k_timestamp_b                            | k_timestamp_b
   │                               | hostname                                 | any_not_null
   │                               | sum                                      | sum
   │                               | count                                    | count
   │                               | avg                                      | avg
   │                               | max                                      | max
   │                               | last_ts                                  | lastts
   └── sort                        |                                          |
        │                          | order                                    | +k_timestamp_b,+lastts
        └── render                 |                                          |
             │                     | engine type                              | time series
             │                     | any_not_null                             | any_not_null
             │                     | sum                                      | sum
             │                     | count                                    | count
             │                     | avg                                      | avg
             │                     | max                                      | max
             │                     | lastts                                   | lastts
             │                     | k_timestamp_b                            | k_timestamp_b
             └── group             |                                          |
                  │                | engine type                              | time series
                  │                | aggregate 0                              | datacenter
                  │                | aggregate 1                              | rack
                  │                | aggregate 2                              | k_timestamp_b
                  │                | aggregate 3                              | sum(usage_guest)
                  │                | aggregate 4                              | count(usage_idle)
                  │                | aggregate 5                              | avg(usage_system)
                  │                | aggregate 6                              | max(usage_steal)
                  │                | aggregate 7                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | aggregate 8                              | any_not_null(hostname)
                  │                | group by                                 | datacenter, rack, k_timestamp_b
                  │                | pushLocalAggToScan                       | true
                  │                | addSynchronizer                          | true
                  └── render       |                                          |
                       │           | engine type                              | time series
                       │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                       │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                       │           | k_timestamp                              | k_timestamp
                       │           | usage_user                               | usage_user
                       │           | usage_system                             | usage_system
                       │           | usage_idle                               | usage_idle
                       │           | usage_steal                              | usage_steal
                       │           | usage_guest                              | usage_guest
                       │           | hostname                                 | hostname
                       │           | datacenter                               | datacenter
                       │           | rack                                     | rack
                       └── ts scan |                                          |
                                   | ts-table                                 | cpu
                                   | access mode                              | tableTableMeta
                                   | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                   | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
                                   | tag filter[0]                            | hostname = 'host_0'
                                   | tag filter[1]                            | region = 'aaa'
(55 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b, hostname, last_row(usage_iowait), avg(usage_irq), max(usage_system), firstts(usage_irq), lastts(usage_softirq), lastts(usage_user) as last_ts FROM test.cpu WHERE k_timestamp >= '2023-01-01 00:00:00' AND k_timestamp < '2024-01-01 00:00:00' AND hostname = 'host_0' AND region = 'aaaaaaaa' GROUP BY hostname, region, datacenter, rack, k_timestamp_b ORDER BY hostname, k_timestamp_b, last_ts;
                tree               |                  field                   |                                 description
-----------------------------------+------------------------------------------+-------------------------------------------------------------------------------
                                   | distributed                              | true
                                   | vectorized                               | false
  render                           |                                          |
   │                               | k_timestamp_b                            | k_timestamp_b
   │                               | hostname                                 | any_not_null
   │                               | last_row                                 | last_row
   │                               | avg                                      | avg
   │                               | max                                      | max
   │                               | firstts                                  | firstts
   │                               | lastts                                   | lastts
   │                               | last_ts                                  | lastts
   └── sort                        |                                          |
        │                          | order                                    | +k_timestamp_b,+lastts
        └── render                 |                                          |
             │                     | engine type                              | time series
             │                     | any_not_null                             | any_not_null
             │                     | last_row                                 | last_row
             │                     | avg                                      | avg
             │                     | max                                      | max
             │                     | firstts                                  | firstts
             │                     | lastts                                   | lastts
             │                     | lastts                                   | lastts
             │                     | k_timestamp_b                            | k_timestamp_b
             └── group             |                                          |
                  │                | engine type                              | time series
                  │                | aggregate 0                              | datacenter
                  │                | aggregate 1                              | rack
                  │                | aggregate 2                              | k_timestamp_b
                  │                | aggregate 3                              | last_row(usage_iowait, k_timestamp)
                  │                | aggregate 4                              | avg(usage_irq)
                  │                | aggregate 5                              | max(usage_system)
                  │                | aggregate 6                              | firstts(usage_irq, k_timestamp)
                  │                | aggregate 7                              | lastts(usage_softirq, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | aggregate 8                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | aggregate 9                              | any_not_null(hostname)
                  │                | group by                                 | datacenter, rack, k_timestamp_b
                  │                | pushLocalAggToScan                       | true
                  │                | addSynchronizer                          | true
                  └── render       |                                          |
                       │           | engine type                              | time series
                       │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                       │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                       │           | k_timestamp                              | k_timestamp
                       │           | usage_user                               | usage_user
                       │           | usage_system                             | usage_system
                       │           | usage_iowait                             | usage_iowait
                       │           | usage_irq                                | usage_irq
                       │           | usage_softirq                            | usage_softirq
                       │           | hostname                                 | hostname
                       │           | datacenter                               | datacenter
                       │           | rack                                     | rack
                       └── ts scan |                                          |
                                   | ts-table                                 | cpu
                                   | access mode                              | tableTableMeta
                                   | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                   | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
                                   | tag filter[0]                            | hostname = 'host_0'
                                   | tag filter[1]                            | region = 'aaaaaaaa'
(58 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,first_row(usage_irq),lastts(usage_iowait),sum(usage_iowait),hostname,first_row(usage_system),lastts(usage_user) as last_ts FROM test.cpu WHERE k_timestamp >= '2023-01-01 00:00:00' AND k_timestamp < '2024-01-01 00:00:00' AND region = 'aaa' GROUP BY hostname, region, datacenter, rack, k_timestamp_b ORDER BY hostname, k_timestamp_b, last_ts;
                tree               |                  field                   |                                 description
-----------------------------------+------------------------------------------+------------------------------------------------------------------------------
                                   | distributed                              | true
                                   | vectorized                               | false
  render                           |                                          |
   │                               | k_timestamp_b                            | k_timestamp_b
   │                               | first_row                                | first_row
   │                               | lastts                                   | lastts
   │                               | sum                                      | sum
   │                               | hostname                                 | hostname
   │                               | first_row                                | first_row
   │                               | last_ts                                  | lastts
   └── sort                        |                                          |
        │                          | order                                    | +hostname,+k_timestamp_b,+lastts
        └── render                 |                                          |
             │                     | engine type                              | time series
             │                     | hostname                                 | hostname
             │                     | first_row                                | first_row
             │                     | lastts                                   | lastts
             │                     | sum                                      | sum
             │                     | first_row                                | first_row
             │                     | lastts                                   | lastts
             │                     | k_timestamp_b                            | k_timestamp_b
             └── group             |                                          |
                  │                | engine type                              | time series
                  │                | aggregate 0                              | hostname
                  │                | aggregate 1                              | datacenter
                  │                | aggregate 2                              | rack
                  │                | aggregate 3                              | k_timestamp_b
                  │                | aggregate 4                              | first_row(usage_irq, k_timestamp)
                  │                | aggregate 5                              | lastts(usage_iowait, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | aggregate 6                              | sum(usage_iowait)
                  │                | aggregate 7                              | first_row(usage_system, k_timestamp)
                  │                | aggregate 8                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | group by                                 | hostname, datacenter, rack, k_timestamp_b
                  │                | pushLocalAggToScan                       | true
                  │                | addSynchronizer                          | true
                  └── render       |                                          |
                       │           | engine type                              | time series
                       │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                       │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                       │           | k_timestamp                              | k_timestamp
                       │           | usage_user                               | usage_user
                       │           | usage_system                             | usage_system
                       │           | usage_iowait                             | usage_iowait
                       │           | usage_irq                                | usage_irq
                       │           | hostname                                 | hostname
                       │           | datacenter                               | datacenter
                       │           | rack                                     | rack
                       └── ts scan |                                          |
                                   | ts-table                                 | cpu
                                   | access mode                              | tableTableMeta
                                   | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                   | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
                                   | tag filter[0]                            | region = 'aaa'
(53 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b, first (usage_nice), min (usage_system), min (usage_softirq), last_row(usage_guest_nice), hostname, lastts(usage_user) as last_ts FROM test.cpu WHERE k_timestamp >= '2023-01-01 00:00:00' AND k_timestamp < '2024-01-01 00:00:00' AND region = 'aaaaaaaa' GROUP BY hostname, region, datacenter, rack, k_timestamp_b ORDER BY hostname, k_timestamp_b, last_ts;
                tree               |                  field                   |                                description
-----------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                   | distributed                              | true
                                   | vectorized                               | false
  render                           |                                          |
   │                               | k_timestamp_b                            | k_timestamp_b
   │                               | first                                    | first
   │                               | min                                      | min
   │                               | min                                      | min
   │                               | last_row                                 | last_row
   │                               | hostname                                 | hostname
   │                               | last_ts                                  | lastts
   └── sort                        |                                          |
        │                          | order                                    | +hostname,+k_timestamp_b,+lastts
        └── render                 |                                          |
             │                     | engine type                              | time series
             │                     | hostname                                 | hostname
             │                     | first                                    | first
             │                     | min                                      | min
             │                     | min                                      | min
             │                     | last_row                                 | last_row
             │                     | lastts                                   | lastts
             │                     | k_timestamp_b                            | k_timestamp_b
             └── group             |                                          |
                  │                | engine type                              | time series
                  │                | aggregate 0                              | hostname
                  │                | aggregate 1                              | datacenter
                  │                | aggregate 2                              | rack
                  │                | aggregate 3                              | k_timestamp_b
                  │                | aggregate 4                              | first(usage_nice, k_timestamp)
                  │                | aggregate 5                              | min(usage_system)
                  │                | aggregate 6                              | min(usage_softirq)
                  │                | aggregate 7                              | last_row(usage_guest_nice, k_timestamp)
                  │                | aggregate 8                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | group by                                 | hostname, datacenter, rack, k_timestamp_b
                  │                | pushLocalAggToScan                       | true
                  │                | addSynchronizer                          | true
                  └── render       |                                          |
                       │           | engine type                              | time series
                       │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                       │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                       │           | k_timestamp                              | k_timestamp
                       │           | usage_user                               | usage_user
                       │           | usage_system                             | usage_system
                       │           | usage_nice                               | usage_nice
                       │           | usage_softirq                            | usage_softirq
                       │           | usage_guest_nice                         | usage_guest_nice
                       │           | hostname                                 | hostname
                       │           | datacenter                               | datacenter
                       │           | rack                                     | rack
                       └── ts scan |                                          |
                                   | ts-table                                 | cpu
                                   | access mode                              | tableTableMeta
                                   | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                   | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
                                   | tag filter[0]                            | region = 'aaaaaaaa'
(54 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b, avg(usage_steal), avg(usage_guest_nice), last_row(usage_guest), min(usage_idle), hostname, lastts(usage_user) as last_ts FROM test.cpu WHERE k_timestamp >= '2023-01-01 00:00:00' AND k_timestamp < '2024-01-01 00:00:00' GROUP BY hostname, region, datacenter, rack, k_timestamp_b ORDER BY hostname, k_timestamp_b, last_ts LIMIT 10;
                tree               |                  field                   |                                description
-----------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                   | distributed                              | true
                                   | vectorized                               | false
  render                           |                                          |
   │                               | engine type                              | time series
   │                               | k_timestamp_b                            | k_timestamp_b
   │                               | avg                                      | avg
   │                               | avg                                      | avg
   │                               | last_row                                 | last_row
   │                               | min                                      | min
   │                               | hostname                                 | hostname
   │                               | last_ts                                  | lastts
   └── limit                       |                                          |
        │                          | engine type                              | time series
        │                          | count                                    | 10
        └── sort                   |                                          |
             │                     | order                                    | +hostname,+k_timestamp_b,+lastts
             └── group             |                                          |
                  │                | engine type                              | time series
                  │                | aggregate 0                              | hostname
                  │                | aggregate 1                              | region
                  │                | aggregate 2                              | datacenter
                  │                | aggregate 3                              | rack
                  │                | aggregate 4                              | k_timestamp_b
                  │                | aggregate 5                              | avg(usage_steal)
                  │                | aggregate 6                              | avg(usage_guest_nice)
                  │                | aggregate 7                              | last_row(usage_guest, k_timestamp)
                  │                | aggregate 8                              | min(usage_idle)
                  │                | aggregate 9                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                  │                | pushLocalAggToScan                       | true
                  │                | addSynchronizer                          | true
                  │                | pruneLocalAgg                            | true
                  │                | pruneFinalAgg                            | true
                  └── render       |                                          |
                       │           | engine type                              | time series
                       │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                       │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                       │           | k_timestamp                              | k_timestamp
                       │           | usage_user                               | usage_user
                       │           | usage_idle                               | usage_idle
                       │           | usage_steal                              | usage_steal
                       │           | usage_guest                              | usage_guest
                       │           | usage_guest_nice                         | usage_guest_nice
                       │           | hostname                                 | hostname
                       │           | region                                   | region
                       │           | datacenter                               | datacenter
                       │           | rack                                     | rack
                       └── ts scan |                                          |
                                   | ts-table                                 | cpu
                                   | ordered type                             | order scan
                                   | access mode                              | tableTableMeta
                                   | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                   | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(53 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       sum(usage_nice),
       sum(usage_idle),
       min(usage_irq),
       sum(usage_system),
       last_row(usage_user),
       lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_1'
  AND region = 'aaa'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts
OFFSET 2;
                tree               |                  field                   |                                description
-----------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                   | distributed                              | true
                                   | vectorized                               | false
  render                           |                                          |
   │                               | k_timestamp_b                            | k_timestamp_b
   │                               | hostname                                 | any_not_null
   │                               | sum                                      | sum
   │                               | sum                                      | sum
   │                               | min                                      | min
   │                               | sum                                      | sum
   │                               | last_row                                 | last_row
   │                               | last_ts                                  | lastts
   └── limit                       |                                          |
        │                          | offset                                   | 2
        └── sort                   |                                          |
             │                     | order                                    | +k_timestamp_b,+lastts
             └── group             |                                          |
                  │                | engine type                              | time series
                  │                | aggregate 0                              | datacenter
                  │                | aggregate 1                              | rack
                  │                | aggregate 2                              | k_timestamp_b
                  │                | aggregate 3                              | sum(usage_nice)
                  │                | aggregate 4                              | sum(usage_idle)
                  │                | aggregate 5                              | min(usage_irq)
                  │                | aggregate 6                              | sum(usage_system)
                  │                | aggregate 7                              | last_row(usage_user, k_timestamp)
                  │                | aggregate 8                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | aggregate 9                              | any_not_null(hostname)
                  │                | group by                                 | datacenter, rack, k_timestamp_b
                  │                | pushLocalAggToScan                       | true
                  │                | addSynchronizer                          | true
                  └── render       |                                          |
                       │           | engine type                              | time series
                       │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                       │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                       │           | k_timestamp                              | k_timestamp
                       │           | usage_user                               | usage_user
                       │           | usage_system                             | usage_system
                       │           | usage_idle                               | usage_idle
                       │           | usage_nice                               | usage_nice
                       │           | usage_irq                                | usage_irq
                       │           | hostname                                 | hostname
                       │           | datacenter                               | datacenter
                       │           | rack                                     | rack
                       └── ts scan |                                          |
                                   | ts-table                                 | cpu
                                   | access mode                              | tableTableMeta
                                   | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                   | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
                                   | tag filter[0]                            | hostname = 'host_1'
                                   | tag filter[1]                            | region = 'aaa'
(50 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       min(usage_iowait),
       last_row(usage_irq),
       count(usage_nice),
       last_row(usage_idle),
       last_row(usage_system),
       lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaa'
  AND datacenter = 888888
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
                tree               |                  field                   |                                description
-----------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                   | distributed                              | true
                                   | vectorized                               | false
  render                           |                                          |
   │                               | k_timestamp_b                            | k_timestamp_b
   │                               | hostname                                 | any_not_null
   │                               | min                                      | min
   │                               | last_row                                 | last_row
   │                               | count                                    | count
   │                               | last_row                                 | last_row
   │                               | last_row                                 | last_row
   │                               | last_ts                                  | lastts
   └── sort                        |                                          |
        │                          | order                                    | +k_timestamp_b,+lastts
        └── render                 |                                          |
             │                     | engine type                              | time series
             │                     | any_not_null                             | any_not_null
             │                     | min                                      | min
             │                     | last_row                                 | last_row
             │                     | count                                    | count
             │                     | last_row                                 | last_row
             │                     | last_row                                 | last_row
             │                     | lastts                                   | lastts
             │                     | k_timestamp_b                            | k_timestamp_b
             └── group             |                                          |
                  │                | engine type                              | time series
                  │                | aggregate 0                              | rack
                  │                | aggregate 1                              | k_timestamp_b
                  │                | aggregate 2                              | min(usage_iowait)
                  │                | aggregate 3                              | last_row(usage_irq, k_timestamp)
                  │                | aggregate 4                              | count(usage_nice)
                  │                | aggregate 5                              | last_row(usage_idle, k_timestamp)
                  │                | aggregate 6                              | last_row(usage_system, k_timestamp)
                  │                | aggregate 7                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                | aggregate 8                              | any_not_null(hostname)
                  │                | group by                                 | rack, k_timestamp_b
                  │                | pushLocalAggToScan                       | true
                  │                | addSynchronizer                          | true
                  └── render       |                                          |
                       │           | engine type                              | time series
                       │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                       │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                       │           | k_timestamp                              | k_timestamp
                       │           | usage_user                               | usage_user
                       │           | usage_system                             | usage_system
                       │           | usage_idle                               | usage_idle
                       │           | usage_nice                               | usage_nice
                       │           | usage_iowait                             | usage_iowait
                       │           | usage_irq                                | usage_irq
                       │           | hostname                                 | hostname
                       │           | rack                                     | rack
                       └── ts scan |                                          |
                                   | ts-table                                 | cpu
                                   | access mode                              | tableTableMeta
                                   | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                   | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
                                   | tag filter[0]                            | hostname = 'host_0'
                                   | tag filter[1]                            | region = 'aaa'
                                   | tag filter[2]                            | datacenter = 888888
(58 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       first_row(usage_iowait),
       last_row(usage_steal),
       min(usage_user),
       last_row(usage_nice),
       lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaa'
  AND datacenter = 888888
  AND rack = 8888.88
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
                     tree                    |                  field                   |                                         description
---------------------------------------------+------------------------------------------+-----------------------------------------------------------------------------------------------
                                             | distributed                              | true
                                             | vectorized                               | false
  render                                     |                                          |
   │                                         | k_timestamp_b                            | k_timestamp_b
   │                                         | hostname                                 | any_not_null
   │                                         | first_row                                | first_row
   │                                         | last_row                                 | last_row
   │                                         | min                                      | min
   │                                         | last_row                                 | last_row
   │                                         | last_ts                                  | lastts
   └── sort                                  |                                          |
        │                                    | order                                    | +k_timestamp_b,+lastts
        └── render                           |                                          |
             │                               | any_not_null                             | any_not_null
             │                               | first_row                                | first_row
             │                               | last_row                                 | last_row
             │                               | min                                      | min
             │                               | last_row                                 | last_row
             │                               | lastts                                   | lastts
             │                               | k_timestamp_b                            | k_timestamp_b
             └── group                       |                                          |
                  │                          | aggregate 0                              | rack
                  │                          | aggregate 1                              | k_timestamp_b
                  │                          | aggregate 2                              | first_row(usage_iowait, k_timestamp)
                  │                          | aggregate 3                              | last_row(usage_steal, k_timestamp)
                  │                          | aggregate 4                              | min(usage_user)
                  │                          | aggregate 5                              | last_row(usage_nice, k_timestamp)
                  │                          | aggregate 6                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                  │                          | aggregate 7                              | any_not_null(hostname)
                  │                          | group by                                 | rack, k_timestamp_b
                  └── render                 |                                          |
                       │                     | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                       │                     | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                       │                     | k_timestamp                              | k_timestamp
                       │                     | usage_user                               | usage_user
                       │                     | usage_nice                               | usage_nice
                       │                     | usage_iowait                             | usage_iowait
                       │                     | usage_steal                              | usage_steal
                       │                     | hostname                                 | hostname
                       │                     | rack                                     | rack
                       └── filter            |                                          |
                            │                | filter                                   | rack = 8888.88
                            └── synchronizer |                                          |
                                 └── ts scan |                                          |
                                             | ts-table                                 | cpu
                                             | access mode                              | tableTableMeta
                                             | filter                                   | (k_timestamp >= '2023-01-01 00:00:00+00:00') AND (k_timestamp < '2024-01-01 00:00:00+00:00')
                                             | tag filter[0]                            | hostname = 'host_0'
                                             | tag filter[1]                            | region = 'aaa'
                                             | tag filter[2]                            | datacenter = 888888
(50 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       sum(usage_guest_nice),
       sum(usage_irq),
       lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                description
----------------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | sum                                      | sum
   │                                    | sum                                      | sum
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | sum                                      | sum
                  │                     | sum                                      | sum
                  │                     | lastts                                   | lastts
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | sum(usage_guest_nice)
                       │                | aggregate 6                              | sum(usage_irq)
                       │                | aggregate 7                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_irq                                | usage_irq
                            │           | usage_guest_nice                         | usage_guest_nice
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(50 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       min(usage_nice),
       firstts(usage_user),
       min(usage_guest), first (usage_idle), first (usage_softirq),
    lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                description
----------------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | min                                      | min
   │                                    | firstts                                  | firstts
   │                                    | min                                      | min
   │                                    | first                                    | first
   │                                    | first                                    | first
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | min                                      | min
                  │                     | firstts                                  | firstts
                  │                     | min                                      | min
                  │                     | first                                    | first
                  │                     | first                                    | first
                  │                     | lastts                                   | lastts
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | min(usage_nice)
                       │                | aggregate 6                              | firstts(usage_user, k_timestamp)
                       │                | aggregate 7                              | min(usage_guest)
                       │                | aggregate 8                              | first(usage_idle, k_timestamp)
                       │                | aggregate 9                              | first(usage_softirq, k_timestamp)
                       │                | aggregate 10                             | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_idle                               | usage_idle
                            │           | usage_nice                               | usage_nice
                            │           | usage_softirq                            | usage_softirq
                            │           | usage_guest                              | usage_guest
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(61 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       count(usage_iowait), last (usage_guest_nice), sum (usage_softirq), first_row(usage_user),
    lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts
    LIMIT 1
OFFSET 1;
                  tree                  |                  field                   |                                  description
----------------------------------------+------------------------------------------+--------------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | count                                    | count
   │                                    | last                                     | last
   │                                    | sum                                      | sum
   │                                    | first_row                                | first_row
   │                                    | last_ts                                  | lastts
   └── limit                            |                                          |
        │                               | offset                                   | 1
        └── limit                       |                                          |
             │                          | engine type                              | time series
             │                          | count                                    | 2
             └── sort                   |                                          |
                  │                     | order                                    | +hostname,+k_timestamp_b,+lastts
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | count(usage_iowait)
                       │                | aggregate 6                              | last(usage_guest_nice, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | aggregate 7                              | sum(usage_softirq)
                       │                | aggregate 8                              | first_row(usage_user, k_timestamp)
                       │                | aggregate 9                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | addSynchronizer                          | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_iowait                             | usage_iowait
                            │           | usage_softirq                            | usage_softirq
                            │           | usage_guest_nice                         | usage_guest_nice
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(53 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       firstts(usage_iowait), last (usage_user), min (usage_steal),
    lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                description
----------------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | firstts                                  | firstts
   │                                    | last                                     | last
   │                                    | min                                      | min
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | firstts                                  | firstts
                  │                     | last                                     | last
                  │                     | min                                      | min
                  │                     | lastts                                   | lastts
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | firstts(usage_iowait, k_timestamp)
                       │                | aggregate 6                              | last(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | aggregate 7                              | min(usage_steal)
                       │                | aggregate 8                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_iowait                             | usage_iowait
                            │           | usage_steal                              | usage_steal
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(53 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       first_row(usage_guest),
       firstts(usage_system),
       lastts(usage_system),
       lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                 description
----------------------------------------+------------------------------------------+------------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | first_row                                | first_row
   │                                    | firstts                                  | firstts
   │                                    | lastts                                   | lastts
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | first_row                                | first_row
                  │                     | firstts                                  | firstts
                  │                     | lastts                                   | lastts
                  │                     | lastts                                   | lastts
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | first_row(usage_guest, k_timestamp)
                       │                | aggregate 6                              | firstts(usage_system, k_timestamp)
                       │                | aggregate 7                              | lastts(usage_system, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | aggregate 8                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_system                             | usage_system
                            │           | usage_guest                              | usage_guest
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(53 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname, first (usage_steal), count (usage_system), firstts(usage_steal), lastts(usage_steal), first_row(usage_steal),
    lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                description
----------------------------------------+------------------------------------------+-----------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | first                                    | first
   │                                    | count                                    | count
   │                                    | firstts                                  | firstts
   │                                    | lastts                                   | lastts
   │                                    | first_row                                | first_row
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | first                                    | first
                  │                     | count                                    | count
                  │                     | firstts                                  | firstts
                  │                     | lastts                                   | lastts
                  │                     | first_row                                | first_row
                  │                     | lastts                                   | lastts
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | first(usage_steal, k_timestamp)
                       │                | aggregate 6                              | count(usage_system)
                       │                | aggregate 7                              | firstts(usage_steal, k_timestamp)
                       │                | aggregate 8                              | lastts(usage_steal, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | aggregate 9                              | first_row(usage_steal, k_timestamp)
                       │                | aggregate 10                             | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_system                             | usage_system
                            │           | usage_steal                              | usage_steal
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(59 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname, first (usage_guest_nice), last (usage_guest), first (usage_iowait), firstts(usage_guest),
    lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                description
----------------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | first                                    | first
   │                                    | last                                     | last
   │                                    | first                                    | first
   │                                    | firstts                                  | firstts
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | first                                    | first
                  │                     | last                                     | last
                  │                     | first                                    | first
                  │                     | firstts                                  | firstts
                  │                     | lastts                                   | lastts
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | first(usage_guest_nice, k_timestamp)
                       │                | aggregate 6                              | last(usage_guest, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | aggregate 7                              | first(usage_iowait, k_timestamp)
                       │                | aggregate 8                              | firstts(usage_guest, k_timestamp)
                       │                | aggregate 9                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_iowait                             | usage_iowait
                            │           | usage_guest                              | usage_guest
                            │           | usage_guest_nice                         | usage_guest_nice
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(57 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       lastts(usage_user),
       firstts(usage_guest_nice), last (usage_softirq), last_row(usage_softirq),
    lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                description
----------------------------------------+------------------------------------------+-----------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | lastts                                   | lastts
   │                                    | firstts                                  | firstts
   │                                    | last                                     | last
   │                                    | last_row                                 | last_row
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | lastts                                   | lastts
                  │                     | firstts                                  | firstts
                  │                     | last                                     | last
                  │                     | last_row                                 | last_row
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | aggregate 6                              | firstts(usage_guest_nice, k_timestamp)
                       │                | aggregate 7                              | last(usage_softirq, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | aggregate 8                              | last_row(usage_softirq, k_timestamp)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_softirq                            | usage_softirq
                            │           | usage_guest_nice                         | usage_guest_nice
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(54 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       firstts(usage_idle),
       first_row(usage_guest_nice),
       avg(usage_user),
       count(usage_softirq),
       count(usage_steal),
       lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                description
----------------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | firstts                                  | firstts
   │                                    | first_row                                | first_row
   │                                    | avg                                      | avg
   │                                    | count                                    | count
   │                                    | count                                    | count
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | firstts                                  | firstts
                  │                     | first_row                                | first_row
                  │                     | avg                                      | avg
                  │                     | count                                    | count
                  │                     | count                                    | count
                  │                     | lastts                                   | lastts
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | firstts(usage_idle, k_timestamp)
                       │                | aggregate 6                              | first_row(usage_guest_nice, k_timestamp)
                       │                | aggregate 7                              | avg(usage_user)
                       │                | aggregate 8                              | count(usage_softirq)
                       │                | aggregate 9                              | count(usage_steal)
                       │                | aggregate 10                             | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_idle                               | usage_idle
                            │           | usage_softirq                            | usage_softirq
                            │           | usage_steal                              | usage_steal
                            │           | usage_guest_nice                         | usage_guest_nice
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(61 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       max(usage_nice), first (usage_system), avg (usage_idle), last (usage_irq), first (usage_irq),
    lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                description
----------------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | max                                      | max
   │                                    | first                                    | first
   │                                    | avg                                      | avg
   │                                    | last                                     | last
   │                                    | first                                    | first
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | max                                      | max
                  │                     | first                                    | first
                  │                     | avg                                      | avg
                  │                     | last                                     | last
                  │                     | first                                    | first
                  │                     | lastts                                   | lastts
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | max(usage_nice)
                       │                | aggregate 6                              | first(usage_system, k_timestamp)
                       │                | aggregate 7                              | avg(usage_idle)
                       │                | aggregate 8                              | last(usage_irq, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | aggregate 9                              | first(usage_irq, k_timestamp)
                       │                | aggregate 10                             | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_system                             | usage_system
                            │           | usage_idle                               | usage_idle
                            │           | usage_nice                               | usage_nice
                            │           | usage_irq                                | usage_irq
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(61 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       max(usage_guest_nice),
       lastts(usage_idle),
       max(usage_guest),
       avg(usage_nice), first (usage_guest),
    lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, datacenter, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                description
----------------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | max                                      | max
   │                                    | lastts                                   | lastts
   │                                    | max                                      | max
   │                                    | avg                                      | avg
   │                                    | first                                    | first
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | max                                      | max
                  │                     | lastts                                   | lastts
                  │                     | max                                      | max
                  │                     | avg                                      | avg
                  │                     | first                                    | first
                  │                     | lastts                                   | lastts
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | max(usage_guest_nice)
                       │                | aggregate 6                              | lastts(usage_idle, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | aggregate 7                              | max(usage_guest)
                       │                | aggregate 8                              | avg(usage_nice)
                       │                | aggregate 9                              | first(usage_guest, k_timestamp)
                       │                | aggregate 10                             | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_idle                               | usage_idle
                            │           | usage_nice                               | usage_nice
                            │           | usage_guest                              | usage_guest
                            │           | usage_guest_nice                         | usage_guest_nice
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(61 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       min(usage_guest_nice),
       max(usage_softirq),lastts(usage_user) as last_ts FROM test.cpu WHERE k_timestamp >= '2023-01-01 00:00:00' AND k_timestamp < '2024-01-01 00:00:00' GROUP BY hostname, region, datacenter, rack, k_timestamp_b ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                description
----------------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | min                                      | min
   │                                    | max                                      | max
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | min                                      | min
                  │                     | max                                      | max
                  │                     | lastts                                   | lastts
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | min(usage_guest_nice)
                       │                | aggregate 6                              | max(usage_softirq)
                       │                | aggregate 7                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_softirq                            | usage_softirq
                            │           | usage_guest_nice                         | usage_guest_nice
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(50 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b, hostname, last (usage_steal), count (usage_user), avg (usage_iowait), count (usage_guest), lastts(usage_user) as last_ts FROM test.cpu WHERE k_timestamp >= '2023-01-01 00:00:00' AND k_timestamp < '2024-01-01 00:00:00' GROUP BY hostname, region, datacenter, rack, k_timestamp_b ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                description
----------------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | last                                     | last
   │                                    | count                                    | count
   │                                    | avg                                      | avg
   │                                    | count                                    | count
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | last                                     | last
                  │                     | count                                    | count
                  │                     | avg                                      | avg
                  │                     | count                                    | count
                  │                     | lastts                                   | lastts
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | last(usage_steal, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | aggregate 6                              | count(usage_user)
                       │                | aggregate 7                              | avg(usage_iowait)
                       │                | aggregate 8                              | count(usage_guest)
                       │                | aggregate 9                              | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_iowait                             | usage_iowait
                            │           | usage_steal                              | usage_steal
                            │           | usage_guest                              | usage_guest
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(57 rows)
> explain SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b, hostname, count(usage_guest_nice), firstts(usage_softirq), last (usage_nice), sum (usage_user), max (usage_iowait), lastts(usage_user) as last_ts FROM test.cpu WHERE k_timestamp >= '2023-01-01 00:00:00' AND k_timestamp < '2024-01-01 00:00:00' GROUP BY hostname, region, datacenter, rack, k_timestamp_b ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                description
----------------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | count                                    | count
   │                                    | firstts                                  | firstts
   │                                    | last                                     | last
   │                                    | sum                                      | sum
   │                                    | max                                      | max
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | count                                    | count
                  │                     | firstts                                  | firstts
                  │                     | last                                     | last
                  │                     | sum                                      | sum
                  │                     | max                                      | max
                  │                     | lastts                                   | lastts
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | count(usage_guest_nice)
                       │                | aggregate 6                              | firstts(usage_softirq, k_timestamp)
                       │                | aggregate 7                              | last(usage_nice, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | aggregate 8                              | sum(usage_user)
                       │                | aggregate 9                              | max(usage_iowait)
                       │                | aggregate 10                             | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_nice                               | usage_nice
                            │           | usage_iowait                             | usage_iowait
                            │           | usage_softirq                            | usage_softirq
                            │           | usage_guest_nice                         | usage_guest_nice
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(61 rows)
> explain SELECT count(usage_irq),time_bucket(k_timestamp, '2s') as k_timestamp_b,hostname,avg(usage_softirq),first_row(usage_softirq),first_row(usage_nice), last (usage_iowait), lastts(usage_user) as last_ts FROM test.cpu WHERE k_timestamp >= '2023-01-01 00:00:00' AND k_timestamp < '2024-01-01 00:00:00' GROUP BY hostname, region, datacenter, rack, k_timestamp_b ORDER BY hostname, k_timestamp_b, last_ts;
                  tree                  |                  field                   |                                description
----------------------------------------+------------------------------------------+----------------------------------------------------------------------------
                                        | distributed                              | true
                                        | vectorized                               | false
  render                                |                                          |
   │                                    | count                                    | count
   │                                    | k_timestamp_b                            | k_timestamp_b
   │                                    | hostname                                 | hostname
   │                                    | avg                                      | avg
   │                                    | first_row                                | first_row
   │                                    | first_row                                | first_row
   │                                    | last                                     | last
   │                                    | last_ts                                  | lastts
   └── sort                             |                                          |
        │                               | order                                    | +hostname,+k_timestamp_b,+lastts
        └── synchronizer                |                                          |
             └── render                 |                                          |
                  │                     | engine type                              | time series
                  │                     | hostname                                 | hostname
                  │                     | count                                    | count
                  │                     | avg                                      | avg
                  │                     | first_row                                | first_row
                  │                     | first_row                                | first_row
                  │                     | last                                     | last
                  │                     | lastts                                   | lastts
                  │                     | k_timestamp_b                            | k_timestamp_b
                  └── group             |                                          |
                       │                | engine type                              | time series
                       │                | aggregate 0                              | hostname
                       │                | aggregate 1                              | region
                       │                | aggregate 2                              | datacenter
                       │                | aggregate 3                              | rack
                       │                | aggregate 4                              | k_timestamp_b
                       │                | aggregate 5                              | count(usage_irq)
                       │                | aggregate 6                              | avg(usage_softirq)
                       │                | aggregate 7                              | first_row(usage_softirq, k_timestamp)
                       │                | aggregate 8                              | first_row(usage_nice, k_timestamp)
                       │                | aggregate 9                              | last(usage_iowait, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | aggregate 10                             | lastts(usage_user, k_timestamp, '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ)
                       │                | group by                                 | hostname, region, datacenter, rack, k_timestamp_b
                       │                | pushLocalAggToScan                       | true
                       │                | pruneLocalAgg                            | true
                       │                | pruneFinalAgg                            | true
                       └── render       |                                          |
                            │           | engine type                              | time series
                            │           | '2970-01-01 00:00:00+00:00'::TIMESTAMPTZ | '2970-01-01 00:00:00+00:00'
                            │           | k_timestamp_b                            | time_bucket(k_timestamp, '2s')
                            │           | k_timestamp                              | k_timestamp
                            │           | usage_user                               | usage_user
                            │           | usage_nice                               | usage_nice
                            │           | usage_iowait                             | usage_iowait
                            │           | usage_irq                                | usage_irq
                            │           | usage_softirq                            | usage_softirq
                            │           | hostname                                 | hostname
                            │           | region                                   | region
                            │           | datacenter                               | datacenter
                            │           | rack                                     | rack
                            └── ts scan |                                          |
                                        | ts-table                                 | cpu
                                        | ordered type                             | order scan
                                        | access mode                              | tableTableMeta
                                        | spans:fromTime                           | 2023-01-01 00:00:00 +0000 UTC
                                        | spans:toTime                             | 2023-12-31 23:59:59.999 +0000 UTC
(61 rows)
> drop database test cascade;
DROP DATABASE
> create ts database test;
CREATE TS DATABASE
> create table test.cpu
(
    k_timestamp      timestamp not null,
    usage_user       bigint,
    usage_system     bigint,
    usage_idle       int,
    usage_nice       int,
    usage_iowait     smallint,
    usage_irq        smallint,
    usage_softirq    float,
    usage_steal      float,
    usage_guest      real,
    usage_guest_nice real
) attributes (
    hostname char(30) not null,
    region varchar(8),
    datacenter int,
    rack int not null,
    os char(30),
    arch char(30),
    team char(30),
    service char(30),
    service_version char(30),
    service_environment char(30)
    )
primary attributes (hostname);
CREATE TABLE
> INSERT INTO test.cpu
values ('2023-05-31 10:00:00', -2147483648, -2147483648, -2147483648, -2147483648, -32768, -32768, 54.122111, 54.122111, 3.141593, 3.141593, 'host_0', null, 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', -2147483648, -2147483648, -2147483648, -2147483648, -32768, -32768, 54.122111, 54.122111, 3.141593, 3.141593, 'host_0', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 84, 2147483647, -2147483648, 2147483647, 29, 20, -54.122111, -54.122111, 53, 74, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 29, 48, 5, 63, -17, 52, 60, null, 93, 1, 'host_2', 'a', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 8, 21, -89, 78, 30, 81, 33, 24, 24, 82, 'host_3', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 2, 26, 64, 6, 38, 20, -71, 19, 40, 54, 'host_4', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', -76, -40, -63, -7, -81, -20, -29, -55, null, -15, 'host_5', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 44, 70, 20, -67, 65, 11, 7, 92, 0, 31, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 92, 35, 99, 9, 31, -1, 2, 24, 96, 69, 'host_7', 'aaa', -888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 90, 0, 81, 28, 25, -44, 8, -89, 11, 76, 'host_9', 'aaa', 888888, 6666, '', '', '', '', '', '');
INSERT 11
> INSERT INTO test.cpu
values ('2023-05-31 10:00:01', 2147483647, -2147483648, 2147483647, -2147483648, 32767, -32768, -100.1, 54.122111, -3.141593, null, 'host_0', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', null, 2147483647, 2147483647, 2147483647, 32767, 32767, 54.122111, -54.1221111, 3.141593, -3.141593, 'host_1', null, 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 29, 48, 5, 63, 17, 52, 60, 49, 93, 1, 'host_3', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 8, 21, 89, 78, 30, 81, 33, 24, 24, 82, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 2, 26, 64, 6, 38, 20, 71, null, 40, 54, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 76, 40, 63, 7, 81, 20, 29, -55, 20, 15, 'host_6', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_7', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 92, 35,-99, 9, 31, 1, 2, 24, 96, 69, 'host_8', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 21, 77, 90, 83, 41, 84, 26, 60, null, 36, 'host_9', 'aaa', -888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 90, 0, -81, 28, 25, 44, 8, 89, 11, 76, 'host_2', 'a', -888888, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:02', 58, -2, 24, 61, 22, 63, 6, 44, null, 38, 'host_2', 'aaa', 2147483647, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_3', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 29, 48, -5, 63, -17, 52, 60, 49, 93, 1, 'host_4', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 8, 21, 89, -78, 30, 81, 33, 24, 24, 82, 'host_5', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 2, 26, -64, 6, -38, 20, 71, null, 40, 54, 'host_6', 'aaa', 2147483647, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_7', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_8', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 92, 35, 99, -9, 31, 1, -2, 24, 96, 69, 'host_9', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 21, 77, -90, 83, 41, 84, 26, 60, 43, null, 'host_0', 'aaaaaaaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 90, 0, 81, 28, 25, 44, 8, -89, 11, 76, 'host_1', 'aaa', 2147483647, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:04', null, 2, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 29, 48, 5, -63, 17, -52, 60, 49, 93, 1, 'host_5', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 8, 21, 89, 78, 30, -81, 33, 24, 24, 82, 'host_6', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 2, 26, -64, 6, 38, -20, 71, null, 40, 54, 'host_7', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_8', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_9', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 92, 35, 99, 9, 31, -1, 2, 24, 96, 69, 'host_0', 'aaaaaaaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_1', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 90, 0, 81, 28, 25, 44, 8, -89, 11, 76, 'host_2', 'aaa', -2147483648, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:03', 58, null, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 29, 48, 5, 63, 17, 52, 60, 49, 93, 1, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 8, 21, 89, 78, 30, 81, 33, 24, 24, 82, 'host_6', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 2, 26, 64, 6, 38, -20, 71, null, 40, 54, 'host_7', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 44, 70, 20, 67, 65, 11, -7, 92, 0, 31, 'host_9', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 92, 35, 99, 9, 31, 1, 2, 24, 96, 69, 'host_0', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 90, 0, 81, 28, 25, 44, 8, 89, 11, 76, 'host_2', 'aaa', 888888, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_3', 'aaaaaaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_7', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_8', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_9', '', null, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_0', '', 0, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', null, null, null, null, null, null, null, null, null, null, 'host_2', 'aaa', 888888, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_3', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_5', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_7', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_8', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_9', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_0', 'aaa', -888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', null, null, null, null, null, null, null, null, null, null, 'host_2', 'aaa', 888888, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:10', 58, null, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 29, 48, 5, -63, 17, 52, 60, 49, 93, 1, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 8, 21, 89, -78, 30, 81, 33, 24, 24, 82, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 2, 26, 64, 6, 38, -20, 71, null, -40, 54, 'host_7', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 76, 40, -63, 7, 81, -20, 29, 55, 20, 15, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 44, 70, 20, 67, 65, 11, 7, -92, 0, 31, 'host_9', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 92, 35, 99, 9, -31, 1, 2, 24, 96, 69, 'host_0', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 21, 77, 90, 83, 41, -84, 26, 60, 43, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 90, 0, 81, 28, 25, -44, 8, 89, 11, 76, 'host_2', 'aaa', -888888, 6666, '', '', '', '', '', '');
INSERT 10
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       lastts(usage_guest),
       sum(usage_steal),
       firstts(usage_nice),
       max(usage_user),
       max(usage_irq),
       lastts(usage_user) as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          lastts           |    sum     |          firstts          |    max     |  max   |          last_ts
----------------------------+----------+---------------------------+------------+---------------------------+------------+--------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:01+00:00 | 108.244222 | 2023-05-31 10:00:00+00:00 | 2147483647 | -32768 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:03+00:00 |         84 | 2023-05-31 10:00:02+00:00 |         92 |     84 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   | 2023-05-31 10:00:04+00:00 |         24 | 2023-05-31 10:00:04+00:00 |         92 |     -1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | NULL       | NULL                      |       NULL | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_0   | 2023-05-31 10:00:10+00:00 |         24 | 2023-05-31 10:00:10+00:00 |         92 |      1 | 2023-05-31 10:00:10+00:00
(5 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       first_row(usage_idle),
       lastts(usage_nice),
       lastts(usage_irq),
       lastts(usage_guest_nice),
       max(usage_idle),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_1'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |  first_row  |          lastts           |          lastts           |          lastts           |    max     |          last_ts
----------------------------+----------+-------------+---------------------------+---------------------------+---------------------------+------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_1   | -2147483648 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2147483647 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          81 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |         90 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |          90 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | NULL                      |         90 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL        | NULL                      | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_1   |          90 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | NULL                      |         90 | 2023-05-31 10:00:10+00:00
(5 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       sum(usage_guest),
       count(usage_idle),
       avg(usage_system),
       max(usage_steal),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaa'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
  k_timestamp_b | hostname | sum | count | avg | max | last_ts
----------------+----------+-----+-------+-----+-----+----------
(0 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       last_row(usage_iowait),
       avg(usage_irq),
       max(usage_system),
       firstts(usage_irq),
       lastts(usage_softirq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaaaaaaa'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
  k_timestamp_b | hostname | last_row | avg | max | firstts | lastts | last_ts
----------------+----------+----------+-----+-----+---------+--------+----------
(0 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       first_row(usage_irq),
       lastts(usage_iowait),
       sum(usage_iowait),
       hostname,
       first_row(usage_system),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND region = 'aaa'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | first_row |          lastts           |  sum  | hostname | first_row  |          last_ts
----------------------------+-----------+---------------------------+-------+----------+------------+----------------------------
  2023-05-31 10:00:00+00:00 |        20 | 2023-05-31 10:00:01+00:00 | 32796 | host_1   | 2147483647 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 |        44 | 2023-05-31 10:00:03+00:00 |    66 | host_1   |          0 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        84 | 2023-05-31 10:00:04+00:00 |    41 | host_1   |         77 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_1   |       NULL | NULL
  2023-05-31 10:00:10+00:00 |       -84 | 2023-05-31 10:00:10+00:00 |    41 | host_1   |         77 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        81 | 2023-05-31 10:00:01+00:00 |    47 | host_3   |         21 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        20 | 2023-05-31 10:00:03+00:00 |    51 | host_3   |         11 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        63 | 2023-05-31 10:00:04+00:00 |    22 | host_3   |          2 | NULL
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_3   |       NULL | NULL
  2023-05-31 10:00:10+00:00 |        63 | 2023-05-31 10:00:10+00:00 |    22 | host_3   |       NULL | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        20 | 2023-05-31 10:00:01+00:00 |    68 | host_4   |         26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        52 | 2023-05-31 10:00:03+00:00 |    12 | host_4   |         48 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        20 | 2023-05-31 10:00:04+00:00 |    29 | host_4   |         11 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_4   |       NULL | NULL
  2023-05-31 10:00:10+00:00 |        20 | 2023-05-31 10:00:10+00:00 |    29 | host_4   |         11 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |       -20 | 2023-05-31 10:00:01+00:00 |   -43 | host_5   |        -40 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        81 | 2023-05-31 10:00:03+00:00 |    47 | host_5   |         21 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |       -52 | 2023-05-31 10:00:04+00:00 |    17 | host_5   |         48 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_5   |       NULL | NULL
  2023-05-31 10:00:10+00:00 |        52 | 2023-05-31 10:00:10+00:00 |    17 | host_5   |         48 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        11 | 2023-05-31 10:00:01+00:00 |   146 | host_6   |         70 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        20 | 2023-05-31 10:00:03+00:00 |    -8 | host_6   |         26 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |       -81 | 2023-05-31 10:00:04+00:00 |    30 | host_6   |         21 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_6   |       NULL | NULL
  2023-05-31 10:00:10+00:00 |        81 | 2023-05-31 10:00:10+00:00 |    30 | host_6   |         21 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        -1 | 2023-05-31 10:00:01+00:00 |    96 | host_7   |         35 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        20 | 2023-05-31 10:00:03+00:00 |   119 | host_7   |         40 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |       -20 | 2023-05-31 10:00:04+00:00 |    38 | host_7   |         26 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_7   |       NULL | NULL
  2023-05-31 10:00:10+00:00 |       -20 | 2023-05-31 10:00:10+00:00 |    38 | host_7   |         26 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        84 | 2023-05-31 10:00:01+00:00 |    72 | host_8   |         77 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        11 | 2023-05-31 10:00:03+00:00 |   146 | host_8   |         70 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        20 | 2023-05-31 10:00:04+00:00 |    81 | host_8   |         40 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_8   |       NULL | NULL
  2023-05-31 10:00:10+00:00 |       -20 | 2023-05-31 10:00:10+00:00 |    81 | host_8   |         40 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |       -44 | 2023-05-31 10:00:01+00:00 |    66 | host_9   |          0 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |         1 | 2023-05-31 10:00:03+00:00 |    96 | host_9   |         35 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        11 | 2023-05-31 10:00:04+00:00 |    65 | host_9   |         70 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_9   |       NULL | NULL
  2023-05-31 10:00:10+00:00 |        11 | 2023-05-31 10:00:10+00:00 |    65 | host_9   |         70 | 2023-05-31 10:00:10+00:00
(40 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
    first (usage_nice), min (usage_system), min (usage_softirq), last_row(usage_guest_nice), hostname,
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
  AND region = 'aaaaaaaa'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
  k_timestamp_b | first | min | min | last_row | hostname | last_ts
----------------+-------+-----+-----+----------+----------+----------
(0 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       avg(usage_steal),
       avg(usage_guest_nice),
       last_row(usage_guest),
       min(usage_idle),
       hostname,
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts LIMIT 10;
        k_timestamp_b       |     avg      |        avg         | last_row  |     min     | hostname |          last_ts
----------------------------+--------------+--------------------+-----------+-------------+----------+----------------------------
  2023-05-31 10:00:00+00:00 |    54.122111 | 3.1415929794311523 | -3.141593 | -2147483648 | host_0   | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |           42 |                 69 |        96 |         -90 | host_0   | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |           24 |                 69 |        96 |          99 | host_0   | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL         | NULL               | NULL      | NULL        | host_0   | NULL
  2023-05-31 10:00:10+00:00 |           24 |                 69 |        96 |          99 | host_0   | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | -54.12211105 | 35.429203510284424 |  3.141593 | -2147483648 | host_1   | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 |        -14.5 |                 76 |        43 |          81 | host_1   | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |           60 | NULL               |        43 |          90 | host_1   | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL         | NULL               | NULL      | NULL        | host_1   | NULL
  2023-05-31 10:00:10+00:00 |           60 | NULL               |        43 |          90 | host_1   | 2023-05-31 10:00:10+00:00
(10 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       sum(usage_nice),
       sum(usage_idle),
       min(usage_irq),
       sum(usage_system),
       last_row(usage_user),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_1'
  AND region = 'aaa'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts
OFFSET 2;
        k_timestamp_b       | hostname | sum  | sum  | min  | sum  | last_row |          last_ts
----------------------------+----------+------+------+------+------+----------+----------------------------
  2023-05-31 10:00:04+00:00 | host_1   |   83 |   90 |   84 |   77 |       21 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL | NULL | NULL | NULL |     NULL | NULL
  2023-05-31 10:00:10+00:00 | host_1   |   83 |   90 |  -84 |   77 |       21 | 2023-05-31 10:00:10+00:00
(3 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       min(usage_iowait),
       last_row(usage_irq),
       count(usage_nice),
       last_row(usage_idle),
       last_row(usage_system),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaa'
  AND datacenter = 888888
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
  k_timestamp_b | hostname | min | last_row | count | last_row | last_row | last_ts
----------------+----------+-----+----------+-------+----------+----------+----------
(0 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       first_row(usage_iowait),
       last_row(usage_steal),
       min(usage_user),
       last_row(usage_nice),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaa'
  AND datacenter = 888888
  AND rack = 8888.88
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
  k_timestamp_b | hostname | first_row | last_row | min | last_row | last_ts
----------------+----------+-----------+----------+-----+----------+----------
(0 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       sum(usage_guest_nice),
       sum(usage_irq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |        sum         |  sum   |          last_ts
----------------------------+----------+--------------------+--------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 3.1415929794311523 | -65536 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |                 69 |     85 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |                 69 |     -1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_0   |                 69 |      1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |  70.85840702056885 |  32787 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |                 76 |    128 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | NULL               |     84 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_1   | NULL               |    -84 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |                 77 |     96 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |                114 |    107 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |                 76 |     44 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_2   |                 76 |    -44 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |                 83 |    133 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |                112 |     83 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |                 38 |     63 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_3   |                 38 |     63 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |                136 |    101 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |                 75 |     72 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |                 74 |     20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_4   |                 74 |     20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |                 39 |      0 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |                 83 |    133 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |                  1 |    -52 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_5   |                  1 |     52 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |                 46 |     31 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |                136 |    101 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |                 82 |    -81 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_6   |                 82 |     81 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |                100 |     10 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |                 69 |      0 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |                 54 |    -20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_7   |                 54 |    -20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |                 69 |     85 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |                 46 |     31 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |                 15 |     20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_8   |                 15 |    -20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |                112 |     40 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |                100 |     12 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |                 31 |     11 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL               | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_9   |                 31 |     11 | 2023-05-31 10:00:10+00:00
(50 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       min(usage_nice),
       firstts(usage_user),
       min(usage_guest), first (usage_idle), first (usage_softirq),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |     min     |          firstts          |    min    |    first    |   first    |          last_ts
----------------------------+----------+-------------+---------------------------+-----------+-------------+------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 | 2023-05-31 10:00:00+00:00 | -3.141593 | -2147483648 |  54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |           9 | 2023-05-31 10:00:02+00:00 |        43 |         -90 |         26 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |           9 | 2023-05-31 10:00:04+00:00 |        96 |          99 |          2 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_0   |           9 | 2023-05-31 10:00:10+00:00 |        96 |          99 |          2 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |  2147483647 | 2023-05-31 10:00:00+00:00 |  3.141593 | -2147483648 | -54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          28 | 2023-05-31 10:00:02+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |          83 | 2023-05-31 10:00:04+00:00 |        43 |          90 |         26 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_1   |          83 | 2023-05-31 10:00:10+00:00 |        43 |          90 |         26 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |          28 | 2023-05-31 10:00:00+00:00 |        11 |           5 |         60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |          28 | 2023-05-31 10:00:02+00:00 |        11 |          24 |          6 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |          28 | 2023-05-31 10:00:04+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_2   |          28 | 2023-05-31 10:00:10+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |          63 | 2023-05-31 10:00:00+00:00 |        24 |         -89 |         33 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          61 | 2023-05-31 10:00:02+00:00 |        53 |          53 |         54 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |          61 | NULL                      | NULL      |          24 |          6 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_3   |          61 | 2023-05-31 10:00:10+00:00 | NULL      |          24 |          6 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |           6 | 2023-05-31 10:00:00+00:00 |        24 |          64 |        -71 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |          63 | 2023-05-31 10:00:02+00:00 |        53 |          -5 |         60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |          87 | 2023-05-31 10:00:04+00:00 |        53 |          53 |         54 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_4   |          87 | 2023-05-31 10:00:10+00:00 |        53 |          53 |         54 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |          -7 | 2023-05-31 10:00:00+00:00 |        40 |         -63 |        -29 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |         -78 | 2023-05-31 10:00:02+00:00 |        24 |          89 |         33 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |         -63 | 2023-05-31 10:00:04+00:00 |        93 |           5 |         60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_5   |         -63 | 2023-05-31 10:00:10+00:00 |        93 |           5 |         60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |         -67 | 2023-05-31 10:00:00+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |           6 | 2023-05-31 10:00:02+00:00 |        24 |         -64 |         71 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |          78 | 2023-05-31 10:00:04+00:00 |        24 |          89 |         33 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_6   |         -78 | 2023-05-31 10:00:10+00:00 |        24 |          89 |         33 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |           9 | 2023-05-31 10:00:00+00:00 |         0 |          99 |          2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |           6 | 2023-05-31 10:00:02+00:00 |        20 |          63 |         29 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |           6 | 2023-05-31 10:00:04+00:00 |        40 |         -64 |         71 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_7   |           6 | 2023-05-31 10:00:10+00:00 |       -40 |          64 |         71 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |           9 | 2023-05-31 10:00:00+00:00 |        43 |          90 |         26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |           7 | 2023-05-31 10:00:02+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |           7 | 2023-05-31 10:00:04+00:00 |        20 |          63 |         29 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_8   |           7 | 2023-05-31 10:00:10+00:00 |        20 |         -63 |         29 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |          28 | 2023-05-31 10:00:00+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |          -9 | 2023-05-31 10:00:02+00:00 |         0 |          99 |         -2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |          67 | 2023-05-31 10:00:04+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL        | NULL                      | NULL      | NULL        | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_9   |          67 | 2023-05-31 10:00:10+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:10+00:00
(50 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
    last (usage_system), avg (usage_guest), last (usage_idle), first (usage_user),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |    last     |        avg         |    last    |    first    |          last_ts
----------------------------+----------+-------------+--------------------+------------+-------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 |                  0 | 2147483647 | -2147483648 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |          35 |               69.5 |         99 |          21 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |          35 |                 96 |         99 |          92 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   |        NULL | NULL               | NULL       |        NULL | NULL
  2023-05-31 10:00:10+00:00 | host_0   |          35 |                 96 |         99 |          92 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |  2147483647 | 28.070796489715576 | 2147483647 |          84 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          77 |                 27 |         90 |          90 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |          77 |                 43 |         90 |          21 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   |        NULL | NULL               | NULL       |        NULL | NULL
  2023-05-31 10:00:10+00:00 | host_1   |          77 |                 43 |         90 |          21 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |           0 |                 52 |        -81 |          29 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |           0 |                 11 |         81 |          58 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |           0 |                 11 |         81 |          90 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   |        NULL | NULL               | NULL       |        NULL | NULL
  2023-05-31 10:00:10+00:00 | host_2   |           0 |                 11 |         81 |          90 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |          48 |               58.5 |          5 |           8 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          11 |                 53 |         24 |          84 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |           2 | NULL               |         24 |        NULL | NULL
  2023-05-31 10:00:08+00:00 | host_3   |        NULL | NULL               | NULL       |        NULL | NULL
  2023-05-31 10:00:10+00:00 | host_3   |        NULL | NULL               |         24 |          58 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |          21 |                 32 |         89 |           2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |          11 |                 73 |         53 |          29 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |          11 |                 53 |         53 |          84 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   |        NULL | NULL               | NULL       |        NULL | NULL
  2023-05-31 10:00:10+00:00 | host_4   |          11 |                 53 |         53 |          84 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |          26 |                 40 |         64 |         -76 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |          48 |               58.5 |          5 |           8 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |          48 |                 93 |          5 |          29 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   |        NULL | NULL               | NULL       |        NULL | NULL
  2023-05-31 10:00:10+00:00 | host_5   |          48 |                 93 |          5 |          29 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |          40 |                 10 |         63 |          44 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |          21 |                 32 |         89 |           2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |          21 |                 24 |         89 |           8 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   |        NULL | NULL               | NULL       |        NULL | NULL
  2023-05-31 10:00:10+00:00 | host_6   |          21 |                 24 |         89 |           8 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |          70 |                 48 |         20 |          92 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |          26 |                 30 |         64 |          76 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |          26 |                 40 |        -64 |           2 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   |        NULL | NULL               | NULL       |        NULL | NULL
  2023-05-31 10:00:10+00:00 | host_7   |          26 |                -40 |         64 |           2 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |          35 |               69.5 |        -99 |          21 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |          40 |                 10 |         63 |          44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |          40 |                 20 |         63 |          76 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   |        NULL | NULL               | NULL       |        NULL | NULL
  2023-05-31 10:00:10+00:00 | host_8   |          40 |                 20 |        -63 |          76 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |          77 |                 11 |         90 |          90 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |          70 |                 48 |         20 |          92 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |          70 |                  0 |         20 |          44 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   |        NULL | NULL               | NULL       |        NULL | NULL
  2023-05-31 10:00:10+00:00 | host_9   |          70 |                  0 |         20 |          44 | 2023-05-31 10:00:10+00:00
(50 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       count(usage_iowait), last (usage_guest_nice), sum (usage_softirq), first_row(usage_user),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts
    LIMIT 1
OFFSET 1;
        k_timestamp_b       | hostname | count | last | sum | first_row |          last_ts
----------------------------+----------+-------+------+-----+-----------+----------------------------
  2023-05-31 10:00:02+00:00 | host_0   |     2 |   69 |  28 |        21 | 2023-05-31 10:00:03+00:00
(1 row)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       firstts(usage_iowait), last (usage_user), min (usage_steal),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          firstts          |    last    |     min     |          last_ts
----------------------------+----------+---------------------------+------------+-------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 | 2147483647 |   54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:02+00:00 |         92 |          24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   | 2023-05-31 10:00:04+00:00 |         92 |          24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      |       NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_0   | 2023-05-31 10:00:10+00:00 |         92 |          24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | 2023-05-31 10:00:00+00:00 |         84 | -54.1221111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   | 2023-05-31 10:00:02+00:00 |         21 |         -89 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | 2023-05-31 10:00:04+00:00 |         21 |          60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL                      |       NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_1   | 2023-05-31 10:00:10+00:00 |         21 |          60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   | 2023-05-31 10:00:00+00:00 |         90 |          89 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:02+00:00 |         90 |          44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   | 2023-05-31 10:00:04+00:00 |         90 |         -89 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL                      |       NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_2   | 2023-05-31 10:00:10+00:00 |         90 |          89 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:00+00:00 |         29 |          24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:02+00:00 |         58 |          44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   | 2023-05-31 10:00:04+00:00 |       NULL |          44 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL                      |       NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_3   | 2023-05-31 10:00:10+00:00 |         58 |          44 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:00:00+00:00 |          8 |          19 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   | 2023-05-31 10:00:02+00:00 |         84 |          49 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   | 2023-05-31 10:00:04+00:00 |         84 |          77 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL                      |       NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_4   | 2023-05-31 10:00:10+00:00 |         84 |          77 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:00+00:00 |          2 |         -55 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   | 2023-05-31 10:00:02+00:00 |         29 |          24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   | 2023-05-31 10:00:04+00:00 |         29 |          49 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL                      |       NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_5   | 2023-05-31 10:00:10+00:00 |         29 |          49 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:00:00+00:00 |         76 |         -55 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:02+00:00 |          8 |          24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   | 2023-05-31 10:00:04+00:00 |          8 |          24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL                      |       NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_6   | 2023-05-31 10:00:10+00:00 |          8 |          24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:00+00:00 |         44 |          24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   | 2023-05-31 10:00:02+00:00 |          2 |          55 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   | 2023-05-31 10:00:04+00:00 |          2 | NULL        | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL                      |       NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_7   | 2023-05-31 10:00:10+00:00 |          2 | NULL        | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:00:00+00:00 |         92 |          24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   | 2023-05-31 10:00:02+00:00 |         76 |          55 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   | 2023-05-31 10:00:04+00:00 |         76 |          55 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL                      |       NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_8   | 2023-05-31 10:00:10+00:00 |         76 |          55 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:00+00:00 |         21 |         -89 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   | 2023-05-31 10:00:02+00:00 |         44 |          24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   | 2023-05-31 10:00:04+00:00 |         44 |          92 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL                      |       NULL | NULL        | NULL
  2023-05-31 10:00:10+00:00 | host_9   | 2023-05-31 10:00:10+00:00 |         44 |         -92 | 2023-05-31 10:00:10+00:00
(50 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       first_row(usage_guest),
       firstts(usage_system),
       lastts(usage_system),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname | first_row |          firstts          |          lastts           |          last_ts
----------------------------+----------+-----------+---------------------------+---------------------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |  3.141593 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |        43 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |        96 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_0   |        96 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |        53 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |        11 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |        43 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_1   |        43 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |        93 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   | NULL      | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |        11 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_2   |        11 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |        24 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |        53 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   | NULL      | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_3   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |        40 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |        93 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |        53 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_4   |        53 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL      | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |        24 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |        93 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_5   |        93 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |         0 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |        40 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |        24 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_6   |        24 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |        96 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |        20 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |        40 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_7   |       -40 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |        43 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |         0 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |        20 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_8   |        20 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |        11 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |        96 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |         0 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL      | NULL                      | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_9   |         0 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
(50 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
    first (usage_steal), count (usage_system), firstts(usage_steal), lastts(usage_steal), first_row(usage_steal),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |   first    | count |          firstts          |          lastts           | first_row  |          last_ts
----------------------------+----------+------------+-------+---------------------------+---------------------------+------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |  54.122111 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 |  54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |         60 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 |         60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |         24 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_0   |         24 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | -54.122111 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | -54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |        -89 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 |        -89 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |         60 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_1   |         60 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |         89 |     2 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | NULL       | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |         44 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 |         44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |        -89 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        -89 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_2   |         89 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         89 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |         24 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 |         24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |         77 |     1 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 |         77 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |         44 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         44 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_3   |         44 |     0 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         44 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |         19 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 |         19 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |         49 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 |         49 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |         77 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         77 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_4   |         77 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         77 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |        -55 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |        -55 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |         24 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 |         24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |         49 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         49 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_5   |         49 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         49 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |         92 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 |         92 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |         24 |     2 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | NULL       | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |         24 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_6   |         24 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |         24 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 |         24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |         55 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         55 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   | NULL       |     1 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_7   | NULL       |     1 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |         60 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 |         60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |         92 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 |         92 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |         55 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         55 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_8   |         55 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         55 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |        -89 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 |        -89 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |         24 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 |         24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |         92 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         92 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL       |     0 | NULL                      | NULL                      | NULL       | NULL
  2023-05-31 10:00:10+00:00 | host_9   |        -92 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        -92 | 2023-05-31 10:00:10+00:00
(50 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
    first (usage_guest_nice), last (usage_guest), first (usage_iowait), firstts(usage_guest),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |  first   |   last    | first  |          firstts          |          last_ts
----------------------------+----------+----------+-----------+--------+---------------------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 3.141593 | -3.141593 | -32768 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |       69 |        96 |     41 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |       69 |        96 |     31 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_0   |       69 |        96 |    -31 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |       74 |  3.141593 |     29 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |       76 |        43 |     25 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | NULL     |        43 |     41 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_1   | NULL     |        43 |     41 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |        1 |        11 |    -17 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |       38 |        11 |     22 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |       76 |        11 |     25 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_2   |       76 |        11 |     25 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |       82 |        93 |     30 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |       74 |        53 |     29 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |       38 | NULL      |     22 | NULL                      | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_3   |       38 | NULL      |     22 | NULL                      | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |       54 |        24 |     38 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |        1 |        53 |    -17 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |       74 |        53 |     29 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_4   |       74 |        53 |     29 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |      -15 |        40 |    -81 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |       82 |        93 |     30 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |        1 |        93 |     17 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_5   |        1 |        93 |     17 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |       31 |        20 |     65 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |       54 |        24 |    -38 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |       82 |        24 |     30 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_6   |       82 |        24 |     30 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |       69 |         0 |     31 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |       15 |        40 |     81 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |       54 |        40 |     38 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_7   |       54 |       -40 |     38 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |       69 |        96 |     41 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |       31 |        20 |     65 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |       15 |        20 |     81 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_8   |       15 |        20 |     81 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |       76 |        11 |     25 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |       69 |         0 |     31 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |       31 |         0 |     65 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL     | NULL      | NULL   | NULL                      | NULL
  2023-05-31 10:00:10+00:00 | host_9   |       31 |         0 |     65 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
(50 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       lastts(usage_user),
       firstts(usage_guest_nice), last (usage_softirq), last_row(usage_softirq),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          lastts           |          firstts          |   last    | last_row  |          last_ts
----------------------------+----------+---------------------------+---------------------------+-----------+-----------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |    -100.1 |    -100.1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         2 |         2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         2 |         2 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_0   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         2 |         2 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 54.122111 | 54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |        26 |        26 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | 2023-05-31 10:00:04+00:00 | NULL                      |        26 |        26 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_1   | 2023-05-31 10:00:10+00:00 | NULL                      |        26 |        26 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |         8 |         8 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |         8 |         8 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         8 |         8 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_2   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         8 |         8 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |        60 |        60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |         6 |         6 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   | NULL                      | 2023-05-31 10:00:04+00:00 |         6 |         6 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_3   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         6 |         6 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |        33 |        33 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |        54 |        54 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        54 |        54 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_4   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        54 |        54 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |        71 |        71 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |        60 |        60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        60 |        60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_5   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        60 |        60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |        29 |        29 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |        33 |        33 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        33 |        33 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_6   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        33 |        33 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |         7 |         7 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |        71 |        71 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        71 |        71 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_7   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        71 |        71 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |         2 |         2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |        29 |        29 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        29 |        29 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_8   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        29 |        29 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |        26 |        26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |        -7 |        -7 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         7 |         7 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL                      | NULL                      | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_9   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         7 |         7 | 2023-05-31 10:00:10+00:00
(50 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       firstts(usage_idle),
       first_row(usage_guest_nice),
       avg(usage_user),
       count(usage_softirq),
       count(usage_steal),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          firstts          | first_row | avg  | count | count |          last_ts
----------------------------+----------+---------------------------+-----------+------+-------+-------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 |  3.141593 | -0.5 |     2 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:02+00:00 | NULL      | 56.5 |     2 |     2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   | 2023-05-31 10:00:04+00:00 |        69 |   92 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | NULL      | NULL |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_0   | 2023-05-31 10:00:10+00:00 |        69 |   92 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | 2023-05-31 10:00:00+00:00 |        74 |   84 |     2 |     2 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   | 2023-05-31 10:00:02+00:00 |        76 | 55.5 |     2 |     2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | 2023-05-31 10:00:04+00:00 | NULL      |   21 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL                      | NULL      | NULL |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_1   | 2023-05-31 10:00:10+00:00 | NULL      |   21 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   | 2023-05-31 10:00:00+00:00 |         1 | 59.5 |     2 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:02+00:00 |        38 |   74 |     2 |     2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   | 2023-05-31 10:00:04+00:00 |        76 |   90 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL                      | NULL      | NULL |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_2   | 2023-05-31 10:00:10+00:00 |        76 |   90 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:00+00:00 |        82 | 18.5 |     2 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:02+00:00 |        74 |   71 |     2 |     2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   | 2023-05-31 10:00:04+00:00 |        38 | NULL |     1 |     1 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL                      | NULL      | NULL |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_3   | 2023-05-31 10:00:10+00:00 |        38 |   58 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:00:00+00:00 |        54 |    5 |     2 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   | 2023-05-31 10:00:02+00:00 |         1 | 56.5 |     2 |     2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   | 2023-05-31 10:00:04+00:00 |        74 |   84 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL                      | NULL      | NULL |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_4   | 2023-05-31 10:00:10+00:00 |        74 |   84 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:00+00:00 |       -15 |  -37 |     2 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   | 2023-05-31 10:00:02+00:00 |        82 | 18.5 |     2 |     2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   | 2023-05-31 10:00:04+00:00 |         1 |   29 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL                      | NULL      | NULL |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_5   | 2023-05-31 10:00:10+00:00 |         1 |   29 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:00:00+00:00 |        31 |   60 |     2 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:02+00:00 |        54 |    5 |     2 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   | 2023-05-31 10:00:04+00:00 |        82 |    8 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL                      | NULL      | NULL |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_6   | 2023-05-31 10:00:10+00:00 |        82 |    8 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:00+00:00 |        69 |   68 |     2 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   | 2023-05-31 10:00:02+00:00 |        15 |   39 |     2 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   | 2023-05-31 10:00:04+00:00 |        54 |    2 |     1 |     0 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL                      | NULL      | NULL |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_7   | 2023-05-31 10:00:10+00:00 |        54 |    2 |     1 |     0 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:00:00+00:00 | NULL      | 56.5 |     2 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   | 2023-05-31 10:00:02+00:00 |        31 |   60 |     2 |     2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   | 2023-05-31 10:00:04+00:00 |        15 |   76 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL                      | NULL      | NULL |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_8   | 2023-05-31 10:00:10+00:00 |        15 |   76 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:00+00:00 |        76 | 55.5 |     2 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   | 2023-05-31 10:00:02+00:00 |        69 |   68 |     2 |     2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   | 2023-05-31 10:00:04+00:00 |        31 |   44 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL                      | NULL      | NULL |     0 |     0 | NULL
  2023-05-31 10:00:10+00:00 | host_9   | 2023-05-31 10:00:10+00:00 |        31 |   44 |     1 |     1 | 2023-05-31 10:00:10+00:00
(50 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       max(usage_nice), first (usage_system), avg (usage_idle), last (usage_irq), first (usage_irq),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |     max     |    first    | avg  |  last  | first  |          last_ts
----------------------------+----------+-------------+-------------+------+--------+--------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 | -2147483648 | -0.5 | -32768 | -32768 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |          83 |          77 |  4.5 |      1 |     84 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |           9 |          35 |   99 |     -1 |     -1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL        |        NULL | NULL | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_0   |           9 |          35 |   99 |      1 |      1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |  2147483647 |  2147483647 | -0.5 |  32767 |     20 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          83 |           0 | 85.5 |     84 |     44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |          83 |          77 |   90 |     84 |     84 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL        |        NULL | NULL | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_1   |          83 |          77 |   90 |    -84 |    -84 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |          63 |          48 |  -38 |     44 |     52 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |          61 |          -2 | 52.5 |     44 |     63 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |          28 |           0 |   81 |     44 |     44 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL        |        NULL | NULL | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_2   |          28 |           0 |   81 |    -44 |    -44 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |          78 |          21 |  -42 |     52 |     81 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          87 |          11 | 38.5 |     63 |     20 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |          61 |           2 |   24 |     63 |     63 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL        |        NULL | NULL | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_3   |          61 |        NULL |   24 |     63 |     63 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |          78 |          26 | 76.5 |     81 |     20 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |          87 |          48 |   24 |     20 |     52 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |          87 |          11 |   53 |     20 |     20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL        |        NULL | NULL | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_4   |          87 |          11 |   53 |     20 |     20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |           6 |         -40 |  0.5 |     20 |    -20 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |          63 |          21 |   47 |     52 |     81 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |         -63 |          48 |    5 |    -52 |    -52 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL        |        NULL | NULL | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_5   |         -63 |          48 |    5 |     52 |     52 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |           7 |          70 | 41.5 |     20 |     11 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |          78 |          26 | 12.5 |     81 |     20 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |          78 |          21 |   89 |    -81 |    -81 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL        |        NULL | NULL | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_6   |         -78 |          21 |   89 |     81 |     81 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |          67 |          35 | 59.5 |     11 |     -1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |           7 |          40 | 63.5 |    -20 |     20 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |           6 |          26 |  -64 |    -20 |    -20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL        |        NULL | NULL | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_7   |           6 |          26 |   64 |    -20 |    -20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |          83 |          77 | -4.5 |      1 |     84 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |          67 |          70 | 41.5 |     20 |     11 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |           7 |          40 |   63 |     20 |     20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL        |        NULL | NULL | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_8   |           7 |          40 |  -63 |    -20 |    -20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |          83 |           0 | 85.5 |     84 |    -44 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |          67 |          35 | 59.5 |     11 |      1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |          67 |          70 |   20 |     11 |     11 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL        |        NULL | NULL | NULL   | NULL   | NULL
  2023-05-31 10:00:10+00:00 | host_9   |          67 |          70 |   20 |     11 |     11 | 2023-05-31 10:00:10+00:00
(50 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       max(usage_guest_nice),
       lastts(usage_idle),
       max(usage_guest),
       avg(usage_nice), first (usage_guest),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |   max    |          lastts           |   max    |     avg     |  first   |          last_ts
----------------------------+----------+----------+---------------------------+----------+-------------+----------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 3.141593 | 2023-05-31 10:00:01+00:00 | 3.141593 | -2147483648 | 3.141593 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |       69 | 2023-05-31 10:00:03+00:00 |       96 |          46 |       43 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |       69 | 2023-05-31 10:00:04+00:00 |       96 |           9 |       96 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL     | NULL                      | NULL     | NULL        | NULL     | NULL
  2023-05-31 10:00:10+00:00 | host_0   |       69 | 2023-05-31 10:00:10+00:00 |       96 |           9 |       96 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |       74 | 2023-05-31 10:00:01+00:00 |       53 |  2147483647 |       53 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |       76 | 2023-05-31 10:00:03+00:00 |       43 |        55.5 |       11 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | NULL     | 2023-05-31 10:00:04+00:00 |       43 |          83 |       43 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL     | NULL                      | NULL     | NULL        | NULL     | NULL
  2023-05-31 10:00:10+00:00 | host_1   | NULL     | 2023-05-31 10:00:10+00:00 |       43 |          83 |       43 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |       76 | 2023-05-31 10:00:01+00:00 |       93 |        45.5 |       93 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |       76 | 2023-05-31 10:00:03+00:00 |       11 |        44.5 |       11 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |       76 | 2023-05-31 10:00:04+00:00 |       11 |          28 |       11 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL     | NULL                      | NULL     | NULL        | NULL     | NULL
  2023-05-31 10:00:10+00:00 | host_2   |       76 | 2023-05-31 10:00:10+00:00 |       11 |          28 |       11 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |       82 | 2023-05-31 10:00:01+00:00 |       93 |        70.5 |       24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |       74 | 2023-05-31 10:00:03+00:00 |       53 |          74 |       53 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |       38 | 2023-05-31 10:00:04+00:00 | NULL     |          61 | NULL     | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL     | NULL                      | NULL     | NULL        | NULL     | NULL
  2023-05-31 10:00:10+00:00 | host_3   |       38 | 2023-05-31 10:00:10+00:00 | NULL     |          61 | NULL     | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |       82 | 2023-05-31 10:00:01+00:00 |       40 |          42 |       40 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |       74 | 2023-05-31 10:00:03+00:00 |       93 |          75 |       93 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |       74 | 2023-05-31 10:00:04+00:00 |       53 |          87 |       53 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL     | NULL                      | NULL     | NULL        | NULL     | NULL
  2023-05-31 10:00:10+00:00 | host_4   |       74 | 2023-05-31 10:00:10+00:00 |       53 |          87 |       53 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |       54 | 2023-05-31 10:00:01+00:00 |       40 |        -0.5 |       40 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |       82 | 2023-05-31 10:00:03+00:00 |       93 |        -7.5 |       24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |        1 | 2023-05-31 10:00:04+00:00 |       93 |         -63 |       93 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL     | NULL                      | NULL     | NULL        | NULL     | NULL
  2023-05-31 10:00:10+00:00 | host_5   |        1 | 2023-05-31 10:00:10+00:00 |       93 |         -63 |       93 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |       31 | 2023-05-31 10:00:01+00:00 |       20 |         -30 |        0 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |       82 | 2023-05-31 10:00:03+00:00 |       40 |          42 |       40 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |       82 | 2023-05-31 10:00:04+00:00 |       24 |          78 |       24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL     | NULL                      | NULL     | NULL        | NULL     | NULL
  2023-05-31 10:00:10+00:00 | host_6   |       82 | 2023-05-31 10:00:10+00:00 |       24 |         -78 |       24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |       69 | 2023-05-31 10:00:01+00:00 |       96 |          38 |       96 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |       54 | 2023-05-31 10:00:03+00:00 |       40 |         6.5 |       20 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |       54 | 2023-05-31 10:00:04+00:00 |       40 |           6 |       40 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL     | NULL                      | NULL     | NULL        | NULL     | NULL
  2023-05-31 10:00:10+00:00 | host_7   |       54 | 2023-05-31 10:00:10+00:00 |      -40 |           6 |      -40 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |       69 | 2023-05-31 10:00:01+00:00 |       96 |          46 |       43 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |       31 | 2023-05-31 10:00:03+00:00 |       20 |          37 |        0 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |       15 | 2023-05-31 10:00:04+00:00 |       20 |           7 |       20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL     | NULL                      | NULL     | NULL        | NULL     | NULL
  2023-05-31 10:00:10+00:00 | host_8   |       15 | 2023-05-31 10:00:10+00:00 |       20 |           7 |       20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |       76 | 2023-05-31 10:00:01+00:00 |       11 |        55.5 |       11 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |       69 | 2023-05-31 10:00:03+00:00 |       96 |          29 |       96 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |       31 | 2023-05-31 10:00:04+00:00 |        0 |          67 |        0 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL     | NULL                      | NULL     | NULL        | NULL     | NULL
  2023-05-31 10:00:10+00:00 | host_9   |       31 | 2023-05-31 10:00:10+00:00 |        0 |          67 |        0 | 2023-05-31 10:00:10+00:00
(50 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       min(usage_guest_nice),
       max(usage_softirq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |    min    |    max    |          last_ts
----------------------------+----------+-----------+-----------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |  3.141593 | 54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |        69 |        26 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |        69 |         2 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_0   |        69 |         2 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | -3.141593 | 54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_1   |        76 |        26 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | NULL      |        26 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_1   | NULL      |        26 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |         1 |        60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |        38 |         8 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |        76 |         8 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_2   |        76 |         8 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |         1 |        60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |        38 |        54 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |        38 |         6 | NULL
  2023-05-31 10:00:08+00:00 | host_3   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_3   |        38 |         6 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |        54 |        33 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |         1 |        60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |        74 |        54 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_4   |        74 |        54 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |       -15 |        71 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |         1 |        60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |         1 |        60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_5   |         1 |        60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |        15 |        29 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |        54 |        71 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |        82 |        33 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_6   |        82 |        33 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |        31 |         7 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |        15 |        71 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |        54 |        71 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_7   |        54 |        71 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |        69 |        26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |        15 |        29 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |        15 |        29 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_8   |        15 |        29 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |        36 |        26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |        31 |        -2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |        31 |         7 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL      | NULL      | NULL
  2023-05-31 10:00:10+00:00 | host_9   |        31 |         7 | 2023-05-31 10:00:10+00:00
(50 rows)
> SELECT count(usage_irq),
       time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       avg(usage_softirq),
       first_row(usage_softirq),
       first_row(usage_nice), last (usage_iowait),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
  count |       k_timestamp_b       | hostname |     avg     | first_row  |  first_row  | last  |          last_ts
--------+---------------------------+----------+-------------+------------+-------------+-------+----------------------------
      2 | 2023-05-31 10:00:00+00:00 | host_0   | -22.9889445 |  54.122111 | -2147483648 | 32767 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_0   |          14 |         26 |          83 |    31 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_0   |           2 |          2 |           9 |    31 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_0   | NULL        | NULL       | NULL        | NULL  | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_0   |           2 |          2 |           9 |   -31 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_1   |           0 | -54.122111 |  2147483647 | 32767 | 2023-05-31 10:00:00+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_1   |          17 |          8 |          28 |    41 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_1   |          26 |         26 |          83 |    41 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_1   | NULL        | NULL       | NULL        | NULL  | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_1   |          26 |         26 |          83 |    41 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_2   |          34 |         60 |          63 |    25 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_2   |           7 |          6 |          61 |    25 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_2   |           8 |          8 |          28 |    25 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_2   | NULL        | NULL       | NULL        | NULL  | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_2   |           8 |          8 |          28 |    25 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_3   |        46.5 |         33 |          78 |    17 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_3   |          30 |         54 |          87 |    22 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_3   |           6 |          6 |          61 |    22 | NULL
      0 | 2023-05-31 10:00:08+00:00 | host_3   | NULL        | NULL       | NULL        | NULL  | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_3   |           6 |          6 |          61 |    22 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_4   |         -19 |        -71 |           6 |    30 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_4   |          57 |         60 |          63 |    29 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_4   |          54 |         54 |          87 |    29 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_4   | NULL        | NULL       | NULL        | NULL  | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_4   |          54 |         54 |          87 |    29 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_5   |          21 |        -29 |          -7 |    38 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_5   |        46.5 |         33 |         -78 |    17 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_5   |          60 |         60 |         -63 |    17 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_5   | NULL        | NULL       | NULL        | NULL  | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_5   |          60 |         60 |         -63 |    17 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_6   |          18 |          7 |         -67 |    81 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_6   |          52 |         71 |           6 |    30 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_6   |          33 |         33 |          78 |    30 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_6   | NULL        | NULL       | NULL        | NULL  | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_6   |          33 |         33 |         -78 |    30 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_7   |         4.5 |          2 |           9 |    65 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_7   |          50 |         29 |           7 |    38 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_7   |          71 |         71 |           6 |    38 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_7   | NULL        | NULL       | NULL        | NULL  | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_7   |          71 |         71 |           6 |    38 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_8   |          14 |         26 |          83 |    31 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_8   |          18 |          7 |          67 |    81 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_8   |          29 |         29 |           7 |    81 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_8   | NULL        | NULL       | NULL        | NULL  | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_8   |          29 |         29 |           7 |    81 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_9   |          17 |          8 |          28 |    41 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_9   |        -4.5 |         -2 |          -9 |    65 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_9   |           7 |          7 |          67 |    65 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_9   | NULL        | NULL       | NULL        | NULL  | NULL
      1 | 2023-05-31 10:00:10+00:00 | host_9   |           7 |          7 |          67 |    65 | 2023-05-31 10:00:10+00:00
(50 rows)
> drop database test cascade;
DROP DATABASE
> drop database if exists test cascade;
DROP DATABASE
> create ts database test;
CREATE TS DATABASE
> create table test.cpu
(
    k_timestamp      timestamp not null,
    usage_user       bigint not null,
    usage_system     bigint,
    usage_idle       int,
    usage_nice       int,
    usage_iowait     smallint,
    usage_irq        smallint,
    usage_softirq    float,
    usage_steal      float,
    usage_guest      real,
    usage_guest_nice real
) attributes (
    hostname char(30) not null,
    region varchar(8) not null,
    datacenter int,
    rack int not null,
    os char(30),
    arch char(30),
    team char(30),
    service char(30),
    service_version char(30),
    service_environment char(30)
    )
primary attributes (hostname, region, rack);
CREATE TABLE
> INSERT INTO test.cpu
values ('2023-05-31 10:00:00', 2147483647, -2147483648, -2147483648, -2147483648, -32768, -32768, 54.122111, 54.122111, 3.141593, 3.141593, 'host_0', 'aaaaaaaa', null, 6666, '', null, '', null, '', ''),
       ('2023-05-31 10:00:00', -2147483648, -2147483648, -2147483648, -2147483648, -32768, -32768, 54.122111, 54.122111, 3.141593, 3.141593, 'host_0', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 84, 2147483647, -2147483648, 2147483647, 29, 20, -54.122111, -54.122111, 53, 74, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 29, 48, 5, 63, -17, 52, 60, null, 93, 1, 'host_2', 'a', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 8, 21, -89, 78, 30, 81, 33, 24, 24, 82, 'host_3', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 2, 26, 64, 6, 38, 20, -71, 19, 40, 54, 'host_4', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', -76, -40, -63, -7, -81, -20, -29, -55, null, -15, 'host_5', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 44, 70, 20, -67, 65, 11, 7, 92, 0, 31, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 92, 35, 99, 9, 31, -1, 2, 24, 96, 69, 'host_7', 'aaa', -888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:00', 90, 0, 81, 28, 25, -44, 8, -89, 11, 76, 'host_9', 'aaa', 888888, 6666, '', '', '', '', '', '');
INSERT 11
> INSERT INTO test.cpu
values ('2023-05-31 10:00:01', 2147483647, -2147483648, 2147483647, -2147483648, 32767, -32768, -100.1, 54.122111, -3.141593, null, 'host_0', 'aaa', -2147483648, 6666, '', '', null, '', '', ''),
       ('2023-05-31 10:00:01', 2147483647, 2147483647, 2147483647, 2147483647, 32767, 32767, 54.122111, -54.1221111, 3.141593, -3.141593, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 29, 48, 5, 63, 17, 52, 60, 49, 93, 1, 'host_3', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 8, 21, 89, 78, 30, 81, 33, 24, 24, 82, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 2, 26, 64, 6, 38, 20, 71, null, 40, 54, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 76, 40, 63, 7, 81, 20, 29, -55, 20, 15, 'host_6', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_7', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 92, 35,-99, 9, 31, 1, 2, 24, 96, 69, 'host_8', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 21, 77, 90, 83, 41, 84, 26, 60, null, 36, 'host_9', 'aaa', -888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:01', 90, 0, -81, 28, 25, 44, 8, 89, 11, 76, 'host_2', 'a', -888888, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:02', 58, -2, 24, 61, 22, 63, 6, 44, null, 38, 'host_2', 'aaa', null, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_3', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 29, 48, -5, 63, -17, 52, 60, 49, 93, 1, 'host_4', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 8, 21, 89, -78, 30, 81, 33, 24, 24, 82, 'host_5', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 2, 26, -64, 6, -38, 20, 71, null, 40, 54, 'host_6', 'aaa', null, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_7', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_8', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 92, 35, 99, -9, 31, 1, -2, 24, 96, 69, 'host_9', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 21, 77, -90, 83, 41, 84, 26, 60, 43, null, 'host_0', 'aaaaaaaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:02', 90, 0, 81, 28, 25, 44, 8, -89, 11, 76, 'host_1', 'aaa', 2147483647, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:04', 2147483647, 2, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 29, 48, 5, -63, 17, -52, 60, 49, 93, 1, 'host_5', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 8, 21, 89, 78, 30, -81, 33, 24, 24, 82, 'host_6', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 2, 26, -64, 6, 38, -20, 71, null, 40, 54, 'host_7', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_8', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_9', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 92, 35, 99, 9, 31, -1, 2, 24, 96, 69, 'host_0', 'aaaaaaaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_1', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:04', 90, 0, 81, 28, 25, 44, 8, -89, 11, 76, 'host_2', 'aaa', -2147483648, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:03', 58, null, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 29, 48, 5, 63, 17, 52, 60, 49, 93, 1, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 8, 21, 89, 78, 30, 81, 33, 24, 24, 82, 'host_6', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 2, 26, 64, 6, 38, -20, 71, null, 40, 54, 'host_7', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 44, 70, 20, 67, 65, 11, -7, 92, 0, 31, 'host_9', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 92, 35, 99, 9, 31, 1, 2, 24, 96, 69, 'host_0', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:03', 90, 0, 81, 28, 25, 44, 8, 89, 11, 76, 'host_2', 'aaa', 888888, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_3', 'aaaaaaa', null, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_4', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_7', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_9', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_0', 'aaa', 0, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_2', 'aaa', null, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_3', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_5', 'aaa', null, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_7', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_8', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_9', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_0', 'aaa', -888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_2', 'aaa', null, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:10', 58, null, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 29, 48, 5, -63, 17, 52, 60, 49, 93, 1, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 8, 21, 89, -78, 30, 81, 33, 24, 24, 82, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 2, 26, 64, 6, 38, -20, 71, null, -40, 54, 'host_7', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 76, 40, -63, 7, 81, -20, 29, 55, 20, 15, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 44, 70, 20, 67, 65, 11, 7, -92, 0, 31, 'host_9', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 92, 35, 99, 9, -31, 1, 2, 24, 96, 69, 'host_0', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 21, 77, 90, 83, 41, -84, 26, 60, 43, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:10', 90, 0, 81, 28, 25, -44, 8, 89, 11, 76, 'host_2', 'aaa', -888888, 6666, '', '', '', '', '', '');
INSERT 10
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       lastts(usage_guest),
       sum(usage_steal),
       firstts(usage_nice),
       max(usage_user),
       max(usage_irq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          lastts           |    sum     |          firstts          |    max     |  max   |          last_ts
----------------------------+----------+---------------------------+------------+---------------------------+------------+--------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 |  54.122111 | 2023-05-31 10:00:00+00:00 | 2147483647 | -32768 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:01+00:00 | 108.244222 | 2023-05-31 10:00:00+00:00 | 2147483647 | -32768 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:02+00:00 |         60 | 2023-05-31 10:00:02+00:00 |         21 |     84 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:03+00:00 |         24 | 2023-05-31 10:00:03+00:00 |         92 |      1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   | 2023-05-31 10:00:04+00:00 |         24 | 2023-05-31 10:00:04+00:00 |         92 |     -1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | NULL       | NULL                      | 2147483647 | NULL   | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | NULL       | NULL                      | 2147483647 | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   | 2023-05-31 10:00:10+00:00 |         24 | 2023-05-31 10:00:10+00:00 |         92 |      1 | 2023-05-31 10:00:10+00:00
(8 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       first_row(usage_idle),
       lastts(usage_nice),
       lastts(usage_irq),
       lastts(usage_guest_nice),
       max(usage_idle),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_1'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |  first_row  |          lastts           |          lastts           |          lastts           |    max     |          last_ts
----------------------------+----------+-------------+---------------------------+---------------------------+---------------------------+------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_1   | -2147483648 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2147483647 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          81 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |         90 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |          90 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | NULL                      |         90 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL        | NULL                      | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   |          90 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | NULL                      |         90 | 2023-05-31 10:00:10+00:00
(5 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       sum(usage_guest),
       count(usage_idle),
       avg(usage_system),
       max(usage_steal),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaa'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname | sum  | count |     avg     |    max    |          last_ts
----------------------------+----------+------+-------+-------------+-----------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |    0 |     2 | -2147483648 | 54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |   96 |     1 |          35 |        24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL |     0 | NULL        | NULL      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL |     0 | NULL        | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   |   96 |     1 |          35 |        24 | 2023-05-31 10:00:10+00:00
(5 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       last_row(usage_iowait),
       avg(usage_irq),
       max(usage_system),
       firstts(usage_irq),
       lastts(usage_softirq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaaaaaaa'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname | last_row |  avg   |     max     |          firstts          |          lastts           |          last_ts
----------------------------+----------+----------+--------+-------------+---------------------------+---------------------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |   -32768 | -32768 | -2147483648 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 | host_0   |       41 |     84 |          77 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:04+00:00 | host_0   |       31 |     -1 |          35 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
(3 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       first_row(usage_irq),
       lastts(usage_iowait),
       sum(usage_iowait),
       hostname,
       first_row(usage_system),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND region = 'aaa'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | first_row |          lastts           |  sum  | hostname |  first_row  |          last_ts
----------------------------+-----------+---------------------------+-------+----------+-------------+----------------------------
  2023-05-31 10:00:00+00:00 |    -32768 | 2023-05-31 10:00:01+00:00 |    -1 | host_0   | -2147483648 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |         1 | 2023-05-31 10:00:03+00:00 |    31 | host_0   |          35 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_0   |        NULL | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_0   |        NULL | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 |         1 | 2023-05-31 10:00:10+00:00 |   -31 | host_0   |          35 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        20 | 2023-05-31 10:00:01+00:00 | 32796 | host_1   |  2147483647 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        44 | 2023-05-31 10:00:03+00:00 |    66 | host_1   |           0 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        84 | 2023-05-31 10:00:04+00:00 |    41 | host_1   |          77 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_1   |        NULL | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 |       -84 | 2023-05-31 10:00:10+00:00 |    41 | host_1   |          77 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:02+00:00 |        63 | 2023-05-31 10:00:02+00:00 |    22 | host_2   |          -2 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |        44 | 2023-05-31 10:00:03+00:00 |    25 | host_2   |           0 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        44 | 2023-05-31 10:00:04+00:00 |    25 | host_2   |           0 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_2   |        NULL | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 |       -44 | 2023-05-31 10:00:10+00:00 |    25 | host_2   |           0 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        81 | 2023-05-31 10:00:01+00:00 |    47 | host_3   |          21 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        20 | 2023-05-31 10:00:02+00:00 |    29 | host_3   |          11 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |        63 | 2023-05-31 10:00:03+00:00 |    22 | host_3   |        NULL | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        63 | 2023-05-31 10:00:04+00:00 |    22 | host_3   |           2 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_3   |        NULL | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 |        63 | 2023-05-31 10:00:10+00:00 |    22 | host_3   |        NULL | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        20 | 2023-05-31 10:00:01+00:00 |    68 | host_4   |          26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        52 | 2023-05-31 10:00:03+00:00 |    12 | host_4   |          48 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        20 | 2023-05-31 10:00:04+00:00 |    29 | host_4   |          11 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_4   |        NULL | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 |        20 | 2023-05-31 10:00:10+00:00 |    29 | host_4   |          11 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |       -20 | 2023-05-31 10:00:00+00:00 |   -81 | host_5   |         -40 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |        20 | 2023-05-31 10:00:01+00:00 |    38 | host_5   |          26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        81 | 2023-05-31 10:00:03+00:00 |    47 | host_5   |          21 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |       -52 | 2023-05-31 10:00:04+00:00 |    17 | host_5   |          48 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_5   |        NULL | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_5   |        NULL | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 |        52 | 2023-05-31 10:00:10+00:00 |    17 | host_5   |          48 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        11 | 2023-05-31 10:00:01+00:00 |   146 | host_6   |          70 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        20 | 2023-05-31 10:00:02+00:00 |   -38 | host_6   |          26 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |        81 | 2023-05-31 10:00:03+00:00 |    30 | host_6   |          21 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |       -81 | 2023-05-31 10:00:04+00:00 |    30 | host_6   |          21 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_6   |        NULL | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 |        81 | 2023-05-31 10:00:10+00:00 |    30 | host_6   |          21 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        -1 | 2023-05-31 10:00:00+00:00 |    31 | host_7   |          35 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |        11 | 2023-05-31 10:00:01+00:00 |    65 | host_7   |          70 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        20 | 2023-05-31 10:00:03+00:00 |   119 | host_7   |          40 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |       -20 | 2023-05-31 10:00:04+00:00 |    38 | host_7   |          26 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_7   |        NULL | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 |       -20 | 2023-05-31 10:00:10+00:00 |    38 | host_7   |          26 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |        84 | 2023-05-31 10:00:01+00:00 |    72 | host_8   |          77 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        11 | 2023-05-31 10:00:03+00:00 |   146 | host_8   |          70 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        20 | 2023-05-31 10:00:04+00:00 |    81 | host_8   |          40 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_8   |        NULL | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_8   |        NULL | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 |       -20 | 2023-05-31 10:00:10+00:00 |    81 | host_8   |          40 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 |       -44 | 2023-05-31 10:00:00+00:00 |    25 | host_9   |           0 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |        84 | 2023-05-31 10:00:01+00:00 |    41 | host_9   |          77 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |         1 | 2023-05-31 10:00:03+00:00 |    96 | host_9   |          35 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |        11 | 2023-05-31 10:00:04+00:00 |    65 | host_9   |          70 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL      | NULL                      | NULL  | host_9   |        NULL | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 |        11 | 2023-05-31 10:00:10+00:00 |    65 | host_9   |          70 | 2023-05-31 10:00:10+00:00
(57 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b, first (usage_nice), min (usage_system), min (usage_softirq), last_row(usage_guest_nice), hostname,
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
  AND region = 'aaaaaaaa'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       |    first    |     min     |    min    | last_row | hostname |          last_ts
----------------------------+-------------+-------------+-----------+----------+----------+----------------------------
  2023-05-31 10:00:00+00:00 | -2147483648 | -2147483648 | 54.122111 | 3.141593 | host_0   | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:02+00:00 |          83 |          77 |        26 | NULL     | host_0   | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:04+00:00 |           9 |          35 |         2 |       69 | host_0   | 2023-05-31 10:00:04+00:00
(3 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       avg(usage_steal),
       avg(usage_guest_nice),
       last_row(usage_guest),
       min(usage_idle),
       hostname,
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts LIMIT 10;
        k_timestamp_b       |     avg      |        avg         | last_row  |     min     | hostname |          last_ts
----------------------------+--------------+--------------------+-----------+-------------+----------+----------------------------
  2023-05-31 10:00:00+00:00 |    54.122111 | 3.1415929794311523 |  3.141593 | -2147483648 | host_0   | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 |    54.122111 | 3.1415929794311523 | -3.141593 | -2147483648 | host_0   | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |           60 | NULL               |        43 |         -90 | host_0   | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 |           24 |                 69 |        96 |          99 | host_0   | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 |           24 |                 69 |        96 |          99 | host_0   | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | NULL         | NULL               | NULL      | NULL        | host_0   | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | NULL         | NULL               | NULL      | NULL        | host_0   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 |           24 |                 69 |        96 |          99 | host_0   | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | -54.12211105 | 35.429203510284424 |  3.141593 | -2147483648 | host_1   | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 |        -14.5 |                 76 |        43 |          81 | host_1   | 2023-05-31 10:00:03+00:00
(10 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       sum(usage_nice),
       sum(usage_idle),
       min(usage_irq),
       sum(usage_system),
       last_row(usage_user),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_1'
  AND region = 'aaa'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts
OFFSET 2;
        k_timestamp_b       | hostname | sum  | sum  | min  | sum  |  last_row  |          last_ts
----------------------------+----------+------+------+------+------+------------+----------------------------
  2023-05-31 10:00:04+00:00 | host_1   |   83 |   90 |   84 |   77 |         21 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL | NULL | NULL | NULL | 2147483647 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   |   83 |   90 |  -84 |   77 |         21 | 2023-05-31 10:00:10+00:00
(3 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       min(usage_iowait),
       last_row(usage_irq),
       count(usage_nice),
       last_row(usage_idle),
       last_row(usage_system),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaa'
  AND datacenter = 888888
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |  min   | last_row | count |  last_row  |  last_row   |          last_ts
----------------------------+----------+--------+----------+-------+------------+-------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | -32768 |   -32768 |     2 | 2147483647 | -2147483648 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |     31 |        1 |     1 |         99 |          35 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL   | NULL     |     0 | NULL       |        NULL | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:10+00:00 | host_0   |    -31 |        1 |     1 |         99 |          35 | 2023-05-31 10:00:10+00:00
(4 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       first_row(usage_iowait),
       last_row(usage_steal),
       min(usage_user),
       last_row(usage_nice),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
  AND hostname = 'host_0'
  AND region = 'aaa'
  AND datacenter = 888888
  AND rack = 8888.88
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
  k_timestamp_b | hostname | first_row | last_row | min | last_row | last_ts
----------------+----------+-----------+----------+-----+----------+----------
(0 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       sum(usage_guest_nice),
       sum(usage_irq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |        sum         |  sum   |          last_ts
----------------------------+----------+--------------------+--------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 3.1415929794311523 | -32768 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 3.1415929794311523 | -65536 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | NULL               |     84 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |                 69 |      1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |                 69 |     -1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL               | NULL   | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   |                 69 |      1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |  70.85840702056885 |  32787 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_1   |                 76 |    128 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | NULL               |     84 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   | NULL               |    -84 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |                 77 |     96 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |                 38 |     63 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |                 76 |     44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |                 76 |     44 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_2   |                 76 |    -44 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |                 83 |    133 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |                 74 |     20 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |                 38 |     63 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |                 38 |     63 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL               | NULL   | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_3   |                 38 |     63 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |                136 |    101 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |                 75 |     72 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |                 74 |     20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_4   |                 74 |     20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |                -15 |    -20 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |                 54 |     20 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |                 83 |    133 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |                  1 |    -52 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL               | NULL   | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_5   |                  1 |     52 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |                 46 |     31 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |                 54 |     20 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |                 82 |     81 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |                 82 |    -81 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_6   |                 82 |     81 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |                 69 |     -1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |                 31 |     11 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |                 69 |      0 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |                 54 |    -20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_7   |                 54 |    -20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |                 69 |     85 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |                 46 |     31 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |                 15 |     20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL               | NULL   | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_8   |                 15 |    -20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |                 76 |    -44 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |                 36 |     84 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |                100 |     12 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |                 31 |     11 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_9   |                 31 |     11 | 2023-05-31 10:00:10+00:00
(62 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       min(usage_nice),
       firstts(usage_user),
       min(usage_guest), first (usage_idle), first (usage_softirq),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |     min     |          firstts          |    min    |    first    |   first    |          last_ts
----------------------------+----------+-------------+---------------------------+-----------+-------------+------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 | 2023-05-31 10:00:00+00:00 |  3.141593 | -2147483648 |  54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 | 2023-05-31 10:00:00+00:00 | -3.141593 | -2147483648 |  54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |          83 | 2023-05-31 10:00:02+00:00 |        43 |         -90 |         26 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |           9 | 2023-05-31 10:00:03+00:00 |        96 |          99 |          2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |           9 | 2023-05-31 10:00:04+00:00 |        96 |          99 |          2 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL        | 2023-05-31 10:00:08+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL        | 2023-05-31 10:00:09+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   |           9 | 2023-05-31 10:00:10+00:00 |        96 |          99 |          2 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |  2147483647 | 2023-05-31 10:00:00+00:00 |  3.141593 | -2147483648 | -54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          28 | 2023-05-31 10:00:02+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |          83 | 2023-05-31 10:00:04+00:00 |        43 |          90 |         26 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL        | 2023-05-31 10:00:08+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   |          83 | 2023-05-31 10:00:10+00:00 |        43 |          90 |         26 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |          28 | 2023-05-31 10:00:00+00:00 |        11 |           5 |         60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |          61 | 2023-05-31 10:00:02+00:00 | NULL      |          24 |          6 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |          28 | 2023-05-31 10:00:03+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |          28 | 2023-05-31 10:00:04+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL        | 2023-05-31 10:00:08+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_2   |          28 | 2023-05-31 10:00:10+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |          63 | 2023-05-31 10:00:00+00:00 |        24 |         -89 |         33 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          87 | 2023-05-31 10:00:02+00:00 |        53 |          53 |         54 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          61 | 2023-05-31 10:00:03+00:00 | NULL      |          24 |          6 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |          61 | 2023-05-31 10:00:04+00:00 | NULL      |          24 |          6 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL        | 2023-05-31 10:00:08+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL        | 2023-05-31 10:00:09+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_3   |          61 | 2023-05-31 10:00:10+00:00 | NULL      |          24 |          6 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |           6 | 2023-05-31 10:00:00+00:00 |        24 |          64 |        -71 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |          63 | 2023-05-31 10:00:02+00:00 |        53 |          -5 |         60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |          87 | 2023-05-31 10:00:04+00:00 |        53 |          53 |         54 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL        | 2023-05-31 10:00:08+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_4   |          87 | 2023-05-31 10:00:10+00:00 |        53 |          53 |         54 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |          -7 | 2023-05-31 10:00:00+00:00 | NULL      |         -63 |        -29 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |           6 | 2023-05-31 10:00:01+00:00 |        40 |          64 |         71 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |         -78 | 2023-05-31 10:00:02+00:00 |        24 |          89 |         33 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |         -63 | 2023-05-31 10:00:04+00:00 |        93 |           5 |         60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL        | 2023-05-31 10:00:08+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL        | 2023-05-31 10:00:09+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_5   |         -63 | 2023-05-31 10:00:10+00:00 |        93 |           5 |         60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |         -67 | 2023-05-31 10:00:00+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |           6 | 2023-05-31 10:00:02+00:00 |        40 |         -64 |         71 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |          78 | 2023-05-31 10:00:03+00:00 |        24 |          89 |         33 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |          78 | 2023-05-31 10:00:04+00:00 |        24 |          89 |         33 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL        | 2023-05-31 10:00:08+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_6   |         -78 | 2023-05-31 10:00:10+00:00 |        24 |          89 |         33 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |           9 | 2023-05-31 10:00:00+00:00 |        96 |          99 |          2 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |          67 | 2023-05-31 10:00:01+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |           6 | 2023-05-31 10:00:02+00:00 |        20 |          63 |         29 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |           6 | 2023-05-31 10:00:04+00:00 |        40 |         -64 |         71 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL        | 2023-05-31 10:00:08+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_7   |           6 | 2023-05-31 10:00:10+00:00 |       -40 |          64 |         71 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |           9 | 2023-05-31 10:00:00+00:00 |        43 |          90 |         26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |           7 | 2023-05-31 10:00:02+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |           7 | 2023-05-31 10:00:04+00:00 |        20 |          63 |         29 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL        | 2023-05-31 10:00:08+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL        | 2023-05-31 10:00:09+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_8   |           7 | 2023-05-31 10:00:10+00:00 |        20 |         -63 |         29 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |          28 | 2023-05-31 10:00:00+00:00 |        11 |          81 |          8 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |          83 | 2023-05-31 10:00:01+00:00 | NULL      |          90 |         26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |          -9 | 2023-05-31 10:00:02+00:00 |         0 |          99 |         -2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |          67 | 2023-05-31 10:00:04+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL        | 2023-05-31 10:00:08+00:00 | NULL      | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_9   |          67 | 2023-05-31 10:00:10+00:00 |         0 |          20 |          7 | 2023-05-31 10:00:10+00:00
(62 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
    last (usage_system), avg (usage_guest), last (usage_idle), first (usage_user),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |    last     |        avg         |    last     |    first    |          last_ts
----------------------------+----------+-------------+--------------------+-------------+-------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 | 3.1415929794311523 | -2147483648 |  2147483647 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 |                  0 |  2147483647 | -2147483648 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |          77 |                 43 |         -90 |          21 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |          35 |                 96 |          99 |          92 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |          35 |                 96 |          99 |          92 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   |          35 |                 96 |          99 |          92 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |  2147483647 | 28.070796489715576 |  2147483647 |          84 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          77 |                 27 |          90 |          90 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |          77 |                 43 |          90 |          21 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   |          77 |                 43 |          90 |          21 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |           0 |                 52 |         -81 |          29 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |          -2 | NULL               |          24 |          58 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |           0 |                 11 |          81 |          90 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |           0 |                 11 |          81 |          90 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_2   |           0 |                 11 |          81 |          90 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |          48 |               58.5 |           5 |           8 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          11 |                 53 |          53 |          84 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |        NULL | NULL               |          24 |          58 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |           2 | NULL               |          24 |  2147483647 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_3   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_3   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_3   |        NULL | NULL               |          24 |          58 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |          21 |                 32 |          89 |           2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |          11 |                 73 |          53 |          29 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |          11 |                 53 |          53 |          84 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_4   |          11 |                 53 |          53 |          84 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |         -40 | NULL               |         -63 |         -76 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |          26 |                 40 |          64 |           2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |          48 |               58.5 |           5 |           8 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |          48 |                 93 |           5 |          29 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_5   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_5   |          48 |                 93 |           5 |          29 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |          40 |                 10 |          63 |          44 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |          26 |                 40 |         -64 |           2 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |          21 |                 24 |          89 |           8 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |          21 |                 24 |          89 |           8 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_6   |          21 |                 24 |          89 |           8 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |          35 |                 96 |          99 |          92 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |          70 |                  0 |          20 |          44 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |          26 |                 30 |          64 |          76 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |          26 |                 40 |         -64 |           2 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_7   |          26 |                -40 |          64 |           2 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |          35 |               69.5 |         -99 |          21 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |          40 |                 10 |          63 |          44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |          40 |                 20 |          63 |          76 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_8   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_8   |          40 |                 20 |         -63 |          76 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |           0 |                 11 |          81 |          90 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |          77 | NULL               |          90 |          21 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |          70 |                 48 |          20 |          92 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |          70 |                  0 |          20 |          44 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_9   |          70 |                  0 |          20 |          44 | 2023-05-31 10:00:10+00:00
(62 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       count(usage_iowait), last (usage_guest_nice), sum (usage_softirq), first_row(usage_user),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts
    LIMIT 1
OFFSET 1;
        k_timestamp_b       | hostname | count |   last   |    sum     |  first_row  |          last_ts
----------------------------+----------+-------+----------+------------+-------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |     2 | 3.141593 | -45.977889 | -2147483648 | 2023-05-31 10:00:01+00:00
(1 row)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       firstts(usage_iowait), last (usage_user), min (usage_steal),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          firstts          |    last    |     min     |          last_ts
----------------------------+----------+---------------------------+------------+-------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 | 2147483647 |   54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 | 2147483647 |   54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:02+00:00 |         21 |          60 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:03+00:00 |         92 |          24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   | 2023-05-31 10:00:04+00:00 |         92 |          24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   | 2023-05-31 10:00:10+00:00 |         92 |          24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | 2023-05-31 10:00:00+00:00 | 2147483647 | -54.1221111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_1   | 2023-05-31 10:00:02+00:00 |         21 |         -89 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | 2023-05-31 10:00:04+00:00 |         21 |          60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   | 2023-05-31 10:00:10+00:00 |         21 |          60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   | 2023-05-31 10:00:00+00:00 |         90 |          89 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:02+00:00 |         58 |          44 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:03+00:00 |         90 |          89 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   | 2023-05-31 10:00:04+00:00 |         90 |         -89 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_2   | 2023-05-31 10:00:10+00:00 |         90 |          89 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:00+00:00 |         29 |          24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:02+00:00 |         84 |          77 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:03+00:00 |         58 |          44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   | 2023-05-31 10:00:04+00:00 | 2147483647 |          44 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_3   | 2023-05-31 10:00:10+00:00 |         58 |          44 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:00:00+00:00 |          8 |          19 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   | 2023-05-31 10:00:02+00:00 |         84 |          49 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   | 2023-05-31 10:00:04+00:00 |         84 |          77 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_4   | 2023-05-31 10:00:10+00:00 |         84 |          77 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:00+00:00 |        -76 |         -55 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:01+00:00 |          2 | NULL        | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   | 2023-05-31 10:00:02+00:00 |         29 |          24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   | 2023-05-31 10:00:04+00:00 |         29 |          49 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_5   | 2023-05-31 10:00:10+00:00 |         29 |          49 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:00:00+00:00 |         76 |         -55 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:02+00:00 |          2 | NULL        | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:03+00:00 |          8 |          24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   | 2023-05-31 10:00:04+00:00 |          8 |          24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_6   | 2023-05-31 10:00:10+00:00 |          8 |          24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:00+00:00 |         92 |          24 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:01+00:00 |         44 |          92 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   | 2023-05-31 10:00:02+00:00 |          2 |          55 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   | 2023-05-31 10:00:04+00:00 |          2 | NULL        | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_7   | 2023-05-31 10:00:10+00:00 |          2 | NULL        | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:00:00+00:00 |         92 |          24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   | 2023-05-31 10:00:02+00:00 |         76 |          55 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   | 2023-05-31 10:00:04+00:00 |         76 |          55 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_8   | 2023-05-31 10:00:10+00:00 |         76 |          55 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:00+00:00 |         90 |         -89 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:01+00:00 |         21 |          60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   | 2023-05-31 10:00:02+00:00 |         44 |          24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   | 2023-05-31 10:00:04+00:00 |         44 |          92 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL                      | 2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_9   | 2023-05-31 10:00:10+00:00 |         44 |         -92 | 2023-05-31 10:00:10+00:00
(62 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       first_row(usage_guest),
       firstts(usage_system),
       lastts(usage_system),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname | first_row |          firstts          |          lastts           |          last_ts
----------------------------+----------+-----------+---------------------------+---------------------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |  3.141593 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   |  3.141593 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |        43 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |        96 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |        96 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   |        96 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |        53 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_1   |        11 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |        43 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   |        43 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |        93 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   | NULL      | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |        11 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |        11 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_2   |        11 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |        24 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |        53 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   | NULL      | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_3   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |        40 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |        93 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |        53 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_4   |        53 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL      | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |        40 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |        24 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |        93 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_5   |        93 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |         0 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |        40 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |        24 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |        24 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_6   |        24 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |        96 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |         0 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |        20 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |        40 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_7   |       -40 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |        43 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |         0 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |        20 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_8   |        20 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |        11 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   | NULL      | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |        96 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |         0 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_9   |         0 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
(62 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
    first (usage_steal), count (usage_system), firstts(usage_steal), lastts(usage_steal), first_row(usage_steal),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |   first    | count |          firstts          |          lastts           | first_row  |          last_ts
----------------------------+----------+------------+-------+---------------------------+---------------------------+------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |  54.122111 |     1 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |  54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   |  54.122111 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 |  54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |         60 |     1 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         60 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |         24 |     1 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |         24 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   |         24 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | -54.122111 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 | -54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_1   |        -89 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 |        -89 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |         60 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   |         60 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |         89 |     2 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 | NULL       | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |         44 |     1 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         44 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |         89 |     1 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         89 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |        -89 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        -89 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_2   |         89 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         89 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |         24 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 |         24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |         77 |     1 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         77 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |         44 |     0 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |         44 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         44 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_3   |         44 |     0 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         44 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |         19 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 |         19 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |         49 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 |         49 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |         77 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         77 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_4   |         77 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         77 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |        -55 |     1 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |        -55 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL       |     1 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |         24 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 |         24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |         49 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         49 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_5   |         49 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         49 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |         92 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 |         92 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   | NULL       |     1 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |         24 |     1 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |         24 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_6   |         24 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |         24 |     1 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |         24 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |         92 |     1 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |         92 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |         55 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         55 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   | NULL       |     1 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_7   | NULL       |     1 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |         60 |     2 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00 |         60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |         92 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 |         92 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |         55 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         55 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_8   |         55 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         55 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |        -89 |     1 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |        -89 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |         60 |     1 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |         60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |         24 |     2 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00 |         24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |         92 |     1 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         92 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_9   |        -92 |     1 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        -92 | 2023-05-31 10:00:10+00:00
(62 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
    first (usage_guest_nice), last (usage_guest), first (usage_iowait), firstts(usage_guest),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |  first   |   last    | first  |          firstts          |          last_ts
----------------------------+----------+----------+-----------+--------+---------------------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 3.141593 |  3.141593 | -32768 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 3.141593 | -3.141593 | -32768 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | NULL     |        43 |     41 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |       69 |        96 |     31 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |       69 |        96 |     31 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   |       69 |        96 |    -31 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |       74 |  3.141593 |     29 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_1   |       76 |        43 |     25 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | NULL     |        43 |     41 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   | NULL     |        43 |     41 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |        1 |        11 |    -17 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |       38 | NULL      |     22 | NULL                      | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |       76 |        11 |     25 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |       76 |        11 |     25 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_2   |       76 |        11 |     25 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |       82 |        93 |     30 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |       74 |        53 |     29 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |       38 | NULL      |     22 | NULL                      | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |       38 | NULL      |     22 | NULL                      | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_3   |       38 | NULL      |     22 | NULL                      | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |       54 |        24 |     38 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |        1 |        53 |    -17 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |       74 |        53 |     29 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_4   |       74 |        53 |     29 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |      -15 | NULL      |    -81 | NULL                      | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |       54 |        40 |     38 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |       82 |        93 |     30 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |        1 |        93 |     17 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_5   |        1 |        93 |     17 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |       31 |        20 |     65 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |       54 |        40 |    -38 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |       82 |        24 |     30 | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |       82 |        24 |     30 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_6   |       82 |        24 |     30 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |       69 |        96 |     31 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |       31 |         0 |     65 | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |       15 |        40 |     81 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |       54 |        40 |     38 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_7   |       54 |       -40 |     38 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |       69 |        96 |     41 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |       31 |        20 |     65 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |       15 |        20 |     81 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_8   |       15 |        20 |     81 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |       76 |        11 |     25 | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |       36 | NULL      |     41 | NULL                      | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |       69 |         0 |     31 | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |       31 |         0 |     65 | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL     | NULL      | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_9   |       31 |         0 |     65 | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00
(62 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       lastts(usage_user),
       firstts(usage_guest_nice), last (usage_softirq), last_row(usage_softirq),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          lastts           |          firstts          |   last    | last_row  |          last_ts
----------------------------+----------+---------------------------+---------------------------+-----------+-----------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 | 54.122111 | 54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |    -100.1 |    -100.1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:02+00:00 | NULL                      |        26 |        26 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         2 |         2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         2 |         2 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | 2023-05-31 10:00:08+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         2 |         2 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 | 54.122111 | 54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_1   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |        26 |        26 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | 2023-05-31 10:00:04+00:00 | NULL                      |        26 |        26 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   | 2023-05-31 10:00:10+00:00 | NULL                      |        26 |        26 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |         8 |         8 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |         6 |         6 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         8 |         8 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         8 |         8 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_2   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         8 |         8 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |        60 |        60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |        54 |        54 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |         6 |         6 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         6 |         6 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_3   | 2023-05-31 10:00:08+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_3   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_3   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         6 |         6 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |        33 |        33 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |        54 |        54 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        54 |        54 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_4   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        54 |        54 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |       -29 |       -29 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |        71 |        71 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |        60 |        60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        60 |        60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | 2023-05-31 10:00:08+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_5   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_5   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        60 |        60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:00+00:00 |        29 |        29 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:02+00:00 | 2023-05-31 10:00:02+00:00 |        71 |        71 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:03+00:00 |        33 |        33 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        33 |        33 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_6   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        33 |        33 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |         2 |         2 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |         7 |         7 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |        71 |        71 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        71 |        71 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_7   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        71 |        71 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |         2 |         2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |        29 |        29 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |        29 |        29 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | 2023-05-31 10:00:08+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_8   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_8   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |        29 |        29 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:00+00:00 | 2023-05-31 10:00:00+00:00 |         8 |         8 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:01+00:00 | 2023-05-31 10:00:01+00:00 |        26 |        26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   | 2023-05-31 10:00:03+00:00 | 2023-05-31 10:00:02+00:00 |        -7 |        -7 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   | 2023-05-31 10:00:04+00:00 | 2023-05-31 10:00:04+00:00 |         7 |         7 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_9   | 2023-05-31 10:00:10+00:00 | 2023-05-31 10:00:10+00:00 |         7 |         7 | 2023-05-31 10:00:10+00:00
(62 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       firstts(usage_idle),
       first_row(usage_guest_nice),
       avg(usage_user),
       count(usage_softirq),
       count(usage_steal),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          firstts          | first_row |     avg      | count | count |          last_ts
----------------------------+----------+---------------------------+-----------+--------------+-------+-------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 |  3.141593 |   2147483647 |     1 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:00+00:00 |  3.141593 |         -0.5 |     2 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:02+00:00 | NULL      |           21 |     1 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   | 2023-05-31 10:00:03+00:00 |        69 |           92 |     1 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   | 2023-05-31 10:00:04+00:00 |        69 |           92 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   | 2023-05-31 10:00:10+00:00 |        69 |           92 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | 2023-05-31 10:00:00+00:00 |        74 | 1073741865.5 |     2 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_1   | 2023-05-31 10:00:02+00:00 |        76 |         55.5 |     2 |     2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | 2023-05-31 10:00:04+00:00 | NULL      |           21 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   | 2023-05-31 10:00:10+00:00 | NULL      |           21 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   | 2023-05-31 10:00:00+00:00 |         1 |         59.5 |     2 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:02+00:00 |        38 |           58 |     1 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   | 2023-05-31 10:00:03+00:00 |        76 |           90 |     1 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   | 2023-05-31 10:00:04+00:00 |        76 |           90 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_2   | 2023-05-31 10:00:10+00:00 |        76 |           90 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:00+00:00 |        82 |         18.5 |     2 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:02+00:00 |        74 |           84 |     1 |     1 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   | 2023-05-31 10:00:03+00:00 |        38 |           58 |     1 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   | 2023-05-31 10:00:04+00:00 |        38 |   2147483647 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_3   | 2023-05-31 10:00:10+00:00 |        38 |           58 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:00:00+00:00 |        54 |            5 |     2 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   | 2023-05-31 10:00:02+00:00 |         1 |         56.5 |     2 |     2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   | 2023-05-31 10:00:04+00:00 |        74 |           84 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_4   | 2023-05-31 10:00:10+00:00 |        74 |           84 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:00+00:00 |       -15 |          -76 |     1 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:01+00:00 |        54 |            2 |     1 |     0 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   | 2023-05-31 10:00:02+00:00 |        82 |         18.5 |     2 |     2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   | 2023-05-31 10:00:04+00:00 |         1 |           29 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_5   | 2023-05-31 10:00:10+00:00 |         1 |           29 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:00:00+00:00 |        31 |           60 |     2 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:02+00:00 |        54 |            2 |     1 |     0 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   | 2023-05-31 10:00:03+00:00 |        82 |            8 |     1 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   | 2023-05-31 10:00:04+00:00 |        82 |            8 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_6   | 2023-05-31 10:00:10+00:00 |        82 |            8 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:00+00:00 |        69 |           92 |     1 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:00:01+00:00 |        31 |           44 |     1 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   | 2023-05-31 10:00:02+00:00 |        15 |           39 |     2 |     1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   | 2023-05-31 10:00:04+00:00 |        54 |            2 |     1 |     0 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_7   | 2023-05-31 10:00:10+00:00 |        54 |            2 |     1 |     0 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:00:00+00:00 | NULL      |         56.5 |     2 |     2 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   | 2023-05-31 10:00:02+00:00 |        31 |           60 |     2 |     2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   | 2023-05-31 10:00:04+00:00 |        15 |           76 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_8   | 2023-05-31 10:00:10+00:00 |        15 |           76 |     1 |     1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:00+00:00 |        76 |           90 |     1 |     1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:01+00:00 |        36 |           21 |     1 |     1 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   | 2023-05-31 10:00:02+00:00 |        69 |           68 |     2 |     2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   | 2023-05-31 10:00:04+00:00 |        31 |           44 |     1 |     1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL                      | NULL      |   2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_9   | 2023-05-31 10:00:10+00:00 |        31 |           44 |     1 |     1 | 2023-05-31 10:00:10+00:00
(62 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       max(usage_nice), first (usage_system), avg (usage_idle), last (usage_irq), first (usage_irq),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |     max     |    first    |     avg     |  last  | first  |          last_ts
----------------------------+----------+-------------+-------------+-------------+--------+--------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 | -2147483648 | -2147483648 | -32768 | -32768 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | -2147483648 | -2147483648 |        -0.5 | -32768 | -32768 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   |          83 |          77 |         -90 |     84 |     84 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |           9 |          35 |          99 |      1 |      1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |           9 |          35 |          99 |     -1 |     -1 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   |           9 |          35 |          99 |      1 |      1 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |  2147483647 |  2147483647 |        -0.5 |  32767 |     20 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_1   |          83 |           0 |        85.5 |     84 |     44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   |          83 |          77 |          90 |     84 |     84 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   |          83 |          77 |          90 |    -84 |    -84 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |          63 |          48 |         -38 |     44 |     52 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |          61 |          -2 |          24 |     63 |     63 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |          28 |           0 |          81 |     44 |     44 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |          28 |           0 |          81 |     44 |     44 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_2   |          28 |           0 |          81 |    -44 |    -44 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |          78 |          21 |         -42 |     52 |     81 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          87 |          11 |          53 |     20 |     20 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |          61 |        NULL |          24 |     63 |     63 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |          61 |           2 |          24 |     63 |     63 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_3   |          61 |        NULL |          24 |     63 |     63 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |          78 |          26 |        76.5 |     81 |     20 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |          87 |          48 |          24 |     20 |     52 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |          87 |          11 |          53 |     20 |     20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_4   |          87 |          11 |          53 |     20 |     20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |          -7 |         -40 |         -63 |    -20 |    -20 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |           6 |          26 |          64 |     20 |     20 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |          63 |          21 |          47 |     52 |     81 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |         -63 |          48 |           5 |    -52 |    -52 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_5   |         -63 |          48 |           5 |     52 |     52 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |           7 |          70 |        41.5 |     20 |     11 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |           6 |          26 |         -64 |     20 |     20 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |          78 |          21 |          89 |     81 |     81 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |          78 |          21 |          89 |    -81 |    -81 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_6   |         -78 |          21 |          89 |     81 |     81 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |           9 |          35 |          99 |     -1 |     -1 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |          67 |          70 |          20 |     11 |     11 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |           7 |          40 |        63.5 |    -20 |     20 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |           6 |          26 |         -64 |    -20 |    -20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_7   |           6 |          26 |          64 |    -20 |    -20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |          83 |          77 |        -4.5 |      1 |     84 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |          67 |          70 |        41.5 |     20 |     11 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |           7 |          40 |          63 |     20 |     20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_8   |           7 |          40 |         -63 |    -20 |    -20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |          28 |           0 |          81 |    -44 |    -44 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |          83 |          77 |          90 |     84 |     84 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |          67 |          35 |        59.5 |     11 |      1 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |          67 |          70 |          20 |     11 |     11 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_9   |          67 |          70 |          20 |     11 |     11 | 2023-05-31 10:00:10+00:00
(62 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       max(usage_guest_nice),
       lastts(usage_idle),
       max(usage_guest),
       avg(usage_nice), first (usage_guest),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |   max    |          lastts           |   max    |     avg     |  first   |          last_ts
----------------------------+----------+----------+---------------------------+----------+-------------+----------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 3.141593 | 2023-05-31 10:00:00+00:00 | 3.141593 | -2147483648 | 3.141593 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 3.141593 | 2023-05-31 10:00:01+00:00 | 3.141593 | -2147483648 | 3.141593 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | NULL     | 2023-05-31 10:00:02+00:00 |       43 |          83 |       43 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |       69 | 2023-05-31 10:00:03+00:00 |       96 |           9 |       96 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |       69 | 2023-05-31 10:00:04+00:00 |       96 |           9 |       96 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   |       69 | 2023-05-31 10:00:10+00:00 |       96 |           9 |       96 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   |       74 | 2023-05-31 10:00:01+00:00 |       53 |  2147483647 |       53 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_1   |       76 | 2023-05-31 10:00:03+00:00 |       43 |        55.5 |       11 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | NULL     | 2023-05-31 10:00:04+00:00 |       43 |          83 |       43 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   | NULL     | 2023-05-31 10:00:10+00:00 |       43 |          83 |       43 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |       76 | 2023-05-31 10:00:01+00:00 |       93 |        45.5 |       93 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |       38 | 2023-05-31 10:00:02+00:00 | NULL     |          61 | NULL     | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |       76 | 2023-05-31 10:00:03+00:00 |       11 |          28 |       11 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |       76 | 2023-05-31 10:00:04+00:00 |       11 |          28 |       11 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_2   |       76 | 2023-05-31 10:00:10+00:00 |       11 |          28 |       11 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |       82 | 2023-05-31 10:00:01+00:00 |       93 |        70.5 |       24 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |       74 | 2023-05-31 10:00:02+00:00 |       53 |          87 |       53 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |       38 | 2023-05-31 10:00:03+00:00 | NULL     |          61 | NULL     | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |       38 | 2023-05-31 10:00:04+00:00 | NULL     |          61 | NULL     | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_3   |       38 | 2023-05-31 10:00:10+00:00 | NULL     |          61 | NULL     | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |       82 | 2023-05-31 10:00:01+00:00 |       40 |          42 |       40 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |       74 | 2023-05-31 10:00:03+00:00 |       93 |          75 |       93 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |       74 | 2023-05-31 10:00:04+00:00 |       53 |          87 |       53 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_4   |       74 | 2023-05-31 10:00:10+00:00 |       53 |          87 |       53 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |      -15 | 2023-05-31 10:00:00+00:00 | NULL     |          -7 | NULL     | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |       54 | 2023-05-31 10:00:01+00:00 |       40 |           6 |       40 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |       82 | 2023-05-31 10:00:03+00:00 |       93 |        -7.5 |       24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |        1 | 2023-05-31 10:00:04+00:00 |       93 |         -63 |       93 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_5   |        1 | 2023-05-31 10:00:10+00:00 |       93 |         -63 |       93 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |       31 | 2023-05-31 10:00:01+00:00 |       20 |         -30 |        0 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |       54 | 2023-05-31 10:00:02+00:00 |       40 |           6 |       40 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |       82 | 2023-05-31 10:00:03+00:00 |       24 |          78 |       24 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |       82 | 2023-05-31 10:00:04+00:00 |       24 |          78 |       24 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_6   |       82 | 2023-05-31 10:00:10+00:00 |       24 |         -78 |       24 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |       69 | 2023-05-31 10:00:00+00:00 |       96 |           9 |       96 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |       31 | 2023-05-31 10:00:01+00:00 |        0 |          67 |        0 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |       54 | 2023-05-31 10:00:03+00:00 |       40 |         6.5 |       20 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |       54 | 2023-05-31 10:00:04+00:00 |       40 |           6 |       40 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_7   |       54 | 2023-05-31 10:00:10+00:00 |      -40 |           6 |      -40 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |       69 | 2023-05-31 10:00:01+00:00 |       96 |          46 |       43 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |       31 | 2023-05-31 10:00:03+00:00 |       20 |          37 |        0 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |       15 | 2023-05-31 10:00:04+00:00 |       20 |           7 |       20 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_8   |       15 | 2023-05-31 10:00:10+00:00 |       20 |           7 |       20 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |       76 | 2023-05-31 10:00:00+00:00 |       11 |          28 |       11 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |       36 | 2023-05-31 10:00:01+00:00 | NULL     |          83 | NULL     | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |       69 | 2023-05-31 10:00:03+00:00 |       96 |          29 |       96 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |       31 | 2023-05-31 10:00:04+00:00 |        0 |          67 |        0 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_9   |       31 | 2023-05-31 10:00:10+00:00 |        0 |          67 |        0 | 2023-05-31 10:00:10+00:00
(62 rows)
> SELECT time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       min(usage_guest_nice),
       max(usage_softirq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |    min    |    max    |          last_ts
----------------------------+----------+-----------+-----------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   |  3.141593 | 54.122111 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_0   |  3.141593 | 54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_0   | NULL      |        26 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_0   |        69 |         2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_0   |        69 |         2 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL      | NULL      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_0   |        69 |         2 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_1   | -3.141593 | 54.122111 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_1   |        76 |        26 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_1   | NULL      |        26 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_1   | NULL      |        26 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_2   |         1 |        60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_2   |        38 |         6 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_2   |        76 |         8 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_2   |        76 |         8 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_2   |        76 |         8 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_3   |         1 |        60 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_3   |        74 |        54 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_3   |        38 |         6 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_3   |        38 |         6 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL      | NULL      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_3   |        38 |         6 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_4   |        54 |        33 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_4   |         1 |        60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_4   |        74 |        54 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_4   |        74 |        54 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_5   |       -15 |       -29 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   |        54 |        71 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_5   |         1 |        60 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_5   |         1 |        60 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL      | NULL      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_5   |         1 |        60 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_6   |        15 |        29 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_6   |        54 |        71 | 2023-05-31 10:00:02+00:00
  2023-05-31 10:00:02+00:00 | host_6   |        82 |        33 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_6   |        82 |        33 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_6   |        82 |        33 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_7   |        69 |         2 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_7   |        31 |         7 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_7   |        15 |        71 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_7   |        54 |        71 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_7   |        54 |        71 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   |        69 |        26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_8   |        15 |        29 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_8   |        15 |        29 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL      | NULL      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_8   |        15 |        29 | 2023-05-31 10:00:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   |        76 |         8 | 2023-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_9   |        36 |        26 | 2023-05-31 10:00:01+00:00
  2023-05-31 10:00:02+00:00 | host_9   |        31 |        -2 | 2023-05-31 10:00:03+00:00
  2023-05-31 10:00:04+00:00 | host_9   |        31 |         7 | 2023-05-31 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL      | NULL      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:10+00:00 | host_9   |        31 |         7 | 2023-05-31 10:00:10+00:00
(62 rows)
> SELECT count(usage_irq),
       time_bucket(k_timestamp, '2s') as k_timestamp_b,
       hostname,
       avg(usage_softirq),
       first_row(usage_softirq),
       first_row(usage_nice), last (usage_iowait),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '2023-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, k_timestamp_b, last_ts;
  count |       k_timestamp_b       | hostname |     avg     | first_row  |  first_row  |  last  |          last_ts
--------+---------------------------+----------+-------------+------------+-------------+--------+----------------------------
      1 | 2023-05-31 10:00:00+00:00 | host_0   |   54.122111 |  54.122111 | -2147483648 | -32768 | 2023-05-31 10:00:00+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_0   | -22.9889445 |  54.122111 | -2147483648 |  32767 | 2023-05-31 10:00:01+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_0   |          26 |         26 |          83 |     41 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_0   |           2 |          2 |           9 |     31 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_0   |           2 |          2 |           9 |     31 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_0   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:08+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_0   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      1 | 2023-05-31 10:00:10+00:00 | host_0   |           2 |          2 |           9 |    -31 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_1   |           0 | -54.122111 |  2147483647 |  32767 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_1   |          17 |          8 |          28 |     41 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_1   |          26 |         26 |          83 |     41 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_1   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      1 | 2023-05-31 10:00:10+00:00 | host_1   |          26 |         26 |          83 |     41 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_2   |          34 |         60 |          63 |     25 | 2023-05-31 10:00:01+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_2   |           6 |          6 |          61 |     22 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_2   |           8 |          8 |          28 |     25 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_2   |           8 |          8 |          28 |     25 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_2   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      1 | 2023-05-31 10:00:10+00:00 | host_2   |           8 |          8 |          28 |     25 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_3   |        46.5 |         33 |          78 |     17 | 2023-05-31 10:00:01+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_3   |          54 |         54 |          87 |     29 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_3   |           6 |          6 |          61 |     22 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_3   |           6 |          6 |          61 |     22 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_3   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:08+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_3   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      1 | 2023-05-31 10:00:10+00:00 | host_3   |           6 |          6 |          61 |     22 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_4   |         -19 |        -71 |           6 |     30 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_4   |          57 |         60 |          63 |     29 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_4   |          54 |         54 |          87 |     29 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_4   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      1 | 2023-05-31 10:00:10+00:00 | host_4   |          54 |         54 |          87 |     29 | 2023-05-31 10:00:10+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_5   |         -29 |        -29 |          -7 |    -81 | 2023-05-31 10:00:00+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_5   |          71 |         71 |           6 |     38 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_5   |        46.5 |         33 |         -78 |     17 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_5   |          60 |         60 |         -63 |     17 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_5   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:08+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_5   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      1 | 2023-05-31 10:00:10+00:00 | host_5   |          60 |         60 |         -63 |     17 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_6   |          18 |          7 |         -67 |     81 | 2023-05-31 10:00:01+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_6   |          71 |         71 |           6 |    -38 | 2023-05-31 10:00:02+00:00
      1 | 2023-05-31 10:00:02+00:00 | host_6   |          33 |         33 |          78 |     30 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_6   |          33 |         33 |          78 |     30 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_6   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      1 | 2023-05-31 10:00:10+00:00 | host_6   |          33 |         33 |         -78 |     30 | 2023-05-31 10:00:10+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_7   |           2 |          2 |           9 |     31 | 2023-05-31 10:00:00+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_7   |           7 |          7 |          67 |     65 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_7   |          50 |         29 |           7 |     38 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_7   |          71 |         71 |           6 |     38 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_7   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      1 | 2023-05-31 10:00:10+00:00 | host_7   |          71 |         71 |           6 |     38 | 2023-05-31 10:00:10+00:00
      2 | 2023-05-31 10:00:00+00:00 | host_8   |          14 |         26 |          83 |     31 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_8   |          18 |          7 |          67 |     81 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_8   |          29 |         29 |           7 |     81 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_8   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:08+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_8   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      1 | 2023-05-31 10:00:10+00:00 | host_8   |          29 |         29 |           7 |     81 | 2023-05-31 10:00:10+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_9   |           8 |          8 |          28 |     25 | 2023-05-31 10:00:00+00:00
      1 | 2023-05-31 10:00:00+00:00 | host_9   |          26 |         26 |          83 |     41 | 2023-05-31 10:00:01+00:00
      2 | 2023-05-31 10:00:02+00:00 | host_9   |        -4.5 |         -2 |          -9 |     65 | 2023-05-31 10:00:03+00:00
      1 | 2023-05-31 10:00:04+00:00 | host_9   |           7 |          7 |          67 |     65 | 2023-05-31 10:00:04+00:00
      0 | 2023-05-31 10:00:08+00:00 | host_9   | NULL        | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      1 | 2023-05-31 10:00:10+00:00 | host_9   |           7 |          7 |          67 |     65 | 2023-05-31 10:00:10+00:00
(62 rows)
> drop database test cascade;
DROP DATABASE
> drop database test_last cascade;
ERROR: database "test_last" does not exist
SQLSTATE: 3D000
> create ts database test_last;
CREATE TS DATABASE
> create table test_last.tb (k_timestamp timestamp not null,e1 timestamp,e2 int2,e3 int,e4 int8,e5 float,e6 float8,e7 bool,e8 char,e9 char(1023),e10 nchar,e11 nchar(255),e12 varchar,e13 varchar(255),e14 varchar(4096),e15 nvarchar,e16 nvarchar(255),e17 nvarchar(4096),e18 varbytes,e19 varbytes(1023),e20 varbytes,e21 varbytes(254),e22 varbytes(4096)) tags (att1 int2 not null,att2 int,att3 int8,att4 bool,att5 float4,att6 float8,att7 varchar,att8 varchar(64)) primary tags (att1);
CREATE TABLE
> create table test_last.stb (k_timestamp timestamp not null,e1 timestamp,e2 int2,e3 int,e4 int8,e5 float,e6 float8,e7 bool,e8 char,e9 char(1023),e10 nchar,e11 nchar(255),e12 varchar,e13 varchar(255),e14 varchar(4096),e15 nvarchar,e16 nvarchar(255),e17 nvarchar(4096),e18 varbytes,e19 varbytes(1023),e20 varbytes,e21 varbytes(254),e22 varbytes(4096)) tags (name varchar(10) not null, att1 int2,att2 int,att3 int8,att4 bool,att5 float4,att6 float8,att7 varchar,att8 varchar(3000),att9 char(1000),att10 varbytes(10),att11 varbytes(100)) primary tags (name);
CREATE TABLE
> insert into test_last.tb values('2023-05-15 09:10:11.123',111111110000,100,10000,100000,1000000.101,100000000.1010111,true,
                                '','','','','','','','','','','','','','','', 1, 2, 3, true, 1.1, 1.2, '', '');
INSERT 1
> insert into test_last.tb values('2023-05-15 09:10:14.678',111111110011,400,40000,400000,4000000.404,400000000.4040444,false,
                                'c','char1','n','nchar255定长类型^&@#nchar255定长类型^&@#nchar255定长类型^&@#',
                                'varchar_11','varchar255测试cdf~#varchar255测试cdf~#','varcharlengthis4096_0字符类型测试%%&!+varcharlengthis4096字符类型测试%%&!+',
                                'nvarchar-0','nvarchar255()&^%{}','nvarchar4096中英文测试0中英文测试0中英文测试0()&^%{}nvarchar4096中英文测试0中英文测试0中英文测试0()&^%{}',
                                'b','bytes1023','varbytes_1',b'\xaa\xbb\xcc',b'\xaa\xaa\xaa\xbb\xbb\xbb\xcc\xcc\xcc\xdd\xdd\xdd', 1, 2, 3, true, 1.1, 1.2, '', '');
INSERT 1
> insert into test_last.tb values('2023-05-15 09:10:12.345', 111111110022, 200, 20000, 200000, 2000000.202, 200000000.2020222, true,
                                'h', 'char2', 'c', 'nchar255_1定长类型测试1测试2测试3()&^%{}nchar255定长类型测试1测试2测试3()&^%{}',
                                'varchar_22', 'varchar255中文测试abc!<>&^%$varchar255中文测试abc!<>&^%$', 'varcharlengthis4096字符类型测试%%&!+varcharlengthis4096字符类型测试%%&!+',
                                'nvarchar-1', 'nvarchar255nvarchar255()&^%{}','nvarchar4096_1中英文测试1中英文测试1中英文测试1()&^%{}nvarchar4096_1中英文测试1中英文测试1中英文测试1()&^%{}',
                                'y', b'bytes', 'varbytes_2', b'\xdd\xee\xff', b'\xee\xee\xee\xff\xff\xff\xee\xee\xee\xff\xff\xff', 1, 2, 3, true, 1.1, 1.2, '', '');
INSERT 1
> insert into test_last.tb values('2023-07-10 20:18:43.145', 111111110044, 300, 30000, 300000, 3000000.303, 300000000.3030333, false,
                                'r', 'char3', 'a', 'nchar255_0定长类型测试1测试2测试3()&^%{}nchar255定长类型测试1测试2测试3()&^%{}',
                                'varchar_44', 'varchar255_中文测试abc!<>&^%$varchar255_中文测试abc!<>&^%$', 'varcharlengthof4096通用查询test%%&!+varcharlengthof4096通用查询test%%&!+',
                                'nvarchar-2', 'nvarchar255()&^%{}', 'nvarchar4096中英文测试1中英文测试1中英文测试1()&^%{}nvarchar4096中英文测试1中英文测试1中英文测试1()&^%{}',
                                'e', b'byte12', 'varbytes_3', b'\xbb\xcc\xff', 'varbytes4096$%^varbytes4096$%^varbytes4096$%^', 1, 2, 3, true, 1.1, 1.2, '', '');
INSERT 1
> insert into test_last.tb values('2023-07-10 20:18:41.456', 111111110033, 700, 70000, 700000, 7000000.707, 700000000.7070777, true,
                                'a', 'char4', 'h', 'nchar255定长类型测试1测试2测试3()&^%{}nchar255定长类型测试1测试2测试3()&^%{}',
                                'varchar_33', 'varchar255_123456中文测试abc!<>&^%$varchar255_123456中文测试abc!<>&^%$', 'varcharlengthof4096字符类型test%%&!+varcharlengthof4096字符类型test%%&!+',
                                'nvarchar-3', 'nvarchar255_+!@#nvarchar255_+!@#', 'nvarchar4096_2中英文测试2中英文测试2中英文测试2()&^%{}nvarchar4096_2中英文测试2中英文测试2中英文测试2()&^%{}',
                                't', b'bytes', 'varbytes_2', b'\xaa\xdd\xee', b'\xaa\xaa\xaa\xbb\xbb\xbb\xcc\xcc\xcc\xee\xee\xee', 1, 2, 3, true, 1.1, 1.2, '', '');
INSERT 1
> insert into test_last.stb values('2023-05-15 09:10:11.123',111111110000,100,10000,100000,1000000.101,100000000.1010111,true,
                                 '','','','','','','','','','','','','','','','stb_1',null,null,null,null,null,null,null,'beijing',null,'red',null);
INSERT 1
> insert into test_last.stb values('2023-05-15 09:10:14.678', 111111110022, 200, 20000, 200000, 2000000.202, 200000000.2020222, true,
                                 'h', 'char2', 'c', 'nchar255定长类型测试1测试2测试3()&^%{}nchar255定长类型测试1测试2测试3()&^%{}',
                                 'varchar_22', 'varchar255中文测试abc!<>&^%$varchar255中文测试abc!<>&^%$', 'varcharlengthis4096字符类型测试%%&!+varcharlengthis4096字符类型测试%%&!+',
                                 'nvarchar-1', 'nvarchar255nvarchar255()&^%{}','nvarchar4096_1中英文测试1中英文测试1中英文测试1()&^%{}nvarchar4096_1中英文测试1中英文测试1中英文测试1()&^%{}',
                                 'y', b'bytes', 'varbytes_2', b'\xdd\xee\xff', b'\xee\xee\xee\xff\xff\xff\xee\xee\xee\xff\xff\xff','stb_1',null,null,null,null,null,null,null,'beijing',null,'red',null);
INSERT 1
> insert into test_last.stb values('2023-05-15 09:10:12.345',111111110011,100,10000,100000,1000000.101,100000000.1010111,false,
                                 'c','char1','n','nchar255定长类型^&@#nchar255定长类型^&@#nchar255定长类型^&@#',
                                 'varchar_11','varchar255测试cdf~#varchar255测试cdf~#','varcharlengthis4096字符类型测试%%&!+varcharlengthis4096字符类型测试%%&!+',
                                 'nvarchar-0','nvarchar255()&^%{}','nvarchar4096中英文测试0中英文测试0中英文测试0()&^%{}nvarchar4096中英文测试0中英文测试0中英文测试0()&^%{}',
                                 'b','bytes1023','varbytes_1',b'\xaa\xbb\xcc',b'\xaa\xaa\xaa\xbb\xbb\xbb\xcc\xcc\xcc\xdd\xdd\xdd','stb_1',null,null,null,null,null,null,null,'beijing',null,'red',null);
INSERT 1
> insert into test_last.stb values('2023-07-10 20:18:43.446', 111111110044, 300, 30000, 300000, 3000000.303, 300000000.3030333, false,
                                 'r', 'char3', 'a', 'nchar255定长类型测试1测试2测试3()&^%{}nchar255定长类型测试1测试2测试3()&^%{}',
                                 'varchar_44', 'varchar255_中文测试abc!<>&^%$varchar255_中文测试abc!<>&^%$', 'varcharlengthof4096通用查询test%%&!+varcharlengthof4096通用查询test%%&!+',
                                 'nvarchar-2', 'nvarchar255()&^%{}', 'nvarchar4096中英文测试1中英文测试1中英文测试1()&^%{}nvarchar4096中英文测试1中英文测试1中英文测试1()&^%{}',
                                 'e', b'byte12', 'varbytes_3', b'\xbb\xcc\xff', 'varbytes4096$%^varbytes4096$%^varbytes4096$%^','stb_1',null,null,null,null,null,null,null,'beijing',null,'red',null);
INSERT 1
> insert into test_last.stb values('2023-07-10 20:18:43.145', 111111110033, 700, 70000, 700000, 7000000.707, 700000000.7070777, true,
                                 'a', 'char4', 'h', 'nchar255定长类型测试1测试2测试3()&^%{}nchar255定长类型测试1测试2测试3()&^%{}',
                                 'varchar_33', 'varchar255_123456中文测试abc!<>&^%$varchar255_123456中文测试abc!<>&^%$', 'varcharlengthof4096字符类型test%%&!+varcharlengthof4096字符类型test%%&!+',
                                 'nvarchar-3', 'nvarchar255_+!@#nvarchar255_+!@#', 'nvarchar4096_2中英文测试2中英文测试2中英文测试2()&^%{}nvarchar4096_2中英文测试2中英文测试2中英文测试2()&^%{}',
                                 't', b'bytes', 'varbytes_2', b'\xaa\xdd\xee', b'\xaa\xaa\xaa\xbb\xbb\xbb\xcc\xcc\xcc\xdd\xdd\xdd','stb_1',null,null,null,null,null,null,null,'beijing',null,'red',null);
INSERT 1
> insert into test_last.stb values('2022-06-16 10:18:30.123',111111110011,100,10000,100000,1000000.101,100000000.1010111,false,
                                 'c','char1','n','nchar255定长类型^&@#nchar255定长类型^&@#nchar255定长类型^&@#',
                                 'varchar_11','varchar255测试cdf~#varchar255测试cdf~#','varcharlengthis4096字符类型测试%%&!+varcharlengthis4096字符类型测试%%&!+',
                                 'nvarchar-0','nvarchar255()&^%{}','nvarchar4096中英文测试0中英文测试0中英文测试0()&^%{}nvarchar4096中英文测试0中英文测试0中英文测试0()&^%{}',
                                 'b','bytes1023','varbytes_1',b'\xaa\xbb\xcc',b'\xaa\xaa\xaa\xbb\xbb\xbb\xcc\xcc\xcc\xdd\xdd\xdd','stb_2',null,null,null,null,null,null,null,'shanghai',null,'blue',null);
INSERT 1
> insert into test_last.stb values('2022-06-16 10:18:35.981', 111111110022, 200, 20000, 200000, 2000000.202, 200000000.2020222, true,
                                 'h', 'char2', 'c', 'nchar255定长类型测试1测试2测试3()&^%{}nchar255定长类型测试1测试2测试3()&^%{}',
                                 'varchar_22', 'varchar255中文测试abc!<>&^%$varchar255中文测试abc!<>&^%$', 'varcharlengthis4096字符类型测试%%&!+varcharlengthis4096字符类型测试%%&!+',
                                 'nvarchar-1', 'nvarchar255nvarchar255()&^%{}','nvarchar4096_1中英文测试1中英文测试1中英文测试1()&^%{}nvarchar4096_1中英文测试1中英文测试1中英文测试1()&^%{}',
                                 'y', b'bytes', 'varbytes_2', b'\xdd\xee\xff', b'\xee\xee\xee\xff\xff\xff\xee\xee\xee\xff\xff\xff','stb_2',null,null,null,null,null,null,null,'shanghai',null,'blue',null);
INSERT 1
> insert into test_last.stb values('2023-02-10 12:05:51.445',111111110000,100,10000,100000,1000000.101,100000000.1010111,true,
                                 '','','','','','','','','','','','','','','','stb_3',null,null,null,null,null,null,null,'shanghai',null,'blue',null);
INSERT 1
> insert into test_last.stb values('2023-02-10 12:05:52.556', 111111110033, 700, 70000, 700000, 7000000.707, 700000000.7070777, true,
                                 'a', 'char4', 'h', 'nchar255定长类型测试1测试2测试3()&^%{}nchar255定长类型测试1测试2测试3()&^%{}',
                                 'varchar_33', 'varchar255_123456中文测试abc!<>&^%$varchar255_123456中文测试abc!<>&^%$', 'varcharlengthof4096字符类型test%%&!+varcharlengthof4096字符类型test%%&!+',
                                 'nvarchar-3', 'nvarchar255_+!@#nvarchar255_+!@#', 'nvarchar4096_2中英文测试2中英文测试2中英文测试2()&^%{}nvarchar4096_2中英文测试2中英文测试2中英文测试2()&^%{}',
                                 't', b'bytes', 'varbytes_2', b'\xaa\xdd\xee', b'\xaa\xaa\xaa\xbb\xbb\xbb\xcc\xcc\xcc\xdd\xdd\xdd','stb_3',null,null,null,null,null,null,null,'shanghai',null,'blue',null);
INSERT 1
> insert into test_last.stb values('2023-02-10 12:05:50.166', 111111110044, 300, 30000, 300000, 3000000.303, 300000000.3030333, false,
                                 'r', 'char3', 'a', 'nchar255定长类型测试1测试2测试3()&^%{}nchar255定长类型测试1测试2测试3()&^%{}',
                                 'varchar_44', 'varchar255_中文测试abc!<>&^%$varchar255_中文测试abc!<>&^%$', 'varcharlengthof4096通用查询test%%&!+varcharlengthof4096通用查询test%%&!+',
                                 'nvarchar-2', 'nvarchar255()&^%{}', 'nvarchar4096中英文测试1中英文测试1中英文测试1()&^%{}nvarchar4096中英文测试1中英文测试1中英文测试1()&^%{}',
                                 'e', b'byte12', 'varbytes_3', b'\xbb\xcc\xff', 'varbytes4096$%^varbytes4096$%^varbytes4096$%^','stb_3',null,null,null,null,null,null,null,'shanghai',null,'blue',null);
INSERT 1
> select time_bucket(k_timestamp, '10s') as tb, last(e20),last(e21),last(e22) from test_last.tb group by tb,att1 order by tb;
             tb             |          last          |   last   |                                             last
----------------------------+------------------------+----------+-----------------------------------------------------------------------------------------------
  2023-05-15 09:10:10+00:00 | \x76617262797465735f31 | \xaabbcc | \xaaaaaabbbbbbccccccdddddd
  2023-07-10 20:18:40+00:00 | \x76617262797465735f33 | \xbbccff | \x76617262797465733430393624255e76617262797465733430393624255e76617262797465733430393624255e
(2 rows)
> select time_bucket(k_timestamp, '10s') as tb, last_row(e20),last_row(e21),last_row(e22) from test_last.tb group by tb,att1 order by tb;
             tb             |        last_row        | last_row |                                           last_row
----------------------------+------------------------+----------+-----------------------------------------------------------------------------------------------
  2023-05-15 09:10:10+00:00 | \x76617262797465735f31 | \xaabbcc | \xaaaaaabbbbbbccccccdddddd
  2023-07-10 20:18:40+00:00 | \x76617262797465735f33 | \xbbccff | \x76617262797465733430393624255e76617262797465733430393624255e76617262797465733430393624255e
(2 rows)
> select time_bucket(k_timestamp, '15s') as tb, last_row(e8),last_row(e12) from test_last.tb where e8 in(' ','c','h') group by tb,att1 order by tb;
             tb             | last_row |  last_row
----------------------------+----------+-------------
  2023-05-15 09:10:00+00:00 | c        | varchar_11
(1 row)
> select time_bucket(k_timestamp, '10s') as tb, last(e20),last(e21),last(e22) from test_last.stb group by tb order by tb;
             tb             |          last          |   last   |                                             last
----------------------------+------------------------+----------+-----------------------------------------------------------------------------------------------
  2022-06-16 10:18:30+00:00 | \x76617262797465735f32 | \xddeeff | \xeeeeeeffffffeeeeeeffffff
  2023-02-10 12:05:50+00:00 | \x76617262797465735f32 | \xaaddee | \xaaaaaabbbbbbccccccdddddd
  2023-05-15 09:10:10+00:00 | \x76617262797465735f32 | \xddeeff | \xeeeeeeffffffeeeeeeffffff
  2023-07-10 20:18:40+00:00 | \x76617262797465735f33 | \xbbccff | \x76617262797465733430393624255e76617262797465733430393624255e76617262797465733430393624255e
(4 rows)
> select time_bucket(k_timestamp, '10s') as tb, last_row(e20),last_row(e21),last_row(e22) from test_last.stb group by tb order by tb;
             tb             |        last_row        | last_row |                                           last_row
----------------------------+------------------------+----------+-----------------------------------------------------------------------------------------------
  2022-06-16 10:18:30+00:00 | \x76617262797465735f32 | \xddeeff | \xeeeeeeffffffeeeeeeffffff
  2023-02-10 12:05:50+00:00 | \x76617262797465735f32 | \xaaddee | \xaaaaaabbbbbbccccccdddddd
  2023-05-15 09:10:10+00:00 | \x76617262797465735f32 | \xddeeff | \xeeeeeeffffffeeeeeeffffff
  2023-07-10 20:18:40+00:00 | \x76617262797465735f33 | \xbbccff | \x76617262797465733430393624255e76617262797465733430393624255e76617262797465733430393624255e
(4 rows)
> select time_bucket(k_timestamp, '15s') as tb, last_row(e8),last_row(e9) from test_last.stb where e8 in(' ','c','h','r') group by tb order by tb;
             tb             | last_row | last_row
----------------------------+----------+-----------
  2022-06-16 10:18:30+00:00 | h        | char2
  2023-02-10 12:05:45+00:00 | r        | char3
  2023-05-15 09:10:00+00:00 | h        | char2
  2023-07-10 20:18:30+00:00 | r        | char3
(4 rows)
> select time_bucket(k_timestamp, '15s') as tb, last(e12),last(e15) from test_last.stb group by tb,name order by tb;
             tb             |    last    |    last
----------------------------+------------+-------------
  2022-06-16 10:18:30+00:00 | varchar_22 | nvarchar-1
  2023-02-10 12:05:45+00:00 | varchar_33 | nvarchar-3
  2023-05-15 09:10:00+00:00 | varchar_22 | nvarchar-1
  2023-07-10 20:18:30+00:00 | varchar_44 | nvarchar-2
(4 rows)
> select time_bucket(k_timestamp, '15s') as tb, last_row(e12),last_row(e15) from test_last.stb group by tb,name order by tb;
             tb             |  last_row  |  last_row
----------------------------+------------+-------------
  2022-06-16 10:18:30+00:00 | varchar_22 | nvarchar-1
  2023-02-10 12:05:45+00:00 | varchar_33 | nvarchar-3
  2023-05-15 09:10:00+00:00 | varchar_22 | nvarchar-1
  2023-07-10 20:18:30+00:00 | varchar_44 | nvarchar-2
(4 rows)
> drop database test_last cascade;
DROP DATABASE
> drop database if exists test cascade;
DROP DATABASE
> create ts database test;
CREATE TS DATABASE
> create table test.cpu
(
    k_timestamp      timestamp not null,
    usage_user       bigint not null,
    usage_system     bigint,
    usage_idle       int,
    usage_nice       int,
    usage_iowait     smallint,
    usage_irq        smallint,
    usage_softirq    float,
    usage_steal      float,
    usage_guest      real,
    usage_guest_nice real
) attributes (
    hostname char(30) not null,
    region varchar(8) not null,
    datacenter int,
    rack int not null,
    os char(30),
    arch char(30),
    team char(30),
    service char(30),
    service_version char(30),
    service_environment char(30)
    )
primary attributes (hostname, region, rack);
CREATE TABLE
> INSERT INTO test.cpu
values ('1800-05-31 10:00:00', 2147483647, -2147483648, -2147483648, -2147483648, -32768, -32768, 54.122111, 54.122111, 3.141593, 3.141593, 'host_0', 'aaaaaaaa', null, 6666, '', null, '', null, '', ''),
       ('1800-05-31 10:00:00', -2147483648, -2147483648, -2147483648, -2147483648, -32768, -32768, 54.122111, 54.122111, 3.141593, 3.141593, 'host_0', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1800-05-31 10:00:00', 84, 2147483647, -2147483648, 2147483647, 29, 20, -54.122111, -54.122111, 53, 74, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1800-05-31 10:00:00', 29, 48, 5, 63, -17, 52, 60, null, 93, 1, 'host_2', 'a', -888888, 6666, '', '', '', '', '', ''),
       ('1800-05-31 10:00:00', 8, 21, -89, 78, 30, 81, 33, 24, 24, 82, 'host_3', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1800-05-31 10:00:00', 2, 26, 64, 6, 38, 20, -71, 19, 40, 54, 'host_4', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('1800-05-31 10:00:00', -76, -40, -63, -7, -81, -20, -29, -55, null, -15, 'host_5', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('1800-05-31 10:00:00', 44, 70, 20, -67, 65, 11, 7, 92, 0, 31, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1800-05-31 10:00:00', 92, 35, 99, 9, 31, -1, 2, 24, 96, 69, 'host_7', 'aaa', -888888, -6666, '', '', '', '', '', ''),
       ('1800-05-31 10:00:00', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1800-05-31 10:00:00', 90, 0, 81, 28, 25, -44, 8, -89, 11, 76, 'host_9', 'aaa', 888888, 6666, '', '', '', '', '', '');
INSERT 11
> INSERT INTO test.cpu
values ('1800-06-01 11:00:01', 2147483647, -2147483648, 2147483647, -2147483648, 32767, -32768, -100.1, 54.122111, -3.141593, null, 'host_0', 'aaa', -2147483648, 6666, '', '', null, '', '', ''),
       ('1800-06-01 11:00:01', 2147483647, 2147483647, 2147483647, 2147483647, 32767, 32767, 54.122111, -54.1221111, 3.141593, -3.141593, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1800-06-01 11:00:01', 29, 48, 5, 63, 17, 52, 60, 49, 93, 1, 'host_3', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('1800-06-01 11:00:01', 8, 21, 89, 78, 30, 81, 33, 24, 24, 82, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1800-06-01 11:00:01', 2, 26, 64, 6, 38, 20, 71, null, 40, 54, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1800-06-01 11:00:01', 76, 40, 63, 7, 81, 20, 29, -55, 20, 15, 'host_6', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1800-06-01 11:00:01', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_7', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1800-06-01 11:00:01', 92, 35,-99, 9, 31, 1, 2, 24, 96, 69, 'host_8', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('1800-06-01 11:00:01', 21, 77, 90, 83, 41, 84, 26, 60, null, 36, 'host_9', 'aaa', -888888, -6666, '', '', '', '', '', ''),
       ('1800-06-31 11:00:01', 90, 0, -81, 28, 25, 44, 8, 89, 11, 76, 'host_2', 'a', -888888, 6666, '', '', '', '', '', '');
ERROR: could not resolve "1800-06-31 11:00:01" as TIMESTAMPTZ type (column k_timestamp)
SQLSTATE: 42804
> INSERT INTO test.cpu
values ('1969-12-31 10:00:02', 58, -2, 24, 61, 22, 63, 6, 44, null, 38, 'host_2', 'aaa', null, -6666, '', '', '', '', '', ''),
       ('1969-12-31 10:00:02', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_3', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('1969-12-31 10:00:02', 29, 48, -5, 63, -17, 52, 60, 49, 93, 1, 'host_4', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('1969-12-31 10:00:02', 8, 21, 89, -78, 30, 81, 33, 24, 24, 82, 'host_5', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('1969-12-31 10:00:02', 2, 26, -64, 6, -38, 20, 71, null, 40, 54, 'host_6', 'aaa', null, -6666, '', '', '', '', '', ''),
       ('1969-12-31 10:00:02', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_7', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('1969-12-31 10:00:02', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_8', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('1969-12-31 10:00:02', 92, 35, 99, -9, 31, 1, -2, 24, 96, 69, 'host_9', 'aaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('1969-12-31 10:00:02', 21, 77, -90, 83, 41, 84, 26, 60, 43, null, 'host_0', 'aaaaaaaa', 2147483647, 6666, '', '', '', '', '', ''),
       ('1969-12-31 10:00:02', 90, 0, 81, 28, 25, 44, 8, -89, 11, 76, 'host_1', 'aaa', 2147483647, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('1970-01-01 15:00:04', 2147483647, 2, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-01-01 15:00:04', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-01-01 15:00:04', 29, 48, 5, -63, 17, -52, 60, 49, 93, 1, 'host_5', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-01-01 16:00:04', 8, 21, 89, 78, 30, -81, 33, 24, 24, 82, 'host_6', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-01-01 17:00:04', 2, 26, -64, 6, 38, -20, 71, null, 40, 54, 'host_7', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('1970-01-01 15:00:04', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_8', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-01-01 16:00:04', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_9', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-01-01 15:00:04', 92, 35, 99, 9, 31, -1, 2, 24, 96, 69, 'host_0', 'aaaaaaaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-01-01 15:00:04', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_1', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-01-01 15:00:04', 90, 0, 81, 28, 25, 44, 8, -89, 11, 76, 'host_2', 'aaa', -2147483648, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('1970-02-01 10:00:04', 2147483647, 2, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-01 10:00:04', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-01 10:00:04', 29, 48, 5, -63, 17, -52, 60, 49, 93, 1, 'host_5', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-01 10:00:04', 8, 21, 89, 78, 30, -81, 33, 24, 24, 82, 'host_6', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-01 10:00:04', 2, 26, -64, 6, 38, -20, 71, null, 40, 54, 'host_7', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('1970-02-01 10:00:04', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_8', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-01 10:00:04', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_9', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-01 10:00:04', 92, 35, 99, 9, 31, -1, 2, 24, 96, 69, 'host_0', 'aaaaaaaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-01 10:00:04', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_1', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-01 10:00:04', 90, 0, 81, 28, 25, 44, 8, -89, 11, 76, 'host_2', 'aaa', -2147483648, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('1970-02-02 10:00:04', 2147483647, 2, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-02 10:00:04', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-02 10:00:04', 29, 48, 5, -63, 17, -52, 60, 49, 93, 1, 'host_5', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-02 10:00:04', 8, 21, 89, 78, 30, -81, 33, 24, 24, 82, 'host_6', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-02 10:00:04', 2, 26, -64, 6, 38, -20, 71, null, 40, 54, 'host_7', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('1970-02-02 10:00:04', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_8', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-02 10:00:04', 44, 70, 20, 67, 65, 11, 7, 92, 0, 31, 'host_9', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-02 10:00:04', 92, 35, 99, 9, 31, -1, 2, 24, 96, 69, 'host_0', 'aaaaaaaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-02 10:00:04', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_1', 'aaa', -2147483648, 6666, '', '', '', '', '', ''),
       ('1970-02-02 10:00:04', 90, 0, 81, 28, 25, 44, 8, -89, 11, 76, 'host_2', 'aaa', -2147483648, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('1970-05-31 22:00:03', 58, null, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('1970-05-31 22:00:03', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1970-05-31 22:00:03', 29, 48, 5, 63, 17, 52, 60, 49, 93, 1, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1970-05-31 22:00:03', 8, 21, 89, 78, 30, 81, 33, 24, 24, 82, 'host_6', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('1970-05-31 22:00:03', 2, 26, 64, 6, 38, -20, 71, null, 40, 54, 'host_7', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1970-05-31 22:00:03', 76, 40, 63, 7, 81, 20, 29, 55, 20, 15, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1970-05-31 22:00:03', 44, 70, 20, 67, 65, 11, -7, 92, 0, 31, 'host_9', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1970-05-31 22:00:03', 92, 35, 99, 9, 31, 1, 2, 24, 96, 69, 'host_0', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1970-05-31 22:00:03', 21, 77, 90, 83, 41, 84, 26, 60, 43, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('1970-05-31 22:00:03', 90, 0, 81, 28, 25, 44, 8, 89, 11, 76, 'host_2', 'aaa', 888888, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_3', 'aaaaaaa', null, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_4', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_7', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_9', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_0', 'aaa', 0, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:08', 2147483647, null, null, null, null, null, null, null, null, null, 'host_2', 'aaa', null, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_3', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_5', 'aaa', null, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_7', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_8', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_9', 'aaa', null, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_0', 'aaa', -888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:00:09', 2147483647, null, null, null, null, null, null, null, null, null, 'host_2', 'aaa', null, 6666, '', '', '', '', '', '');
INSERT 10
> INSERT INTO test.cpu
values ('2023-05-31 10:30:10', 58, null, 24, 61, 22, 63, 6, 44, null, 38, 'host_3', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:30:10', 84, 11, 53, 87, 29, 20, 54, 77, 53, 74, 'host_4', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:30:10', 29, 48, 5, -63, 17, 52, 60, 49, 93, 1, 'host_5', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:30:10', 8, 21, 89, -78, 30, 81, 33, 24, 24, 82, 'host_6', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:30:10', 2, 26, 64, 6, 38, -20, 71, null, -40, 54, 'host_7', 'aaa', -888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:30:10', 76, 40, -63, 7, 81, -20, 29, 55, 20, 15, 'host_8', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:30:10', 44, 70, 20, 67, 65, 11, 7, -92, 0, 31, 'host_9', 'aaa', 888888, -6666, '', '', '', '', '', ''),
       ('2023-05-31 10:30:10', 92, 35, 99, 9, -31, 1, 2, 24, 96, 69, 'host_0', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:30:10', 21, 77, 90, 83, 41, -84, 26, 60, 43, null, 'host_1', 'aaa', 888888, 6666, '', '', '', '', '', ''),
       ('2023-05-31 10:30:10', 90, 0, 81, 28, 25, -44, 8, 89, 11, 76, 'host_2', 'aaa', -888888, 6666, '', '', '', '', '', '');
INSERT 10
> SELECT time_bucket(k_timestamp, '4YEAR') as k_timestamp_b,
       hostname,
       lastts(usage_guest),
       sum(usage_steal),
       firstts(usage_nice),
       max(usage_user),
       max(usage_irq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE hostname = 'host_0'
AND k_timestamp >= '1800-01-01 00:00:00'
AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          lastts           |    sum    |          firstts          |     max     |  max   |          last_ts
----------------------------+----------+---------------------------+-----------+---------------------------+-------------+--------+----------------------------
  2021-01-01 00:00:00+00:00 | host_0   | NULL                      | NULL      | NULL                      |  2147483647 | NULL   | 2023-05-31 10:00:09+00:00
  1797-01-01 00:00:00+00:00 | host_0   | 1800-05-31 10:00:00+00:00 | 54.122111 | 1800-05-31 10:00:00+00:00 | -2147483648 | -32768 | 1800-05-31 10:00:00+00:00
  1969-01-01 00:00:00+00:00 | host_0   | 1970-05-31 22:00:03+00:00 |        24 | 1970-05-31 22:00:03+00:00 |          92 |      1 | 1970-05-31 22:00:03+00:00
  2021-01-01 00:00:00+00:00 | host_0   | 2023-05-31 10:30:10+00:00 |        24 | 2023-05-31 10:30:10+00:00 |  2147483647 |      1 | 2023-05-31 10:30:10+00:00
  1797-01-01 00:00:00+00:00 | host_0   | 1800-05-31 10:00:00+00:00 | 54.122111 | 1800-05-31 10:00:00+00:00 |  2147483647 | -32768 | 1800-05-31 10:00:00+00:00
  1969-01-01 00:00:00+00:00 | host_0   | 1970-02-02 10:00:04+00:00 |       132 | 1969-12-31 10:00:02+00:00 |          92 |     84 | 1970-02-02 10:00:04+00:00
(6 rows)
> SELECT time_bucket(k_timestamp, '2yrs') as k_timestamp_b,
       hostname,
       first_row(usage_idle),
       lastts(usage_nice),
       lastts(usage_irq),
       lastts(usage_guest_nice),
       max(usage_idle),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE hostname = 'host_1'
AND k_timestamp >= '1900-01-01 00:00:00'
AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname | first_row |          lastts           |          lastts           |          lastts           | max |          last_ts
----------------------------+----------+-----------+---------------------------+---------------------------+---------------------------+-----+----------------------------
  1969-01-01 00:00:00+00:00 | host_1   |        81 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 | 1969-12-31 10:00:02+00:00 |  90 | 1970-05-31 22:00:03+00:00
  2023-01-01 00:00:00+00:00 | host_1   | NULL      | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 | NULL                      |  90 | 2023-05-31 10:30:10+00:00
(2 rows)
> SELECT time_bucket(k_timestamp, '20yr') as k_timestamp_b,
       hostname,
       sum(usage_guest),
       count(usage_idle),
       avg(usage_system),
       max(usage_steal),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE hostname = 'host_0'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |        sum         | count |     avg     |    max    |          last_ts
----------------------------+----------+--------------------+-------+-------------+-----------+----------------------------
  2021-01-01 00:00:00+00:00 | host_0   | NULL               |     0 | NULL        | NULL      | 2023-05-31 10:00:09+00:00
  1781-01-01 00:00:00+00:00 | host_0   | 3.1415929794311523 |     1 | -2147483648 | 54.122111 | 1800-05-31 10:00:00+00:00
  1961-01-01 00:00:00+00:00 | host_0   |                 96 |     1 |          35 |        24 | 1970-05-31 22:00:03+00:00
  2021-01-01 00:00:00+00:00 | host_0   |                 96 |     1 |          35 |        24 | 2023-05-31 10:30:10+00:00
  1781-01-01 00:00:00+00:00 | host_0   | 3.1415929794311523 |     1 | -2147483648 | 54.122111 | 1800-05-31 10:00:00+00:00
  1961-01-01 00:00:00+00:00 | host_0   |                331 |     4 |        45.5 |        60 | 1970-02-02 10:00:04+00:00
(6 rows)
> SELECT time_bucket(k_timestamp, '100y') as k_timestamp_b,
       hostname,
       last_row(usage_iowait),
       avg(usage_irq),
       max(usage_system),
       firstts(usage_irq),
       lastts(usage_softirq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE hostname = 'host_0'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname | last_row |  avg   |     max     |          firstts          |          lastts           |          last_ts
----------------------------+----------+----------+--------+-------------+---------------------------+---------------------------+----------------------------
  2001-01-01 00:00:00+00:00 | host_0   | NULL     | NULL   |        NULL | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  1701-01-01 00:00:00+00:00 | host_0   |   -32768 | -32768 | -2147483648 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1901-01-01 00:00:00+00:00 | host_0   |       31 |      1 |          35 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2001-01-01 00:00:00+00:00 | host_0   |      -31 |      1 |          35 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1701-01-01 00:00:00+00:00 | host_0   |   -32768 | -32768 | -2147483648 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1901-01-01 00:00:00+00:00 | host_0   |       31 |  20.25 |          77 | 1969-12-31 10:00:02+00:00 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
(6 rows)
> SELECT time_bucket(k_timestamp, '2month') as k_timestamp_b,
       first_row(usage_irq),
       lastts(usage_iowait),
       sum(usage_iowait),
       hostname,
       first_row(usage_system),
       lastts(usage_user)            as last_ts
FROM test.cpu
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | first_row |          lastts           |  sum   | hostname |  first_row  |          last_ts
----------------------------+-----------+---------------------------+--------+----------+-------------+----------------------------
  2023-05-01 00:00:00+00:00 | NULL      | NULL                      | NULL   | host_0   |        NULL | 2023-05-31 10:00:09+00:00
  1800-05-01 00:00:00+00:00 |    -32768 | 1800-05-31 10:00:00+00:00 | -32768 | host_0   | -2147483648 | 1800-05-31 10:00:00+00:00
  1970-05-01 00:00:00+00:00 |         1 | 1970-05-31 22:00:03+00:00 |     31 | host_0   |          35 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | NULL      | 2023-05-31 10:30:10+00:00 |    -31 | host_0   |        NULL | 2023-05-31 10:30:10+00:00
  1800-05-01 00:00:00+00:00 |    -32768 | 1800-05-31 10:00:00+00:00 | -32768 | host_0   | -2147483648 | 1800-05-31 10:00:00+00:00
  1969-11-01 00:00:00+00:00 |        84 | 1969-12-31 10:00:02+00:00 |     41 | host_0   |          77 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 |        -1 | 1970-02-02 10:00:04+00:00 |     93 | host_0   |          35 | 1970-02-02 10:00:04+00:00
  1800-05-01 00:00:00+00:00 |        20 | 1800-05-31 10:00:00+00:00 |     29 | host_1   |  2147483647 | 1800-05-31 10:00:00+00:00
  1969-11-01 00:00:00+00:00 |        44 | 1969-12-31 10:00:02+00:00 |     25 | host_1   |           0 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 |        84 | 1970-02-02 10:00:04+00:00 |    123 | host_1   |          77 | 1970-02-02 10:00:04+00:00
  1970-05-01 00:00:00+00:00 |        84 | 1970-05-31 22:00:03+00:00 |     41 | host_1   |          77 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | NULL      | 2023-05-31 10:30:10+00:00 |     41 | host_1   |        NULL | 2023-05-31 10:30:10+00:00
  1800-05-01 00:00:00+00:00 |        52 | 1800-05-31 10:00:00+00:00 |    -17 | host_2   |          48 | 1800-05-31 10:00:00+00:00
  1969-11-01 00:00:00+00:00 |        63 | 1969-12-31 10:00:02+00:00 |     22 | host_2   |          -2 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 |        44 | 1970-02-02 10:00:04+00:00 |     75 | host_2   |           0 | 1970-02-02 10:00:04+00:00
  1970-05-01 00:00:00+00:00 |        44 | 1970-05-31 22:00:03+00:00 |     25 | host_2   |           0 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | NULL      | 2023-05-31 10:30:10+00:00 |     25 | host_2   |        NULL | 2023-05-31 10:30:10+00:00
  1970-05-01 00:00:00+00:00 |        63 | 1970-05-31 22:00:03+00:00 |     22 | host_3   |        NULL | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 |        63 | 2023-05-31 10:30:10+00:00 |     22 | host_3   |        NULL | 2023-05-31 10:30:10+00:00
  1800-05-01 00:00:00+00:00 |        81 | 1800-05-31 10:00:00+00:00 |     30 | host_3   |          21 | 1800-05-31 10:00:00+00:00
  1969-11-01 00:00:00+00:00 |        20 | 1969-12-31 10:00:02+00:00 |     29 | host_3   |          11 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 |        63 | 1970-02-02 10:00:04+00:00 |     66 | host_3   |           2 | 1970-02-02 10:00:04+00:00
  2023-05-01 00:00:00+00:00 | NULL      | NULL                      | NULL   | host_3   |        NULL | 2023-05-31 10:00:09+00:00
  2023-05-01 00:00:00+00:00 | NULL      | NULL                      | NULL   | host_3   |        NULL | 2023-05-31 10:00:08+00:00
  1800-05-01 00:00:00+00:00 |        20 | 1800-05-31 10:00:00+00:00 |     38 | host_4   |          26 | 1800-05-31 10:00:00+00:00
  1969-11-01 00:00:00+00:00 |        52 | 1969-12-31 10:00:02+00:00 |    -17 | host_4   |          48 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 |        20 | 1970-02-02 10:00:04+00:00 |     87 | host_4   |          11 | 1970-02-02 10:00:04+00:00
  1970-05-01 00:00:00+00:00 |        20 | 1970-05-31 22:00:03+00:00 |     29 | host_4   |          11 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | NULL      | 2023-05-31 10:30:10+00:00 |     29 | host_4   |        NULL | 2023-05-31 10:30:10+00:00
  1800-05-01 00:00:00+00:00 |       -20 | 1800-05-31 10:00:00+00:00 |    -81 | host_5   |         -40 | 1800-05-31 10:00:00+00:00
  2023-05-01 00:00:00+00:00 | NULL      | NULL                      | NULL   | host_5   |        NULL | 2023-05-31 10:00:09+00:00
  1969-11-01 00:00:00+00:00 |        81 | 1969-12-31 10:00:02+00:00 |     30 | host_5   |          21 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 |       -52 | 1970-02-02 10:00:04+00:00 |     51 | host_5   |          48 | 1970-02-02 10:00:04+00:00
  1970-05-01 00:00:00+00:00 |        52 | 1970-05-31 22:00:03+00:00 |     17 | host_5   |          48 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | NULL      | 2023-05-31 10:30:10+00:00 |     17 | host_5   |        NULL | 2023-05-31 10:30:10+00:00
  1969-11-01 00:00:00+00:00 |        20 | 1969-12-31 10:00:02+00:00 |    -38 | host_6   |          26 | 1969-12-31 10:00:02+00:00
  1800-05-01 00:00:00+00:00 |        11 | 1800-05-31 10:00:00+00:00 |     65 | host_6   |          70 | 1800-05-31 10:00:00+00:00
  1970-01-01 00:00:00+00:00 |       -81 | 1970-02-02 10:00:04+00:00 |     90 | host_6   |          21 | 1970-02-02 10:00:04+00:00
  1970-05-01 00:00:00+00:00 |        81 | 1970-05-31 22:00:03+00:00 |     30 | host_6   |          21 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | NULL      | 2023-05-31 10:30:10+00:00 |     30 | host_6   |        NULL | 2023-05-31 10:30:10+00:00
  1800-05-01 00:00:00+00:00 |        -1 | 1800-05-31 10:00:00+00:00 |     31 | host_7   |          35 | 1800-05-31 10:00:00+00:00
  1969-11-01 00:00:00+00:00 |        20 | 1969-12-31 10:00:02+00:00 |     81 | host_7   |          40 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 |       -20 | 1970-02-02 10:00:04+00:00 |    114 | host_7   |          26 | 1970-02-02 10:00:04+00:00
  1970-05-01 00:00:00+00:00 |       -20 | 1970-05-31 22:00:03+00:00 |     38 | host_7   |          26 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | NULL      | 2023-05-31 10:30:10+00:00 |     38 | host_7   |        NULL | 2023-05-31 10:30:10+00:00
  2023-05-01 00:00:00+00:00 | NULL      | NULL                      | NULL   | host_8   |        NULL | 2023-05-31 10:00:09+00:00
  1800-05-01 00:00:00+00:00 |        84 | 1800-05-31 10:00:00+00:00 |     41 | host_8   |          77 | 1800-05-31 10:00:00+00:00
  1969-11-01 00:00:00+00:00 |        11 | 1969-12-31 10:00:02+00:00 |     65 | host_8   |          70 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 |        20 | 1970-02-02 10:00:04+00:00 |    243 | host_8   |          40 | 1970-02-02 10:00:04+00:00
  1970-05-01 00:00:00+00:00 |        20 | 1970-05-31 22:00:03+00:00 |     81 | host_8   |          40 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | NULL      | 2023-05-31 10:30:10+00:00 |     81 | host_8   |        NULL | 2023-05-31 10:30:10+00:00
  2023-05-01 00:00:00+00:00 |        11 | 2023-05-31 10:30:10+00:00 |     65 | host_9   |          70 | 2023-05-31 10:30:10+00:00
  1800-05-01 00:00:00+00:00 |       -44 | 1800-05-31 10:00:00+00:00 |     25 | host_9   |           0 | 1800-05-31 10:00:00+00:00
  1969-11-01 00:00:00+00:00 |         1 | 1969-12-31 10:00:02+00:00 |     31 | host_9   |          35 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 |        11 | 1970-02-02 10:00:04+00:00 |    195 | host_9   |          70 | 1970-02-02 10:00:04+00:00
  1970-05-01 00:00:00+00:00 |        11 | 1970-05-31 22:00:03+00:00 |     65 | host_9   |          70 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | NULL      | NULL                      | NULL   | host_9   |        NULL | 2023-05-31 10:00:09+00:00
(57 rows)
> SELECT time_bucket(k_timestamp, '5mon') as k_timestamp_b, first (usage_nice), min (usage_system), min (usage_softirq), last_row(usage_guest_nice), hostname,
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE region = 'aaaaaaaa'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       |    first    |     min     |    min    | last_row | hostname |          last_ts
----------------------------+-------------+-------------+-----------+----------+----------+----------------------------
  1800-03-01 00:00:00+00:00 | -2147483648 | -2147483648 | 54.122111 | 3.141593 | host_0   | 1800-05-31 10:00:00+00:00
  1969-10-01 00:00:00+00:00 |          83 |          35 |         2 |       69 | host_0   | 1970-02-02 10:00:04+00:00
(2 rows)
> SELECT time_bucket(k_timestamp, '16mons') as k_timestamp_b,
       avg(usage_steal),
       avg(usage_guest_nice),
       last_row(usage_guest),
       min(usage_idle),
       hostname,
       lastts(usage_user)            as last_ts
FROM test.cpu
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts
LIMIT 10;
        k_timestamp_b       |    avg     |        avg         | last_row |     min     | hostname |          last_ts
----------------------------+------------+--------------------+----------+-------------+----------+----------------------------
  2022-05-01 00:00:00+00:00 | NULL       | NULL               | NULL     | NULL        | host_0   | 2023-05-31 10:00:09+00:00
  1799-09-01 00:00:00+00:00 |  54.122111 | 3.1415929794311523 | 3.141593 | -2147483648 | host_0   | 1800-05-31 10:00:00+00:00
  1970-05-01 00:00:00+00:00 |         24 |                 69 |       96 |          99 | host_0   | 1970-05-31 22:00:03+00:00
  2022-05-01 00:00:00+00:00 |         24 |                 69 |       96 |          99 | host_0   | 2023-05-31 10:30:10+00:00
  1799-09-01 00:00:00+00:00 |  54.122111 | 3.1415929794311523 | 3.141593 | -2147483648 | host_0   | 1800-05-31 10:00:00+00:00
  1969-01-01 00:00:00+00:00 |         33 |                 69 |       96 |         -90 | host_0   | 1970-02-02 10:00:04+00:00
  1799-09-01 00:00:00+00:00 | -54.122111 |                 74 |       53 | -2147483648 | host_1   | 1800-05-31 10:00:00+00:00
  1969-01-01 00:00:00+00:00 |      22.75 |                 76 |       43 |          81 | host_1   | 1970-02-02 10:00:04+00:00
  1970-05-01 00:00:00+00:00 |         60 | NULL               |       43 |          90 | host_1   | 1970-05-31 22:00:03+00:00
  2022-05-01 00:00:00+00:00 |         60 | NULL               |       43 |          90 | host_1   | 2023-05-31 10:30:10+00:00
(10 rows)
> SELECT time_bucket(k_timestamp, '15weeks') as k_timestamp_b,
       hostname,
       sum(usage_nice),
       sum(usage_idle),
       min(usage_irq),
       sum(usage_system),
       last_row(usage_user),
       lastts(usage_user)            as last_ts
FROM test.cpu
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts
OFFSET 2;
        k_timestamp_b       | hostname |     sum     |     sum     |  min   |     sum     |  last_row  |          last_ts
----------------------------+----------+-------------+-------------+--------+-------------+------------+----------------------------
  1970-03-30 00:00:00+00:00 | host_0   |           9 |          99 |      1 |          35 |         92 | 1970-05-31 22:00:03+00:00
  2023-02-20 00:00:00+00:00 | host_0   |           9 |          99 |      1 |          35 |         92 | 2023-05-31 10:30:10+00:00
  1800-05-05 00:00:00+00:00 | host_0   | -2147483648 | -2147483648 | -32768 | -2147483648 | 2147483647 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_0   |         110 |         207 |     -1 |         182 |         92 | 1970-02-02 10:00:04+00:00
  1800-05-05 00:00:00+00:00 | host_1   |  2147483647 | -2147483648 |     20 |  2147483647 |         84 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_1   |         277 |         351 |     44 |         231 |         21 | 1970-02-02 10:00:04+00:00
  1970-03-30 00:00:00+00:00 | host_1   |          83 |          90 |     84 |          77 |         21 | 1970-05-31 22:00:03+00:00
  2023-02-20 00:00:00+00:00 | host_1   |          83 |          90 |    -84 |          77 |         21 | 2023-05-31 10:30:10+00:00
  1800-05-05 00:00:00+00:00 | host_2   |          63 |           5 |     52 |          48 |         29 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_2   |          61 |          24 |     63 |          -2 |         58 | 1969-12-31 10:00:02+00:00
  1969-12-15 00:00:00+00:00 | host_2   |          84 |         243 |     44 |           0 |         90 | 1970-02-02 10:00:04+00:00
  1970-03-30 00:00:00+00:00 | host_2   |          28 |          81 |     44 |           0 |         90 | 1970-05-31 22:00:03+00:00
  2023-02-20 00:00:00+00:00 | host_2   |          28 |          81 |    -44 |           0 |         90 | 2023-05-31 10:30:10+00:00
  1970-03-30 00:00:00+00:00 | host_3   |          61 |          24 |     63 | NULL        |         58 | 1970-05-31 22:00:03+00:00
  2023-02-20 00:00:00+00:00 | host_3   |          61 |          24 |     63 | NULL        |         58 | 2023-05-31 10:30:10+00:00
  1800-05-05 00:00:00+00:00 | host_3   |          78 |         -89 |     81 |          21 |          8 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_3   |         270 |         125 |     20 |          17 | 2147483647 | 1970-02-02 10:00:04+00:00
  2023-02-20 00:00:00+00:00 | host_3   | NULL        | NULL        | NULL   | NULL        | 2147483647 | 2023-05-31 10:00:09+00:00
  2023-02-20 00:00:00+00:00 | host_3   | NULL        | NULL        | NULL   | NULL        | 2147483647 | 2023-05-31 10:00:08+00:00
  1800-05-05 00:00:00+00:00 | host_4   |           6 |          64 |     20 |          26 |          2 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_4   |         324 |         154 |     20 |          81 |         84 | 1970-02-02 10:00:04+00:00
  1970-03-30 00:00:00+00:00 | host_4   |          87 |          53 |     20 |          11 |         84 | 1970-05-31 22:00:03+00:00
  2023-02-20 00:00:00+00:00 | host_4   |          87 |          53 |     20 |          11 |         84 | 2023-05-31 10:30:10+00:00
  1800-05-05 00:00:00+00:00 | host_5   |          -7 |         -63 |    -20 |         -40 |        -76 | 1800-05-31 10:00:00+00:00
  2023-02-20 00:00:00+00:00 | host_5   | NULL        | NULL        | NULL   | NULL        | 2147483647 | 2023-05-31 10:00:09+00:00
  1969-12-15 00:00:00+00:00 | host_5   |        -267 |         104 |    -52 |         165 |         29 | 1970-02-02 10:00:04+00:00
  1970-03-30 00:00:00+00:00 | host_5   |          63 |           5 |     52 |          48 |         29 | 1970-05-31 22:00:03+00:00
  2023-02-20 00:00:00+00:00 | host_5   |         -63 |           5 |     52 |          48 |         29 | 2023-05-31 10:30:10+00:00
  1969-12-15 00:00:00+00:00 | host_6   |           6 |         -64 |     20 |          26 |          2 | 1969-12-31 10:00:02+00:00
  1800-05-05 00:00:00+00:00 | host_6   |         -67 |          20 |     11 |          70 |         44 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_6   |         234 |         267 |    -81 |          63 |          8 | 1970-02-02 10:00:04+00:00
  1970-03-30 00:00:00+00:00 | host_6   |          78 |          89 |     81 |          21 |          8 | 1970-05-31 22:00:03+00:00
  2023-02-20 00:00:00+00:00 | host_6   |         -78 |          89 |     81 |          21 |          8 | 2023-05-31 10:30:10+00:00
  1800-05-05 00:00:00+00:00 | host_7   |           9 |          99 |     -1 |          35 |         92 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_7   |          25 |        -129 |    -20 |         118 |          2 | 1970-02-02 10:00:04+00:00
  1970-03-30 00:00:00+00:00 | host_7   |           6 |          64 |    -20 |          26 |          2 | 1970-05-31 22:00:03+00:00
  2023-02-20 00:00:00+00:00 | host_7   |           6 |          64 |    -20 |          26 |          2 | 2023-05-31 10:30:10+00:00
  2023-02-20 00:00:00+00:00 | host_8   | NULL        | NULL        | NULL   | NULL        | 2147483647 | 2023-05-31 10:00:09+00:00
  1800-05-05 00:00:00+00:00 | host_8   |          83 |          90 |     84 |          77 |         21 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_8   |          88 |         209 |     11 |         190 |         76 | 1970-02-02 10:00:04+00:00
  1970-03-30 00:00:00+00:00 | host_8   |           7 |          63 |     20 |          40 |         76 | 1970-05-31 22:00:03+00:00
  2023-02-20 00:00:00+00:00 | host_8   |           7 |         -63 |    -20 |          40 |         76 | 2023-05-31 10:30:10+00:00
  2023-02-20 00:00:00+00:00 | host_9   |          67 |          20 |     11 |          70 |         44 | 2023-05-31 10:30:10+00:00
  1800-05-05 00:00:00+00:00 | host_9   |          28 |          81 |    -44 |           0 |         90 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_9   |         192 |         159 |      1 |         245 |         44 | 1970-02-02 10:00:04+00:00
  1970-03-30 00:00:00+00:00 | host_9   |          67 |          20 |     11 |          70 |         44 | 1970-05-31 22:00:03+00:00
  2023-02-20 00:00:00+00:00 | host_9   | NULL        | NULL        | NULL   | NULL        | 2147483647 | 2023-05-31 10:00:09+00:00
(47 rows)
> SELECT time_bucket(k_timestamp, '5week') as k_timestamp_b,
       hostname,
       min(usage_iowait),
       last_row(usage_irq),
       count(usage_nice),
       last_row(usage_idle),
       last_row(usage_system),
       lastts(usage_user)            as last_ts
FROM test.cpu
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |  min   | last_row | count |  last_row   |  last_row   |          last_ts
----------------------------+----------+--------+----------+-------+-------------+-------------+----------------------------
  2023-05-01 00:00:00+00:00 | host_0   | NULL   | NULL     |     0 | NULL        |        NULL | 2023-05-31 10:00:09+00:00
  1800-05-05 00:00:00+00:00 | host_0   | -32768 |   -32768 |     1 | -2147483648 | -2147483648 | 1800-05-31 10:00:00+00:00
  1970-05-04 00:00:00+00:00 | host_0   |     31 |        1 |     1 |          99 |          35 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | host_0   |    -31 |        1 |     1 |          99 |          35 | 2023-05-31 10:30:10+00:00
  1800-05-05 00:00:00+00:00 | host_0   | -32768 |   -32768 |     1 | -2147483648 | -2147483648 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_0   |     31 |       -1 |     2 |          99 |          35 | 1970-01-01 15:00:04+00:00
  1970-01-19 00:00:00+00:00 | host_0   |     31 |       -1 |     2 |          99 |          35 | 1970-02-02 10:00:04+00:00
  1800-05-05 00:00:00+00:00 | host_1   |     29 |       20 |     1 | -2147483648 |  2147483647 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_1   |     25 |       84 |     2 |          90 |          77 | 1970-01-01 15:00:04+00:00
  1970-01-19 00:00:00+00:00 | host_1   |     41 |       84 |     2 |          90 |          77 | 1970-02-02 10:00:04+00:00
  1970-05-04 00:00:00+00:00 | host_1   |     41 |       84 |     1 |          90 |          77 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | host_1   |     41 |      -84 |     1 |          90 |          77 | 2023-05-31 10:30:10+00:00
  1800-05-05 00:00:00+00:00 | host_2   |    -17 |       52 |     1 |           5 |          48 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_2   |     22 |       63 |     1 |          24 |          -2 | 1969-12-31 10:00:02+00:00
  1969-12-15 00:00:00+00:00 | host_2   |     25 |       44 |     1 |          81 |           0 | 1970-01-01 15:00:04+00:00
  1970-01-19 00:00:00+00:00 | host_2   |     25 |       44 |     2 |          81 |           0 | 1970-02-02 10:00:04+00:00
  1970-05-04 00:00:00+00:00 | host_2   |     25 |       44 |     1 |          81 |           0 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | host_2   |     25 |      -44 |     1 |          81 |           0 | 2023-05-31 10:30:10+00:00
  1970-05-04 00:00:00+00:00 | host_3   |     22 |       63 |     1 |          24 |        NULL | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | host_3   |     22 |       63 |     1 |          24 |        NULL | 2023-05-31 10:30:10+00:00
  1800-05-05 00:00:00+00:00 | host_3   |     30 |       81 |     1 |         -89 |          21 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_3   |     22 |       63 |     2 |          24 |           2 | 1970-01-01 15:00:04+00:00
  1970-01-19 00:00:00+00:00 | host_3   |     22 |       63 |     2 |          24 |           2 | 1970-02-02 10:00:04+00:00
  2023-05-01 00:00:00+00:00 | host_3   | NULL   | NULL     |     0 | NULL        |        NULL | 2023-05-31 10:00:09+00:00
  2023-05-01 00:00:00+00:00 | host_3   | NULL   | NULL     |     0 | NULL        |        NULL | 2023-05-31 10:00:08+00:00
  1800-05-05 00:00:00+00:00 | host_4   |     38 |       20 |     1 |          64 |          26 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_4   |    -17 |       20 |     2 |          53 |          11 | 1970-01-01 15:00:04+00:00
  1970-01-19 00:00:00+00:00 | host_4   |     29 |       20 |     2 |          53 |          11 | 1970-02-02 10:00:04+00:00
  1970-05-04 00:00:00+00:00 | host_4   |     29 |       20 |     1 |          53 |          11 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | host_4   |     29 |       20 |     1 |          53 |          11 | 2023-05-31 10:30:10+00:00
  1800-05-05 00:00:00+00:00 | host_5   |    -81 |      -20 |     1 |         -63 |         -40 | 1800-05-31 10:00:00+00:00
  2023-05-01 00:00:00+00:00 | host_5   | NULL   | NULL     |     0 | NULL        |        NULL | 2023-05-31 10:00:09+00:00
  1969-12-15 00:00:00+00:00 | host_5   |     17 |      -52 |     2 |           5 |          48 | 1970-01-01 15:00:04+00:00
  1970-01-19 00:00:00+00:00 | host_5   |     17 |      -52 |     2 |           5 |          48 | 1970-02-02 10:00:04+00:00
  1970-05-04 00:00:00+00:00 | host_5   |     17 |       52 |     1 |           5 |          48 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | host_5   |     17 |       52 |     1 |           5 |          48 | 2023-05-31 10:30:10+00:00
  1969-12-15 00:00:00+00:00 | host_6   |    -38 |       20 |     1 |         -64 |          26 | 1969-12-31 10:00:02+00:00
  1800-05-05 00:00:00+00:00 | host_6   |     65 |       11 |     1 |          20 |          70 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_6   |     30 |      -81 |     1 |          89 |          21 | 1970-01-01 16:00:04+00:00
  1970-01-19 00:00:00+00:00 | host_6   |     30 |      -81 |     2 |          89 |          21 | 1970-02-02 10:00:04+00:00
  1970-05-04 00:00:00+00:00 | host_6   |     30 |       81 |     1 |          89 |          21 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | host_6   |     30 |       81 |     1 |          89 |          21 | 2023-05-31 10:30:10+00:00
  1800-05-05 00:00:00+00:00 | host_7   |     31 |       -1 |     1 |          99 |          35 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_7   |     38 |      -20 |     2 |         -64 |          26 | 1970-01-01 17:00:04+00:00
  1970-01-19 00:00:00+00:00 | host_7   |     38 |      -20 |     2 |         -64 |          26 | 1970-02-02 10:00:04+00:00
  1970-05-04 00:00:00+00:00 | host_7   |     38 |      -20 |     1 |          64 |          26 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | host_7   |     38 |      -20 |     1 |          64 |          26 | 2023-05-31 10:30:10+00:00
  2023-05-01 00:00:00+00:00 | host_8   | NULL   | NULL     |     0 | NULL        |        NULL | 2023-05-31 10:00:09+00:00
  1800-05-05 00:00:00+00:00 | host_8   |     41 |       84 |     1 |          90 |          77 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_8   |     65 |       20 |     2 |          63 |          40 | 1970-01-01 15:00:04+00:00
  1970-01-19 00:00:00+00:00 | host_8   |     81 |       20 |     2 |          63 |          40 | 1970-02-02 10:00:04+00:00
  1970-05-04 00:00:00+00:00 | host_8   |     81 |       20 |     1 |          63 |          40 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | host_8   |     81 |      -20 |     1 |         -63 |          40 | 2023-05-31 10:30:10+00:00
  2023-05-01 00:00:00+00:00 | host_9   |     65 |       11 |     1 |          20 |          70 | 2023-05-31 10:30:10+00:00
  1800-05-05 00:00:00+00:00 | host_9   |     25 |      -44 |     1 |          81 |           0 | 1800-05-31 10:00:00+00:00
  1969-12-15 00:00:00+00:00 | host_9   |     31 |       11 |     2 |          20 |          70 | 1970-01-01 16:00:04+00:00
  1970-01-19 00:00:00+00:00 | host_9   |     65 |       11 |     2 |          20 |          70 | 1970-02-02 10:00:04+00:00
  1970-05-04 00:00:00+00:00 | host_9   |     65 |       11 |     1 |          20 |          70 | 1970-05-31 22:00:03+00:00
  2023-05-01 00:00:00+00:00 | host_9   | NULL   | NULL     |     0 | NULL        |        NULL | 2023-05-31 10:00:09+00:00
(59 rows)
> SELECT time_bucket(k_timestamp, '1w') as k_timestamp_b,
       hostname,
       first_row(usage_iowait),
       last_row(usage_steal),
       min(usage_user),
       last_row(usage_nice),
       lastts(usage_user)            as last_ts
FROM test.cpu
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname | first_row |  last_row  |     min     |  last_row   |          last_ts
----------------------------+----------+-----------+------------+-------------+-------------+----------------------------
  2023-05-29 00:00:00+00:00 | host_0   | NULL      | NULL       |  2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  1800-05-26 00:00:00+00:00 | host_0   |    -32768 |  54.122111 | -2147483648 | -2147483648 | 1800-05-31 10:00:00+00:00
  1970-05-25 00:00:00+00:00 | host_0   |        31 |         24 |          92 |           9 | 1970-05-31 22:00:03+00:00
  2023-05-29 00:00:00+00:00 | host_0   | NULL      |         24 |          92 |           9 | 2023-05-31 10:30:10+00:00
  1800-05-26 00:00:00+00:00 | host_0   |    -32768 |  54.122111 |  2147483647 | -2147483648 | 1800-05-31 10:00:00+00:00
  1969-12-29 00:00:00+00:00 | host_0   |        41 |         24 |          21 |           9 | 1970-01-01 15:00:04+00:00
  1970-01-26 00:00:00+00:00 | host_0   |        31 |         24 |          92 |           9 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_0   |        31 |         24 |          92 |           9 | 1970-02-02 10:00:04+00:00
  1800-05-26 00:00:00+00:00 | host_1   |        29 | -54.122111 |          84 |  2147483647 | 1800-05-31 10:00:00+00:00
  1969-12-29 00:00:00+00:00 | host_1   |        25 |         60 |          21 |          83 | 1970-01-01 15:00:04+00:00
  1970-01-26 00:00:00+00:00 | host_1   |        41 |         60 |          21 |          83 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_1   |        41 |         60 |          21 |          83 | 1970-02-02 10:00:04+00:00
  1970-05-25 00:00:00+00:00 | host_1   |        41 |         60 |          21 |          83 | 1970-05-31 22:00:03+00:00
  2023-05-29 00:00:00+00:00 | host_1   | NULL      |         60 |          21 |          83 | 2023-05-31 10:30:10+00:00
  1800-05-26 00:00:00+00:00 | host_2   |       -17 | NULL       |          29 |          63 | 1800-05-31 10:00:00+00:00
  1969-12-29 00:00:00+00:00 | host_2   |        22 |         44 |          58 |          61 | 1969-12-31 10:00:02+00:00
  1969-12-29 00:00:00+00:00 | host_2   |        25 |        -89 |          90 |          28 | 1970-01-01 15:00:04+00:00
  1970-01-26 00:00:00+00:00 | host_2   |        25 |        -89 |          90 |          28 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_2   |        25 |        -89 |          90 |          28 | 1970-02-02 10:00:04+00:00
  1970-05-25 00:00:00+00:00 | host_2   |        25 |         89 |          90 |          28 | 1970-05-31 22:00:03+00:00
  2023-05-29 00:00:00+00:00 | host_2   | NULL      |         89 |          90 |          28 | 2023-05-31 10:30:10+00:00
  1970-05-25 00:00:00+00:00 | host_3   |        22 |         44 |          58 |          61 | 1970-05-31 22:00:03+00:00
  2023-05-29 00:00:00+00:00 | host_3   |        22 |         44 |          58 |          61 | 2023-05-31 10:30:10+00:00
  1800-05-26 00:00:00+00:00 | host_3   |        30 |         24 |           8 |          78 | 1800-05-31 10:00:00+00:00
  1969-12-29 00:00:00+00:00 | host_3   |        29 |         44 |          84 |          61 | 1970-01-01 15:00:04+00:00
  1970-01-26 00:00:00+00:00 | host_3   |        22 |         44 |  2147483647 |          61 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_3   |        22 |         44 |  2147483647 |          61 | 1970-02-02 10:00:04+00:00
  2023-05-29 00:00:00+00:00 | host_3   | NULL      | NULL       |  2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  2023-05-29 00:00:00+00:00 | host_3   | NULL      | NULL       |  2147483647 | NULL        | 2023-05-31 10:00:08+00:00
  1800-05-26 00:00:00+00:00 | host_4   |        38 |         19 |           2 |           6 | 1800-05-31 10:00:00+00:00
  1969-12-29 00:00:00+00:00 | host_4   |       -17 |         77 |          29 |          87 | 1970-01-01 15:00:04+00:00
  1970-01-26 00:00:00+00:00 | host_4   |        29 |         77 |          84 |          87 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_4   |        29 |         77 |          84 |          87 | 1970-02-02 10:00:04+00:00
  1970-05-25 00:00:00+00:00 | host_4   |        29 |         77 |          84 |          87 | 1970-05-31 22:00:03+00:00
  2023-05-29 00:00:00+00:00 | host_4   | NULL      |         77 |          84 |          87 | 2023-05-31 10:30:10+00:00
  1800-05-26 00:00:00+00:00 | host_5   |       -81 |        -55 |         -76 |          -7 | 1800-05-31 10:00:00+00:00
  2023-05-29 00:00:00+00:00 | host_5   | NULL      | NULL       |  2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  1969-12-29 00:00:00+00:00 | host_5   |        30 |         49 |           8 |         -63 | 1970-01-01 15:00:04+00:00
  1970-01-26 00:00:00+00:00 | host_5   |        17 |         49 |          29 |         -63 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_5   |        17 |         49 |          29 |         -63 | 1970-02-02 10:00:04+00:00
  1970-05-25 00:00:00+00:00 | host_5   |        17 |         49 |          29 |          63 | 1970-05-31 22:00:03+00:00
  2023-05-29 00:00:00+00:00 | host_5   | NULL      |         49 |          29 |         -63 | 2023-05-31 10:30:10+00:00
  1969-12-29 00:00:00+00:00 | host_6   |       -38 | NULL       |           2 |           6 | 1969-12-31 10:00:02+00:00
  1800-05-26 00:00:00+00:00 | host_6   |        65 |         92 |          44 |         -67 | 1800-05-31 10:00:00+00:00
  1969-12-29 00:00:00+00:00 | host_6   |        30 |         24 |           8 |          78 | 1970-01-01 16:00:04+00:00
  1970-01-26 00:00:00+00:00 | host_6   |        30 |         24 |           8 |          78 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_6   |        30 |         24 |           8 |          78 | 1970-02-02 10:00:04+00:00
  1970-05-25 00:00:00+00:00 | host_6   |        30 |         24 |           8 |          78 | 1970-05-31 22:00:03+00:00
  2023-05-29 00:00:00+00:00 | host_6   | NULL      |         24 |           8 |         -78 | 2023-05-31 10:30:10+00:00
  1800-05-26 00:00:00+00:00 | host_7   |        31 |         24 |          92 |           9 | 1800-05-31 10:00:00+00:00
  1969-12-29 00:00:00+00:00 | host_7   |        81 | NULL       |           2 |           6 | 1970-01-01 17:00:04+00:00
  1970-01-26 00:00:00+00:00 | host_7   |        38 | NULL       |           2 |           6 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_7   |        38 | NULL       |           2 |           6 | 1970-02-02 10:00:04+00:00
  1970-05-25 00:00:00+00:00 | host_7   |        38 | NULL       |           2 |           6 | 1970-05-31 22:00:03+00:00
  2023-05-29 00:00:00+00:00 | host_7   | NULL      | NULL       |           2 |           6 | 2023-05-31 10:30:10+00:00
  2023-05-29 00:00:00+00:00 | host_8   | NULL      | NULL       |  2147483647 | NULL        | 2023-05-31 10:00:09+00:00
  1800-05-26 00:00:00+00:00 | host_8   |        41 |         60 |          21 |          83 | 1800-05-31 10:00:00+00:00
  1969-12-29 00:00:00+00:00 | host_8   |        65 |         55 |          44 |           7 | 1970-01-01 15:00:04+00:00
  1970-01-26 00:00:00+00:00 | host_8   |        81 |         55 |          76 |           7 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_8   |        81 |         55 |          76 |           7 | 1970-02-02 10:00:04+00:00
  1970-05-25 00:00:00+00:00 | host_8   |        81 |         55 |          76 |           7 | 1970-05-31 22:00:03+00:00
  2023-05-29 00:00:00+00:00 | host_8   | NULL      |         55 |          76 |           7 | 2023-05-31 10:30:10+00:00
  2023-05-29 00:00:00+00:00 | host_9   |        65 |        -92 |          44 |          67 | 2023-05-31 10:30:10+00:00
  1800-05-26 00:00:00+00:00 | host_9   |        25 |        -89 |          90 |          28 | 1800-05-31 10:00:00+00:00
  1969-12-29 00:00:00+00:00 | host_9   |        31 |         92 |          44 |          67 | 1970-01-01 16:00:04+00:00
  1970-01-26 00:00:00+00:00 | host_9   |        65 |         92 |          44 |          67 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_9   |        65 |         92 |          44 |          67 | 1970-02-02 10:00:04+00:00
  1970-05-25 00:00:00+00:00 | host_9   |        65 |         92 |          44 |          67 | 1970-05-31 22:00:03+00:00
  2023-05-29 00:00:00+00:00 | host_9   | NULL      | NULL       |  2147483647 | NULL        | 2023-05-31 10:00:09+00:00
(69 rows)
> SELECT time_bucket(k_timestamp, '2day') as k_timestamp_b,
       hostname,
       sum(usage_guest_nice),
       sum(usage_irq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1700-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |        sum         |  sum   |          last_ts
----------------------------+----------+--------------------+--------+----------------------------
  2023-05-31 00:00:00+00:00 | host_0   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  1800-05-30 00:00:00+00:00 | host_0   | 3.1415929794311523 | -32768 | 1800-05-31 10:00:00+00:00
  1970-05-31 00:00:00+00:00 | host_0   |                 69 |      1 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_0   |                 69 |      1 | 2023-05-31 10:30:10+00:00
  1800-05-30 00:00:00+00:00 | host_0   | 3.1415929794311523 | -32768 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_0   | NULL               |     84 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 | host_0   |                 69 |     -1 | 1970-01-01 15:00:04+00:00
  1970-01-31 00:00:00+00:00 | host_0   |                 69 |     -1 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_0   |                 69 |     -1 | 1970-02-02 10:00:04+00:00
  1800-05-30 00:00:00+00:00 | host_1   |                 74 |     20 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_1   |                 76 |     44 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 | host_1   | NULL               |     84 | 1970-01-01 15:00:04+00:00
  1970-01-31 00:00:00+00:00 | host_1   | NULL               |     84 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_1   | NULL               |     84 | 1970-02-02 10:00:04+00:00
  1970-05-31 00:00:00+00:00 | host_1   | NULL               |     84 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_1   | NULL               |    -84 | 2023-05-31 10:30:10+00:00
  1800-05-30 00:00:00+00:00 | host_2   |                  1 |     52 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_2   |                 38 |     63 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 | host_2   |                 76 |     44 | 1970-01-01 15:00:04+00:00
  1970-01-31 00:00:00+00:00 | host_2   |                 76 |     44 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_2   |                 76 |     44 | 1970-02-02 10:00:04+00:00
  1970-05-31 00:00:00+00:00 | host_2   |                 76 |     44 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_2   |                 76 |    -44 | 2023-05-31 10:30:10+00:00
  1970-05-31 00:00:00+00:00 | host_3   |                 38 |     63 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_3   |                 38 |     63 | 2023-05-31 10:30:10+00:00
  1800-05-30 00:00:00+00:00 | host_3   |                 82 |     81 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_3   |                 74 |     20 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 | host_3   |                 38 |     63 | 1970-01-01 15:00:04+00:00
  1970-01-31 00:00:00+00:00 | host_3   |                 38 |     63 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_3   |                 38 |     63 | 1970-02-02 10:00:04+00:00
  2023-05-31 00:00:00+00:00 | host_3   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 00:00:00+00:00 | host_3   | NULL               | NULL   | 2023-05-31 10:00:08+00:00
  1800-05-30 00:00:00+00:00 | host_4   |                 54 |     20 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_4   |                  1 |     52 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 | host_4   |                 74 |     20 | 1970-01-01 15:00:04+00:00
  1970-01-31 00:00:00+00:00 | host_4   |                 74 |     20 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_4   |                 74 |     20 | 1970-02-02 10:00:04+00:00
  1970-05-31 00:00:00+00:00 | host_4   |                 74 |     20 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_4   |                 74 |     20 | 2023-05-31 10:30:10+00:00
  1800-05-30 00:00:00+00:00 | host_5   |                -15 |    -20 | 1800-05-31 10:00:00+00:00
  2023-05-31 00:00:00+00:00 | host_5   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  1969-12-30 00:00:00+00:00 | host_5   |                 82 |     81 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 | host_5   |                  1 |    -52 | 1970-01-01 15:00:04+00:00
  1970-01-31 00:00:00+00:00 | host_5   |                  1 |    -52 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_5   |                  1 |    -52 | 1970-02-02 10:00:04+00:00
  1970-05-31 00:00:00+00:00 | host_5   |                  1 |     52 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_5   |                  1 |     52 | 2023-05-31 10:30:10+00:00
  1969-12-30 00:00:00+00:00 | host_6   |                 54 |     20 | 1969-12-31 10:00:02+00:00
  1800-05-30 00:00:00+00:00 | host_6   |                 31 |     11 | 1800-05-31 10:00:00+00:00
  1970-01-01 00:00:00+00:00 | host_6   |                 82 |    -81 | 1970-01-01 16:00:04+00:00
  1970-01-31 00:00:00+00:00 | host_6   |                 82 |    -81 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_6   |                 82 |    -81 | 1970-02-02 10:00:04+00:00
  1970-05-31 00:00:00+00:00 | host_6   |                 82 |     81 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_6   |                 82 |     81 | 2023-05-31 10:30:10+00:00
  1800-05-30 00:00:00+00:00 | host_7   |                 69 |     -1 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_7   |                 15 |     20 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 | host_7   |                 54 |    -20 | 1970-01-01 17:00:04+00:00
  1970-01-31 00:00:00+00:00 | host_7   |                 54 |    -20 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_7   |                 54 |    -20 | 1970-02-02 10:00:04+00:00
  1970-05-31 00:00:00+00:00 | host_7   |                 54 |    -20 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_7   |                 54 |    -20 | 2023-05-31 10:30:10+00:00
  2023-05-31 00:00:00+00:00 | host_8   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
  1800-05-30 00:00:00+00:00 | host_8   | NULL               |     84 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_8   |                 31 |     11 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 | host_8   |                 15 |     20 | 1970-01-01 15:00:04+00:00
  1970-01-31 00:00:00+00:00 | host_8   |                 15 |     20 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_8   |                 15 |     20 | 1970-02-02 10:00:04+00:00
  1970-05-31 00:00:00+00:00 | host_8   |                 15 |     20 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_8   |                 15 |    -20 | 2023-05-31 10:30:10+00:00
  2023-05-31 00:00:00+00:00 | host_9   |                 31 |     11 | 2023-05-31 10:30:10+00:00
  1800-05-30 00:00:00+00:00 | host_9   |                 76 |    -44 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_9   |                 69 |      1 | 1969-12-31 10:00:02+00:00
  1970-01-01 00:00:00+00:00 | host_9   |                 31 |     11 | 1970-01-01 16:00:04+00:00
  1970-01-31 00:00:00+00:00 | host_9   |                 31 |     11 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_9   |                 31 |     11 | 1970-02-02 10:00:04+00:00
  1970-05-31 00:00:00+00:00 | host_9   |                 31 |     11 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_9   | NULL               | NULL   | 2023-05-31 10:00:09+00:00
(77 rows)
> SELECT time_bucket(k_timestamp, '10d') as k_timestamp_b,
       hostname,
       min(usage_nice),
       firstts(usage_user),
       min(usage_guest), first (usage_idle), first (usage_softirq),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1100-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |     min     |          firstts          |   min    |    first    |   first    |          last_ts
----------------------------+----------+-------------+---------------------------+----------+-------------+------------+----------------------------
  2023-05-31 00:00:00+00:00 | host_0   | NULL        | 2023-05-31 10:00:09+00:00 | NULL     | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  1800-05-30 00:00:00+00:00 | host_0   | -2147483648 | 1800-05-31 10:00:00+00:00 | 3.141593 | -2147483648 |  54.122111 | 1800-05-31 10:00:00+00:00
  1970-05-29 00:00:00+00:00 | host_0   |           9 | 1970-05-31 22:00:03+00:00 |       96 |          99 |          2 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_0   |           9 | 2023-05-31 10:00:08+00:00 |       96 |          99 |          2 | 2023-05-31 10:30:10+00:00
  1800-05-30 00:00:00+00:00 | host_0   | -2147483648 | 1800-05-31 10:00:00+00:00 | 3.141593 | -2147483648 |  54.122111 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_0   |           9 | 1969-12-31 10:00:02+00:00 |       43 |         -90 |         26 | 1970-01-01 15:00:04+00:00
  1970-01-29 00:00:00+00:00 | host_0   |           9 | 1970-02-01 10:00:04+00:00 |       96 |          99 |          2 | 1970-02-02 10:00:04+00:00
  1800-05-30 00:00:00+00:00 | host_1   |  2147483647 | 1800-05-31 10:00:00+00:00 |       53 | -2147483648 | -54.122111 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_1   |          28 | 1969-12-31 10:00:02+00:00 |       11 |          81 |          8 | 1970-01-01 15:00:04+00:00
  1970-01-29 00:00:00+00:00 | host_1   |          83 | 1970-02-01 10:00:04+00:00 |       43 |          90 |         26 | 1970-02-02 10:00:04+00:00
  1970-05-29 00:00:00+00:00 | host_1   |          83 | 1970-05-31 22:00:03+00:00 |       43 |          90 |         26 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_1   |          83 | 2023-05-31 10:00:08+00:00 |       43 |          90 |         26 | 2023-05-31 10:30:10+00:00
  1800-05-30 00:00:00+00:00 | host_2   |          63 | 1800-05-31 10:00:00+00:00 |       93 |           5 |         60 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_2   |          61 | 1969-12-31 10:00:02+00:00 | NULL     |          24 |          6 | 1969-12-31 10:00:02+00:00
  1969-12-30 00:00:00+00:00 | host_2   |          28 | 1970-01-01 15:00:04+00:00 |       11 |          81 |          8 | 1970-01-01 15:00:04+00:00
  1970-01-29 00:00:00+00:00 | host_2   |          28 | 1970-02-01 10:00:04+00:00 |       11 |          81 |          8 | 1970-02-02 10:00:04+00:00
  1970-05-29 00:00:00+00:00 | host_2   |          28 | 1970-05-31 22:00:03+00:00 |       11 |          81 |          8 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_2   |          28 | 2023-05-31 10:00:08+00:00 |       11 |          81 |          8 | 2023-05-31 10:30:10+00:00
  1970-05-29 00:00:00+00:00 | host_3   |          61 | 1970-05-31 22:00:03+00:00 | NULL     |          24 |          6 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_3   |          61 | 2023-05-31 10:30:10+00:00 | NULL     |          24 |          6 | 2023-05-31 10:30:10+00:00
  1800-05-30 00:00:00+00:00 | host_3   |          78 | 1800-05-31 10:00:00+00:00 |       24 |         -89 |         33 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_3   |          61 | 1969-12-31 10:00:02+00:00 |       53 |          53 |         54 | 1970-01-01 15:00:04+00:00
  1970-01-29 00:00:00+00:00 | host_3   |          61 | 1970-02-01 10:00:04+00:00 | NULL     |          24 |          6 | 1970-02-02 10:00:04+00:00
  2023-05-31 00:00:00+00:00 | host_3   | NULL        | 2023-05-31 10:00:09+00:00 | NULL     | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 00:00:00+00:00 | host_3   | NULL        | 2023-05-31 10:00:08+00:00 | NULL     | NULL        | NULL       | 2023-05-31 10:00:08+00:00
  1800-05-30 00:00:00+00:00 | host_4   |           6 | 1800-05-31 10:00:00+00:00 |       40 |          64 |        -71 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_4   |          63 | 1969-12-31 10:00:02+00:00 |       53 |          -5 |         60 | 1970-01-01 15:00:04+00:00
  1970-01-29 00:00:00+00:00 | host_4   |          87 | 1970-02-01 10:00:04+00:00 |       53 |          53 |         54 | 1970-02-02 10:00:04+00:00
  1970-05-29 00:00:00+00:00 | host_4   |          87 | 1970-05-31 22:00:03+00:00 |       53 |          53 |         54 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_4   |          87 | 2023-05-31 10:00:08+00:00 |       53 |          53 |         54 | 2023-05-31 10:30:10+00:00
  1800-05-30 00:00:00+00:00 | host_5   |          -7 | 1800-05-31 10:00:00+00:00 | NULL     |         -63 |        -29 | 1800-05-31 10:00:00+00:00
  2023-05-31 00:00:00+00:00 | host_5   | NULL        | 2023-05-31 10:00:09+00:00 | NULL     | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  1969-12-30 00:00:00+00:00 | host_5   |         -78 | 1969-12-31 10:00:02+00:00 |       24 |          89 |         33 | 1970-01-01 15:00:04+00:00
  1970-01-29 00:00:00+00:00 | host_5   |         -63 | 1970-02-01 10:00:04+00:00 |       93 |           5 |         60 | 1970-02-02 10:00:04+00:00
  1970-05-29 00:00:00+00:00 | host_5   |          63 | 1970-05-31 22:00:03+00:00 |       93 |           5 |         60 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_5   |         -63 | 2023-05-31 10:00:08+00:00 |       93 |           5 |         60 | 2023-05-31 10:30:10+00:00
  1969-12-30 00:00:00+00:00 | host_6   |           6 | 1969-12-31 10:00:02+00:00 |       40 |         -64 |         71 | 1969-12-31 10:00:02+00:00
  1800-05-30 00:00:00+00:00 | host_6   |         -67 | 1800-05-31 10:00:00+00:00 |        0 |          20 |          7 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_6   |          78 | 1970-01-01 16:00:04+00:00 |       24 |          89 |         33 | 1970-01-01 16:00:04+00:00
  1970-01-29 00:00:00+00:00 | host_6   |          78 | 1970-02-01 10:00:04+00:00 |       24 |          89 |         33 | 1970-02-02 10:00:04+00:00
  1970-05-29 00:00:00+00:00 | host_6   |          78 | 1970-05-31 22:00:03+00:00 |       24 |          89 |         33 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_6   |         -78 | 2023-05-31 10:00:08+00:00 |       24 |          89 |         33 | 2023-05-31 10:30:10+00:00
  1800-05-30 00:00:00+00:00 | host_7   |           9 | 1800-05-31 10:00:00+00:00 |       96 |          99 |          2 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_7   |           6 | 1969-12-31 10:00:02+00:00 |       20 |          63 |         29 | 1970-01-01 17:00:04+00:00
  1970-01-29 00:00:00+00:00 | host_7   |           6 | 1970-02-01 10:00:04+00:00 |       40 |         -64 |         71 | 1970-02-02 10:00:04+00:00
  1970-05-29 00:00:00+00:00 | host_7   |           6 | 1970-05-31 22:00:03+00:00 |       40 |          64 |         71 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_7   |           6 | 2023-05-31 10:00:08+00:00 |      -40 |          64 |         71 | 2023-05-31 10:30:10+00:00
  2023-05-31 00:00:00+00:00 | host_8   | NULL        | 2023-05-31 10:00:09+00:00 | NULL     | NULL        | NULL       | 2023-05-31 10:00:09+00:00
  1800-05-30 00:00:00+00:00 | host_8   |          83 | 1800-05-31 10:00:00+00:00 |       43 |          90 |         26 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_8   |           7 | 1969-12-31 10:00:02+00:00 |        0 |          20 |          7 | 1970-01-01 15:00:04+00:00
  1970-01-29 00:00:00+00:00 | host_8   |           7 | 1970-02-01 10:00:04+00:00 |       20 |          63 |         29 | 1970-02-02 10:00:04+00:00
  1970-05-29 00:00:00+00:00 | host_8   |           7 | 1970-05-31 22:00:03+00:00 |       20 |          63 |         29 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_8   |           7 | 2023-05-31 10:00:08+00:00 |       20 |         -63 |         29 | 2023-05-31 10:30:10+00:00
  2023-05-31 00:00:00+00:00 | host_9   |          67 | 2023-05-31 10:30:10+00:00 |        0 |          20 |          7 | 2023-05-31 10:30:10+00:00
  1800-05-30 00:00:00+00:00 | host_9   |          28 | 1800-05-31 10:00:00+00:00 |       11 |          81 |          8 | 1800-05-31 10:00:00+00:00
  1969-12-30 00:00:00+00:00 | host_9   |          -9 | 1969-12-31 10:00:02+00:00 |        0 |          99 |         -2 | 1970-01-01 16:00:04+00:00
  1970-01-29 00:00:00+00:00 | host_9   |          67 | 1970-02-01 10:00:04+00:00 |        0 |          20 |          7 | 1970-02-02 10:00:04+00:00
  1970-05-29 00:00:00+00:00 | host_9   |          67 | 1970-05-31 22:00:03+00:00 |        0 |          20 |         -7 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_9   | NULL        | 2023-05-31 10:00:08+00:00 | NULL     | NULL        | NULL       | 2023-05-31 10:00:09+00:00
(59 rows)
> SELECT time_bucket(k_timestamp, '12hour') as k_timestamp_b,
       hostname,
    last (usage_system), avg (usage_guest), last (usage_idle), first (usage_user),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1500-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |    last     |        avg         |    last     |    first    |          last_ts
----------------------------+----------+-------------+--------------------+-------------+-------------+----------------------------
  2023-05-31 00:00:00+00:00 | host_0   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  1800-05-31 00:00:00+00:00 | host_0   | -2147483648 | 3.1415929794311523 | -2147483648 | -2147483648 | 1800-05-31 10:00:00+00:00
  1970-05-31 12:00:00+00:00 | host_0   |          35 |                 96 |          99 |          92 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_0   |          35 |                 96 |          99 |  2147483647 | 2023-05-31 10:30:10+00:00
  1800-05-31 00:00:00+00:00 | host_0   | -2147483648 | 3.1415929794311523 | -2147483648 |  2147483647 | 1800-05-31 10:00:00+00:00
  1969-12-31 00:00:00+00:00 | host_0   |          77 |                 43 |         -90 |          21 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_0   |          35 |                 96 |          99 |          92 | 1970-01-01 15:00:04+00:00
  1970-02-01 00:00:00+00:00 | host_0   |          35 |                 96 |          99 |          92 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_0   |          35 |                 96 |          99 |          92 | 1970-02-02 10:00:04+00:00
  1800-05-31 00:00:00+00:00 | host_1   |  2147483647 |                 53 | -2147483648 |          84 | 1800-05-31 10:00:00+00:00
  1969-12-31 00:00:00+00:00 | host_1   |           0 |                 11 |          81 |          90 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_1   |          77 |                 43 |          90 |          21 | 1970-01-01 15:00:04+00:00
  1970-02-01 00:00:00+00:00 | host_1   |          77 |                 43 |          90 |          21 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_1   |          77 |                 43 |          90 |          21 | 1970-02-02 10:00:04+00:00
  1970-05-31 12:00:00+00:00 | host_1   |          77 |                 43 |          90 |          21 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_1   |          77 |                 43 |          90 |  2147483647 | 2023-05-31 10:30:10+00:00
  1800-05-31 00:00:00+00:00 | host_2   |          48 |                 93 |           5 |          29 | 1800-05-31 10:00:00+00:00
  1969-12-31 00:00:00+00:00 | host_2   |          -2 | NULL               |          24 |          58 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_2   |           0 |                 11 |          81 |          90 | 1970-01-01 15:00:04+00:00
  1970-02-01 00:00:00+00:00 | host_2   |           0 |                 11 |          81 |          90 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_2   |           0 |                 11 |          81 |          90 | 1970-02-02 10:00:04+00:00
  1970-05-31 12:00:00+00:00 | host_2   |           0 |                 11 |          81 |          90 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_2   |           0 |                 11 |          81 |  2147483647 | 2023-05-31 10:30:10+00:00
  1970-05-31 12:00:00+00:00 | host_3   |        NULL | NULL               |          24 |          58 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_3   |        NULL | NULL               |          24 |          58 | 2023-05-31 10:30:10+00:00
  1800-05-31 00:00:00+00:00 | host_3   |          21 |                 24 |         -89 |           8 | 1800-05-31 10:00:00+00:00
  1969-12-31 00:00:00+00:00 | host_3   |          11 |                 53 |          53 |          84 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_3   |           2 | NULL               |          24 |  2147483647 | 1970-01-01 15:00:04+00:00
  1970-02-01 00:00:00+00:00 | host_3   |           2 | NULL               |          24 |  2147483647 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_3   |           2 | NULL               |          24 |  2147483647 | 1970-02-02 10:00:04+00:00
  2023-05-31 00:00:00+00:00 | host_3   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  2023-05-31 00:00:00+00:00 | host_3   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:08+00:00
  1800-05-31 00:00:00+00:00 | host_4   |          26 |                 40 |          64 |           2 | 1800-05-31 10:00:00+00:00
  1969-12-31 00:00:00+00:00 | host_4   |          48 |                 93 |          -5 |          29 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_4   |          11 |                 53 |          53 |          84 | 1970-01-01 15:00:04+00:00
  1970-02-01 00:00:00+00:00 | host_4   |          11 |                 53 |          53 |          84 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_4   |          11 |                 53 |          53 |          84 | 1970-02-02 10:00:04+00:00
  1970-05-31 12:00:00+00:00 | host_4   |          11 |                 53 |          53 |          84 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_4   |          11 |                 53 |          53 |  2147483647 | 2023-05-31 10:30:10+00:00
  1800-05-31 00:00:00+00:00 | host_5   |         -40 | NULL               |         -63 |         -76 | 1800-05-31 10:00:00+00:00
  2023-05-31 00:00:00+00:00 | host_5   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  1969-12-31 00:00:00+00:00 | host_5   |          21 |                 24 |          89 |           8 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_5   |          48 |                 93 |           5 |          29 | 1970-01-01 15:00:04+00:00
  1970-02-01 00:00:00+00:00 | host_5   |          48 |                 93 |           5 |          29 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_5   |          48 |                 93 |           5 |          29 | 1970-02-02 10:00:04+00:00
  1970-05-31 12:00:00+00:00 | host_5   |          48 |                 93 |           5 |          29 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_5   |          48 |                 93 |           5 |  2147483647 | 2023-05-31 10:30:10+00:00
  1969-12-31 00:00:00+00:00 | host_6   |          26 |                 40 |         -64 |           2 | 1969-12-31 10:00:02+00:00
  1800-05-31 00:00:00+00:00 | host_6   |          70 |                  0 |          20 |          44 | 1800-05-31 10:00:00+00:00
  1970-01-01 12:00:00+00:00 | host_6   |          21 |                 24 |          89 |           8 | 1970-01-01 16:00:04+00:00
  1970-02-01 00:00:00+00:00 | host_6   |          21 |                 24 |          89 |           8 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_6   |          21 |                 24 |          89 |           8 | 1970-02-02 10:00:04+00:00
  1970-05-31 12:00:00+00:00 | host_6   |          21 |                 24 |          89 |           8 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_6   |          21 |                 24 |          89 |  2147483647 | 2023-05-31 10:30:10+00:00
  1800-05-31 00:00:00+00:00 | host_7   |          35 |                 96 |          99 |          92 | 1800-05-31 10:00:00+00:00
  1969-12-31 00:00:00+00:00 | host_7   |          40 |                 20 |          63 |          76 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_7   |          26 |                 40 |         -64 |           2 | 1970-01-01 17:00:04+00:00
  1970-02-01 00:00:00+00:00 | host_7   |          26 |                 40 |         -64 |           2 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_7   |          26 |                 40 |         -64 |           2 | 1970-02-02 10:00:04+00:00
  1970-05-31 12:00:00+00:00 | host_7   |          26 |                 40 |          64 |           2 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_7   |          26 |                -40 |          64 |  2147483647 | 2023-05-31 10:30:10+00:00
  2023-05-31 00:00:00+00:00 | host_8   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
  1800-05-31 00:00:00+00:00 | host_8   |          77 |                 43 |          90 |          21 | 1800-05-31 10:00:00+00:00
  1969-12-31 00:00:00+00:00 | host_8   |          70 |                  0 |          20 |          44 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_8   |          40 |                 20 |          63 |          76 | 1970-01-01 15:00:04+00:00
  1970-02-01 00:00:00+00:00 | host_8   |          40 |                 20 |          63 |          76 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_8   |          40 |                 20 |          63 |          76 | 1970-02-02 10:00:04+00:00
  1970-05-31 12:00:00+00:00 | host_8   |          40 |                 20 |          63 |          76 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_8   |          40 |                 20 |         -63 |  2147483647 | 2023-05-31 10:30:10+00:00
  2023-05-31 00:00:00+00:00 | host_9   |          70 |                  0 |          20 |          44 | 2023-05-31 10:30:10+00:00
  1800-05-31 00:00:00+00:00 | host_9   |           0 |                 11 |          81 |          90 | 1800-05-31 10:00:00+00:00
  1969-12-31 00:00:00+00:00 | host_9   |          35 |                 96 |          99 |          92 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_9   |          70 |                  0 |          20 |          44 | 1970-01-01 16:00:04+00:00
  1970-02-01 00:00:00+00:00 | host_9   |          70 |                  0 |          20 |          44 | 1970-02-01 10:00:04+00:00
  1970-02-02 00:00:00+00:00 | host_9   |          70 |                  0 |          20 |          44 | 1970-02-02 10:00:04+00:00
  1970-05-31 12:00:00+00:00 | host_9   |          70 |                  0 |          20 |          44 | 1970-05-31 22:00:03+00:00
  2023-05-31 00:00:00+00:00 | host_9   |        NULL | NULL               | NULL        |  2147483647 | 2023-05-31 10:00:09+00:00
(77 rows)
> SELECT time_bucket(k_timestamp, '3hrs') as k_timestamp_b,
       hostname,
       count(usage_iowait), last (usage_guest_nice), sum (usage_softirq), first_row(usage_user),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1800-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts

    LIMIT 1
OFFSET 1;
        k_timestamp_b       | hostname | count |   last   |    sum    |  first_row  |          last_ts
----------------------------+----------+-------+----------+-----------+-------------+----------------------------
  1800-05-31 09:00:00+00:00 | host_0   |     1 | 3.141593 | 54.122111 | -2147483648 | 1800-05-31 10:00:00+00:00
(1 row)
> SELECT time_bucket(k_timestamp, '2hr') as k_timestamp_b,
       hostname,
       firstts(usage_iowait), last (usage_user), min (usage_steal),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1600-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          firstts          |    last     |    min     |          last_ts
----------------------------+----------+---------------------------+-------------+------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | NULL                      |  2147483647 | NULL       | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_0   | 1800-05-31 10:00:00+00:00 | -2147483648 |  54.122111 | 1800-05-31 10:00:00+00:00
  1970-05-31 22:00:00+00:00 | host_0   | 1970-05-31 22:00:03+00:00 |          92 |         24 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:30:10+00:00 |          92 |         24 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_0   | 1800-05-31 10:00:00+00:00 |  2147483647 |  54.122111 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_0   | 1969-12-31 10:00:02+00:00 |          21 |         60 | 1969-12-31 10:00:02+00:00
  1970-01-01 14:00:00+00:00 | host_0   | 1970-01-01 15:00:04+00:00 |          92 |         24 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_0   | 1970-02-01 10:00:04+00:00 |          92 |         24 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_0   | 1970-02-02 10:00:04+00:00 |          92 |         24 | 1970-02-02 10:00:04+00:00
  1800-05-31 10:00:00+00:00 | host_1   | 1800-05-31 10:00:00+00:00 |          84 | -54.122111 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_1   | 1969-12-31 10:00:02+00:00 |          90 |        -89 | 1969-12-31 10:00:02+00:00
  1970-01-01 14:00:00+00:00 | host_1   | 1970-01-01 15:00:04+00:00 |          21 |         60 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_1   | 1970-02-01 10:00:04+00:00 |          21 |         60 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_1   | 1970-02-02 10:00:04+00:00 |          21 |         60 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_1   | 1970-05-31 22:00:03+00:00 |          21 |         60 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_1   | 2023-05-31 10:30:10+00:00 |          21 |         60 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_2   | 1800-05-31 10:00:00+00:00 |          29 | NULL       | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_2   | 1969-12-31 10:00:02+00:00 |          58 |         44 | 1969-12-31 10:00:02+00:00
  1970-01-01 14:00:00+00:00 | host_2   | 1970-01-01 15:00:04+00:00 |          90 |        -89 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_2   | 1970-02-01 10:00:04+00:00 |          90 |        -89 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_2   | 1970-02-02 10:00:04+00:00 |          90 |        -89 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_2   | 1970-05-31 22:00:03+00:00 |          90 |         89 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_2   | 2023-05-31 10:30:10+00:00 |          90 |         89 | 2023-05-31 10:30:10+00:00
  1970-05-31 22:00:00+00:00 | host_3   | 1970-05-31 22:00:03+00:00 |          58 |         44 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:30:10+00:00 |          58 |         44 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_3   | 1800-05-31 10:00:00+00:00 |           8 |         24 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_3   | 1969-12-31 10:00:02+00:00 |          84 |         77 | 1969-12-31 10:00:02+00:00
  1970-01-01 14:00:00+00:00 | host_3   | 1970-01-01 15:00:04+00:00 |  2147483647 |         44 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_3   | 1970-02-01 10:00:04+00:00 |  2147483647 |         44 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_3   | 1970-02-02 10:00:04+00:00 |  2147483647 |         44 | 1970-02-02 10:00:04+00:00
  2023-05-31 10:00:00+00:00 | host_3   | NULL                      |  2147483647 | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:00+00:00 | host_3   | NULL                      |  2147483647 | NULL       | 2023-05-31 10:00:08+00:00
  1800-05-31 10:00:00+00:00 | host_4   | 1800-05-31 10:00:00+00:00 |           2 |         19 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_4   | 1969-12-31 10:00:02+00:00 |          29 |         49 | 1969-12-31 10:00:02+00:00
  1970-01-01 14:00:00+00:00 | host_4   | 1970-01-01 15:00:04+00:00 |          84 |         77 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_4   | 1970-02-01 10:00:04+00:00 |          84 |         77 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_4   | 1970-02-02 10:00:04+00:00 |          84 |         77 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_4   | 1970-05-31 22:00:03+00:00 |          84 |         77 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:30:10+00:00 |          84 |         77 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_5   | 1800-05-31 10:00:00+00:00 |         -76 |        -55 | 1800-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL                      |  2147483647 | NULL       | 2023-05-31 10:00:09+00:00
  1969-12-31 10:00:00+00:00 | host_5   | 1969-12-31 10:00:02+00:00 |           8 |         24 | 1969-12-31 10:00:02+00:00
  1970-01-01 14:00:00+00:00 | host_5   | 1970-01-01 15:00:04+00:00 |          29 |         49 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_5   | 1970-02-01 10:00:04+00:00 |          29 |         49 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_5   | 1970-02-02 10:00:04+00:00 |          29 |         49 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_5   | 1970-05-31 22:00:03+00:00 |          29 |         49 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:30:10+00:00 |          29 |         49 | 2023-05-31 10:30:10+00:00
  1969-12-31 10:00:00+00:00 | host_6   | 1969-12-31 10:00:02+00:00 |           2 | NULL       | 1969-12-31 10:00:02+00:00
  1800-05-31 10:00:00+00:00 | host_6   | 1800-05-31 10:00:00+00:00 |          44 |         92 | 1800-05-31 10:00:00+00:00
  1970-01-01 16:00:00+00:00 | host_6   | 1970-01-01 16:00:04+00:00 |           8 |         24 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_6   | 1970-02-01 10:00:04+00:00 |           8 |         24 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_6   | 1970-02-02 10:00:04+00:00 |           8 |         24 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_6   | 1970-05-31 22:00:03+00:00 |           8 |         24 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:30:10+00:00 |           8 |         24 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_7   | 1800-05-31 10:00:00+00:00 |          92 |         24 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_7   | 1969-12-31 10:00:02+00:00 |          76 |         55 | 1969-12-31 10:00:02+00:00
  1970-01-01 16:00:00+00:00 | host_7   | 1970-01-01 17:00:04+00:00 |           2 | NULL       | 1970-01-01 17:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_7   | 1970-02-01 10:00:04+00:00 |           2 | NULL       | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_7   | 1970-02-02 10:00:04+00:00 |           2 | NULL       | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_7   | 1970-05-31 22:00:03+00:00 |           2 | NULL       | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:30:10+00:00 |           2 | NULL       | 2023-05-31 10:30:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | NULL                      |  2147483647 | NULL       | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_8   | 1800-05-31 10:00:00+00:00 |          21 |         60 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_8   | 1969-12-31 10:00:02+00:00 |          44 |         92 | 1969-12-31 10:00:02+00:00
  1970-01-01 14:00:00+00:00 | host_8   | 1970-01-01 15:00:04+00:00 |          76 |         55 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_8   | 1970-02-01 10:00:04+00:00 |          76 |         55 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_8   | 1970-02-02 10:00:04+00:00 |          76 |         55 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_8   | 1970-05-31 22:00:03+00:00 |          76 |         55 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:30:10+00:00 |          76 |         55 | 2023-05-31 10:30:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:30:10+00:00 |          44 |        -92 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_9   | 1800-05-31 10:00:00+00:00 |          90 |        -89 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_9   | 1969-12-31 10:00:02+00:00 |          92 |         24 | 1969-12-31 10:00:02+00:00
  1970-01-01 16:00:00+00:00 | host_9   | 1970-01-01 16:00:04+00:00 |          44 |         92 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_9   | 1970-02-01 10:00:04+00:00 |          44 |         92 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_9   | 1970-02-02 10:00:04+00:00 |          44 |         92 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_9   | 1970-05-31 22:00:03+00:00 |          44 |         92 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_9   | NULL                      |  2147483647 | NULL       | 2023-05-31 10:00:09+00:00
(77 rows)
> SELECT time_bucket(k_timestamp, '7h') as k_timestamp_b,
       hostname,
       first_row(usage_guest),
       firstts(usage_system),
       lastts(usage_system),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1700-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname | first_row |          firstts          |          lastts           |          last_ts
----------------------------+----------+-----------+---------------------------+---------------------------+----------------------------
  2023-05-31 08:00:00+00:00 | host_0   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  1800-05-31 06:00:00+00:00 | host_0   |  3.141593 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1970-05-31 17:00:00+00:00 | host_0   |        96 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 08:00:00+00:00 | host_0   | NULL      | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1800-05-31 06:00:00+00:00 | host_0   |  3.141593 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 08:00:00+00:00 | host_0   |        43 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_0   |        96 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_0   |        96 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 07:00:00+00:00 | host_0   |        96 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1800-05-31 06:00:00+00:00 | host_1   |        53 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 08:00:00+00:00 | host_1   |        11 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_1   |        43 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_1   |        43 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 07:00:00+00:00 | host_1   |        43 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 17:00:00+00:00 | host_1   |        43 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 08:00:00+00:00 | host_1   | NULL      | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1800-05-31 06:00:00+00:00 | host_2   |        93 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 08:00:00+00:00 | host_2   | NULL      | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_2   |        11 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_2   |        11 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 07:00:00+00:00 | host_2   |        11 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 17:00:00+00:00 | host_2   |        11 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 08:00:00+00:00 | host_2   | NULL      | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1970-05-31 17:00:00+00:00 | host_3   | NULL      | NULL                      | NULL                      | 1970-05-31 22:00:03+00:00
  2023-05-31 08:00:00+00:00 | host_3   | NULL      | NULL                      | NULL                      | 2023-05-31 10:30:10+00:00
  1800-05-31 06:00:00+00:00 | host_3   |        24 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 08:00:00+00:00 | host_3   |        53 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_3   | NULL      | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_3   | NULL      | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 07:00:00+00:00 | host_3   | NULL      | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  2023-05-31 08:00:00+00:00 | host_3   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 08:00:00+00:00 | host_3   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:08+00:00
  1800-05-31 06:00:00+00:00 | host_4   |        40 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 08:00:00+00:00 | host_4   |        93 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_4   |        53 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_4   |        53 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 07:00:00+00:00 | host_4   |        53 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 17:00:00+00:00 | host_4   |        53 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 08:00:00+00:00 | host_4   | NULL      | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1800-05-31 06:00:00+00:00 | host_5   | NULL      | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  2023-05-31 08:00:00+00:00 | host_5   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  1969-12-31 08:00:00+00:00 | host_5   |        24 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_5   |        93 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_5   |        93 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 07:00:00+00:00 | host_5   |        93 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 17:00:00+00:00 | host_5   |        93 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 08:00:00+00:00 | host_5   | NULL      | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1969-12-31 08:00:00+00:00 | host_6   |        40 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1800-05-31 06:00:00+00:00 | host_6   |         0 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1970-01-01 12:00:00+00:00 | host_6   |        24 | 1970-01-01 16:00:04+00:00 | 1970-01-01 16:00:04+00:00 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_6   |        24 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 07:00:00+00:00 | host_6   |        24 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 17:00:00+00:00 | host_6   |        24 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 08:00:00+00:00 | host_6   | NULL      | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1800-05-31 06:00:00+00:00 | host_7   |        96 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 08:00:00+00:00 | host_7   |        20 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_7   |        40 | 1970-01-01 17:00:04+00:00 | 1970-01-01 17:00:04+00:00 | 1970-01-01 17:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_7   |        40 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 07:00:00+00:00 | host_7   |        40 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 17:00:00+00:00 | host_7   |        40 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 08:00:00+00:00 | host_7   | NULL      | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  2023-05-31 08:00:00+00:00 | host_8   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
  1800-05-31 06:00:00+00:00 | host_8   |        43 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 08:00:00+00:00 | host_8   |         0 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_8   |        20 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_8   |        20 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 07:00:00+00:00 | host_8   |        20 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 17:00:00+00:00 | host_8   |        20 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 08:00:00+00:00 | host_8   | NULL      | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  2023-05-31 08:00:00+00:00 | host_9   |         0 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1800-05-31 06:00:00+00:00 | host_9   |        11 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 08:00:00+00:00 | host_9   |        96 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 12:00:00+00:00 | host_9   |         0 | 1970-01-01 16:00:04+00:00 | 1970-01-01 16:00:04+00:00 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_9   |         0 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 07:00:00+00:00 | host_9   |         0 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 17:00:00+00:00 | host_9   |         0 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 08:00:00+00:00 | host_9   | NULL      | NULL                      | NULL                      | 2023-05-31 10:00:09+00:00
(77 rows)
> SELECT time_bucket(k_timestamp, '2minute') as k_timestamp_b,
       hostname,
    first (usage_steal), count (usage_system), firstts(usage_steal), lastts(usage_steal), first_row(usage_steal),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1600-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |   first    | count |          firstts          |          lastts           | first_row  |          last_ts
----------------------------+----------+------------+-------+---------------------------+---------------------------+------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_0   |  54.122111 |     1 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |  54.122111 | 1800-05-31 10:00:00+00:00
  1970-05-31 22:00:00+00:00 | host_0   |         24 |     1 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         24 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_0   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:08+00:00
  2023-05-31 10:30:00+00:00 | host_0   |         24 |     1 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |         24 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_0   |  54.122111 |     1 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |  54.122111 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_0   |         60 |     1 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         60 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_0   |         24 |     1 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 |         24 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_0   |         24 |     1 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |         24 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_0   |         24 |     1 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |         24 | 1970-02-02 10:00:04+00:00
  1800-05-31 10:00:00+00:00 | host_1   | -54.122111 |     1 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | -54.122111 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_1   |        -89 |     1 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |        -89 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_1   |         60 |     1 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 |         60 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_1   |         60 |     1 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |         60 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_1   |         60 |     1 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |         60 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_1   |         60 |     1 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         60 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_1   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_1   |         60 |     1 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |         60 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_2   | NULL       |     1 | NULL                      | NULL                      | NULL       | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_2   |         44 |     1 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         44 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_2   |        -89 |     1 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 |        -89 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_2   |        -89 |     1 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |        -89 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_2   |        -89 |     1 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |        -89 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_2   |         89 |     1 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         89 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_2   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_2   |         89 |     1 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |         89 | 2023-05-31 10:30:10+00:00
  1970-05-31 22:00:00+00:00 | host_3   |         44 |     0 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         44 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:30:00+00:00 | host_3   |         44 |     0 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |         44 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_3   |         24 |     1 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |         24 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_3   |         77 |     1 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         77 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_3   |         44 |     1 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 |         44 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_3   |         44 |     1 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |         44 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_3   |         44 |     1 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |         44 | 1970-02-02 10:00:04+00:00
  2023-05-31 10:00:00+00:00 | host_3   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:00+00:00 | host_3   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:08+00:00
  1800-05-31 10:00:00+00:00 | host_4   |         19 |     1 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |         19 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_4   |         49 |     1 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         49 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_4   |         77 |     1 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 |         77 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_4   |         77 |     1 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |         77 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_4   |         77 |     1 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |         77 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_4   |         77 |     1 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         77 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_4   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_4   |         77 |     1 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |         77 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_5   |        -55 |     1 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |        -55 | 1800-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  1969-12-31 10:00:00+00:00 | host_5   |         24 |     1 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         24 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_5   |         49 |     1 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 |         49 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_5   |         49 |     1 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |         49 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_5   |         49 |     1 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |         49 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_5   |         49 |     1 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         49 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:08+00:00
  2023-05-31 10:30:00+00:00 | host_5   |         49 |     1 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |         49 | 2023-05-31 10:30:10+00:00
  1969-12-31 10:00:00+00:00 | host_6   | NULL       |     1 | NULL                      | NULL                      | NULL       | 1969-12-31 10:00:02+00:00
  1800-05-31 10:00:00+00:00 | host_6   |         92 |     1 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |         92 | 1800-05-31 10:00:00+00:00
  1970-01-01 16:00:00+00:00 | host_6   |         24 |     1 | 1970-01-01 16:00:04+00:00 | 1970-01-01 16:00:04+00:00 |         24 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_6   |         24 |     1 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |         24 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_6   |         24 |     1 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |         24 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_6   |         24 |     1 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         24 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_6   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_6   |         24 |     1 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |         24 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_7   |         24 |     1 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |         24 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_7   |         55 |     1 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         55 | 1969-12-31 10:00:02+00:00
  1970-01-01 17:00:00+00:00 | host_7   | NULL       |     1 | NULL                      | NULL                      | NULL       | 1970-01-01 17:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_7   | NULL       |     1 | NULL                      | NULL                      | NULL       | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_7   | NULL       |     1 | NULL                      | NULL                      | NULL       | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_7   | NULL       |     1 | NULL                      | NULL                      | NULL       | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_7   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_7   | NULL       |     1 | NULL                      | NULL                      | NULL       | 2023-05-31 10:30:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_8   |         60 |     1 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |         60 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_8   |         92 |     1 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         92 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_8   |         55 |     1 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 |         55 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_8   |         55 |     1 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |         55 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_8   |         55 |     1 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |         55 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_8   |         55 |     1 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         55 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_8   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:08+00:00
  2023-05-31 10:30:00+00:00 | host_8   |         55 |     1 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |         55 | 2023-05-31 10:30:10+00:00
  2023-05-31 10:30:00+00:00 | host_9   |        -92 |     1 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |        -92 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_9   |        -89 |     1 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |        -89 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_9   |         24 |     1 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         24 | 1969-12-31 10:00:02+00:00
  1970-01-01 16:00:00+00:00 | host_9   |         92 |     1 | 1970-01-01 16:00:04+00:00 | 1970-01-01 16:00:04+00:00 |         92 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_9   |         92 |     1 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |         92 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_9   |         92 |     1 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |         92 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_9   |         92 |     1 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         92 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_9   | NULL       |     0 | NULL                      | NULL                      | NULL       | 2023-05-31 10:00:09+00:00
(85 rows)
> SELECT time_bucket(k_timestamp, '15mins') as k_timestamp_b,
       hostname,
    first (usage_guest_nice), last (usage_guest), first (usage_iowait), firstts(usage_guest),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1600-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |  first   |   last   | first  |          firstts          |          last_ts
----------------------------+----------+----------+----------+--------+---------------------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_0   | 3.141593 | 3.141593 | -32768 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1970-05-31 22:00:00+00:00 | host_0   |       69 |       96 |     31 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_0   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:30:00+00:00 | host_0   |       69 |       96 |    -31 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_0   | 3.141593 | 3.141593 | -32768 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_0   | NULL     |       43 |     41 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_0   |       69 |       96 |     31 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_0   |       69 |       96 |     31 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_0   |       69 |       96 |     31 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1800-05-31 10:00:00+00:00 | host_1   |       74 |       53 |     29 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_1   |       76 |       11 |     25 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_1   | NULL     |       43 |     41 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_1   | NULL     |       43 |     41 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_1   | NULL     |       43 |     41 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_1   | NULL     |       43 |     41 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_1   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_1   | NULL     |       43 |     41 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_2   |        1 |       93 |    -17 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_2   |       38 | NULL     |     22 | NULL                      | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_2   |       76 |       11 |     25 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_2   |       76 |       11 |     25 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_2   |       76 |       11 |     25 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_2   |       76 |       11 |     25 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_2   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_2   |       76 |       11 |     25 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1970-05-31 22:00:00+00:00 | host_3   |       38 | NULL     |     22 | NULL                      | 1970-05-31 22:00:03+00:00
  2023-05-31 10:30:00+00:00 | host_3   |       38 | NULL     |     22 | NULL                      | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_3   |       82 |       24 |     30 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_3   |       74 |       53 |     29 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_3   |       38 | NULL     |     22 | NULL                      | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_3   |       38 | NULL     |     22 | NULL                      | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_3   |       38 | NULL     |     22 | NULL                      | 1970-02-02 10:00:04+00:00
  2023-05-31 10:00:00+00:00 | host_3   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:00+00:00 | host_3   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:08+00:00
  1800-05-31 10:00:00+00:00 | host_4   |       54 |       40 |     38 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_4   |        1 |       93 |    -17 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_4   |       74 |       53 |     29 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_4   |       74 |       53 |     29 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_4   |       74 |       53 |     29 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_4   |       74 |       53 |     29 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_4   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_4   |       74 |       53 |     29 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_5   |      -15 | NULL     |    -81 | NULL                      | 1800-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  1969-12-31 10:00:00+00:00 | host_5   |       82 |       24 |     30 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_5   |        1 |       93 |     17 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_5   |        1 |       93 |     17 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_5   |        1 |       93 |     17 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_5   |        1 |       93 |     17 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:30:00+00:00 | host_5   |        1 |       93 |     17 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1969-12-31 10:00:00+00:00 | host_6   |       54 |       40 |    -38 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1800-05-31 10:00:00+00:00 | host_6   |       31 |        0 |     65 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1970-01-01 16:00:00+00:00 | host_6   |       82 |       24 |     30 | 1970-01-01 16:00:04+00:00 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_6   |       82 |       24 |     30 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_6   |       82 |       24 |     30 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_6   |       82 |       24 |     30 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_6   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_6   |       82 |       24 |     30 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_7   |       69 |       96 |     31 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_7   |       15 |       20 |     81 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 17:00:00+00:00 | host_7   |       54 |       40 |     38 | 1970-01-01 17:00:04+00:00 | 1970-01-01 17:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_7   |       54 |       40 |     38 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_7   |       54 |       40 |     38 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_7   |       54 |       40 |     38 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_7   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_7   |       54 |      -40 |     38 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_8   | NULL     |       43 |     41 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_8   |       31 |        0 |     65 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_8   |       15 |       20 |     81 | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_8   |       15 |       20 |     81 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_8   |       15 |       20 |     81 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_8   |       15 |       20 |     81 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_8   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:08+00:00
  2023-05-31 10:30:00+00:00 | host_8   |       15 |       20 |     81 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  2023-05-31 10:30:00+00:00 | host_9   |       31 |        0 |     65 | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_9   |       76 |       11 |     25 | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_9   |       69 |       96 |     31 | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00
  1970-01-01 16:00:00+00:00 | host_9   |       31 |        0 |     65 | 1970-01-01 16:00:04+00:00 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_9   |       31 |        0 |     65 | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_9   |       31 |        0 |     65 | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_9   |       31 |        0 |     65 | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_9   | NULL     | NULL     | NULL   | NULL                      | 2023-05-31 10:00:09+00:00
(85 rows)
> SELECT time_bucket(k_timestamp, '60min') as k_timestamp_b,
       hostname,
       lastts(usage_user),
       firstts(usage_guest_nice), last (usage_softirq), last_row(usage_softirq),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1600-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          lastts           |          firstts          |    last    |  last_row  |          last_ts
----------------------------+----------+---------------------------+---------------------------+------------+------------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL       | NULL       | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_0   | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |  54.122111 |  54.122111 | 1800-05-31 10:00:00+00:00
  1970-05-31 22:00:00+00:00 | host_0   | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |          2 |          2 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_0   | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |          2 |          2 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_0   | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |  54.122111 |  54.122111 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_0   | 1969-12-31 10:00:02+00:00 | NULL                      |         26 |         26 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_0   | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 |          2 |          2 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_0   | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |          2 |          2 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_0   | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |          2 |          2 | 1970-02-02 10:00:04+00:00
  1800-05-31 10:00:00+00:00 | host_1   | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 | -54.122111 | -54.122111 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_1   | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |          8 |          8 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_1   | 1970-01-01 15:00:04+00:00 | NULL                      |         26 |         26 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_1   | 1970-02-01 10:00:04+00:00 | NULL                      |         26 |         26 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_1   | 1970-02-02 10:00:04+00:00 | NULL                      |         26 |         26 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_1   | 1970-05-31 22:00:03+00:00 | NULL                      |         26 |         26 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_1   | 2023-05-31 10:30:10+00:00 | NULL                      |         26 |         26 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_2   | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |         60 |         60 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_2   | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |          6 |          6 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_2   | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 |          8 |          8 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_2   | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |          8 |          8 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_2   | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |          8 |          8 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_2   | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |          8 |          8 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_2   | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |          8 |          8 | 2023-05-31 10:30:10+00:00
  1970-05-31 22:00:00+00:00 | host_3   | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |          6 |          6 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |          6 |          6 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_3   | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |         33 |         33 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_3   | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         54 |         54 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_3   | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 |          6 |          6 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_3   | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |          6 |          6 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_3   | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |          6 |          6 | 1970-02-02 10:00:04+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL       | NULL       | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:00+00:00 | host_3   | 2023-05-31 10:00:08+00:00 | NULL                      | NULL       | NULL       | 2023-05-31 10:00:08+00:00
  1800-05-31 10:00:00+00:00 | host_4   | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |        -71 |        -71 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_4   | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         60 |         60 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_4   | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 |         54 |         54 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_4   | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |         54 |         54 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_4   | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |         54 |         54 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_4   | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         54 |         54 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_4   | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |         54 |         54 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_5   | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |        -29 |        -29 | 1800-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL       | NULL       | 2023-05-31 10:00:09+00:00
  1969-12-31 10:00:00+00:00 | host_5   | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         33 |         33 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_5   | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 |         60 |         60 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_5   | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |         60 |         60 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_5   | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |         60 |         60 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_5   | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         60 |         60 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_5   | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |         60 |         60 | 2023-05-31 10:30:10+00:00
  1969-12-31 10:00:00+00:00 | host_6   | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         71 |         71 | 1969-12-31 10:00:02+00:00
  1800-05-31 10:00:00+00:00 | host_6   | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |          7 |          7 | 1800-05-31 10:00:00+00:00
  1970-01-01 16:00:00+00:00 | host_6   | 1970-01-01 16:00:04+00:00 | 1970-01-01 16:00:04+00:00 |         33 |         33 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_6   | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |         33 |         33 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_6   | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |         33 |         33 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_6   | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         33 |         33 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_6   | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |         33 |         33 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_7   | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |          2 |          2 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_7   | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         29 |         29 | 1969-12-31 10:00:02+00:00
  1970-01-01 17:00:00+00:00 | host_7   | 1970-01-01 17:00:04+00:00 | 1970-01-01 17:00:04+00:00 |         71 |         71 | 1970-01-01 17:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_7   | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |         71 |         71 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_7   | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |         71 |         71 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_7   | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         71 |         71 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_7   | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |         71 |         71 | 2023-05-31 10:30:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL       | NULL       | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_8   | 1800-05-31 10:00:00+00:00 | NULL                      |         26 |         26 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_8   | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |          7 |          7 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_8   | 1970-01-01 15:00:04+00:00 | 1970-01-01 15:00:04+00:00 |         29 |         29 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_8   | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |         29 |         29 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_8   | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |         29 |         29 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_8   | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         29 |         29 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_8   | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |         29 |         29 | 2023-05-31 10:30:10+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:30:10+00:00 | 2023-05-31 10:30:10+00:00 |          7 |          7 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_9   | 1800-05-31 10:00:00+00:00 | 1800-05-31 10:00:00+00:00 |          8 |          8 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_9   | 1969-12-31 10:00:02+00:00 | 1969-12-31 10:00:02+00:00 |         -2 |         -2 | 1969-12-31 10:00:02+00:00
  1970-01-01 16:00:00+00:00 | host_9   | 1970-01-01 16:00:04+00:00 | 1970-01-01 16:00:04+00:00 |          7 |          7 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_9   | 1970-02-01 10:00:04+00:00 | 1970-02-01 10:00:04+00:00 |          7 |          7 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_9   | 1970-02-02 10:00:04+00:00 | 1970-02-02 10:00:04+00:00 |          7 |          7 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_9   | 1970-05-31 22:00:03+00:00 | 1970-05-31 22:00:03+00:00 |         -7 |         -7 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_9   | 2023-05-31 10:00:09+00:00 | NULL                      | NULL       | NULL       | 2023-05-31 10:00:09+00:00
(77 rows)
> SELECT time_bucket(k_timestamp, '12min') as k_timestamp_b,
       hostname,
       firstts(usage_idle),
       first_row(usage_guest_nice),
       avg(usage_user),
       count(usage_softirq),
       count(usage_steal),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1600-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |          firstts          | first_row |     avg     | count | count |          last_ts
----------------------------+----------+---------------------------+-----------+-------------+-------+-------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_0   | 1800-05-31 10:00:00+00:00 |  3.141593 | -2147483648 |     1 |     1 | 1800-05-31 10:00:00+00:00
  1970-05-31 22:00:00+00:00 | host_0   | 1970-05-31 22:00:03+00:00 |        69 |          92 |     1 |     1 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_0   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:08+00:00
  2023-05-31 10:24:00+00:00 | host_0   | 2023-05-31 10:30:10+00:00 |        69 |          92 |     1 |     1 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_0   | 1800-05-31 10:00:00+00:00 |  3.141593 |  2147483647 |     1 |     1 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_0   | 1969-12-31 10:00:02+00:00 | NULL      |          21 |     1 |     1 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_0   | 1970-01-01 15:00:04+00:00 |        69 |          92 |     1 |     1 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_0   | 1970-02-01 10:00:04+00:00 |        69 |          92 |     1 |     1 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_0   | 1970-02-02 10:00:04+00:00 |        69 |          92 |     1 |     1 | 1970-02-02 10:00:04+00:00
  1800-05-31 10:00:00+00:00 | host_1   | 1800-05-31 10:00:00+00:00 |        74 |          84 |     1 |     1 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_1   | 1969-12-31 10:00:02+00:00 |        76 |          90 |     1 |     1 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_1   | 1970-01-01 15:00:04+00:00 | NULL      |          21 |     1 |     1 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_1   | 1970-02-01 10:00:04+00:00 | NULL      |          21 |     1 |     1 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_1   | 1970-02-02 10:00:04+00:00 | NULL      |          21 |     1 |     1 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_1   | 1970-05-31 22:00:03+00:00 | NULL      |          21 |     1 |     1 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_1   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:24:00+00:00 | host_1   | 2023-05-31 10:30:10+00:00 | NULL      |          21 |     1 |     1 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_2   | 1800-05-31 10:00:00+00:00 |         1 |          29 |     1 |     0 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_2   | 1969-12-31 10:00:02+00:00 |        38 |          58 |     1 |     1 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_2   | 1970-01-01 15:00:04+00:00 |        76 |          90 |     1 |     1 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_2   | 1970-02-01 10:00:04+00:00 |        76 |          90 |     1 |     1 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_2   | 1970-02-02 10:00:04+00:00 |        76 |          90 |     1 |     1 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_2   | 1970-05-31 22:00:03+00:00 |        76 |          90 |     1 |     1 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_2   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:24:00+00:00 | host_2   | 2023-05-31 10:30:10+00:00 |        76 |          90 |     1 |     1 | 2023-05-31 10:30:10+00:00
  1970-05-31 22:00:00+00:00 | host_3   | 1970-05-31 22:00:03+00:00 |        38 |          58 |     1 |     1 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:24:00+00:00 | host_3   | 2023-05-31 10:30:10+00:00 |        38 |          58 |     1 |     1 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_3   | 1800-05-31 10:00:00+00:00 |        82 |           8 |     1 |     1 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_3   | 1969-12-31 10:00:02+00:00 |        74 |          84 |     1 |     1 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_3   | 1970-01-01 15:00:04+00:00 |        38 |  2147483647 |     1 |     1 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_3   | 1970-02-01 10:00:04+00:00 |        38 |  2147483647 |     1 |     1 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_3   | 1970-02-02 10:00:04+00:00 |        38 |  2147483647 |     1 |     1 | 1970-02-02 10:00:04+00:00
  2023-05-31 10:00:00+00:00 | host_3   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:00+00:00 | host_3   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:08+00:00
  1800-05-31 10:00:00+00:00 | host_4   | 1800-05-31 10:00:00+00:00 |        54 |           2 |     1 |     1 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_4   | 1969-12-31 10:00:02+00:00 |         1 |          29 |     1 |     1 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_4   | 1970-01-01 15:00:04+00:00 |        74 |          84 |     1 |     1 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_4   | 1970-02-01 10:00:04+00:00 |        74 |          84 |     1 |     1 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_4   | 1970-02-02 10:00:04+00:00 |        74 |          84 |     1 |     1 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_4   | 1970-05-31 22:00:03+00:00 |        74 |          84 |     1 |     1 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_4   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:24:00+00:00 | host_4   | 2023-05-31 10:30:10+00:00 |        74 |          84 |     1 |     1 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_5   | 1800-05-31 10:00:00+00:00 |       -15 |         -76 |     1 |     1 | 1800-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  1969-12-31 10:00:00+00:00 | host_5   | 1969-12-31 10:00:02+00:00 |        82 |           8 |     1 |     1 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_5   | 1970-01-01 15:00:04+00:00 |         1 |          29 |     1 |     1 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_5   | 1970-02-01 10:00:04+00:00 |         1 |          29 |     1 |     1 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_5   | 1970-02-02 10:00:04+00:00 |         1 |          29 |     1 |     1 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_5   | 1970-05-31 22:00:03+00:00 |         1 |          29 |     1 |     1 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:08+00:00
  2023-05-31 10:24:00+00:00 | host_5   | 2023-05-31 10:30:10+00:00 |         1 |          29 |     1 |     1 | 2023-05-31 10:30:10+00:00
  1969-12-31 10:00:00+00:00 | host_6   | 1969-12-31 10:00:02+00:00 |        54 |           2 |     1 |     0 | 1969-12-31 10:00:02+00:00
  1800-05-31 10:00:00+00:00 | host_6   | 1800-05-31 10:00:00+00:00 |        31 |          44 |     1 |     1 | 1800-05-31 10:00:00+00:00
  1970-01-01 16:00:00+00:00 | host_6   | 1970-01-01 16:00:04+00:00 |        82 |           8 |     1 |     1 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_6   | 1970-02-01 10:00:04+00:00 |        82 |           8 |     1 |     1 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_6   | 1970-02-02 10:00:04+00:00 |        82 |           8 |     1 |     1 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_6   | 1970-05-31 22:00:03+00:00 |        82 |           8 |     1 |     1 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_6   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:24:00+00:00 | host_6   | 2023-05-31 10:30:10+00:00 |        82 |           8 |     1 |     1 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_7   | 1800-05-31 10:00:00+00:00 |        69 |          92 |     1 |     1 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_7   | 1969-12-31 10:00:02+00:00 |        15 |          76 |     1 |     1 | 1969-12-31 10:00:02+00:00
  1970-01-01 17:00:00+00:00 | host_7   | 1970-01-01 17:00:04+00:00 |        54 |           2 |     1 |     0 | 1970-01-01 17:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_7   | 1970-02-01 10:00:04+00:00 |        54 |           2 |     1 |     0 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_7   | 1970-02-02 10:00:04+00:00 |        54 |           2 |     1 |     0 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_7   | 1970-05-31 22:00:03+00:00 |        54 |           2 |     1 |     0 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_7   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  2023-05-31 10:24:00+00:00 | host_7   | 2023-05-31 10:30:10+00:00 |        54 |           2 |     1 |     0 | 2023-05-31 10:30:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_8   | 1800-05-31 10:00:00+00:00 | NULL      |          21 |     1 |     1 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_8   | 1969-12-31 10:00:02+00:00 |        31 |          44 |     1 |     1 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_8   | 1970-01-01 15:00:04+00:00 |        15 |          76 |     1 |     1 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_8   | 1970-02-01 10:00:04+00:00 |        15 |          76 |     1 |     1 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_8   | 1970-02-02 10:00:04+00:00 |        15 |          76 |     1 |     1 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_8   | 1970-05-31 22:00:03+00:00 |        15 |          76 |     1 |     1 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_8   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:08+00:00
  2023-05-31 10:24:00+00:00 | host_8   | 2023-05-31 10:30:10+00:00 |        15 |          76 |     1 |     1 | 2023-05-31 10:30:10+00:00
  2023-05-31 10:24:00+00:00 | host_9   | 2023-05-31 10:30:10+00:00 |        31 |          44 |     1 |     1 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_9   | 1800-05-31 10:00:00+00:00 |        76 |          90 |     1 |     1 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_9   | 1969-12-31 10:00:02+00:00 |        69 |          92 |     1 |     1 | 1969-12-31 10:00:02+00:00
  1970-01-01 16:00:00+00:00 | host_9   | 1970-01-01 16:00:04+00:00 |        31 |          44 |     1 |     1 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_9   | 1970-02-01 10:00:04+00:00 |        31 |          44 |     1 |     1 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_9   | 1970-02-02 10:00:04+00:00 |        31 |          44 |     1 |     1 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_9   | 1970-05-31 22:00:03+00:00 |        31 |          44 |     1 |     1 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_9   | NULL                      | NULL      |  2147483647 |     0 |     0 | 2023-05-31 10:00:09+00:00
(85 rows)
> SELECT time_bucket(k_timestamp, '2second') as k_timestamp_b,
       hostname,
       max(usage_nice), first (usage_system), avg (usage_idle), last (usage_irq), first (usage_irq),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1600-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |     max     |    first    |     avg     |  last  | first  |          last_ts
----------------------------+----------+-------------+-------------+-------------+--------+--------+----------------------------
  2023-05-31 10:00:08+00:00 | host_0   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_0   | -2147483648 | -2147483648 | -2147483648 | -32768 | -32768 | 1800-05-31 10:00:00+00:00
  1970-05-31 22:00:02+00:00 | host_0   |           9 |          35 |          99 |      1 |      1 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:08+00:00 | host_0   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:08+00:00
  2023-05-31 10:30:10+00:00 | host_0   |           9 |          35 |          99 |      1 |      1 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_0   | -2147483648 | -2147483648 | -2147483648 | -32768 | -32768 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:02+00:00 | host_0   |          83 |          77 |         -90 |     84 |     84 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:04+00:00 | host_0   |           9 |          35 |          99 |     -1 |     -1 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:04+00:00 | host_0   |           9 |          35 |          99 |     -1 |     -1 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:04+00:00 | host_0   |           9 |          35 |          99 |     -1 |     -1 | 1970-02-02 10:00:04+00:00
  1800-05-31 10:00:00+00:00 | host_1   |  2147483647 |  2147483647 | -2147483648 |     20 |     20 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:02+00:00 | host_1   |          28 |           0 |          81 |     44 |     44 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:04+00:00 | host_1   |          83 |          77 |          90 |     84 |     84 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:04+00:00 | host_1   |          83 |          77 |          90 |     84 |     84 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:04+00:00 | host_1   |          83 |          77 |          90 |     84 |     84 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:02+00:00 | host_1   |          83 |          77 |          90 |     84 |     84 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:08+00:00 | host_1   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:10+00:00 | host_1   |          83 |          77 |          90 |    -84 |    -84 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_2   |          63 |          48 |           5 |     52 |     52 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:02+00:00 | host_2   |          61 |          -2 |          24 |     63 |     63 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:04+00:00 | host_2   |          28 |           0 |          81 |     44 |     44 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:04+00:00 | host_2   |          28 |           0 |          81 |     44 |     44 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:04+00:00 | host_2   |          28 |           0 |          81 |     44 |     44 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:02+00:00 | host_2   |          28 |           0 |          81 |     44 |     44 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:08+00:00 | host_2   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:10+00:00 | host_2   |          28 |           0 |          81 |    -44 |    -44 | 2023-05-31 10:30:10+00:00
  1970-05-31 22:00:02+00:00 | host_3   |          61 |        NULL |          24 |     63 |     63 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:30:10+00:00 | host_3   |          61 |        NULL |          24 |     63 |     63 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_3   |          78 |          21 |         -89 |     81 |     81 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:02+00:00 | host_3   |          87 |          11 |          53 |     20 |     20 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:04+00:00 | host_3   |          61 |           2 |          24 |     63 |     63 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:04+00:00 | host_3   |          61 |           2 |          24 |     63 |     63 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:04+00:00 | host_3   |          61 |           2 |          24 |     63 |     63 | 1970-02-02 10:00:04+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:08+00:00 | host_3   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:08+00:00
  1800-05-31 10:00:00+00:00 | host_4   |           6 |          26 |          64 |     20 |     20 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:02+00:00 | host_4   |          63 |          48 |          -5 |     52 |     52 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:04+00:00 | host_4   |          87 |          11 |          53 |     20 |     20 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:04+00:00 | host_4   |          87 |          11 |          53 |     20 |     20 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:04+00:00 | host_4   |          87 |          11 |          53 |     20 |     20 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:02+00:00 | host_4   |          87 |          11 |          53 |     20 |     20 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:08+00:00 | host_4   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:10+00:00 | host_4   |          87 |          11 |          53 |     20 |     20 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_5   |          -7 |         -40 |         -63 |    -20 |    -20 | 1800-05-31 10:00:00+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  1969-12-31 10:00:02+00:00 | host_5   |         -78 |          21 |          89 |     81 |     81 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:04+00:00 | host_5   |         -63 |          48 |           5 |    -52 |    -52 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:04+00:00 | host_5   |         -63 |          48 |           5 |    -52 |    -52 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:04+00:00 | host_5   |         -63 |          48 |           5 |    -52 |    -52 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:02+00:00 | host_5   |          63 |          48 |           5 |     52 |     52 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:08+00:00 | host_5   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:08+00:00
  2023-05-31 10:30:10+00:00 | host_5   |         -63 |          48 |           5 |     52 |     52 | 2023-05-31 10:30:10+00:00
  1969-12-31 10:00:02+00:00 | host_6   |           6 |          26 |         -64 |     20 |     20 | 1969-12-31 10:00:02+00:00
  1800-05-31 10:00:00+00:00 | host_6   |         -67 |          70 |          20 |     11 |     11 | 1800-05-31 10:00:00+00:00
  1970-01-01 16:00:04+00:00 | host_6   |          78 |          21 |          89 |    -81 |    -81 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:04+00:00 | host_6   |          78 |          21 |          89 |    -81 |    -81 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:04+00:00 | host_6   |          78 |          21 |          89 |    -81 |    -81 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:02+00:00 | host_6   |          78 |          21 |          89 |     81 |     81 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:08+00:00 | host_6   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:10+00:00 | host_6   |         -78 |          21 |          89 |     81 |     81 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_7   |           9 |          35 |          99 |     -1 |     -1 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:02+00:00 | host_7   |           7 |          40 |          63 |     20 |     20 | 1969-12-31 10:00:02+00:00
  1970-01-01 17:00:04+00:00 | host_7   |           6 |          26 |         -64 |    -20 |    -20 | 1970-01-01 17:00:04+00:00
  1970-02-01 10:00:04+00:00 | host_7   |           6 |          26 |         -64 |    -20 |    -20 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:04+00:00 | host_7   |           6 |          26 |         -64 |    -20 |    -20 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:02+00:00 | host_7   |           6 |          26 |          64 |    -20 |    -20 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:08+00:00 | host_7   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:10+00:00 | host_7   |           6 |          26 |          64 |    -20 |    -20 | 2023-05-31 10:30:10+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_8   |          83 |          77 |          90 |     84 |     84 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:02+00:00 | host_8   |          67 |          70 |          20 |     11 |     11 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:04+00:00 | host_8   |           7 |          40 |          63 |     20 |     20 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:04+00:00 | host_8   |           7 |          40 |          63 |     20 |     20 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:04+00:00 | host_8   |           7 |          40 |          63 |     20 |     20 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:02+00:00 | host_8   |           7 |          40 |          63 |     20 |     20 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:08+00:00 | host_8   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:08+00:00
  2023-05-31 10:30:10+00:00 | host_8   |           7 |          40 |         -63 |    -20 |    -20 | 2023-05-31 10:30:10+00:00
  2023-05-31 10:30:10+00:00 | host_9   |          67 |          70 |          20 |     11 |     11 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_9   |          28 |           0 |          81 |    -44 |    -44 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:02+00:00 | host_9   |          -9 |          35 |          99 |      1 |      1 | 1969-12-31 10:00:02+00:00
  1970-01-01 16:00:04+00:00 | host_9   |          67 |          70 |          20 |     11 |     11 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:04+00:00 | host_9   |          67 |          70 |          20 |     11 |     11 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:04+00:00 | host_9   |          67 |          70 |          20 |     11 |     11 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:02+00:00 | host_9   |          67 |          70 |          20 |     11 |     11 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:08+00:00 | host_9   | NULL        |        NULL | NULL        | NULL   | NULL   | 2023-05-31 10:00:09+00:00
(85 rows)
> SELECT time_bucket(k_timestamp, '20secs') as k_timestamp_b,
       hostname,
       max(usage_guest_nice),
       lastts(usage_idle),
       max(usage_guest),
       avg(usage_nice), first (usage_guest),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1600-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
        k_timestamp_b       | hostname |   max    |          lastts           |   max    |     avg     |  first   |          last_ts
----------------------------+----------+----------+---------------------------+----------+-------------+----------+----------------------------
  2023-05-31 10:00:00+00:00 | host_0   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_0   | 3.141593 | 1800-05-31 10:00:00+00:00 | 3.141593 | -2147483648 | 3.141593 | 1800-05-31 10:00:00+00:00
  1970-05-31 22:00:00+00:00 | host_0   |       69 | 1970-05-31 22:00:03+00:00 |       96 |           9 |       96 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_0   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:08+00:00
  2023-05-31 10:30:00+00:00 | host_0   |       69 | 2023-05-31 10:30:10+00:00 |       96 |           9 |       96 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_0   | 3.141593 | 1800-05-31 10:00:00+00:00 | 3.141593 | -2147483648 | 3.141593 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_0   | NULL     | 1969-12-31 10:00:02+00:00 |       43 |          83 |       43 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_0   |       69 | 1970-01-01 15:00:04+00:00 |       96 |           9 |       96 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_0   |       69 | 1970-02-01 10:00:04+00:00 |       96 |           9 |       96 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_0   |       69 | 1970-02-02 10:00:04+00:00 |       96 |           9 |       96 | 1970-02-02 10:00:04+00:00
  1800-05-31 10:00:00+00:00 | host_1   |       74 | 1800-05-31 10:00:00+00:00 |       53 |  2147483647 |       53 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_1   |       76 | 1969-12-31 10:00:02+00:00 |       11 |          28 |       11 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_1   | NULL     | 1970-01-01 15:00:04+00:00 |       43 |          83 |       43 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_1   | NULL     | 1970-02-01 10:00:04+00:00 |       43 |          83 |       43 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_1   | NULL     | 1970-02-02 10:00:04+00:00 |       43 |          83 |       43 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_1   | NULL     | 1970-05-31 22:00:03+00:00 |       43 |          83 |       43 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_1   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_1   | NULL     | 2023-05-31 10:30:10+00:00 |       43 |          83 |       43 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_2   |        1 | 1800-05-31 10:00:00+00:00 |       93 |          63 |       93 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_2   |       38 | 1969-12-31 10:00:02+00:00 | NULL     |          61 | NULL     | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_2   |       76 | 1970-01-01 15:00:04+00:00 |       11 |          28 |       11 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_2   |       76 | 1970-02-01 10:00:04+00:00 |       11 |          28 |       11 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_2   |       76 | 1970-02-02 10:00:04+00:00 |       11 |          28 |       11 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_2   |       76 | 1970-05-31 22:00:03+00:00 |       11 |          28 |       11 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_2   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_2   |       76 | 2023-05-31 10:30:10+00:00 |       11 |          28 |       11 | 2023-05-31 10:30:10+00:00
  1970-05-31 22:00:00+00:00 | host_3   |       38 | 1970-05-31 22:00:03+00:00 | NULL     |          61 | NULL     | 1970-05-31 22:00:03+00:00
  2023-05-31 10:30:00+00:00 | host_3   |       38 | 2023-05-31 10:30:10+00:00 | NULL     |          61 | NULL     | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_3   |       82 | 1800-05-31 10:00:00+00:00 |       24 |          78 |       24 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_3   |       74 | 1969-12-31 10:00:02+00:00 |       53 |          87 |       53 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_3   |       38 | 1970-01-01 15:00:04+00:00 | NULL     |          61 | NULL     | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_3   |       38 | 1970-02-01 10:00:04+00:00 | NULL     |          61 | NULL     | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_3   |       38 | 1970-02-02 10:00:04+00:00 | NULL     |          61 | NULL     | 1970-02-02 10:00:04+00:00
  2023-05-31 10:00:00+00:00 | host_3   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:00:00+00:00 | host_3   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:08+00:00
  1800-05-31 10:00:00+00:00 | host_4   |       54 | 1800-05-31 10:00:00+00:00 |       40 |           6 |       40 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_4   |        1 | 1969-12-31 10:00:02+00:00 |       93 |          63 |       93 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_4   |       74 | 1970-01-01 15:00:04+00:00 |       53 |          87 |       53 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_4   |       74 | 1970-02-01 10:00:04+00:00 |       53 |          87 |       53 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_4   |       74 | 1970-02-02 10:00:04+00:00 |       53 |          87 |       53 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_4   |       74 | 1970-05-31 22:00:03+00:00 |       53 |          87 |       53 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_4   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_4   |       74 | 2023-05-31 10:30:10+00:00 |       53 |          87 |       53 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_5   |      -15 | 1800-05-31 10:00:00+00:00 | NULL     |          -7 | NULL     | 1800-05-31 10:00:00+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  1969-12-31 10:00:00+00:00 | host_5   |       82 | 1969-12-31 10:00:02+00:00 |       24 |         -78 |       24 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_5   |        1 | 1970-01-01 15:00:04+00:00 |       93 |         -63 |       93 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_5   |        1 | 1970-02-01 10:00:04+00:00 |       93 |         -63 |       93 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_5   |        1 | 1970-02-02 10:00:04+00:00 |       93 |         -63 |       93 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_5   |        1 | 1970-05-31 22:00:03+00:00 |       93 |          63 |       93 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_5   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:08+00:00
  2023-05-31 10:30:00+00:00 | host_5   |        1 | 2023-05-31 10:30:10+00:00 |       93 |         -63 |       93 | 2023-05-31 10:30:10+00:00
  1969-12-31 10:00:00+00:00 | host_6   |       54 | 1969-12-31 10:00:02+00:00 |       40 |           6 |       40 | 1969-12-31 10:00:02+00:00
  1800-05-31 10:00:00+00:00 | host_6   |       31 | 1800-05-31 10:00:00+00:00 |        0 |         -67 |        0 | 1800-05-31 10:00:00+00:00
  1970-01-01 16:00:00+00:00 | host_6   |       82 | 1970-01-01 16:00:04+00:00 |       24 |          78 |       24 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_6   |       82 | 1970-02-01 10:00:04+00:00 |       24 |          78 |       24 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_6   |       82 | 1970-02-02 10:00:04+00:00 |       24 |          78 |       24 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_6   |       82 | 1970-05-31 22:00:03+00:00 |       24 |          78 |       24 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_6   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_6   |       82 | 2023-05-31 10:30:10+00:00 |       24 |         -78 |       24 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_7   |       69 | 1800-05-31 10:00:00+00:00 |       96 |           9 |       96 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_7   |       15 | 1969-12-31 10:00:02+00:00 |       20 |           7 |       20 | 1969-12-31 10:00:02+00:00
  1970-01-01 17:00:00+00:00 | host_7   |       54 | 1970-01-01 17:00:04+00:00 |       40 |           6 |       40 | 1970-01-01 17:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_7   |       54 | 1970-02-01 10:00:04+00:00 |       40 |           6 |       40 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_7   |       54 | 1970-02-02 10:00:04+00:00 |       40 |           6 |       40 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_7   |       54 | 1970-05-31 22:00:03+00:00 |       40 |           6 |       40 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_7   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  2023-05-31 10:30:00+00:00 | host_7   |       54 | 2023-05-31 10:30:10+00:00 |      -40 |           6 |      -40 | 2023-05-31 10:30:10+00:00
  2023-05-31 10:00:00+00:00 | host_8   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
  1800-05-31 10:00:00+00:00 | host_8   | NULL     | 1800-05-31 10:00:00+00:00 |       43 |          83 |       43 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_8   |       31 | 1969-12-31 10:00:02+00:00 |        0 |          67 |        0 | 1969-12-31 10:00:02+00:00
  1970-01-01 15:00:00+00:00 | host_8   |       15 | 1970-01-01 15:00:04+00:00 |       20 |           7 |       20 | 1970-01-01 15:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_8   |       15 | 1970-02-01 10:00:04+00:00 |       20 |           7 |       20 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_8   |       15 | 1970-02-02 10:00:04+00:00 |       20 |           7 |       20 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_8   |       15 | 1970-05-31 22:00:03+00:00 |       20 |           7 |       20 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_8   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:08+00:00
  2023-05-31 10:30:00+00:00 | host_8   |       15 | 2023-05-31 10:30:10+00:00 |       20 |           7 |       20 | 2023-05-31 10:30:10+00:00
  2023-05-31 10:30:00+00:00 | host_9   |       31 | 2023-05-31 10:30:10+00:00 |        0 |          67 |        0 | 2023-05-31 10:30:10+00:00
  1800-05-31 10:00:00+00:00 | host_9   |       76 | 1800-05-31 10:00:00+00:00 |       11 |          28 |       11 | 1800-05-31 10:00:00+00:00
  1969-12-31 10:00:00+00:00 | host_9   |       69 | 1969-12-31 10:00:02+00:00 |       96 |          -9 |       96 | 1969-12-31 10:00:02+00:00
  1970-01-01 16:00:00+00:00 | host_9   |       31 | 1970-01-01 16:00:04+00:00 |        0 |          67 |        0 | 1970-01-01 16:00:04+00:00
  1970-02-01 10:00:00+00:00 | host_9   |       31 | 1970-02-01 10:00:04+00:00 |        0 |          67 |        0 | 1970-02-01 10:00:04+00:00
  1970-02-02 10:00:00+00:00 | host_9   |       31 | 1970-02-02 10:00:04+00:00 |        0 |          67 |        0 | 1970-02-02 10:00:04+00:00
  1970-05-31 22:00:00+00:00 | host_9   |       31 | 1970-05-31 22:00:03+00:00 |        0 |          67 |        0 | 1970-05-31 22:00:03+00:00
  2023-05-31 10:00:00+00:00 | host_9   | NULL     | NULL                      | NULL     | NULL        | NULL     | 2023-05-31 10:00:09+00:00
(85 rows)
> SELECT time_bucket(k_timestamp, '2ec') as k_timestamp_b,
       hostname,
       min(usage_guest_nice),
       max(usage_softirq),
       lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1600-01-01 00:00:00'
  AND k_timestamp < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
ERROR: interval: invalid input syntax: 2ec.
SQLSTATE: 22007
> SELECT count(usage_irq),
       time_bucket(k_timestamp, '-10s') as k_timestamp_b,
       hostname,
       avg(usage_softirq),
       first_row(usage_softirq),
       first_row(usage_nice), last (usage_iowait),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1600-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
ERROR: second arg should be a positive interval.
SQLSTATE: 22023
> SELECT count(usage_irq),
       time_bucket(k_timestamp, '1.5hour') as k_timestamp_b,
       hostname,
       avg(usage_softirq),
       first_row(usage_softirq),
       first_row(usage_nice), last (usage_iowait),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1600-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
ERROR: invalid input interval time for time_bucket or time_bucket_gapfill.
SQLSTATE: 22023
> SELECT count(usage_irq),
       time_bucket(k_timestamp, '2xiaoshi') as k_timestamp_b,
       hostname,
       avg(usage_softirq),
       first_row(usage_softirq),
       first_row(usage_nice), last (usage_iowait),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1600-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
ERROR: interval: invalid input syntax: 2xiaoshi.
SQLSTATE: 22007
> SELECT count(usage_irq),
       time_bucket(k_timestamp, '10YEARS') as k_timestamp_b,
       hostname,
       avg(usage_softirq),
       first_row(usage_softirq),
       first_row(usage_nice), last (usage_iowait),
    lastts(usage_user)            as last_ts
FROM test.cpu
WHERE k_timestamp >= '1600-01-01 00:00:00'
  AND k_timestamp
    < '2024-01-01 00:00:00'
GROUP BY hostname, region, rack, k_timestamp_b
ORDER BY hostname, region, rack, k_timestamp_b, last_ts;
  count |       k_timestamp_b       | hostname |    avg     | first_row  |  first_row  |  last  |          last_ts
--------+---------------------------+----------+------------+------------+-------------+--------+----------------------------
      0 | 2021-01-01 00:00:00+00:00 | host_0   | NULL       | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      1 | 1791-01-01 00:00:00+00:00 | host_0   |  54.122111 |  54.122111 | -2147483648 | -32768 | 1800-05-31 10:00:00+00:00
      1 | 1961-01-01 00:00:00+00:00 | host_0   |          2 |          2 |           9 |     31 | 1970-05-31 22:00:03+00:00
      1 | 2021-01-01 00:00:00+00:00 | host_0   |          2 | NULL       | NULL        |    -31 | 2023-05-31 10:30:10+00:00
      1 | 1791-01-01 00:00:00+00:00 | host_0   |  54.122111 |  54.122111 | -2147483648 | -32768 | 1800-05-31 10:00:00+00:00
      4 | 1961-01-01 00:00:00+00:00 | host_0   |          8 |         26 |          83 |     31 | 1970-02-02 10:00:04+00:00
      1 | 1791-01-01 00:00:00+00:00 | host_1   | -54.122111 | -54.122111 |  2147483647 |     29 | 1800-05-31 10:00:00+00:00
      5 | 1961-01-01 00:00:00+00:00 | host_1   |       22.4 |          8 |          28 |     41 | 1970-05-31 22:00:03+00:00
      1 | 2021-01-01 00:00:00+00:00 | host_1   |         26 | NULL       | NULL        |     41 | 2023-05-31 10:30:10+00:00
      1 | 1791-01-01 00:00:00+00:00 | host_2   |         60 |         60 |          63 |    -17 | 1800-05-31 10:00:00+00:00
      1 | 1961-01-01 00:00:00+00:00 | host_2   |          6 |          6 |          61 |     22 | 1969-12-31 10:00:02+00:00
      4 | 1961-01-01 00:00:00+00:00 | host_2   |          8 |          8 |          28 |     25 | 1970-05-31 22:00:03+00:00
      1 | 2021-01-01 00:00:00+00:00 | host_2   |          8 | NULL       | NULL        |     25 | 2023-05-31 10:30:10+00:00
      1 | 1961-01-01 00:00:00+00:00 | host_3   |          6 |          6 |          61 |     22 | 1970-05-31 22:00:03+00:00
      1 | 2021-01-01 00:00:00+00:00 | host_3   |          6 |          6 |          61 |     22 | 2023-05-31 10:30:10+00:00
      1 | 1791-01-01 00:00:00+00:00 | host_3   |         33 |         33 |          78 |     30 | 1800-05-31 10:00:00+00:00
      4 | 1961-01-01 00:00:00+00:00 | host_3   |         18 |         54 |          87 |     22 | 1970-02-02 10:00:04+00:00
      0 | 2021-01-01 00:00:00+00:00 | host_3   | NULL       | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      0 | 2021-01-01 00:00:00+00:00 | host_3   | NULL       | NULL       | NULL        | NULL   | 2023-05-31 10:00:08+00:00
      1 | 1791-01-01 00:00:00+00:00 | host_4   |        -71 |        -71 |           6 |     38 | 1800-05-31 10:00:00+00:00
      5 | 1961-01-01 00:00:00+00:00 | host_4   |       55.2 |         60 |          63 |     29 | 1970-05-31 22:00:03+00:00
      1 | 2021-01-01 00:00:00+00:00 | host_4   |         54 | NULL       | NULL        |     29 | 2023-05-31 10:30:10+00:00
      1 | 1791-01-01 00:00:00+00:00 | host_5   |        -29 |        -29 |          -7 |    -81 | 1800-05-31 10:00:00+00:00
      0 | 2021-01-01 00:00:00+00:00 | host_5   | NULL       | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      5 | 1961-01-01 00:00:00+00:00 | host_5   |       54.6 |         33 |         -78 |     17 | 1970-05-31 22:00:03+00:00
      1 | 2021-01-01 00:00:00+00:00 | host_5   |         60 | NULL       | NULL        |     17 | 2023-05-31 10:30:10+00:00
      1 | 1961-01-01 00:00:00+00:00 | host_6   |         71 |         71 |           6 |    -38 | 1969-12-31 10:00:02+00:00
      1 | 1791-01-01 00:00:00+00:00 | host_6   |          7 |          7 |         -67 |     65 | 1800-05-31 10:00:00+00:00
      4 | 1961-01-01 00:00:00+00:00 | host_6   |         33 |         33 |          78 |     30 | 1970-05-31 22:00:03+00:00
      1 | 2021-01-01 00:00:00+00:00 | host_6   |         33 | NULL       | NULL        |     30 | 2023-05-31 10:30:10+00:00
      1 | 1791-01-01 00:00:00+00:00 | host_7   |          2 |          2 |           9 |     31 | 1800-05-31 10:00:00+00:00
      5 | 1961-01-01 00:00:00+00:00 | host_7   |       62.6 |         29 |           7 |     38 | 1970-05-31 22:00:03+00:00
      1 | 2021-01-01 00:00:00+00:00 | host_7   |         71 | NULL       | NULL        |     38 | 2023-05-31 10:30:10+00:00
      0 | 2021-01-01 00:00:00+00:00 | host_8   | NULL       | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
      1 | 1791-01-01 00:00:00+00:00 | host_8   |         26 |         26 |          83 |     41 | 1800-05-31 10:00:00+00:00
      5 | 1961-01-01 00:00:00+00:00 | host_8   |       24.6 |          7 |          67 |     81 | 1970-05-31 22:00:03+00:00
      1 | 2021-01-01 00:00:00+00:00 | host_8   |         29 | NULL       | NULL        |     81 | 2023-05-31 10:30:10+00:00
      1 | 2021-01-01 00:00:00+00:00 | host_9   |          7 |          7 |          67 |     65 | 2023-05-31 10:30:10+00:00
      1 | 1791-01-01 00:00:00+00:00 | host_9   |          8 |          8 |          28 |     25 | 1800-05-31 10:00:00+00:00
      5 | 1961-01-01 00:00:00+00:00 | host_9   |        2.4 |         -2 |          -9 |     65 | 1970-05-31 22:00:03+00:00
      0 | 2021-01-01 00:00:00+00:00 | host_9   | NULL       | NULL       | NULL        | NULL   | 2023-05-31 10:00:09+00:00
(41 rows)
> drop database test cascade;
DROP DATABASE
